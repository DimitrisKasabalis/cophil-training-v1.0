<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stylianos Kotsopoulos">
<meta name="dcterms.date" content="2025-10-16">

<title>Session 2: LSTM Drought Monitoring Lab – CoPhil EO AI/ML Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../day4/sessions/session3.html" rel="next">
<link href="../../day4/sessions/session1.html" rel="prev">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c9822816d3895e59fda95a6fa7545fef.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-4a074efccdeff27617fbc72d37c1244e.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c9822816d3895e59fda95a6fa7545fef.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3775014fae9fc394bbda1d6ff89dd45e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-a15f5dce5650fb3fe5aba34e3b6df9a9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-3775014fae9fc394bbda1d6ff89dd45e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../styles/custom.css">
<link rel="stylesheet" href="../../styles/phase2-enhancements.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CoPhil EO AI/ML Training</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-training-days" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Training Days</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-training-days">    
        <li>
    <a class="dropdown-item" href="../../day1/index.html">
 <span class="dropdown-text">Day 1: EO Data &amp; Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day2/index.html">
 <span class="dropdown-text">Day 2: Machine Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day3/index.html">
 <span class="dropdown-text">Day 3: Deep Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day4/index.html">
 <span class="dropdown-text">Day 4: Advanced Topics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../resources/setup.html">
 <span class="dropdown-text">Setup Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/philippine-eo.html">
 <span class="dropdown-text">Philippine EO Links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/cheatsheets.html">
 <span class="dropdown-text">Cheat Sheets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/faq.html">
 <span class="dropdown-text">FAQ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cophil-training-v1.0"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/downloads.html"> <i class="bi bi-download" role="img">
</i> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day4/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day4/sessions/session2.html">Session 2: LSTM Drought Monitoring Lab</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 4: Time Series Analysis, Emerging Trends, and Sustainable Learning</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Sessions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/sessions/session1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 1: LSTMs for Earth Observation Time Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/sessions/session2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Session 2: LSTM Drought Monitoring Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/sessions/session3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 3: Emerging AI Trends in Earth Observation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/sessions/session4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 4: Synthesis, Q&amp;A, and Pathway to Continued Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/notebooks/day4_session1_lstm_demo_STUDENT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 4, Session 1: LSTMs for Earth Observation Time Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day4/notebooks/day4_session2_lstm_drought_lab_STUDENT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 4, Session 2: LSTM Drought Monitoring Lab</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On This Page</h2>
   
  <ul>
  <li><a href="#session-2-lstm-drought-monitoring-lab" id="toc-session-2-lstm-drought-monitoring-lab" class="nav-link active" data-scroll-target="#session-2-lstm-drought-monitoring-lab">Session 2: LSTM Drought Monitoring Lab</a>
  <ul class="collapse">
  <li><a href="#hands-on-implementation-of-lstm-time-series-forecasting-for-mindanao" id="toc-hands-on-implementation-of-lstm-time-series-forecasting-for-mindanao" class="nav-link" data-scroll-target="#hands-on-implementation-of-lstm-time-series-forecasting-for-mindanao">Hands-on Implementation of LSTM Time Series Forecasting for Mindanao</a></li>
  </ul></li>
  <li><a href="#session-overview" id="toc-session-overview" class="nav-link" data-scroll-target="#session-overview">Session Overview</a></li>
  <li><a href="#presentation-slides" id="toc-presentation-slides" class="nav-link" data-scroll-target="#presentation-slides">Presentation Slides</a></li>
  <li><a href="#session-details" id="toc-session-details" class="nav-link" data-scroll-target="#session-details">Session Details</a></li>
  <li><a href="#case-study-mindanao-drought-monitoring" id="toc-case-study-mindanao-drought-monitoring" class="nav-link" data-scroll-target="#case-study-mindanao-drought-monitoring">Case Study: Mindanao Drought Monitoring</a>
  <ul class="collapse">
  <li><a href="#why-mindanao" id="toc-why-mindanao" class="nav-link" data-scroll-target="#why-mindanao">Why Mindanao?</a></li>
  <li><a href="#study-area-specifications" id="toc-study-area-specifications" class="nav-link" data-scroll-target="#study-area-specifications">Study Area Specifications</a></li>
  </ul></li>
  <li><a href="#lab-workflow" id="toc-lab-workflow" class="nav-link" data-scroll-target="#lab-workflow">Lab Workflow</a>
  <ul class="collapse">
  <li><a href="#part-1-setup-and-data-loading-20-minutes" id="toc-part-1-setup-and-data-loading-20-minutes" class="nav-link" data-scroll-target="#part-1-setup-and-data-loading-20-minutes">Part 1: Setup and Data Loading (20 minutes)</a></li>
  <li><a href="#part-2-exploratory-data-analysis-25-minutes" id="toc-part-2-exploratory-data-analysis-25-minutes" class="nav-link" data-scroll-target="#part-2-exploratory-data-analysis-25-minutes">Part 2: Exploratory Data Analysis (25 minutes)</a></li>
  <li><a href="#part-3-sequence-creation-30-minutes" id="toc-part-3-sequence-creation-30-minutes" class="nav-link" data-scroll-target="#part-3-sequence-creation-30-minutes">Part 3: Sequence Creation (30 minutes)</a></li>
  <li><a href="#part-4-lstm-model-building-30-minutes" id="toc-part-4-lstm-model-building-30-minutes" class="nav-link" data-scroll-target="#part-4-lstm-model-building-30-minutes">Part 4: LSTM Model Building (30 minutes)</a></li>
  <li><a href="#part-5-model-training-20-minutes" id="toc-part-5-model-training-20-minutes" class="nav-link" data-scroll-target="#part-5-model-training-20-minutes">Part 5: Model Training (20 minutes)</a></li>
  <li><a href="#part-6-model-evaluation-30-minutes" id="toc-part-6-model-evaluation-30-minutes" class="nav-link" data-scroll-target="#part-6-model-evaluation-30-minutes">Part 6: Model Evaluation (30 minutes)</a></li>
  <li><a href="#part-7-multi-step-forecasting-15-minutes" id="toc-part-7-multi-step-forecasting-15-minutes" class="nav-link" data-scroll-target="#part-7-multi-step-forecasting-15-minutes">Part 7: Multi-Step Forecasting (15 minutes)</a></li>
  <li><a href="#part-8-operational-deployment-considerations-10-minutes" id="toc-part-8-operational-deployment-considerations-10-minutes" class="nav-link" data-scroll-target="#part-8-operational-deployment-considerations-10-minutes">Part 8: Operational Deployment Considerations (10 minutes)</a></li>
  </ul></li>
  <li><a href="#troubleshooting-guide" id="toc-troubleshooting-guide" class="nav-link" data-scroll-target="#troubleshooting-guide">Troubleshooting Guide</a>
  <ul class="collapse">
  <li><a href="#common-issues-and-solutions" id="toc-common-issues-and-solutions" class="nav-link" data-scroll-target="#common-issues-and-solutions">Common Issues and Solutions</a></li>
  </ul></li>
  <li><a href="#extensions-and-advanced-topics" id="toc-extensions-and-advanced-topics" class="nav-link" data-scroll-target="#extensions-and-advanced-topics">Extensions and Advanced Topics</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a>
  <ul class="collapse">
  <li><a href="#code-and-data" id="toc-code-and-data" class="nav-link" data-scroll-target="#code-and-data">Code and Data</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further Reading</a></li>
  <li><a href="#philippine-eo-platforms" id="toc-philippine-eo-platforms" class="nav-link" data-scroll-target="#philippine-eo-platforms">Philippine EO Platforms</a></li>
  </ul></li>
  <li><a href="#session-feedback" id="toc-session-feedback" class="nav-link" data-scroll-target="#session-feedback">Session Feedback</a></li>
  <li><a href="#preparation-for-session-3" id="toc-preparation-for-session-3" class="nav-link" data-scroll-target="#preparation-for-session-3">Preparation for Session 3</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day4/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day4/sessions/session2.html">Session 2: LSTM Drought Monitoring Lab</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Session 2: LSTM Drought Monitoring Lab</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Hands-on Implementation of LSTM Time Series Forecasting for Mindanao</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Instructor</div>
    <div class="quarto-title-meta-contents">
             <p>Stylianos Kotsopoulos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<nav class="breadcrumb" aria-label="Breadcrumb">
<a href="../../index.html">Home</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <a href="../index.html">Day 4</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <span class="breadcrumb-current">Session 2</span>
</nav>
<section id="session-2-lstm-drought-monitoring-lab" class="level1 hero">
<h1>Session 2: LSTM Drought Monitoring Lab</h1>
<section id="hands-on-implementation-of-lstm-time-series-forecasting-for-mindanao" class="level3">
<h3 class="anchored" data-anchor-id="hands-on-implementation-of-lstm-time-series-forecasting-for-mindanao">Hands-on Implementation of LSTM Time Series Forecasting for Mindanao</h3>
<p>Build an operational LSTM model to predict drought conditions 1-3 months ahead using real Sentinel-2 data</p>
</section>
</section>
<section id="session-overview" class="level2">
<h2 class="anchored" data-anchor-id="session-overview">Session Overview</h2>
<p>This intensive 2.5-hour hands-on lab puts LSTM theory into practice. You’ll build a complete drought forecasting system for Mindanao provinces (Bukidnon and South Cotabato) using multi-year Sentinel-2 NDVI time series, weather data, and climate indices. By the end, you’ll have a trained model capable of predicting vegetation stress months in advance.</p>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this session, you will be able to:</p>
<ol type="1">
<li><strong>Acquire and preprocess</strong> multi-year Sentinel-2 NDVI time series for a study area</li>
<li><strong>Create training sequences</strong> using sliding window approach for time series forecasting</li>
<li><strong>Build LSTM models</strong> using TensorFlow/Keras with appropriate architecture</li>
<li><strong>Train and validate</strong> models with proper temporal data splitting</li>
<li><strong>Evaluate forecast accuracy</strong> using RMSE, MAE, and visual diagnostics</li>
<li><strong>Interpret predictions</strong> in the context of drought monitoring</li>
<li><strong>Deploy</strong> models for operational early warning systems</li>
</ol>
</div>
</div>
</section>
<section id="presentation-slides" class="level2">
<h2 class="anchored" data-anchor-id="presentation-slides">Presentation Slides</h2>
<iframe src="../presentations/session2_drought_lab.html" width="100%" height="600" style="border: 1px solid #ccc; border-radius: 4px;">
</iframe>
<hr>
</section>
<section id="session-details" class="level2">
<h2 class="anchored" data-anchor-id="session-details">Session Details</h2>
<div class="session-info">
<p><strong>Duration:</strong> 2.5 hours (150 minutes) | <strong>Format:</strong> Hands-on Lab | <strong>Difficulty:</strong> Intermediate to Advanced</p>
<p><strong>Prerequisites:</strong> - Completion of Session 1 (LSTM theory) - Python programming experience - Understanding of time series concepts - Familiarity with TensorFlow/Keras basics - Google Earth Engine account (optional, data provided)</p>
<p><strong>What You’ll Build:</strong> - Multi-input LSTM drought forecasting model - Training pipeline with temporal cross-validation - Evaluation framework with visualization - Operational deployment considerations</p>
<p><strong>Materials Provided:</strong> - 📓 Interactive Jupyter notebooks (student + instructor versions) - 📊 Synthetic Mindanao drought data (generated in notebook) - 💻 Complete working code for LSTM model - 📈 Visualization and evaluation tools</p>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>🚀 Get Started with the Lab
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a hands-on session - you’ll build a complete LSTM drought forecasting system from scratch!</p>
<p><strong>Download the notebook:</strong> - 📓 <a href="../../day4/notebooks/day4_session2_lstm_drought_lab_STUDENT.html">Student Version</a> - Guided exercises with TODO sections - 📓 <a href="../../day4/notebooks/day4_session2_lstm_drought_lab_INSTRUCTOR.html">Instructor Solution</a> - Complete working code</p>
<p><strong>What you’ll build:</strong> - Multi-variate LSTM model (NDVI, rainfall, temperature, ONI) - Training pipeline with temporal validation - Drought prediction system with 1-month lead time - Operational deployment framework</p>
<p><strong>Requirements:</strong> - Python 3.8+ - TensorFlow 2.x (GPU recommended but not required) - Google Colab account (or local Jupyter)</p>
<p>Open the notebook now and follow along!</p>
</div>
</div>
<hr>
</section>
<section id="case-study-mindanao-drought-monitoring" class="level2">
<h2 class="anchored" data-anchor-id="case-study-mindanao-drought-monitoring">Case Study: Mindanao Drought Monitoring</h2>
<section id="why-mindanao" class="level3">
<h3 class="anchored" data-anchor-id="why-mindanao">Why Mindanao?</h3>
<p><strong>Bukidnon and South Cotabato</strong> are critical agricultural provinces in Mindanao producing: - Corn (major crop) - Rice - Coffee - Pineapple - Vegetables - Livestock</p>
<p><strong>Climate Challenges:</strong> - Pronounced dry season (November-April) - Strong El Niño impacts (reduced rainfall, delayed planting) - Inter-annual variability in monsoon intensity - Increasing climate change pressures</p>
<p><strong>2015-2016 El Niño Impact:</strong> - Severe drought affecting 2.5 million people in Mindanao - Crop losses estimated at billions of pesos - Water shortages in urban and rural areas - Increased food insecurity</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Climate Change Adaptation (CCA) Context
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Department of Agriculture (DA) and PAGASA need <strong>3-month lead time</strong> for effective drought response: - Adjust planting calendars - Activate irrigation systems - Distribute drought-resistant seed varieties - Pre-position crop insurance programs - Issue agricultural advisories to farmers</p>
<p>LSTM-based early warning systems can provide this critical lead time.</p>
</div>
</div>
</section>
<section id="study-area-specifications" class="level3">
<h3 class="anchored" data-anchor-id="study-area-specifications">Study Area Specifications</h3>
<p><strong>Geographic Extent:</strong> - <strong>Bukidnon Province:</strong> 10,498 km² - <strong>South Cotabato Province:</strong> 3,935 km² - <strong>Total Area:</strong> ~14,433 km²</p>
<p><strong>Land Use:</strong> - Agricultural land: ~60% - Forest cover: ~30% - Urban/built-up: ~5% - Other: ~5%</p>
<p><strong>Elevation Range:</strong> - Lowlands: 0-500m - Highlands: 500-2,000m (Bukidnon plateau)</p>
<p><strong>Data Coverage:</strong> - Sentinel-2 tiles: 51PVT, 51PWT, 51PWS - Temporal coverage: 2015-2021 (7 years) - Temporal resolution: 10-day NDVI composites (cloud-masked)</p>
<hr>
</section>
</section>
<section id="lab-workflow" class="level2">
<h2 class="anchored" data-anchor-id="lab-workflow">Lab Workflow</h2>
<section id="part-1-setup-and-data-loading-20-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-1-setup-and-data-loading-20-minutes">Part 1: Setup and Data Loading (20 minutes)</h3>
<section id="environment-setup" class="level4">
<h4 class="anchored" data-anchor-id="environment-setup">1.1 Environment Setup</h4>
<p><strong>Import Libraries:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Geospatial</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler, StandardScaler</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep Learning</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> LSTM, Dense, Dropout</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping, ModelCheckpoint, ReduceLROnPlateau</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.dates <span class="im">import</span> DateFormatter</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seeds for reproducibility</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(<span class="dv">42</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Check TensorFlow Setup:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check TensorFlow version</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TensorFlow version: </span><span class="sc">{</span>tf<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check GPU availability</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"GPU available: </span><span class="sc">{</span>tf<span class="sc">.</span>config<span class="sc">.</span>list_physical_devices(<span class="st">'GPU'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Built with CUDA: </span><span class="sc">{</span>tf<span class="sc">.</span>test<span class="sc">.</span>is_built_with_cuda()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Recommended:</strong> Use GPU if available for faster training. Google Colab provides free GPU access.</p>
</section>
<section id="load-pre-processed-data" class="level4">
<h4 class="anchored" data-anchor-id="load-pre-processed-data">1.2 Load Pre-processed Data</h4>
<p><strong>Option A: Use Provided Dataset (Recommended for Lab)</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load pre-processed NDVI time series</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Shape: (n_pixels, n_timesteps) or aggregated to region average</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ndvi_data <span class="op">=</span> pd.read_csv(<span class="st">'data/mindanao_ndvi_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>rainfall_data <span class="op">=</span> pd.read_csv(<span class="st">'data/pagasa_rainfall_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>temperature_data <span class="op">=</span> pd.read_csv(<span class="st">'data/pagasa_temperature_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>oni_data <span class="op">=</span> pd.read_csv(<span class="st">'data/oni_index_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display data structure</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ndvi_data.head())</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI data shape: </span><span class="sc">{</span>ndvi_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>ndvi_data[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>ndvi_data[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Option B: Download from Google Earth Engine (Optional)</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ee.Initialize()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define study area (Bukidnon + South Cotabato)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>aoi <span class="op">=</span> ee.FeatureCollection(<span class="st">'FAO/GAUL/2015/level1'</span>) <span class="op">\</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.inList(<span class="st">'ADM1_NAME'</span>, [<span class="st">'Bukidnon'</span>, <span class="st">'South Cotabato'</span>]))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Sentinel-2 collection</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">'COPERNICUS/S2_SR_HARMONIZED'</span>) <span class="op">\</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    .filterBounds(aoi) <span class="op">\</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    .filterDate(<span class="st">'2015-06-23'</span>, <span class="st">'2021-12-31'</span>) <span class="op">\</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">'CLOUDY_PIXEL_PERCENTAGE'</span>, <span class="dv">30</span>))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute NDVI</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_ndvi(image):</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">'B8'</span>, <span class="st">'B4'</span>]).rename(<span class="st">'NDVI'</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image.addBands(ndvi)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply NDVI calculation</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>s2_ndvi <span class="op">=</span> s2.<span class="bu">map</span>(add_ndvi)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10-day composites</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_composite(start_date):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> start_date.advance(<span class="dv">10</span>, <span class="st">'day'</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    composite <span class="op">=</span> s2_ndvi.filterDate(start_date, end_date).median()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> composite.<span class="bu">set</span>(<span class="st">'system:time_start'</span>, start_date.millis())</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate composite dates</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> ee.Date(<span class="st">'2015-06-23'</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> ee.List.sequence(<span class="dv">0</span>, <span class="dv">240</span>, <span class="dv">10</span>).<span class="bu">map</span>(<span class="kw">lambda</span> d: start_date.advance(d, <span class="st">'day'</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>composites <span class="op">=</span> ee.ImageCollection.fromImages(dates.<span class="bu">map</span>(create_composite))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract time series for AOI</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_ndvi(image):</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> image.select(<span class="st">'NDVI'</span>).reduceRegion(</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        reducer<span class="op">=</span>ee.Reducer.mean(),</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        geometry<span class="op">=</span>aoi.geometry(),</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        scale<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ee.Feature(<span class="va">None</span>, {</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: image.date().<span class="bu">format</span>(<span class="st">'YYYY-MM-dd'</span>),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ndvi'</span>: stats.get(<span class="st">'NDVI'</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>ndvi_timeseries <span class="op">=</span> composites.<span class="bu">map</span>(extract_ndvi)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Export or download results...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="merge-and-align-data" class="level4">
<h4 class="anchored" data-anchor-id="merge-and-align-data">1.3 Merge and Align Data</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all data sources on date</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> ndvi_data.merge(rainfall_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(temperature_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(oni_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle missing values (interpolate)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'date'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.interpolate(method<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.reset_index()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add temporal features</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.month</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.year</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'doy'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.dayofyear  <span class="co"># day of year for seasonality</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display merged data</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing values: </span><span class="sc">{</span>df<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Expected Data Columns:</strong> - <code>date</code>: Timestamp - <code>ndvi</code>: Mean NDVI value [0-1] - <code>rainfall</code>: Monthly rainfall (mm) - <code>temperature</code>: Monthly mean temperature (°C) - <code>oni</code>: Oceanic Niño Index (El Niño indicator) - <code>month</code>, <code>year</code>, <code>doy</code>: Temporal features</p>
<hr>
</section>
</section>
<section id="part-2-exploratory-data-analysis-25-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-2-exploratory-data-analysis-25-minutes">Part 2: Exploratory Data Analysis (25 minutes)</h3>
<section id="visualize-ndvi-time-series" class="level4">
<h4 class="anchored" data-anchor-id="visualize-ndvi-time-series">2.1 Visualize NDVI Time Series</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot full NDVI time series</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax.plot(df[<span class="st">'date'</span>], df[<span class="st">'ndvi'</span>], linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Mindanao NDVI Time Series (2015-2021)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NDVI'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight drought period (2015-2016 El Niño)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>drought_start <span class="op">=</span> pd.Timestamp(<span class="st">'2015-06-01'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>drought_end <span class="op">=</span> pd.Timestamp(<span class="st">'2016-06-01'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ax.axvspan(drought_start, drought_end, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'2015-16 El Niño Drought'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Observations:</strong> - Clear seasonal pattern (dry season dips) - 2015-2016 drought visible as prolonged low NDVI - Recovery in wet seasons</p>
</section>
<section id="seasonal-decomposition" class="level4">
<h4 class="anchored" data-anchor-id="seasonal-decomposition">2.2 Seasonal Decomposition</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to monthly frequency for decomposition</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>df_monthly <span class="op">=</span> df.set_index(<span class="st">'date'</span>).resample(<span class="st">'M'</span>).mean()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform seasonal decomposition</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>decomposition <span class="op">=</span> seasonal_decompose(df_monthly[<span class="st">'ndvi'</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot components</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">4</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>decomposition.observed.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">'Observed NDVI'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>decomposition.trend.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">'Trend'</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>decomposition.seasonal.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>], title<span class="op">=</span><span class="st">'Seasonal'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>decomposition.resid.plot(ax<span class="op">=</span>axes[<span class="dv">3</span>], title<span class="op">=</span><span class="st">'Residual'</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Interpretation:</strong> - <strong>Trend:</strong> Long-term changes (climate shifts, land use change) - <strong>Seasonal:</strong> Annual dry/wet cycle - <strong>Residual:</strong> Noise and anomalies (droughts, floods)</p>
</section>
<section id="correlation-analysis" class="level4">
<h4 class="anchored" data-anchor-id="correlation-analysis">2.3 Correlation Analysis</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> df[[<span class="st">'ndvi'</span>, <span class="st">'rainfall'</span>, <span class="st">'temperature'</span>, <span class="st">'oni'</span>]].corr()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="dv">1</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>})</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Correlation Matrix'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Expected Correlations:</strong> - NDVI vs.&nbsp;Rainfall: Positive (more rain → greener vegetation) - NDVI vs.&nbsp;Temperature: Weak or negative (heat stress) - NDVI vs.&nbsp;ONI: Negative (El Niño → drought → lower NDVI)</p>
</section>
<section id="lagged-correlations" class="level4">
<h4 class="anchored" data-anchor-id="lagged-correlations">2.4 Lagged Correlations</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute lagged correlations (rainfall effect with delay)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>lags <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">6</span>)  <span class="co"># 0-5 months lag</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>lagged_corr <span class="op">=</span> [df[<span class="st">'ndvi'</span>].corr(df[<span class="st">'rainfall'</span>].shift(lag)) <span class="cf">for</span> lag <span class="kw">in</span> lags]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plt.bar(lags, lagged_corr, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Lag (months)'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Correlation with NDVI'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Lagged Correlation: Rainfall → NDVI'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Insight:</strong> Rainfall typically affects NDVI with 1-2 month delay (vegetation growth response time)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 1: Data Exploration
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Tasks:</strong> 1. Identify the lowest NDVI period in the time series. Does it correspond to the 2015-2016 El Niño? 2. Calculate the mean NDVI for dry season (Nov-Apr) vs.&nbsp;wet season (May-Oct) 3. Plot NDVI vs.&nbsp;Rainfall as a scatter plot. Is the relationship linear? 4. What is the strongest predictor of NDVI based on correlation analysis?</p>
<p><strong>Time:</strong> 10 minutes</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-3-sequence-creation-30-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-3-sequence-creation-30-minutes">Part 3: Sequence Creation (30 minutes)</h3>
<section id="define-sequence-parameters" class="level4">
<h4 class="anchored" data-anchor-id="define-sequence-parameters">3.1 Define Sequence Parameters</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>LOOKBACK_WINDOW <span class="op">=</span> <span class="dv">12</span>  <span class="co"># Use 12 months of history</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>FORECAST_HORIZON <span class="op">=</span> <span class="dv">1</span>   <span class="co"># Predict 1 month ahead (can extend to 3 months)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Features to use</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>feature_columns <span class="op">=</span> [<span class="st">'ndvi'</span>, <span class="st">'rainfall'</span>, <span class="st">'temperature'</span>, <span class="st">'oni'</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'ndvi'</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalization</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>df_scaled <span class="op">=</span> df.copy()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df_scaled[feature_columns] <span class="op">=</span> scaler.fit_transform(df[feature_columns])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lookback window: </span><span class="sc">{</span>LOOKBACK_WINDOW<span class="sc">}</span><span class="ss"> months"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Forecast horizon: </span><span class="sc">{</span>FORECAST_HORIZON<span class="sc">}</span><span class="ss"> month(s)"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>feature_columns<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="create-training-sequences" class="level4">
<h4 class="anchored" data-anchor-id="create-training-sequences">3.2 Create Training Sequences</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_sequences(data, features, target, lookback, horizon):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Create input-output sequences for LSTM training.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">        data: DataFrame with features</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">        features: List of feature column names</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        target: Target column name</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">        lookback: Number of time steps to look back</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">        horizon: Number of time steps to forecast ahead</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">        X: Input sequences (samples, lookback, n_features)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">        y: Target values (samples,)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">        dates: Corresponding dates for sequences</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    X, y, dates <span class="op">=</span> [], [], []</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    feature_data <span class="op">=</span> data[features].values</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    target_data <span class="op">=</span> data[target].values</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    date_data <span class="op">=</span> data[<span class="st">'date'</span>].values</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(lookback, <span class="bu">len</span>(data) <span class="op">-</span> horizon <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Input sequence: [i-lookback : i]</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        X.append(feature_data[i <span class="op">-</span> lookback:i])</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Target value: i + horizon - 1</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        y.append(target_data[i <span class="op">+</span> horizon <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Date of prediction</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        dates.append(date_data[i <span class="op">+</span> horizon <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(X), np.array(y), np.array(dates)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequences</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>X, y, dates <span class="op">=</span> create_sequences(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    df_scaled,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    feature_columns,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    target_column,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    LOOKBACK_WINDOW,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    FORECAST_HORIZON</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"X shape: </span><span class="sc">{</span>X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (samples, time_steps, features)"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y shape: </span><span class="sc">{</span>y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (samples,)"</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total sequences: </span><span class="sc">{</span><span class="bu">len</span>(X)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Example:</strong> - Sequence 1: [Jan 2015 - Dec 2015] → Predict Jan 2016 NDVI - Sequence 2: [Feb 2015 - Jan 2016] → Predict Feb 2016 NDVI - …and so on</p>
</section>
<section id="temporal-train-validation-test-split" class="level4">
<h4 class="anchored" data-anchor-id="temporal-train-validation-test-split">3.3 Temporal Train-Validation-Test Split</h4>
<p><strong>Critical:</strong> Use temporal splits (not random) to avoid data leakage!</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define split points</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>train_end <span class="op">=</span> pd.Timestamp(<span class="st">'2019-12-31'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>val_end <span class="op">=</span> pd.Timestamp(<span class="st">'2020-12-31'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>train_mask <span class="op">=</span> dates <span class="op">&lt;=</span> train_end</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>val_mask <span class="op">=</span> (dates <span class="op">&gt;</span> train_end) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> val_end)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>test_mask <span class="op">=</span> dates <span class="op">&gt;</span> val_end</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>X_train, y_train <span class="op">=</span> X[train_mask], y[train_mask]</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>X_val, y_val <span class="op">=</span> X[val_mask], y[val_mask]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> X[test_mask], y[test_mask]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>dates_train <span class="op">=</span> dates[train_mask]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>dates_val <span class="op">=</span> dates[val_mask]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>dates_test <span class="op">=</span> dates[test_mask]</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data Split:"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Train: </span><span class="sc">{</span><span class="bu">len</span>(X_train)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_train[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_train[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Val:   </span><span class="sc">{</span><span class="bu">len</span>(X_val)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_val[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_val[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test:  </span><span class="sc">{</span><span class="bu">len</span>(X_test)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_test[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_test[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Expected Split:</strong> - Training: 2015-2019 (~80%) - Validation: 2020 (~10%) - Test: 2021 (~10%)</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Avoid Data Leakage!
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Never</strong> use random train-test split for time series!</p>
<p><strong>Why?</strong> Random splits allow the model to “see the future” during training, leading to unrealistically high performance that fails in operational deployment.</p>
<p><strong>Always</strong> split temporally: train on past, validate on recent past, test on future.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-4-lstm-model-building-30-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-4-lstm-model-building-30-minutes">Part 4: LSTM Model Building (30 minutes)</h3>
<section id="define-lstm-architecture" class="level4">
<h4 class="anchored" data-anchor-id="define-lstm-architecture">4.1 Define LSTM Architecture</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_lstm_model(input_shape, lstm_units<span class="op">=</span>[<span class="dv">64</span>, <span class="dv">32</span>], dropout<span class="op">=</span><span class="fl">0.2</span>, learning_rate<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Build LSTM model for time series forecasting.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">        input_shape: (time_steps, n_features)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">        lstm_units: List of units for each LSTM layer</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">        dropout: Dropout rate for regularization</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">        learning_rate: Optimizer learning rate</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Compiled Keras model</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential(name<span class="op">=</span><span class="st">'LSTM_Drought_Forecaster'</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First LSTM layer (return sequences for stacking)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    model.add(LSTM(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        units<span class="op">=</span>lstm_units[<span class="dv">0</span>],</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        return_sequences<span class="op">=</span><span class="va">True</span> <span class="cf">if</span> <span class="bu">len</span>(lstm_units) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="va">False</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        input_shape<span class="op">=</span>input_shape,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'LSTM_Layer_1'</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(dropout, name<span class="op">=</span><span class="st">'Dropout_1'</span>))</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional LSTM layers</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, units <span class="kw">in</span> <span class="bu">enumerate</span>(lstm_units[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        return_seq <span class="op">=</span> (i <span class="op">&lt;</span> <span class="bu">len</span>(lstm_units))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        model.add(LSTM(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            units<span class="op">=</span>units,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            return_sequences<span class="op">=</span>return_seq,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="ss">f'LSTM_Layer_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        model.add(Dropout(dropout, name<span class="op">=</span><span class="ss">f'Dropout_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>))</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dense layers for output</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">16</span>, activation<span class="op">=</span><span class="st">'relu'</span>, name<span class="op">=</span><span class="st">'Dense_1'</span>))</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>, name<span class="op">=</span><span class="st">'Output'</span>))</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compile model</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        optimizer<span class="op">=</span>optimizer,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        loss<span class="op">=</span><span class="st">'mean_squared_error'</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        metrics<span class="op">=</span>[<span class="st">'mae'</span>, <span class="st">'mse'</span>]</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Build model</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (LOOKBACK_WINDOW, <span class="bu">len</span>(feature_columns))</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> build_lstm_model(</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    input_shape<span class="op">=</span>input_shape,</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    lstm_units<span class="op">=</span>[<span class="dv">64</span>, <span class="dv">32</span>],</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Display architecture</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Architecture Summary:</strong> - Input: (12, 4) - 12 time steps, 4 features - LSTM Layer 1: 64 units - Dropout: 0.2 - LSTM Layer 2: 32 units - Dropout: 0.2 - Dense: 16 units (ReLU) - Output: 1 unit (linear, NDVI prediction)</p>
<p><strong>Total Parameters:</strong> ~30,000</p>
</section>
<section id="configure-callbacks" class="level4">
<h4 class="anchored" data-anchor-id="configure-callbacks">4.2 Configure Callbacks</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define callbacks</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>callbacks <span class="op">=</span> [</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Early stopping: stop if validation loss doesn't improve</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    EarlyStopping(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model checkpoint: save best model</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ModelCheckpoint(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        filepath<span class="op">=</span><span class="st">'models/lstm_drought_best.h5'</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        save_best_only<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Learning rate reduction: reduce LR on plateau</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    ReduceLROnPlateau(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        min_lr<span class="op">=</span><span class="fl">1e-6</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Callbacks configured:"</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Early stopping (patience=20)"</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Model checkpoint (save best)"</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Learning rate reduction"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-5-model-training-20-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-5-model-training-20-minutes">Part 5: Model Training (20 minutes)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Training parameters</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting training..."</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    X_train, y_train,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>EPOCHS,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>BATCH_SIZE,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>callbacks,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training complete!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Expected Training Time:</strong> - CPU: 5-10 minutes - GPU: 1-3 minutes</p>
<section id="plot-training-history" class="level4">
<h4 class="anchored" data-anchor-id="plot-training-history">5.1 Plot Training History</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training curves</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(history.history[<span class="st">'loss'</span>], label<span class="op">=</span><span class="st">'Train Loss'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(history.history[<span class="st">'val_loss'</span>], label<span class="op">=</span><span class="st">'Validation Loss'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'MSE Loss'</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Training and Validation Loss'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># MAE</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(history.history[<span class="st">'mae'</span>], label<span class="op">=</span><span class="st">'Train MAE'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(history.history[<span class="st">'val_mae'</span>], label<span class="op">=</span><span class="st">'Validation MAE'</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'MAE'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Training and Validation MAE'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Interpretation:</strong> - Both train and validation loss should decrease - Validation loss should stabilize (early stopping prevents overfitting) - Gap between train and val indicates overfitting degree</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 2: Training Analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Questions:</strong> 1. At what epoch did early stopping trigger? 2. Is there evidence of overfitting (large train-val gap)? 3. What final validation MAE was achieved? 4. How might you improve the model?</p>
<p><strong>Time:</strong> 5 minutes</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-6-model-evaluation-30-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-6-model-evaluation-30-minutes">Part 6: Model Evaluation (30 minutes)</h3>
<section id="make-predictions" class="level4">
<h4 class="anchored" data-anchor-id="make-predictions">6.1 Make Predictions</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions on all sets</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y_train_pred <span class="op">=</span> model.predict(X_train).flatten()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>y_val_pred <span class="op">=</span> model.predict(X_val).flatten()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> model.predict(X_test).flatten()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Predictions generated for train, validation, and test sets."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="calculate-metrics" class="level4">
<h4 class="anchored" data-anchor-id="calculate-metrics">6.2 Calculate Metrics</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics(y_true, y_pred, set_name):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate and print evaluation metrics."""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(y_true, y_pred))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>set_name<span class="sc">}</span><span class="ss"> Metrics:"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  RMSE: </span><span class="sc">{</span>rmse<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  MAE:  </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  R²:   </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">'rmse'</span>: rmse, <span class="st">'mae'</span>: mae, <span class="st">'r2'</span>: r2}</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>train_metrics <span class="op">=</span> calculate_metrics(y_train, y_train_pred, <span class="st">"Training"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>val_metrics <span class="op">=</span> calculate_metrics(y_val, y_val_pred, <span class="st">"Validation"</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>test_metrics <span class="op">=</span> calculate_metrics(y_test, y_test_pred, <span class="st">"Test"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Expected Performance:</strong> - RMSE: &lt; 0.05 (on normalized 0-1 scale) - MAE: &lt; 0.03 - R²: &gt; 0.85</p>
<p><strong>Interpretation:</strong> - RMSE of 0.05 means ±0.05 error on NDVI scale - For typical NDVI range [0.3-0.8], this is ~10% relative error - Acceptable for early warning (trend detection matters more than exact values)</p>
</section>
<section id="visualize-predictions-vs.-actual" class="level4">
<h4 class="anchored" data-anchor-id="visualize-predictions-vs.-actual">6.3 Visualize Predictions vs.&nbsp;Actual</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse transform predictions to original scale</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inverse_transform_ndvi(values, scaler, feature_columns):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Inverse transform NDVI values back to original scale."""</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dummy array with all features</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    dummy <span class="op">=</span> np.zeros((<span class="bu">len</span>(values), <span class="bu">len</span>(feature_columns)))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Place NDVI values in correct column</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    ndvi_idx <span class="op">=</span> feature_columns.index(<span class="st">'ndvi'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    dummy[:, ndvi_idx] <span class="op">=</span> values</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inverse transform</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    inverse <span class="op">=</span> scaler.inverse_transform(dummy)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inverse[:, ndvi_idx]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse transform</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>y_test_actual <span class="op">=</span> inverse_transform_ndvi(y_test, scaler, feature_columns)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>y_test_pred_original <span class="op">=</span> inverse_transform_ndvi(y_test_pred, scaler, feature_columns)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot time series comparison</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>ax.plot(dates_test, y_test_actual, label<span class="op">=</span><span class="st">'Actual NDVI'</span>, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>ax.plot(dates_test, y_test_pred_original, label<span class="op">=</span><span class="st">'Predicted NDVI'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'x'</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'LSTM Drought Forecasting: Predicted vs. Actual (Test Set 2021)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>ax.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Analysis:</strong> - How well does the model capture seasonal dips? - Does it predict drought onset (rapid NDVI decline)? - Are there systematic errors (consistent over/under-prediction)?</p>
</section>
<section id="scatter-plot-predicted-vs.-actual" class="level4">
<h4 class="anchored" data-anchor-id="scatter-plot-predicted-vs.-actual">6.4 Scatter Plot (Predicted vs.&nbsp;Actual)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(y_test_actual, y_test_pred_original, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ax.plot([y_test_actual.<span class="bu">min</span>(), y_test_actual.<span class="bu">max</span>()],</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        [y_test_actual.<span class="bu">min</span>(), y_test_actual.<span class="bu">max</span>()],</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Perfect Prediction'</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Actual NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Predicted NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Predicted vs. Actual NDVI (Test Set)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>ax.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Ideal Result:</strong> Points clustered tightly along the red diagonal line</p>
</section>
<section id="residual-analysis" class="level4">
<h4 class="anchored" data-anchor-id="residual-analysis">6.5 Residual Analysis</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_test_actual <span class="op">-</span> y_test_pred_original</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals over time</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals time series</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(dates_test, residuals, color<span class="op">=</span><span class="st">'purple'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].fill_between(dates_test, residuals, <span class="dv">0</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Residual (Actual - Predicted)'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Prediction Residuals Over Time'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals histogram</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(residuals, bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Residual'</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Residual Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print residual statistics</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual mean: </span><span class="sc">{</span>residuals<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss"> (should be ~0)"</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual std: </span><span class="sc">{</span>residuals<span class="sc">.</span>std()<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Good Model Indicators:</strong> - Residuals centered around 0 (no systematic bias) - Residuals normally distributed - No patterns in residual time series (random noise)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 3: Model Evaluation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Tasks:</strong> 1. Identify the period with largest prediction errors. What might cause this? 2. Is the model better at predicting high NDVI (wet season) or low NDVI (dry season)? 3. Calculate the percentage of predictions within ±0.05 NDVI error 4. Would this model be useful for operational drought warning? Why or why not?</p>
<p><strong>Time:</strong> 10 minutes</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-7-multi-step-forecasting-15-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-7-multi-step-forecasting-15-minutes">Part 7: Multi-Step Forecasting (15 minutes)</h3>
<p><strong>Extending to 3-Month Ahead Forecasts:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forecast_multistep(model, initial_sequence, scaler, feature_columns, n_steps<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Perform multi-step ahead forecasting.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">        model: Trained LSTM model</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">        initial_sequence: Initial input sequence (lookback, n_features)</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">        scaler: Fitted scaler for inverse transform</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">        feature_columns: List of feature names</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">        n_steps: Number of steps to forecast ahead</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">        List of predictions</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> []</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    current_sequence <span class="op">=</span> initial_sequence.copy()</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(n_steps):</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict next value</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model.predict(current_sequence[np.newaxis, :, :], verbose<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        predictions.append(pred)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update sequence: shift left, add prediction</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note: In practice, you'd need to forecast other features too (rainfall, temp)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Here we assume they're known or use climatology</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        current_sequence <span class="op">=</span> np.roll(current_sequence, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set predicted NDVI in last position</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        ndvi_idx <span class="op">=</span> feature_columns.index(<span class="st">'ndvi'</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        current_sequence[<span class="op">-</span><span class="dv">1</span>, ndvi_idx] <span class="op">=</span> pred</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For other features, use last known values (simplified)</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In production, use weather forecasts</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predictions</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Forecast 3 months ahead from last test sequence</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>initial_seq <span class="op">=</span> X_test[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>multi_step_preds <span class="op">=</span> forecast_multistep(model, initial_seq, scaler, feature_columns, n_steps<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3-Month Ahead Forecast:"</span>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, pred <span class="kw">in</span> <span class="bu">enumerate</span>(multi_step_preds, start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    pred_original <span class="op">=</span> inverse_transform_ndvi(np.array([pred]), scaler, feature_columns)[<span class="dv">0</span>]</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Month +</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: NDVI = </span><span class="sc">{</span>pred_original<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Challenges:</strong> - Prediction uncertainty compounds over multiple steps - Need forecasts of input features (rainfall, temperature) - Alternative: Use ensemble models or probabilistic forecasting</p>
<hr>
</section>
<section id="part-8-operational-deployment-considerations-10-minutes" class="level3">
<h3 class="anchored" data-anchor-id="part-8-operational-deployment-considerations-10-minutes">Part 8: Operational Deployment Considerations (10 minutes)</h3>
<section id="integration-with-philippine-agencies" class="level4">
<h4 class="anchored" data-anchor-id="integration-with-philippine-agencies">8.1 Integration with Philippine Agencies</h4>
<p><strong>Data Pipeline:</strong></p>
<ol type="1">
<li><strong>Automated Data Acquisition:</strong>
<ul>
<li>Sentinel-2 NDVI: Download from CoPhil Infrastructure or Google Earth Engine</li>
<li>PAGASA data: API access to rainfall and temperature</li>
<li>NOAA ONI: Monthly updates</li>
</ul></li>
<li><strong>Preprocessing:</strong>
<ul>
<li>Cloud masking (QA bands)</li>
<li>Temporal aggregation (10-day composites)</li>
<li>Spatial aggregation (province/municipality means)</li>
</ul></li>
<li><strong>Model Inference:</strong>
<ul>
<li>Run monthly predictions</li>
<li>Generate 1-month and 3-month forecasts</li>
<li>Calculate confidence intervals</li>
</ul></li>
<li><strong>Alerting:</strong>
<ul>
<li>Define drought threshold (e.g., NDVI &lt; 0.4 for 2 consecutive months)</li>
<li>Trigger alerts when predicted NDVI falls below threshold</li>
<li>Send notifications to DA, PAGASA, LGUs</li>
</ul></li>
<li><strong>Visualization:</strong>
<ul>
<li>Dashboard showing historical NDVI + predictions</li>
<li>Maps of drought risk by municipality</li>
<li>Trend analysis and anomaly detection</li>
</ul></li>
</ol>
<p><strong>Example Integration with PAGASA:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pseudo-code for operational system</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> monthly_drought_forecast():</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Automated monthly drought forecasting workflow.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Acquire latest data</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    latest_ndvi <span class="op">=</span> download_sentinel2_ndvi(region<span class="op">=</span><span class="st">'Mindanao'</span>, days<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    latest_rainfall <span class="op">=</span> fetch_pagasa_rainfall()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    latest_temp <span class="op">=</span> fetch_pagasa_temperature()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    latest_oni <span class="op">=</span> fetch_noaa_oni()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Preprocess</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    df_latest <span class="op">=</span> merge_and_preprocess(latest_ndvi, latest_rainfall, latest_temp, latest_oni)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Create sequence</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    X_latest <span class="op">=</span> create_sequence(df_latest, lookback<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Predict</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> model.predict(X_latest)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    prediction_ndvi <span class="op">=</span> inverse_transform(prediction)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 5: Check threshold</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    DROUGHT_THRESHOLD <span class="op">=</span> <span class="fl">0.40</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prediction_ndvi <span class="op">&lt;</span> DROUGHT_THRESHOLD:</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        send_alert(</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>            recipients<span class="op">=</span>[<span class="st">'DA'</span>, <span class="st">'PAGASA'</span>, <span class="st">'LGUs'</span>],</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            message<span class="op">=</span><span class="ss">f"Drought warning: Predicted NDVI </span><span class="sc">{</span>prediction_ndvi<span class="sc">:.2f}</span><span class="ss"> for next month"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            severity<span class="op">=</span><span class="st">'HIGH'</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 6: Update dashboard</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    update_dashboard(historical<span class="op">=</span>df_latest, prediction<span class="op">=</span>prediction_ndvi)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prediction_ndvi</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-maintenance" class="level4">
<h4 class="anchored" data-anchor-id="model-maintenance">8.2 Model Maintenance</h4>
<p><strong>Retraining Schedule:</strong> - Retrain annually with new data - Monitor performance drift - Update if accuracy degrades</p>
<p><strong>Validation:</strong> - Compare predictions with ground truth each month - Track RMSE, MAE over time - Engage with stakeholders for qualitative feedback (did farmers report drought?)</p>
<p><strong>Version Control:</strong> - Track model versions (architecture, hyperparameters, training data) - A/B testing of model updates - Rollback capability</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Success Metrics for Operational System
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Quantitative:</strong> - Forecast accuracy: RMSE &lt; 0.05 NDVI - Lead time: 1-3 months - Spatial coverage: All major agricultural regions</p>
<p><strong>Qualitative:</strong> - User adoption by DA and LGUs - Actionable warnings (early interventions taken) - Reduction in drought-related crop losses (longitudinal assessment)</p>
<p><strong>Target:</strong> Achieve 80% detection rate for drought events with &lt; 20% false alarm rate</p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="troubleshooting-guide" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting-guide">Troubleshooting Guide</h2>
<section id="common-issues-and-solutions" class="level3">
<h3 class="anchored" data-anchor-id="common-issues-and-solutions">Common Issues and Solutions</h3>
<p><strong>Issue 1: Model overfitting (train loss &lt;&lt; val loss)</strong></p>
<p><strong>Solutions:</strong> - Increase dropout rate (0.3-0.4) - Reduce LSTM units (32, 16 instead of 64, 32) - Add L2 regularization - Increase training data (longer time series, more locations)</p>
<p><strong>Issue 2: Poor convergence (loss not decreasing)</strong></p>
<p><strong>Solutions:</strong> - Reduce learning rate (0.0001) - Increase batch size (64, 128) - Check data normalization (should be [0, 1] or standardized) - Simplify architecture (fewer layers)</p>
<p><strong>Issue 3: Predictions lag behind actual values</strong></p>
<p><strong>Explanation:</strong> Model learns to predict “tomorrow will be like today”</p>
<p><strong>Solutions:</strong> - Add more features (lagged rainfall, soil moisture) - Increase lookback window (18-24 months) - Use attention mechanisms (advanced) - Try bidirectional LSTM</p>
<p><strong>Issue 4: High error during extreme events (droughts)</strong></p>
<p><strong>Solutions:</strong> - Oversample drought periods in training data - Use weighted loss function (higher weight on drought) - Add drought-specific features (El Niño strength) - Ensemble with other models (Random Forest, GRU)</p>
<hr>
</section>
</section>
<section id="extensions-and-advanced-topics" class="level2">
<h2 class="anchored" data-anchor-id="extensions-and-advanced-topics">Extensions and Advanced Topics</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Going Further
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. Spatial LSTM:</strong> Extend model to predict drought across multiple locations simultaneously using ConvLSTM</p>
<p><strong>2. Ensemble Models:</strong> Combine LSTM with Random Forest and gradient boosting for robust predictions</p>
<p><strong>3. Attention Mechanisms:</strong> Add attention layers to identify which historical time steps are most important</p>
<p><strong>4. Uncertainty Quantification:</strong> Use Bayesian LSTM or Monte Carlo dropout to estimate prediction confidence intervals</p>
<p><strong>5. Multi-Output Forecasting:</strong> Predict NDVI, rainfall, and temperature simultaneously (multi-task learning)</p>
<p><strong>6. Transfer Learning:</strong> Train on Mindanao, fine-tune for other Philippine regions (Luzon, Visayas)</p>
<p><strong>7. Explainability:</strong> Use SHAP or LIME to interpret which features drive predictions</p>
</div>
</div>
<hr>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Session 2 Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Lab Achievements:</strong> - Built end-to-end LSTM drought forecasting system for Mindanao - Processed 7 years of Sentinel-2 NDVI time series - Integrated multi-source data (satellite, weather, climate indices) - Achieved operational-grade forecast accuracy (RMSE &lt; 0.05)</p>
<p><strong>Technical Skills:</strong> - Time series sequence creation with sliding windows - LSTM model architecture design and training - Proper temporal data splitting (avoid leakage) - Model evaluation and interpretation - Deployment considerations for operational systems</p>
<p><strong>Philippine Context:</strong> - Mindanao drought vulnerability and agricultural importance - 2015-2016 El Niño case study - Integration with DA and PAGASA early warning systems - 3-month lead time for climate change adaptation</p>
<p><strong>Operational Readiness:</strong> - Automated data pipelines feasible - Monthly forecast updates practical - Alert thresholds definable - Stakeholder engagement critical</p>
<p><strong>Next Steps:</strong> Session 3 explores emerging AI trends (foundation models, self-supervised learning, explainable AI) that could further improve drought monitoring systems.</p>
</div>
</div>
<hr>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<section id="code-and-data" class="level3">
<h3 class="anchored" data-anchor-id="code-and-data">Code and Data</h3>
<p><strong>Lab Materials:</strong> - 📓 <a href="../../day4/notebooks/day4_session2_lstm_drought_lab_STUDENT.html">Student Jupyter Notebook</a> - Guided lab with exercises - 📓 <a href="../../day4/notebooks/day4_session2_lstm_drought_lab_INSTRUCTOR.html">Instructor Solution Notebook</a> - Complete solutions - 📊 Data: Synthetic data generated within notebooks (no separate download needed)</p>
</section>
<section id="further-reading" class="level3">
<h3 class="anchored" data-anchor-id="further-reading">Further Reading</h3>
<p><strong>LSTM for EO:</strong> - Ndikumana et al.&nbsp;(2018). “Deep Recurrent Neural Network for Agricultural Classification using SAR Sentinel-1.” <em>Remote Sensing</em>. - Ru et al.&nbsp;(2020). “Deep Learning for Crop Yield Prediction Using LSTM.” <em>Computers and Electronics in Agriculture</em>.</p>
<p><strong>Drought Monitoring:</strong> - AghaKouchak et al.&nbsp;(2015). “Remote Sensing of Drought: Progress, Challenges and Opportunities.” <em>Reviews of Geophysics</em>. - Philippine PAGASA: <a href="https://www.pagasa.dost.gov.ph">Drought Monitoring Reports</a></p>
<p><strong>TensorFlow/Keras:</strong> - <a href="https://keras.io/examples/timeseries/">Keras Time Series Tutorial</a> - <a href="https://www.tensorflow.org/tutorials/structured_data/time_series">TensorFlow LSTM Guide</a></p>
</section>
<section id="philippine-eo-platforms" class="level3">
<h3 class="anchored" data-anchor-id="philippine-eo-platforms">Philippine EO Platforms</h3>
<ul>
<li><a href="https://infra.copphil.philsa.gov.ph">CoPhil Infrastructure</a></li>
<li><a href="https://earthengine.google.com">Google Earth Engine</a></li>
<li><a href="https://www.pagasa.dost.gov.ph">PAGASA Climate Data</a></li>
</ul>
<hr>
</section>
</section>
<section id="session-feedback" class="level2">
<h2 class="anchored" data-anchor-id="session-feedback">Session Feedback</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Reflect on Your Learning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Questions for Discussion:</strong> 1. How confident are you in building LSTM models for other EO time series problems? 2. What challenges did you encounter during the lab? 3. What Philippine applications could benefit from LSTM forecasting? 4. How would you explain LSTM predictions to non-technical stakeholders (farmers, LGU officials)?</p>
<p><strong>Feedback Form:</strong> <a href="https://forms.gle/copphil-day4-session2">Submit anonymous feedback</a></p>
<p><strong>Instructor Email:</strong> <a href="mailto:training@copphil.philsa.gov.ph">training@copphil.philsa.gov.ph</a></p>
</div>
</div>
<hr>
</section>
<section id="preparation-for-session-3" class="level2">
<h2 class="anchored" data-anchor-id="preparation-for-session-3">Preparation for Session 3</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Looking Ahead
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Session 3: Emerging AI Trends in EO</strong></p>
<p>Topics: - Geospatial foundation models (Prithvi, Clay, SatMAE) - Self-supervised learning for limited labeled data - Explainable AI (SHAP, LIME, Grad-CAM) for transparency</p>
<p><strong>Relevance to This Lab:</strong> - Foundation models could improve drought prediction with less training data - Self-supervised pre-training on unlabeled Sentinel-2 archive - XAI methods to explain which months/features drive drought predictions</p>
<p><strong>No advance preparation needed</strong> - Session 3 is theory and discussion-based</p>
<p><a href="../../day4/sessions/session3.html" class="btn btn-outline-primary">Session 3 Preview →</a></p>
</div>
</div>
<hr>
<p><em>This session is part of Day 4: Time Series Analysis, Emerging Trends, and Sustainable Learning - CoPhil 4-Day Advanced Training on AI/ML for Earth Observation, funded by the European Union under the Global Gateway initiative.</em></p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/DimitrisKasabalis\.github\.io\/cophil-training-v1\.0");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="cophil-training-v1.0" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../day4/sessions/session1.html" class="pagination-link" aria-label="Session 1: LSTMs for Earth Observation Time Series">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Session 1: LSTMs for Earth Observation Time Series</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../day4/sessions/session3.html" class="pagination-link" aria-label="Session 3: Emerging AI Trends in Earth Observation">
        <span class="nav-page-text">Session 3: Emerging AI Trends in Earth Observation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Session 2: LSTM Drought Monitoring Lab"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Hands-on Implementation of LSTM Time Series Forecasting for Mindanao"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Stylianos Kotsopoulos"</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">nav</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb"</span><span class="ot"> aria-label</span><span class="op">=</span><span class="st">"Breadcrumb"</span><span class="dt">&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"../../index.html"</span><span class="dt">&gt;</span>Home<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-separator"</span><span class="ot"> aria-hidden</span><span class="op">=</span><span class="st">"true"</span><span class="dt">&gt;</span>›<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"../index.html"</span><span class="dt">&gt;</span>Day 4<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-separator"</span><span class="ot"> aria-hidden</span><span class="op">=</span><span class="st">"true"</span><span class="dt">&gt;</span>›<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-current"</span><span class="dt">&gt;</span>Session 2<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">nav</span><span class="dt">&gt;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>::: {.hero}</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session 2: LSTM Drought Monitoring Lab</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hands-on Implementation of LSTM Time Series Forecasting for Mindanao</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>Build an operational LSTM model to predict drought conditions 1-3 months ahead using real Sentinel-2 data</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Overview</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>This intensive 2.5-hour hands-on lab puts LSTM theory into practice. You'll build a complete drought forecasting system for Mindanao provinces (Bukidnon and South Cotabato) using multi-year Sentinel-2 NDVI time series, weather data, and climate indices. By the end, you'll have a trained model capable of predicting vegetation stress months in advance.</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>By the end of this session, you will be able to:</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Acquire and preprocess** multi-year Sentinel-2 NDVI time series for a study area</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Create training sequences** using sliding window approach for time series forecasting</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Build LSTM models** using TensorFlow/Keras with appropriate architecture</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Train and validate** models with proper temporal data splitting</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Evaluate forecast accuracy** using RMSE, MAE, and visual diagnostics</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Interpret predictions** in the context of drought monitoring</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Deploy** models for operational early warning systems</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Presentation Slides</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"../presentations/session2_drought_lab.html"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"100%"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"600"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"border: 1px solid #ccc; border-radius: 4px;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Details</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>::: {.session-info}</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>**Duration:** 2.5 hours (150 minutes) | **Format:** Hands-on Lab | **Difficulty:** Intermediate to Advanced</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>**Prerequisites:**</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Completion of Session 1 (LSTM theory)</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python programming experience</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understanding of time series concepts</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Familiarity with TensorFlow/Keras basics</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Google Earth Engine account (optional, data provided)</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>**What You'll Build:**</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multi-input LSTM drought forecasting model</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Training pipeline with temporal cross-validation</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Evaluation framework with visualization</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Operational deployment considerations</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>**Materials Provided:**</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📓 Interactive Jupyter notebooks (student + instructor versions)</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📊 Synthetic Mindanao drought data (generated in notebook)</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>💻 Complete working code for LSTM model</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📈 Visualization and evaluation tools</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="fu">## 🚀 Get Started with the Lab</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>This is a hands-on session - you'll build a complete LSTM drought forecasting system from scratch!</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>**Download the notebook:**</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📓 <span class="co">[</span><span class="ot">Student Version</span><span class="co">](../notebooks/day4_session2_lstm_drought_lab_STUDENT.ipynb)</span> - Guided exercises with TODO sections</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📓 <span class="co">[</span><span class="ot">Instructor Solution</span><span class="co">](../notebooks/day4_session2_lstm_drought_lab_INSTRUCTOR.ipynb)</span> - Complete working code</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>**What you'll build:**</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multi-variate LSTM model (NDVI, rainfall, temperature, ONI)</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Training pipeline with temporal validation</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Drought prediction system with 1-month lead time</span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Operational deployment framework</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>**Requirements:**</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python 3.8+</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>TensorFlow 2.x (GPU recommended but not required)</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Google Colab account (or local Jupyter)</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>Open the notebook now and follow along!</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Case Study: Mindanao Drought Monitoring</span></span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Mindanao?</span></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>**Bukidnon and South Cotabato** are critical agricultural provinces in Mindanao producing:</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Corn (major crop)</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rice</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Coffee</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pineapple</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Vegetables</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Livestock</span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>**Climate Challenges:**</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pronounced dry season (November-April)</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Strong El Niño impacts (reduced rainfall, delayed planting)</span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Inter-annual variability in monsoon intensity</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increasing climate change pressures</span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>**2015-2016 El Niño Impact:**</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Severe drought affecting 2.5 million people in Mindanao</span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Crop losses estimated at billions of pesos</span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Water shortages in urban and rural areas</span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increased food insecurity</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a><span class="fu">## Climate Change Adaptation (CCA) Context</span></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>The Department of Agriculture (DA) and PAGASA need **3-month lead time** for effective drought response:</span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjust planting calendars</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Activate irrigation systems</span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distribute drought-resistant seed varieties</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pre-position crop insurance programs</span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Issue agricultural advisories to farmers</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>LSTM-based early warning systems can provide this critical lead time.</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a><span class="fu">### Study Area Specifications</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>**Geographic Extent:**</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bukidnon Province:** 10,498 km²</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**South Cotabato Province:** 3,935 km²</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Total Area:** ~14,433 km²</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>**Land Use:**</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Agricultural land: ~60%</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Forest cover: ~30%</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Urban/built-up: ~5%</span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other: ~5%</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>**Elevation Range:**</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lowlands: 0-500m</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Highlands: 500-2,000m (Bukidnon plateau)</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>**Data Coverage:**</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sentinel-2 tiles: 51PVT, 51PWT, 51PWS</span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Temporal coverage: 2015-2021 (7 years)</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Temporal resolution: 10-day NDVI composites (cloud-masked)</span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lab Workflow</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 1: Setup and Data Loading (20 minutes)</span></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 1.1 Environment Setup</span></span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>**Import Libraries:**</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Core libraries</span></span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Geospatial</span></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning</span></span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler, StandardScaler</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Deep Learning</span></span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> LSTM, Dense, Dropout</span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping, ModelCheckpoint, ReduceLROnPlateau</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.dates <span class="im">import</span> DateFormatter</span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a><span class="co"># Utilities</span></span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seeds for reproducibility</span></span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(<span class="dv">42</span>)</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a>**Check TensorFlow Setup:**</span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Check TensorFlow version</span></span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TensorFlow version: </span><span class="sc">{</span>tf<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a><span class="co"># Check GPU availability</span></span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"GPU available: </span><span class="sc">{</span>tf<span class="sc">.</span>config<span class="sc">.</span>list_physical_devices(<span class="st">'GPU'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Built with CUDA: </span><span class="sc">{</span>tf<span class="sc">.</span>test<span class="sc">.</span>is_built_with_cuda()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>**Recommended:** Use GPU if available for faster training. Google Colab provides free GPU access.</span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 1.2 Load Pre-processed Data</span></span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>**Option A: Use Provided Dataset (Recommended for Lab)**</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Load pre-processed NDVI time series</span></span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Shape: (n_pixels, n_timesteps) or aggregated to region average</span></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>ndvi_data <span class="op">=</span> pd.read_csv(<span class="st">'data/mindanao_ndvi_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>rainfall_data <span class="op">=</span> pd.read_csv(<span class="st">'data/pagasa_rainfall_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>temperature_data <span class="op">=</span> pd.read_csv(<span class="st">'data/pagasa_temperature_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a>oni_data <span class="op">=</span> pd.read_csv(<span class="st">'data/oni_index_2015_2021.csv'</span>, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Display data structure</span></span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ndvi_data.head())</span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI data shape: </span><span class="sc">{</span>ndvi_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Date range: </span><span class="sc">{</span>ndvi_data[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>ndvi_data[<span class="st">'date'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>**Option B: Download from Google Earth Engine (Optional)**</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>ee.Initialize()</span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a><span class="co"># Define study area (Bukidnon + South Cotabato)</span></span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>aoi <span class="op">=</span> ee.FeatureCollection(<span class="st">'FAO/GAUL/2015/level1'</span>) <span class="op">\</span></span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.inList(<span class="st">'ADM1_NAME'</span>, [<span class="st">'Bukidnon'</span>, <span class="st">'South Cotabato'</span>]))</span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Sentinel-2 collection</span></span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> ee.ImageCollection(<span class="st">'COPERNICUS/S2_SR_HARMONIZED'</span>) <span class="op">\</span></span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a>    .filterBounds(aoi) <span class="op">\</span></span>
<span id="cb24-256"><a href="#cb24-256" aria-hidden="true" tabindex="-1"></a>    .filterDate(<span class="st">'2015-06-23'</span>, <span class="st">'2021-12-31'</span>) <span class="op">\</span></span>
<span id="cb24-257"><a href="#cb24-257" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(ee.Filter.lt(<span class="st">'CLOUDY_PIXEL_PERCENTAGE'</span>, <span class="dv">30</span>))</span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute NDVI</span></span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_ndvi(image):</span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> image.normalizedDifference([<span class="st">'B8'</span>, <span class="st">'B4'</span>]).rename(<span class="st">'NDVI'</span>)</span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image.addBands(ndvi)</span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply NDVI calculation</span></span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a>s2_ndvi <span class="op">=</span> s2.<span class="bu">map</span>(add_ndvi)</span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10-day composites</span></span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_composite(start_date):</span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a>    end_date <span class="op">=</span> start_date.advance(<span class="dv">10</span>, <span class="st">'day'</span>)</span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>    composite <span class="op">=</span> s2_ndvi.filterDate(start_date, end_date).median()</span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> composite.<span class="bu">set</span>(<span class="st">'system:time_start'</span>, start_date.millis())</span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate composite dates</span></span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> ee.Date(<span class="st">'2015-06-23'</span>)</span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> ee.List.sequence(<span class="dv">0</span>, <span class="dv">240</span>, <span class="dv">10</span>).<span class="bu">map</span>(<span class="kw">lambda</span> d: start_date.advance(d, <span class="st">'day'</span>))</span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>composites <span class="op">=</span> ee.ImageCollection.fromImages(dates.<span class="bu">map</span>(create_composite))</span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract time series for AOI</span></span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_ndvi(image):</span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> image.select(<span class="st">'NDVI'</span>).reduceRegion(</span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a>        reducer<span class="op">=</span>ee.Reducer.mean(),</span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a>        geometry<span class="op">=</span>aoi.geometry(),</span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a>        scale<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>        maxPixels<span class="op">=</span><span class="fl">1e9</span></span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ee.Feature(<span class="va">None</span>, {</span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a>        <span class="st">'date'</span>: image.date().<span class="bu">format</span>(<span class="st">'YYYY-MM-dd'</span>),</span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ndvi'</span>: stats.get(<span class="st">'NDVI'</span>)</span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a>ndvi_timeseries <span class="op">=</span> composites.<span class="bu">map</span>(extract_ndvi)</span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Export or download results...</span></span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 1.3 Merge and Align Data</span></span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all data sources on date</span></span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> ndvi_data.merge(rainfall_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(temperature_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.merge(oni_data, on<span class="op">=</span><span class="st">'date'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle missing values (interpolate)</span></span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'date'</span>)</span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.interpolate(method<span class="op">=</span><span class="st">'time'</span>)</span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.reset_index()</span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Add temporal features</span></span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.month</span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.year</span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'doy'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].dt.dayofyear  <span class="co"># day of year for seasonality</span></span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a><span class="co"># Display merged data</span></span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final data shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Missing values: </span><span class="sc">{</span>df<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-318"><a href="#cb24-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-319"><a href="#cb24-319" aria-hidden="true" tabindex="-1"></a>**Expected Data Columns:**</span>
<span id="cb24-320"><a href="#cb24-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`date`</span>: Timestamp</span>
<span id="cb24-321"><a href="#cb24-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ndvi`</span>: Mean NDVI value <span class="co">[</span><span class="ot">0-1</span><span class="co">]</span></span>
<span id="cb24-322"><a href="#cb24-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`rainfall`</span>: Monthly rainfall (mm)</span>
<span id="cb24-323"><a href="#cb24-323" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`temperature`</span>: Monthly mean temperature (°C)</span>
<span id="cb24-324"><a href="#cb24-324" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`oni`</span>: Oceanic Niño Index (El Niño indicator)</span>
<span id="cb24-325"><a href="#cb24-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`month`</span>, <span class="in">`year`</span>, <span class="in">`doy`</span>: Temporal features</span>
<span id="cb24-326"><a href="#cb24-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-327"><a href="#cb24-327" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-328"><a href="#cb24-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-329"><a href="#cb24-329" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 2: Exploratory Data Analysis (25 minutes)</span></span>
<span id="cb24-330"><a href="#cb24-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-331"><a href="#cb24-331" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2.1 Visualize NDVI Time Series</span></span>
<span id="cb24-332"><a href="#cb24-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-333"><a href="#cb24-333" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-334"><a href="#cb24-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot full NDVI time series</span></span>
<span id="cb24-335"><a href="#cb24-335" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb24-336"><a href="#cb24-336" aria-hidden="true" tabindex="-1"></a>ax.plot(df[<span class="st">'date'</span>], df[<span class="st">'ndvi'</span>], linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb24-337"><a href="#cb24-337" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Mindanao NDVI Time Series (2015-2021)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-338"><a href="#cb24-338" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb24-339"><a href="#cb24-339" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NDVI'</span>)</span>
<span id="cb24-340"><a href="#cb24-340" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-341"><a href="#cb24-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-342"><a href="#cb24-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight drought period (2015-2016 El Niño)</span></span>
<span id="cb24-343"><a href="#cb24-343" aria-hidden="true" tabindex="-1"></a>drought_start <span class="op">=</span> pd.Timestamp(<span class="st">'2015-06-01'</span>)</span>
<span id="cb24-344"><a href="#cb24-344" aria-hidden="true" tabindex="-1"></a>drought_end <span class="op">=</span> pd.Timestamp(<span class="st">'2016-06-01'</span>)</span>
<span id="cb24-345"><a href="#cb24-345" aria-hidden="true" tabindex="-1"></a>ax.axvspan(drought_start, drought_end, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'2015-16 El Niño Drought'</span>)</span>
<span id="cb24-346"><a href="#cb24-346" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb24-347"><a href="#cb24-347" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-348"><a href="#cb24-348" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-349"><a href="#cb24-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-350"><a href="#cb24-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-351"><a href="#cb24-351" aria-hidden="true" tabindex="-1"></a>**Observations:**</span>
<span id="cb24-352"><a href="#cb24-352" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clear seasonal pattern (dry season dips)</span>
<span id="cb24-353"><a href="#cb24-353" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>2015-2016 drought visible as prolonged low NDVI</span>
<span id="cb24-354"><a href="#cb24-354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recovery in wet seasons</span>
<span id="cb24-355"><a href="#cb24-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-356"><a href="#cb24-356" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2.2 Seasonal Decomposition</span></span>
<span id="cb24-357"><a href="#cb24-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-358"><a href="#cb24-358" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-359"><a href="#cb24-359" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span>
<span id="cb24-360"><a href="#cb24-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-361"><a href="#cb24-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to monthly frequency for decomposition</span></span>
<span id="cb24-362"><a href="#cb24-362" aria-hidden="true" tabindex="-1"></a>df_monthly <span class="op">=</span> df.set_index(<span class="st">'date'</span>).resample(<span class="st">'M'</span>).mean()</span>
<span id="cb24-363"><a href="#cb24-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-364"><a href="#cb24-364" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform seasonal decomposition</span></span>
<span id="cb24-365"><a href="#cb24-365" aria-hidden="true" tabindex="-1"></a>decomposition <span class="op">=</span> seasonal_decompose(df_monthly[<span class="st">'ndvi'</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-366"><a href="#cb24-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-367"><a href="#cb24-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot components</span></span>
<span id="cb24-368"><a href="#cb24-368" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">4</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb24-369"><a href="#cb24-369" aria-hidden="true" tabindex="-1"></a>decomposition.observed.plot(ax<span class="op">=</span>axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">'Observed NDVI'</span>)</span>
<span id="cb24-370"><a href="#cb24-370" aria-hidden="true" tabindex="-1"></a>decomposition.trend.plot(ax<span class="op">=</span>axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">'Trend'</span>)</span>
<span id="cb24-371"><a href="#cb24-371" aria-hidden="true" tabindex="-1"></a>decomposition.seasonal.plot(ax<span class="op">=</span>axes[<span class="dv">2</span>], title<span class="op">=</span><span class="st">'Seasonal'</span>)</span>
<span id="cb24-372"><a href="#cb24-372" aria-hidden="true" tabindex="-1"></a>decomposition.resid.plot(ax<span class="op">=</span>axes[<span class="dv">3</span>], title<span class="op">=</span><span class="st">'Residual'</span>)</span>
<span id="cb24-373"><a href="#cb24-373" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-374"><a href="#cb24-374" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-375"><a href="#cb24-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-376"><a href="#cb24-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-377"><a href="#cb24-377" aria-hidden="true" tabindex="-1"></a>**Interpretation:**</span>
<span id="cb24-378"><a href="#cb24-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Trend:** Long-term changes (climate shifts, land use change)</span>
<span id="cb24-379"><a href="#cb24-379" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Seasonal:** Annual dry/wet cycle</span>
<span id="cb24-380"><a href="#cb24-380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Residual:** Noise and anomalies (droughts, floods)</span>
<span id="cb24-381"><a href="#cb24-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-382"><a href="#cb24-382" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2.3 Correlation Analysis</span></span>
<span id="cb24-383"><a href="#cb24-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-384"><a href="#cb24-384" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-385"><a href="#cb24-385" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb24-386"><a href="#cb24-386" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> df[[<span class="st">'ndvi'</span>, <span class="st">'rainfall'</span>, <span class="st">'temperature'</span>, <span class="st">'oni'</span>]].corr()</span>
<span id="cb24-387"><a href="#cb24-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-388"><a href="#cb24-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb24-389"><a href="#cb24-389" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb24-390"><a href="#cb24-390" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb24-391"><a href="#cb24-391" aria-hidden="true" tabindex="-1"></a>            square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="dv">1</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>})</span>
<span id="cb24-392"><a href="#cb24-392" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Correlation Matrix'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a>**Expected Correlations:**</span>
<span id="cb24-398"><a href="#cb24-398" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>NDVI vs. Rainfall: Positive (more rain → greener vegetation)</span>
<span id="cb24-399"><a href="#cb24-399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>NDVI vs. Temperature: Weak or negative (heat stress)</span>
<span id="cb24-400"><a href="#cb24-400" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>NDVI vs. ONI: Negative (El Niño → drought → lower NDVI)</span>
<span id="cb24-401"><a href="#cb24-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-402"><a href="#cb24-402" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 2.4 Lagged Correlations</span></span>
<span id="cb24-403"><a href="#cb24-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-404"><a href="#cb24-404" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-405"><a href="#cb24-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute lagged correlations (rainfall effect with delay)</span></span>
<span id="cb24-406"><a href="#cb24-406" aria-hidden="true" tabindex="-1"></a>lags <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">6</span>)  <span class="co"># 0-5 months lag</span></span>
<span id="cb24-407"><a href="#cb24-407" aria-hidden="true" tabindex="-1"></a>lagged_corr <span class="op">=</span> [df[<span class="st">'ndvi'</span>].corr(df[<span class="st">'rainfall'</span>].shift(lag)) <span class="cf">for</span> lag <span class="kw">in</span> lags]</span>
<span id="cb24-408"><a href="#cb24-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-409"><a href="#cb24-409" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb24-410"><a href="#cb24-410" aria-hidden="true" tabindex="-1"></a>plt.bar(lags, lagged_corr, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb24-411"><a href="#cb24-411" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Lag (months)'</span>)</span>
<span id="cb24-412"><a href="#cb24-412" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Correlation with NDVI'</span>)</span>
<span id="cb24-413"><a href="#cb24-413" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Lagged Correlation: Rainfall → NDVI'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-414"><a href="#cb24-414" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-415"><a href="#cb24-415" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-416"><a href="#cb24-416" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-417"><a href="#cb24-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-418"><a href="#cb24-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-419"><a href="#cb24-419" aria-hidden="true" tabindex="-1"></a>**Insight:** Rainfall typically affects NDVI with 1-2 month delay (vegetation growth response time)</span>
<span id="cb24-420"><a href="#cb24-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-421"><a href="#cb24-421" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb24-422"><a href="#cb24-422" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1: Data Exploration</span></span>
<span id="cb24-423"><a href="#cb24-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-424"><a href="#cb24-424" aria-hidden="true" tabindex="-1"></a>**Tasks:**</span>
<span id="cb24-425"><a href="#cb24-425" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Identify the lowest NDVI period in the time series. Does it correspond to the 2015-2016 El Niño?</span>
<span id="cb24-426"><a href="#cb24-426" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Calculate the mean NDVI for dry season (Nov-Apr) vs. wet season (May-Oct)</span>
<span id="cb24-427"><a href="#cb24-427" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Plot NDVI vs. Rainfall as a scatter plot. Is the relationship linear?</span>
<span id="cb24-428"><a href="#cb24-428" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>What is the strongest predictor of NDVI based on correlation analysis?</span>
<span id="cb24-429"><a href="#cb24-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-430"><a href="#cb24-430" aria-hidden="true" tabindex="-1"></a>**Time:** 10 minutes</span>
<span id="cb24-431"><a href="#cb24-431" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-432"><a href="#cb24-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-433"><a href="#cb24-433" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-434"><a href="#cb24-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-435"><a href="#cb24-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 3: Sequence Creation (30 minutes)</span></span>
<span id="cb24-436"><a href="#cb24-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-437"><a href="#cb24-437" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 3.1 Define Sequence Parameters</span></span>
<span id="cb24-438"><a href="#cb24-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-439"><a href="#cb24-439" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-440"><a href="#cb24-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameters</span></span>
<span id="cb24-441"><a href="#cb24-441" aria-hidden="true" tabindex="-1"></a>LOOKBACK_WINDOW <span class="op">=</span> <span class="dv">12</span>  <span class="co"># Use 12 months of history</span></span>
<span id="cb24-442"><a href="#cb24-442" aria-hidden="true" tabindex="-1"></a>FORECAST_HORIZON <span class="op">=</span> <span class="dv">1</span>   <span class="co"># Predict 1 month ahead (can extend to 3 months)</span></span>
<span id="cb24-443"><a href="#cb24-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-444"><a href="#cb24-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Features to use</span></span>
<span id="cb24-445"><a href="#cb24-445" aria-hidden="true" tabindex="-1"></a>feature_columns <span class="op">=</span> [<span class="st">'ndvi'</span>, <span class="st">'rainfall'</span>, <span class="st">'temperature'</span>, <span class="st">'oni'</span>]</span>
<span id="cb24-446"><a href="#cb24-446" aria-hidden="true" tabindex="-1"></a>target_column <span class="op">=</span> <span class="st">'ndvi'</span></span>
<span id="cb24-447"><a href="#cb24-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-448"><a href="#cb24-448" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalization</span></span>
<span id="cb24-449"><a href="#cb24-449" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb24-450"><a href="#cb24-450" aria-hidden="true" tabindex="-1"></a>df_scaled <span class="op">=</span> df.copy()</span>
<span id="cb24-451"><a href="#cb24-451" aria-hidden="true" tabindex="-1"></a>df_scaled[feature_columns] <span class="op">=</span> scaler.fit_transform(df[feature_columns])</span>
<span id="cb24-452"><a href="#cb24-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-453"><a href="#cb24-453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lookback window: </span><span class="sc">{</span>LOOKBACK_WINDOW<span class="sc">}</span><span class="ss"> months"</span>)</span>
<span id="cb24-454"><a href="#cb24-454" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Forecast horizon: </span><span class="sc">{</span>FORECAST_HORIZON<span class="sc">}</span><span class="ss"> month(s)"</span>)</span>
<span id="cb24-455"><a href="#cb24-455" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>feature_columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-456"><a href="#cb24-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-457"><a href="#cb24-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-458"><a href="#cb24-458" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 3.2 Create Training Sequences</span></span>
<span id="cb24-459"><a href="#cb24-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-460"><a href="#cb24-460" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-461"><a href="#cb24-461" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_sequences(data, features, target, lookback, horizon):</span>
<span id="cb24-462"><a href="#cb24-462" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-463"><a href="#cb24-463" aria-hidden="true" tabindex="-1"></a><span class="co">    Create input-output sequences for LSTM training.</span></span>
<span id="cb24-464"><a href="#cb24-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-465"><a href="#cb24-465" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb24-466"><a href="#cb24-466" aria-hidden="true" tabindex="-1"></a><span class="co">        data: DataFrame with features</span></span>
<span id="cb24-467"><a href="#cb24-467" aria-hidden="true" tabindex="-1"></a><span class="co">        features: List of feature column names</span></span>
<span id="cb24-468"><a href="#cb24-468" aria-hidden="true" tabindex="-1"></a><span class="co">        target: Target column name</span></span>
<span id="cb24-469"><a href="#cb24-469" aria-hidden="true" tabindex="-1"></a><span class="co">        lookback: Number of time steps to look back</span></span>
<span id="cb24-470"><a href="#cb24-470" aria-hidden="true" tabindex="-1"></a><span class="co">        horizon: Number of time steps to forecast ahead</span></span>
<span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a><span class="co">        X: Input sequences (samples, lookback, n_features)</span></span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a><span class="co">        y: Target values (samples,)</span></span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a><span class="co">        dates: Corresponding dates for sequences</span></span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a>    X, y, dates <span class="op">=</span> [], [], []</span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>    feature_data <span class="op">=</span> data[features].values</span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>    target_data <span class="op">=</span> data[target].values</span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>    date_data <span class="op">=</span> data[<span class="st">'date'</span>].values</span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(lookback, <span class="bu">len</span>(data) <span class="op">-</span> horizon <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Input sequence: [i-lookback : i]</span></span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a>        X.append(feature_data[i <span class="op">-</span> lookback:i])</span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Target value: i + horizon - 1</span></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a>        y.append(target_data[i <span class="op">+</span> horizon <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Date of prediction</span></span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a>        dates.append(date_data[i <span class="op">+</span> horizon <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb24-492"><a href="#cb24-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-493"><a href="#cb24-493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(X), np.array(y), np.array(dates)</span>
<span id="cb24-494"><a href="#cb24-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-495"><a href="#cb24-495" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequences</span></span>
<span id="cb24-496"><a href="#cb24-496" aria-hidden="true" tabindex="-1"></a>X, y, dates <span class="op">=</span> create_sequences(</span>
<span id="cb24-497"><a href="#cb24-497" aria-hidden="true" tabindex="-1"></a>    df_scaled,</span>
<span id="cb24-498"><a href="#cb24-498" aria-hidden="true" tabindex="-1"></a>    feature_columns,</span>
<span id="cb24-499"><a href="#cb24-499" aria-hidden="true" tabindex="-1"></a>    target_column,</span>
<span id="cb24-500"><a href="#cb24-500" aria-hidden="true" tabindex="-1"></a>    LOOKBACK_WINDOW,</span>
<span id="cb24-501"><a href="#cb24-501" aria-hidden="true" tabindex="-1"></a>    FORECAST_HORIZON</span>
<span id="cb24-502"><a href="#cb24-502" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-503"><a href="#cb24-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-504"><a href="#cb24-504" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"X shape: </span><span class="sc">{</span>X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (samples, time_steps, features)"</span>)</span>
<span id="cb24-505"><a href="#cb24-505" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y shape: </span><span class="sc">{</span>y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (samples,)"</span>)</span>
<span id="cb24-506"><a href="#cb24-506" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total sequences: </span><span class="sc">{</span><span class="bu">len</span>(X)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-507"><a href="#cb24-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-508"><a href="#cb24-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-509"><a href="#cb24-509" aria-hidden="true" tabindex="-1"></a>**Example:**</span>
<span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sequence 1: <span class="co">[</span><span class="ot">Jan 2015 - Dec 2015</span><span class="co">]</span> → Predict Jan 2016 NDVI</span>
<span id="cb24-511"><a href="#cb24-511" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sequence 2: <span class="co">[</span><span class="ot">Feb 2015 - Jan 2016</span><span class="co">]</span> → Predict Feb 2016 NDVI</span>
<span id="cb24-512"><a href="#cb24-512" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>...and so on</span>
<span id="cb24-513"><a href="#cb24-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-514"><a href="#cb24-514" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 3.3 Temporal Train-Validation-Test Split</span></span>
<span id="cb24-515"><a href="#cb24-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-516"><a href="#cb24-516" aria-hidden="true" tabindex="-1"></a>**Critical:** Use temporal splits (not random) to avoid data leakage!</span>
<span id="cb24-517"><a href="#cb24-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-518"><a href="#cb24-518" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-519"><a href="#cb24-519" aria-hidden="true" tabindex="-1"></a><span class="co"># Define split points</span></span>
<span id="cb24-520"><a href="#cb24-520" aria-hidden="true" tabindex="-1"></a>train_end <span class="op">=</span> pd.Timestamp(<span class="st">'2019-12-31'</span>)</span>
<span id="cb24-521"><a href="#cb24-521" aria-hidden="true" tabindex="-1"></a>val_end <span class="op">=</span> pd.Timestamp(<span class="st">'2020-12-31'</span>)</span>
<span id="cb24-522"><a href="#cb24-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-523"><a href="#cb24-523" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices</span></span>
<span id="cb24-524"><a href="#cb24-524" aria-hidden="true" tabindex="-1"></a>train_mask <span class="op">=</span> dates <span class="op">&lt;=</span> train_end</span>
<span id="cb24-525"><a href="#cb24-525" aria-hidden="true" tabindex="-1"></a>val_mask <span class="op">=</span> (dates <span class="op">&gt;</span> train_end) <span class="op">&amp;</span> (dates <span class="op">&lt;=</span> val_end)</span>
<span id="cb24-526"><a href="#cb24-526" aria-hidden="true" tabindex="-1"></a>test_mask <span class="op">=</span> dates <span class="op">&gt;</span> val_end</span>
<span id="cb24-527"><a href="#cb24-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-528"><a href="#cb24-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb24-529"><a href="#cb24-529" aria-hidden="true" tabindex="-1"></a>X_train, y_train <span class="op">=</span> X[train_mask], y[train_mask]</span>
<span id="cb24-530"><a href="#cb24-530" aria-hidden="true" tabindex="-1"></a>X_val, y_val <span class="op">=</span> X[val_mask], y[val_mask]</span>
<span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> X[test_mask], y[test_mask]</span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a>dates_train <span class="op">=</span> dates[train_mask]</span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>dates_val <span class="op">=</span> dates[val_mask]</span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a>dates_test <span class="op">=</span> dates[test_mask]</span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data Split:"</span>)</span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Train: </span><span class="sc">{</span><span class="bu">len</span>(X_train)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_train[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_train[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Val:   </span><span class="sc">{</span><span class="bu">len</span>(X_val)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_val[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_val[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Test:  </span><span class="sc">{</span><span class="bu">len</span>(X_test)<span class="sc">}</span><span class="ss"> sequences (</span><span class="sc">{</span>dates_test[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>dates_test[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a>**Expected Split:**</span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Training: 2015-2019 (~80%)</span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validation: 2020 (~10%)</span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test: 2021 (~10%)</span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a><span class="fu">## Avoid Data Leakage!</span></span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a>**Never** use random train-test split for time series!</span>
<span id="cb24-552"><a href="#cb24-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-553"><a href="#cb24-553" aria-hidden="true" tabindex="-1"></a>**Why?** Random splits allow the model to "see the future" during training, leading to unrealistically high performance that fails in operational deployment.</span>
<span id="cb24-554"><a href="#cb24-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-555"><a href="#cb24-555" aria-hidden="true" tabindex="-1"></a>**Always** split temporally: train on past, validate on recent past, test on future.</span>
<span id="cb24-556"><a href="#cb24-556" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-557"><a href="#cb24-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-558"><a href="#cb24-558" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-559"><a href="#cb24-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-560"><a href="#cb24-560" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 4: LSTM Model Building (30 minutes)</span></span>
<span id="cb24-561"><a href="#cb24-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-562"><a href="#cb24-562" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 4.1 Define LSTM Architecture</span></span>
<span id="cb24-563"><a href="#cb24-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-564"><a href="#cb24-564" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-565"><a href="#cb24-565" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_lstm_model(input_shape, lstm_units<span class="op">=</span>[<span class="dv">64</span>, <span class="dv">32</span>], dropout<span class="op">=</span><span class="fl">0.2</span>, learning_rate<span class="op">=</span><span class="fl">0.001</span>):</span>
<span id="cb24-566"><a href="#cb24-566" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-567"><a href="#cb24-567" aria-hidden="true" tabindex="-1"></a><span class="co">    Build LSTM model for time series forecasting.</span></span>
<span id="cb24-568"><a href="#cb24-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-569"><a href="#cb24-569" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb24-570"><a href="#cb24-570" aria-hidden="true" tabindex="-1"></a><span class="co">        input_shape: (time_steps, n_features)</span></span>
<span id="cb24-571"><a href="#cb24-571" aria-hidden="true" tabindex="-1"></a><span class="co">        lstm_units: List of units for each LSTM layer</span></span>
<span id="cb24-572"><a href="#cb24-572" aria-hidden="true" tabindex="-1"></a><span class="co">        dropout: Dropout rate for regularization</span></span>
<span id="cb24-573"><a href="#cb24-573" aria-hidden="true" tabindex="-1"></a><span class="co">        learning_rate: Optimizer learning rate</span></span>
<span id="cb24-574"><a href="#cb24-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-575"><a href="#cb24-575" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb24-576"><a href="#cb24-576" aria-hidden="true" tabindex="-1"></a><span class="co">        Compiled Keras model</span></span>
<span id="cb24-577"><a href="#cb24-577" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-578"><a href="#cb24-578" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential(name<span class="op">=</span><span class="st">'LSTM_Drought_Forecaster'</span>)</span>
<span id="cb24-579"><a href="#cb24-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-580"><a href="#cb24-580" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First LSTM layer (return sequences for stacking)</span></span>
<span id="cb24-581"><a href="#cb24-581" aria-hidden="true" tabindex="-1"></a>    model.add(LSTM(</span>
<span id="cb24-582"><a href="#cb24-582" aria-hidden="true" tabindex="-1"></a>        units<span class="op">=</span>lstm_units[<span class="dv">0</span>],</span>
<span id="cb24-583"><a href="#cb24-583" aria-hidden="true" tabindex="-1"></a>        return_sequences<span class="op">=</span><span class="va">True</span> <span class="cf">if</span> <span class="bu">len</span>(lstm_units) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="va">False</span>,</span>
<span id="cb24-584"><a href="#cb24-584" aria-hidden="true" tabindex="-1"></a>        input_shape<span class="op">=</span>input_shape,</span>
<span id="cb24-585"><a href="#cb24-585" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'LSTM_Layer_1'</span></span>
<span id="cb24-586"><a href="#cb24-586" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb24-587"><a href="#cb24-587" aria-hidden="true" tabindex="-1"></a>    model.add(Dropout(dropout, name<span class="op">=</span><span class="st">'Dropout_1'</span>))</span>
<span id="cb24-588"><a href="#cb24-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-589"><a href="#cb24-589" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional LSTM layers</span></span>
<span id="cb24-590"><a href="#cb24-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, units <span class="kw">in</span> <span class="bu">enumerate</span>(lstm_units[<span class="dv">1</span>:], start<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb24-591"><a href="#cb24-591" aria-hidden="true" tabindex="-1"></a>        return_seq <span class="op">=</span> (i <span class="op">&lt;</span> <span class="bu">len</span>(lstm_units))</span>
<span id="cb24-592"><a href="#cb24-592" aria-hidden="true" tabindex="-1"></a>        model.add(LSTM(</span>
<span id="cb24-593"><a href="#cb24-593" aria-hidden="true" tabindex="-1"></a>            units<span class="op">=</span>units,</span>
<span id="cb24-594"><a href="#cb24-594" aria-hidden="true" tabindex="-1"></a>            return_sequences<span class="op">=</span>return_seq,</span>
<span id="cb24-595"><a href="#cb24-595" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span><span class="ss">f'LSTM_Layer_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb24-596"><a href="#cb24-596" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb24-597"><a href="#cb24-597" aria-hidden="true" tabindex="-1"></a>        model.add(Dropout(dropout, name<span class="op">=</span><span class="ss">f'Dropout_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>))</span>
<span id="cb24-598"><a href="#cb24-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-599"><a href="#cb24-599" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dense layers for output</span></span>
<span id="cb24-600"><a href="#cb24-600" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">16</span>, activation<span class="op">=</span><span class="st">'relu'</span>, name<span class="op">=</span><span class="st">'Dense_1'</span>))</span>
<span id="cb24-601"><a href="#cb24-601" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>, name<span class="op">=</span><span class="st">'Output'</span>))</span>
<span id="cb24-602"><a href="#cb24-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-603"><a href="#cb24-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compile model</span></span>
<span id="cb24-604"><a href="#cb24-604" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb24-605"><a href="#cb24-605" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(</span>
<span id="cb24-606"><a href="#cb24-606" aria-hidden="true" tabindex="-1"></a>        optimizer<span class="op">=</span>optimizer,</span>
<span id="cb24-607"><a href="#cb24-607" aria-hidden="true" tabindex="-1"></a>        loss<span class="op">=</span><span class="st">'mean_squared_error'</span>,</span>
<span id="cb24-608"><a href="#cb24-608" aria-hidden="true" tabindex="-1"></a>        metrics<span class="op">=</span>[<span class="st">'mae'</span>, <span class="st">'mse'</span>]</span>
<span id="cb24-609"><a href="#cb24-609" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-610"><a href="#cb24-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-611"><a href="#cb24-611" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb24-612"><a href="#cb24-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-613"><a href="#cb24-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Build model</span></span>
<span id="cb24-614"><a href="#cb24-614" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (LOOKBACK_WINDOW, <span class="bu">len</span>(feature_columns))</span>
<span id="cb24-615"><a href="#cb24-615" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> build_lstm_model(</span>
<span id="cb24-616"><a href="#cb24-616" aria-hidden="true" tabindex="-1"></a>    input_shape<span class="op">=</span>input_shape,</span>
<span id="cb24-617"><a href="#cb24-617" aria-hidden="true" tabindex="-1"></a>    lstm_units<span class="op">=</span>[<span class="dv">64</span>, <span class="dv">32</span>],</span>
<span id="cb24-618"><a href="#cb24-618" aria-hidden="true" tabindex="-1"></a>    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb24-619"><a href="#cb24-619" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb24-620"><a href="#cb24-620" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-621"><a href="#cb24-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-622"><a href="#cb24-622" aria-hidden="true" tabindex="-1"></a><span class="co"># Display architecture</span></span>
<span id="cb24-623"><a href="#cb24-623" aria-hidden="true" tabindex="-1"></a>model.summary()</span>
<span id="cb24-624"><a href="#cb24-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-625"><a href="#cb24-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-626"><a href="#cb24-626" aria-hidden="true" tabindex="-1"></a>**Architecture Summary:**</span>
<span id="cb24-627"><a href="#cb24-627" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Input: (12, 4) - 12 time steps, 4 features</span>
<span id="cb24-628"><a href="#cb24-628" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>LSTM Layer 1: 64 units</span>
<span id="cb24-629"><a href="#cb24-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dropout: 0.2</span>
<span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>LSTM Layer 2: 32 units</span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dropout: 0.2</span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dense: 16 units (ReLU)</span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Output: 1 unit (linear, NDVI prediction)</span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a>**Total Parameters:** ~30,000</span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 4.2 Configure Callbacks</span></span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a><span class="co"># Define callbacks</span></span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a>callbacks <span class="op">=</span> [</span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Early stopping: stop if validation loss doesn't improve</span></span>
<span id="cb24-643"><a href="#cb24-643" aria-hidden="true" tabindex="-1"></a>    EarlyStopping(</span>
<span id="cb24-644"><a href="#cb24-644" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb24-645"><a href="#cb24-645" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb24-646"><a href="#cb24-646" aria-hidden="true" tabindex="-1"></a>        restore_best_weights<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-647"><a href="#cb24-647" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb24-648"><a href="#cb24-648" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-649"><a href="#cb24-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-650"><a href="#cb24-650" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model checkpoint: save best model</span></span>
<span id="cb24-651"><a href="#cb24-651" aria-hidden="true" tabindex="-1"></a>    ModelCheckpoint(</span>
<span id="cb24-652"><a href="#cb24-652" aria-hidden="true" tabindex="-1"></a>        filepath<span class="op">=</span><span class="st">'models/lstm_drought_best.h5'</span>,</span>
<span id="cb24-653"><a href="#cb24-653" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb24-654"><a href="#cb24-654" aria-hidden="true" tabindex="-1"></a>        save_best_only<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Learning rate reduction: reduce LR on plateau</span></span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a>    ReduceLROnPlateau(</span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a>        monitor<span class="op">=</span><span class="st">'val_loss'</span>,</span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a>        patience<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb24-663"><a href="#cb24-663" aria-hidden="true" tabindex="-1"></a>        min_lr<span class="op">=</span><span class="fl">1e-6</span>,</span>
<span id="cb24-664"><a href="#cb24-664" aria-hidden="true" tabindex="-1"></a>        verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb24-665"><a href="#cb24-665" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-666"><a href="#cb24-666" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-667"><a href="#cb24-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-668"><a href="#cb24-668" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Callbacks configured:"</span>)</span>
<span id="cb24-669"><a href="#cb24-669" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Early stopping (patience=20)"</span>)</span>
<span id="cb24-670"><a href="#cb24-670" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Model checkpoint (save best)"</span>)</span>
<span id="cb24-671"><a href="#cb24-671" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Learning rate reduction"</span>)</span>
<span id="cb24-672"><a href="#cb24-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-673"><a href="#cb24-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-674"><a href="#cb24-674" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-675"><a href="#cb24-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-676"><a href="#cb24-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 5: Model Training (20 minutes)</span></span>
<span id="cb24-677"><a href="#cb24-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-678"><a href="#cb24-678" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-679"><a href="#cb24-679" aria-hidden="true" tabindex="-1"></a><span class="co"># Training parameters</span></span>
<span id="cb24-680"><a href="#cb24-680" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb24-681"><a href="#cb24-681" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb24-682"><a href="#cb24-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-683"><a href="#cb24-683" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb24-684"><a href="#cb24-684" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting training..."</span>)</span>
<span id="cb24-685"><a href="#cb24-685" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb24-686"><a href="#cb24-686" aria-hidden="true" tabindex="-1"></a>    X_train, y_train,</span>
<span id="cb24-687"><a href="#cb24-687" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(X_val, y_val),</span>
<span id="cb24-688"><a href="#cb24-688" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>EPOCHS,</span>
<span id="cb24-689"><a href="#cb24-689" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>BATCH_SIZE,</span>
<span id="cb24-690"><a href="#cb24-690" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>callbacks,</span>
<span id="cb24-691"><a href="#cb24-691" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb24-692"><a href="#cb24-692" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-693"><a href="#cb24-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-694"><a href="#cb24-694" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Training complete!"</span>)</span>
<span id="cb24-695"><a href="#cb24-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-696"><a href="#cb24-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-697"><a href="#cb24-697" aria-hidden="true" tabindex="-1"></a>**Expected Training Time:**</span>
<span id="cb24-698"><a href="#cb24-698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CPU: 5-10 minutes</span>
<span id="cb24-699"><a href="#cb24-699" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GPU: 1-3 minutes</span>
<span id="cb24-700"><a href="#cb24-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-701"><a href="#cb24-701" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 5.1 Plot Training History</span></span>
<span id="cb24-702"><a href="#cb24-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-703"><a href="#cb24-703" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-704"><a href="#cb24-704" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training curves</span></span>
<span id="cb24-705"><a href="#cb24-705" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb24-706"><a href="#cb24-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-707"><a href="#cb24-707" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss</span></span>
<span id="cb24-708"><a href="#cb24-708" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(history.history[<span class="st">'loss'</span>], label<span class="op">=</span><span class="st">'Train Loss'</span>)</span>
<span id="cb24-709"><a href="#cb24-709" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(history.history[<span class="st">'val_loss'</span>], label<span class="op">=</span><span class="st">'Validation Loss'</span>)</span>
<span id="cb24-710"><a href="#cb24-710" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb24-711"><a href="#cb24-711" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'MSE Loss'</span>)</span>
<span id="cb24-712"><a href="#cb24-712" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Training and Validation Loss'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-713"><a href="#cb24-713" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb24-714"><a href="#cb24-714" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-715"><a href="#cb24-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-716"><a href="#cb24-716" aria-hidden="true" tabindex="-1"></a><span class="co"># MAE</span></span>
<span id="cb24-717"><a href="#cb24-717" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(history.history[<span class="st">'mae'</span>], label<span class="op">=</span><span class="st">'Train MAE'</span>)</span>
<span id="cb24-718"><a href="#cb24-718" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(history.history[<span class="st">'val_mae'</span>], label<span class="op">=</span><span class="st">'Validation MAE'</span>)</span>
<span id="cb24-719"><a href="#cb24-719" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb24-720"><a href="#cb24-720" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'MAE'</span>)</span>
<span id="cb24-721"><a href="#cb24-721" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Training and Validation MAE'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-722"><a href="#cb24-722" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend()</span>
<span id="cb24-723"><a href="#cb24-723" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-724"><a href="#cb24-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-725"><a href="#cb24-725" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-726"><a href="#cb24-726" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-727"><a href="#cb24-727" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-728"><a href="#cb24-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-729"><a href="#cb24-729" aria-hidden="true" tabindex="-1"></a>**Interpretation:**</span>
<span id="cb24-730"><a href="#cb24-730" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Both train and validation loss should decrease</span>
<span id="cb24-731"><a href="#cb24-731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validation loss should stabilize (early stopping prevents overfitting)</span>
<span id="cb24-732"><a href="#cb24-732" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gap between train and val indicates overfitting degree</span>
<span id="cb24-733"><a href="#cb24-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-734"><a href="#cb24-734" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb24-735"><a href="#cb24-735" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2: Training Analysis</span></span>
<span id="cb24-736"><a href="#cb24-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-737"><a href="#cb24-737" aria-hidden="true" tabindex="-1"></a>**Questions:**</span>
<span id="cb24-738"><a href="#cb24-738" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>At what epoch did early stopping trigger?</span>
<span id="cb24-739"><a href="#cb24-739" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Is there evidence of overfitting (large train-val gap)?</span>
<span id="cb24-740"><a href="#cb24-740" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>What final validation MAE was achieved?</span>
<span id="cb24-741"><a href="#cb24-741" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How might you improve the model?</span>
<span id="cb24-742"><a href="#cb24-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-743"><a href="#cb24-743" aria-hidden="true" tabindex="-1"></a>**Time:** 5 minutes</span>
<span id="cb24-744"><a href="#cb24-744" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-745"><a href="#cb24-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-746"><a href="#cb24-746" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-747"><a href="#cb24-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-748"><a href="#cb24-748" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 6: Model Evaluation (30 minutes)</span></span>
<span id="cb24-749"><a href="#cb24-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-750"><a href="#cb24-750" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 6.1 Make Predictions</span></span>
<span id="cb24-751"><a href="#cb24-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-752"><a href="#cb24-752" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-753"><a href="#cb24-753" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions on all sets</span></span>
<span id="cb24-754"><a href="#cb24-754" aria-hidden="true" tabindex="-1"></a>y_train_pred <span class="op">=</span> model.predict(X_train).flatten()</span>
<span id="cb24-755"><a href="#cb24-755" aria-hidden="true" tabindex="-1"></a>y_val_pred <span class="op">=</span> model.predict(X_val).flatten()</span>
<span id="cb24-756"><a href="#cb24-756" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> model.predict(X_test).flatten()</span>
<span id="cb24-757"><a href="#cb24-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-758"><a href="#cb24-758" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Predictions generated for train, validation, and test sets."</span>)</span>
<span id="cb24-759"><a href="#cb24-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-760"><a href="#cb24-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-761"><a href="#cb24-761" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 6.2 Calculate Metrics</span></span>
<span id="cb24-762"><a href="#cb24-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-763"><a href="#cb24-763" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-764"><a href="#cb24-764" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics(y_true, y_pred, set_name):</span>
<span id="cb24-765"><a href="#cb24-765" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate and print evaluation metrics."""</span></span>
<span id="cb24-766"><a href="#cb24-766" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(mean_squared_error(y_true, y_pred))</span>
<span id="cb24-767"><a href="#cb24-767" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb24-768"><a href="#cb24-768" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb24-769"><a href="#cb24-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-770"><a href="#cb24-770" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>set_name<span class="sc">}</span><span class="ss"> Metrics:"</span>)</span>
<span id="cb24-771"><a href="#cb24-771" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  RMSE: </span><span class="sc">{</span>rmse<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb24-772"><a href="#cb24-772" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  MAE:  </span><span class="sc">{</span>mae<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb24-773"><a href="#cb24-773" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  R²:   </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb24-774"><a href="#cb24-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-775"><a href="#cb24-775" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">'rmse'</span>: rmse, <span class="st">'mae'</span>: mae, <span class="st">'r2'</span>: r2}</span>
<span id="cb24-776"><a href="#cb24-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-777"><a href="#cb24-777" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb24-778"><a href="#cb24-778" aria-hidden="true" tabindex="-1"></a>train_metrics <span class="op">=</span> calculate_metrics(y_train, y_train_pred, <span class="st">"Training"</span>)</span>
<span id="cb24-779"><a href="#cb24-779" aria-hidden="true" tabindex="-1"></a>val_metrics <span class="op">=</span> calculate_metrics(y_val, y_val_pred, <span class="st">"Validation"</span>)</span>
<span id="cb24-780"><a href="#cb24-780" aria-hidden="true" tabindex="-1"></a>test_metrics <span class="op">=</span> calculate_metrics(y_test, y_test_pred, <span class="st">"Test"</span>)</span>
<span id="cb24-781"><a href="#cb24-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-782"><a href="#cb24-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-783"><a href="#cb24-783" aria-hidden="true" tabindex="-1"></a>**Expected Performance:**</span>
<span id="cb24-784"><a href="#cb24-784" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RMSE: &lt; 0.05 (on normalized 0-1 scale)</span>
<span id="cb24-785"><a href="#cb24-785" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>MAE: &lt; 0.03</span>
<span id="cb24-786"><a href="#cb24-786" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R²: &gt; 0.85</span>
<span id="cb24-787"><a href="#cb24-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-788"><a href="#cb24-788" aria-hidden="true" tabindex="-1"></a>**Interpretation:**</span>
<span id="cb24-789"><a href="#cb24-789" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RMSE of 0.05 means ±0.05 error on NDVI scale</span>
<span id="cb24-790"><a href="#cb24-790" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For typical NDVI range <span class="co">[</span><span class="ot">0.3-0.8</span><span class="co">]</span>, this is ~10% relative error</span>
<span id="cb24-791"><a href="#cb24-791" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Acceptable for early warning (trend detection matters more than exact values)</span>
<span id="cb24-792"><a href="#cb24-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-793"><a href="#cb24-793" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 6.3 Visualize Predictions vs. Actual</span></span>
<span id="cb24-794"><a href="#cb24-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-795"><a href="#cb24-795" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-796"><a href="#cb24-796" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse transform predictions to original scale</span></span>
<span id="cb24-797"><a href="#cb24-797" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inverse_transform_ndvi(values, scaler, feature_columns):</span>
<span id="cb24-798"><a href="#cb24-798" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Inverse transform NDVI values back to original scale."""</span></span>
<span id="cb24-799"><a href="#cb24-799" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dummy array with all features</span></span>
<span id="cb24-800"><a href="#cb24-800" aria-hidden="true" tabindex="-1"></a>    dummy <span class="op">=</span> np.zeros((<span class="bu">len</span>(values), <span class="bu">len</span>(feature_columns)))</span>
<span id="cb24-801"><a href="#cb24-801" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Place NDVI values in correct column</span></span>
<span id="cb24-802"><a href="#cb24-802" aria-hidden="true" tabindex="-1"></a>    ndvi_idx <span class="op">=</span> feature_columns.index(<span class="st">'ndvi'</span>)</span>
<span id="cb24-803"><a href="#cb24-803" aria-hidden="true" tabindex="-1"></a>    dummy[:, ndvi_idx] <span class="op">=</span> values</span>
<span id="cb24-804"><a href="#cb24-804" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inverse transform</span></span>
<span id="cb24-805"><a href="#cb24-805" aria-hidden="true" tabindex="-1"></a>    inverse <span class="op">=</span> scaler.inverse_transform(dummy)</span>
<span id="cb24-806"><a href="#cb24-806" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inverse[:, ndvi_idx]</span>
<span id="cb24-807"><a href="#cb24-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-808"><a href="#cb24-808" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse transform</span></span>
<span id="cb24-809"><a href="#cb24-809" aria-hidden="true" tabindex="-1"></a>y_test_actual <span class="op">=</span> inverse_transform_ndvi(y_test, scaler, feature_columns)</span>
<span id="cb24-810"><a href="#cb24-810" aria-hidden="true" tabindex="-1"></a>y_test_pred_original <span class="op">=</span> inverse_transform_ndvi(y_test_pred, scaler, feature_columns)</span>
<span id="cb24-811"><a href="#cb24-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-812"><a href="#cb24-812" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot time series comparison</span></span>
<span id="cb24-813"><a href="#cb24-813" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb24-814"><a href="#cb24-814" aria-hidden="true" tabindex="-1"></a>ax.plot(dates_test, y_test_actual, label<span class="op">=</span><span class="st">'Actual NDVI'</span>, color<span class="op">=</span><span class="st">'green'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb24-815"><a href="#cb24-815" aria-hidden="true" tabindex="-1"></a>ax.plot(dates_test, y_test_pred_original, label<span class="op">=</span><span class="st">'Predicted NDVI'</span>, color<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, marker<span class="op">=</span><span class="st">'x'</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb24-816"><a href="#cb24-816" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Date'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-817"><a href="#cb24-817" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-818"><a href="#cb24-818" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'LSTM Drought Forecasting: Predicted vs. Actual (Test Set 2021)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-819"><a href="#cb24-819" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb24-820"><a href="#cb24-820" aria-hidden="true" tabindex="-1"></a>ax.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-821"><a href="#cb24-821" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-822"><a href="#cb24-822" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-823"><a href="#cb24-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-824"><a href="#cb24-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-825"><a href="#cb24-825" aria-hidden="true" tabindex="-1"></a>**Analysis:**</span>
<span id="cb24-826"><a href="#cb24-826" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How well does the model capture seasonal dips?</span>
<span id="cb24-827"><a href="#cb24-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Does it predict drought onset (rapid NDVI decline)?</span>
<span id="cb24-828"><a href="#cb24-828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Are there systematic errors (consistent over/under-prediction)?</span>
<span id="cb24-829"><a href="#cb24-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-830"><a href="#cb24-830" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 6.4 Scatter Plot (Predicted vs. Actual)</span></span>
<span id="cb24-831"><a href="#cb24-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-832"><a href="#cb24-832" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-833"><a href="#cb24-833" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb24-834"><a href="#cb24-834" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb24-835"><a href="#cb24-835" aria-hidden="true" tabindex="-1"></a>ax.scatter(y_test_actual, y_test_pred_original, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">'k'</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb24-836"><a href="#cb24-836" aria-hidden="true" tabindex="-1"></a>ax.plot([y_test_actual.<span class="bu">min</span>(), y_test_actual.<span class="bu">max</span>()],</span>
<span id="cb24-837"><a href="#cb24-837" aria-hidden="true" tabindex="-1"></a>        [y_test_actual.<span class="bu">min</span>(), y_test_actual.<span class="bu">max</span>()],</span>
<span id="cb24-838"><a href="#cb24-838" aria-hidden="true" tabindex="-1"></a>        <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Perfect Prediction'</span>)</span>
<span id="cb24-839"><a href="#cb24-839" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Actual NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-840"><a href="#cb24-840" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Predicted NDVI'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-841"><a href="#cb24-841" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Predicted vs. Actual NDVI (Test Set)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-842"><a href="#cb24-842" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb24-843"><a href="#cb24-843" aria-hidden="true" tabindex="-1"></a>ax.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-844"><a href="#cb24-844" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-845"><a href="#cb24-845" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-846"><a href="#cb24-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-847"><a href="#cb24-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-848"><a href="#cb24-848" aria-hidden="true" tabindex="-1"></a>**Ideal Result:** Points clustered tightly along the red diagonal line</span>
<span id="cb24-849"><a href="#cb24-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-850"><a href="#cb24-850" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 6.5 Residual Analysis</span></span>
<span id="cb24-851"><a href="#cb24-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-852"><a href="#cb24-852" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-853"><a href="#cb24-853" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals</span></span>
<span id="cb24-854"><a href="#cb24-854" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_test_actual <span class="op">-</span> y_test_pred_original</span>
<span id="cb24-855"><a href="#cb24-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-856"><a href="#cb24-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals over time</span></span>
<span id="cb24-857"><a href="#cb24-857" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb24-858"><a href="#cb24-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-859"><a href="#cb24-859" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals time series</span></span>
<span id="cb24-860"><a href="#cb24-860" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(dates_test, residuals, color<span class="op">=</span><span class="st">'purple'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-861"><a href="#cb24-861" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-862"><a href="#cb24-862" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].fill_between(dates_test, residuals, <span class="dv">0</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb24-863"><a href="#cb24-863" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb24-864"><a href="#cb24-864" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Residual (Actual - Predicted)'</span>)</span>
<span id="cb24-865"><a href="#cb24-865" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Prediction Residuals Over Time'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-866"><a href="#cb24-866" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-867"><a href="#cb24-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-868"><a href="#cb24-868" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals histogram</span></span>
<span id="cb24-869"><a href="#cb24-869" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(residuals, bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'purple'</span>)</span>
<span id="cb24-870"><a href="#cb24-870" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-871"><a href="#cb24-871" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Residual'</span>)</span>
<span id="cb24-872"><a href="#cb24-872" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb24-873"><a href="#cb24-873" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Residual Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb24-874"><a href="#cb24-874" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-875"><a href="#cb24-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-876"><a href="#cb24-876" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-877"><a href="#cb24-877" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-878"><a href="#cb24-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-879"><a href="#cb24-879" aria-hidden="true" tabindex="-1"></a><span class="co"># Print residual statistics</span></span>
<span id="cb24-880"><a href="#cb24-880" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual mean: </span><span class="sc">{</span>residuals<span class="sc">.</span>mean()<span class="sc">:.4f}</span><span class="ss"> (should be ~0)"</span>)</span>
<span id="cb24-881"><a href="#cb24-881" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual std: </span><span class="sc">{</span>residuals<span class="sc">.</span>std()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb24-882"><a href="#cb24-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-883"><a href="#cb24-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-884"><a href="#cb24-884" aria-hidden="true" tabindex="-1"></a>**Good Model Indicators:**</span>
<span id="cb24-885"><a href="#cb24-885" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Residuals centered around 0 (no systematic bias)</span>
<span id="cb24-886"><a href="#cb24-886" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Residuals normally distributed</span>
<span id="cb24-887"><a href="#cb24-887" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No patterns in residual time series (random noise)</span>
<span id="cb24-888"><a href="#cb24-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-889"><a href="#cb24-889" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb24-890"><a href="#cb24-890" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3: Model Evaluation</span></span>
<span id="cb24-891"><a href="#cb24-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-892"><a href="#cb24-892" aria-hidden="true" tabindex="-1"></a>**Tasks:**</span>
<span id="cb24-893"><a href="#cb24-893" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Identify the period with largest prediction errors. What might cause this?</span>
<span id="cb24-894"><a href="#cb24-894" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Is the model better at predicting high NDVI (wet season) or low NDVI (dry season)?</span>
<span id="cb24-895"><a href="#cb24-895" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Calculate the percentage of predictions within ±0.05 NDVI error</span>
<span id="cb24-896"><a href="#cb24-896" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Would this model be useful for operational drought warning? Why or why not?</span>
<span id="cb24-897"><a href="#cb24-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-898"><a href="#cb24-898" aria-hidden="true" tabindex="-1"></a>**Time:** 10 minutes</span>
<span id="cb24-899"><a href="#cb24-899" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-900"><a href="#cb24-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-901"><a href="#cb24-901" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-902"><a href="#cb24-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-903"><a href="#cb24-903" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 7: Multi-Step Forecasting (15 minutes)</span></span>
<span id="cb24-904"><a href="#cb24-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-905"><a href="#cb24-905" aria-hidden="true" tabindex="-1"></a>**Extending to 3-Month Ahead Forecasts:**</span>
<span id="cb24-906"><a href="#cb24-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-907"><a href="#cb24-907" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-908"><a href="#cb24-908" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forecast_multistep(model, initial_sequence, scaler, feature_columns, n_steps<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb24-909"><a href="#cb24-909" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-910"><a href="#cb24-910" aria-hidden="true" tabindex="-1"></a><span class="co">    Perform multi-step ahead forecasting.</span></span>
<span id="cb24-911"><a href="#cb24-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-912"><a href="#cb24-912" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb24-913"><a href="#cb24-913" aria-hidden="true" tabindex="-1"></a><span class="co">        model: Trained LSTM model</span></span>
<span id="cb24-914"><a href="#cb24-914" aria-hidden="true" tabindex="-1"></a><span class="co">        initial_sequence: Initial input sequence (lookback, n_features)</span></span>
<span id="cb24-915"><a href="#cb24-915" aria-hidden="true" tabindex="-1"></a><span class="co">        scaler: Fitted scaler for inverse transform</span></span>
<span id="cb24-916"><a href="#cb24-916" aria-hidden="true" tabindex="-1"></a><span class="co">        feature_columns: List of feature names</span></span>
<span id="cb24-917"><a href="#cb24-917" aria-hidden="true" tabindex="-1"></a><span class="co">        n_steps: Number of steps to forecast ahead</span></span>
<span id="cb24-918"><a href="#cb24-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-919"><a href="#cb24-919" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb24-920"><a href="#cb24-920" aria-hidden="true" tabindex="-1"></a><span class="co">        List of predictions</span></span>
<span id="cb24-921"><a href="#cb24-921" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-922"><a href="#cb24-922" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> []</span>
<span id="cb24-923"><a href="#cb24-923" aria-hidden="true" tabindex="-1"></a>    current_sequence <span class="op">=</span> initial_sequence.copy()</span>
<span id="cb24-924"><a href="#cb24-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-925"><a href="#cb24-925" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(n_steps):</span>
<span id="cb24-926"><a href="#cb24-926" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict next value</span></span>
<span id="cb24-927"><a href="#cb24-927" aria-hidden="true" tabindex="-1"></a>        pred <span class="op">=</span> model.predict(current_sequence[np.newaxis, :, :], verbose<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb24-928"><a href="#cb24-928" aria-hidden="true" tabindex="-1"></a>        predictions.append(pred)</span>
<span id="cb24-929"><a href="#cb24-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-930"><a href="#cb24-930" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update sequence: shift left, add prediction</span></span>
<span id="cb24-931"><a href="#cb24-931" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Note: In practice, you'd need to forecast other features too (rainfall, temp)</span></span>
<span id="cb24-932"><a href="#cb24-932" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Here we assume they're known or use climatology</span></span>
<span id="cb24-933"><a href="#cb24-933" aria-hidden="true" tabindex="-1"></a>        current_sequence <span class="op">=</span> np.roll(current_sequence, <span class="op">-</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb24-934"><a href="#cb24-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-935"><a href="#cb24-935" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set predicted NDVI in last position</span></span>
<span id="cb24-936"><a href="#cb24-936" aria-hidden="true" tabindex="-1"></a>        ndvi_idx <span class="op">=</span> feature_columns.index(<span class="st">'ndvi'</span>)</span>
<span id="cb24-937"><a href="#cb24-937" aria-hidden="true" tabindex="-1"></a>        current_sequence[<span class="op">-</span><span class="dv">1</span>, ndvi_idx] <span class="op">=</span> pred</span>
<span id="cb24-938"><a href="#cb24-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-939"><a href="#cb24-939" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For other features, use last known values (simplified)</span></span>
<span id="cb24-940"><a href="#cb24-940" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In production, use weather forecasts</span></span>
<span id="cb24-941"><a href="#cb24-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-942"><a href="#cb24-942" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predictions</span>
<span id="cb24-943"><a href="#cb24-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-944"><a href="#cb24-944" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Forecast 3 months ahead from last test sequence</span></span>
<span id="cb24-945"><a href="#cb24-945" aria-hidden="true" tabindex="-1"></a>initial_seq <span class="op">=</span> X_test[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb24-946"><a href="#cb24-946" aria-hidden="true" tabindex="-1"></a>multi_step_preds <span class="op">=</span> forecast_multistep(model, initial_seq, scaler, feature_columns, n_steps<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb24-947"><a href="#cb24-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-948"><a href="#cb24-948" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3-Month Ahead Forecast:"</span>)</span>
<span id="cb24-949"><a href="#cb24-949" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, pred <span class="kw">in</span> <span class="bu">enumerate</span>(multi_step_preds, start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb24-950"><a href="#cb24-950" aria-hidden="true" tabindex="-1"></a>    pred_original <span class="op">=</span> inverse_transform_ndvi(np.array([pred]), scaler, feature_columns)[<span class="dv">0</span>]</span>
<span id="cb24-951"><a href="#cb24-951" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Month +</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: NDVI = </span><span class="sc">{</span>pred_original<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb24-952"><a href="#cb24-952" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-953"><a href="#cb24-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-954"><a href="#cb24-954" aria-hidden="true" tabindex="-1"></a>**Challenges:**</span>
<span id="cb24-955"><a href="#cb24-955" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Prediction uncertainty compounds over multiple steps</span>
<span id="cb24-956"><a href="#cb24-956" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Need forecasts of input features (rainfall, temperature)</span>
<span id="cb24-957"><a href="#cb24-957" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Alternative: Use ensemble models or probabilistic forecasting</span>
<span id="cb24-958"><a href="#cb24-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-959"><a href="#cb24-959" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-960"><a href="#cb24-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-961"><a href="#cb24-961" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 8: Operational Deployment Considerations (10 minutes)</span></span>
<span id="cb24-962"><a href="#cb24-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-963"><a href="#cb24-963" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 8.1 Integration with Philippine Agencies</span></span>
<span id="cb24-964"><a href="#cb24-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-965"><a href="#cb24-965" aria-hidden="true" tabindex="-1"></a>**Data Pipeline:**</span>
<span id="cb24-966"><a href="#cb24-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-967"><a href="#cb24-967" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Automated Data Acquisition:**</span>
<span id="cb24-968"><a href="#cb24-968" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sentinel-2 NDVI: Download from CoPhil Infrastructure or Google Earth Engine</span>
<span id="cb24-969"><a href="#cb24-969" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>PAGASA data: API access to rainfall and temperature</span>
<span id="cb24-970"><a href="#cb24-970" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>NOAA ONI: Monthly updates</span>
<span id="cb24-971"><a href="#cb24-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-972"><a href="#cb24-972" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Preprocessing:**</span>
<span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Cloud masking (QA bands)</span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Temporal aggregation (10-day composites)</span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Spatial aggregation (province/municipality means)</span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-977"><a href="#cb24-977" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Model Inference:**</span>
<span id="cb24-978"><a href="#cb24-978" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Run monthly predictions</span>
<span id="cb24-979"><a href="#cb24-979" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Generate 1-month and 3-month forecasts</span>
<span id="cb24-980"><a href="#cb24-980" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Calculate confidence intervals</span>
<span id="cb24-981"><a href="#cb24-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-982"><a href="#cb24-982" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Alerting:**</span>
<span id="cb24-983"><a href="#cb24-983" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Define drought threshold (e.g., NDVI &lt; 0.4 for 2 consecutive months)</span>
<span id="cb24-984"><a href="#cb24-984" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Trigger alerts when predicted NDVI falls below threshold</span>
<span id="cb24-985"><a href="#cb24-985" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Send notifications to DA, PAGASA, LGUs</span>
<span id="cb24-986"><a href="#cb24-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-987"><a href="#cb24-987" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Visualization:**</span>
<span id="cb24-988"><a href="#cb24-988" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Dashboard showing historical NDVI + predictions</span>
<span id="cb24-989"><a href="#cb24-989" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Maps of drought risk by municipality</span>
<span id="cb24-990"><a href="#cb24-990" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Trend analysis and anomaly detection</span>
<span id="cb24-991"><a href="#cb24-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-992"><a href="#cb24-992" aria-hidden="true" tabindex="-1"></a>**Example Integration with PAGASA:**</span>
<span id="cb24-993"><a href="#cb24-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-994"><a href="#cb24-994" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb24-995"><a href="#cb24-995" aria-hidden="true" tabindex="-1"></a><span class="co"># Pseudo-code for operational system</span></span>
<span id="cb24-996"><a href="#cb24-996" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> monthly_drought_forecast():</span>
<span id="cb24-997"><a href="#cb24-997" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-998"><a href="#cb24-998" aria-hidden="true" tabindex="-1"></a><span class="co">    Automated monthly drought forecasting workflow.</span></span>
<span id="cb24-999"><a href="#cb24-999" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-1000"><a href="#cb24-1000" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Acquire latest data</span></span>
<span id="cb24-1001"><a href="#cb24-1001" aria-hidden="true" tabindex="-1"></a>    latest_ndvi <span class="op">=</span> download_sentinel2_ndvi(region<span class="op">=</span><span class="st">'Mindanao'</span>, days<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb24-1002"><a href="#cb24-1002" aria-hidden="true" tabindex="-1"></a>    latest_rainfall <span class="op">=</span> fetch_pagasa_rainfall()</span>
<span id="cb24-1003"><a href="#cb24-1003" aria-hidden="true" tabindex="-1"></a>    latest_temp <span class="op">=</span> fetch_pagasa_temperature()</span>
<span id="cb24-1004"><a href="#cb24-1004" aria-hidden="true" tabindex="-1"></a>    latest_oni <span class="op">=</span> fetch_noaa_oni()</span>
<span id="cb24-1005"><a href="#cb24-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1006"><a href="#cb24-1006" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Preprocess</span></span>
<span id="cb24-1007"><a href="#cb24-1007" aria-hidden="true" tabindex="-1"></a>    df_latest <span class="op">=</span> merge_and_preprocess(latest_ndvi, latest_rainfall, latest_temp, latest_oni)</span>
<span id="cb24-1008"><a href="#cb24-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1009"><a href="#cb24-1009" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Create sequence</span></span>
<span id="cb24-1010"><a href="#cb24-1010" aria-hidden="true" tabindex="-1"></a>    X_latest <span class="op">=</span> create_sequence(df_latest, lookback<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-1011"><a href="#cb24-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1012"><a href="#cb24-1012" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Predict</span></span>
<span id="cb24-1013"><a href="#cb24-1013" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> model.predict(X_latest)</span>
<span id="cb24-1014"><a href="#cb24-1014" aria-hidden="true" tabindex="-1"></a>    prediction_ndvi <span class="op">=</span> inverse_transform(prediction)</span>
<span id="cb24-1015"><a href="#cb24-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1016"><a href="#cb24-1016" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 5: Check threshold</span></span>
<span id="cb24-1017"><a href="#cb24-1017" aria-hidden="true" tabindex="-1"></a>    DROUGHT_THRESHOLD <span class="op">=</span> <span class="fl">0.40</span></span>
<span id="cb24-1018"><a href="#cb24-1018" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prediction_ndvi <span class="op">&lt;</span> DROUGHT_THRESHOLD:</span>
<span id="cb24-1019"><a href="#cb24-1019" aria-hidden="true" tabindex="-1"></a>        send_alert(</span>
<span id="cb24-1020"><a href="#cb24-1020" aria-hidden="true" tabindex="-1"></a>            recipients<span class="op">=</span>[<span class="st">'DA'</span>, <span class="st">'PAGASA'</span>, <span class="st">'LGUs'</span>],</span>
<span id="cb24-1021"><a href="#cb24-1021" aria-hidden="true" tabindex="-1"></a>            message<span class="op">=</span><span class="ss">f"Drought warning: Predicted NDVI </span><span class="sc">{</span>prediction_ndvi<span class="sc">:.2f}</span><span class="ss"> for next month"</span>,</span>
<span id="cb24-1022"><a href="#cb24-1022" aria-hidden="true" tabindex="-1"></a>            severity<span class="op">=</span><span class="st">'HIGH'</span></span>
<span id="cb24-1023"><a href="#cb24-1023" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1024"><a href="#cb24-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1025"><a href="#cb24-1025" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 6: Update dashboard</span></span>
<span id="cb24-1026"><a href="#cb24-1026" aria-hidden="true" tabindex="-1"></a>    update_dashboard(historical<span class="op">=</span>df_latest, prediction<span class="op">=</span>prediction_ndvi)</span>
<span id="cb24-1027"><a href="#cb24-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1028"><a href="#cb24-1028" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prediction_ndvi</span>
<span id="cb24-1029"><a href="#cb24-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1030"><a href="#cb24-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1031"><a href="#cb24-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 8.2 Model Maintenance</span></span>
<span id="cb24-1032"><a href="#cb24-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1033"><a href="#cb24-1033" aria-hidden="true" tabindex="-1"></a>**Retraining Schedule:**</span>
<span id="cb24-1034"><a href="#cb24-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Retrain annually with new data</span>
<span id="cb24-1035"><a href="#cb24-1035" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Monitor performance drift</span>
<span id="cb24-1036"><a href="#cb24-1036" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Update if accuracy degrades</span>
<span id="cb24-1037"><a href="#cb24-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1038"><a href="#cb24-1038" aria-hidden="true" tabindex="-1"></a>**Validation:**</span>
<span id="cb24-1039"><a href="#cb24-1039" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compare predictions with ground truth each month</span>
<span id="cb24-1040"><a href="#cb24-1040" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Track RMSE, MAE over time</span>
<span id="cb24-1041"><a href="#cb24-1041" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Engage with stakeholders for qualitative feedback (did farmers report drought?)</span>
<span id="cb24-1042"><a href="#cb24-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1043"><a href="#cb24-1043" aria-hidden="true" tabindex="-1"></a>**Version Control:**</span>
<span id="cb24-1044"><a href="#cb24-1044" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Track model versions (architecture, hyperparameters, training data)</span>
<span id="cb24-1045"><a href="#cb24-1045" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A/B testing of model updates</span>
<span id="cb24-1046"><a href="#cb24-1046" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rollback capability</span>
<span id="cb24-1047"><a href="#cb24-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1048"><a href="#cb24-1048" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb24-1049"><a href="#cb24-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">## Success Metrics for Operational System</span></span>
<span id="cb24-1050"><a href="#cb24-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1051"><a href="#cb24-1051" aria-hidden="true" tabindex="-1"></a>**Quantitative:**</span>
<span id="cb24-1052"><a href="#cb24-1052" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Forecast accuracy: RMSE &lt; 0.05 NDVI</span>
<span id="cb24-1053"><a href="#cb24-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lead time: 1-3 months</span>
<span id="cb24-1054"><a href="#cb24-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Spatial coverage: All major agricultural regions</span>
<span id="cb24-1055"><a href="#cb24-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1056"><a href="#cb24-1056" aria-hidden="true" tabindex="-1"></a>**Qualitative:**</span>
<span id="cb24-1057"><a href="#cb24-1057" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>User adoption by DA and LGUs</span>
<span id="cb24-1058"><a href="#cb24-1058" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Actionable warnings (early interventions taken)</span>
<span id="cb24-1059"><a href="#cb24-1059" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduction in drought-related crop losses (longitudinal assessment)</span>
<span id="cb24-1060"><a href="#cb24-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1061"><a href="#cb24-1061" aria-hidden="true" tabindex="-1"></a>**Target:** Achieve 80% detection rate for drought events with &lt; 20% false alarm rate</span>
<span id="cb24-1062"><a href="#cb24-1062" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-1063"><a href="#cb24-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1064"><a href="#cb24-1064" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1065"><a href="#cb24-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1066"><a href="#cb24-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">## Troubleshooting Guide</span></span>
<span id="cb24-1067"><a href="#cb24-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1068"><a href="#cb24-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Issues and Solutions</span></span>
<span id="cb24-1069"><a href="#cb24-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1070"><a href="#cb24-1070" aria-hidden="true" tabindex="-1"></a>**Issue 1: Model overfitting (train loss &lt;&lt; val loss)**</span>
<span id="cb24-1071"><a href="#cb24-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1072"><a href="#cb24-1072" aria-hidden="true" tabindex="-1"></a>**Solutions:**</span>
<span id="cb24-1073"><a href="#cb24-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increase dropout rate (0.3-0.4)</span>
<span id="cb24-1074"><a href="#cb24-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduce LSTM units (32, 16 instead of 64, 32)</span>
<span id="cb24-1075"><a href="#cb24-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add L2 regularization</span>
<span id="cb24-1076"><a href="#cb24-1076" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increase training data (longer time series, more locations)</span>
<span id="cb24-1077"><a href="#cb24-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1078"><a href="#cb24-1078" aria-hidden="true" tabindex="-1"></a>**Issue 2: Poor convergence (loss not decreasing)**</span>
<span id="cb24-1079"><a href="#cb24-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1080"><a href="#cb24-1080" aria-hidden="true" tabindex="-1"></a>**Solutions:**</span>
<span id="cb24-1081"><a href="#cb24-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduce learning rate (0.0001)</span>
<span id="cb24-1082"><a href="#cb24-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increase batch size (64, 128)</span>
<span id="cb24-1083"><a href="#cb24-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check data normalization (should be <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span> or standardized)</span>
<span id="cb24-1084"><a href="#cb24-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simplify architecture (fewer layers)</span>
<span id="cb24-1085"><a href="#cb24-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1086"><a href="#cb24-1086" aria-hidden="true" tabindex="-1"></a>**Issue 3: Predictions lag behind actual values**</span>
<span id="cb24-1087"><a href="#cb24-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1088"><a href="#cb24-1088" aria-hidden="true" tabindex="-1"></a>**Explanation:** Model learns to predict "tomorrow will be like today"</span>
<span id="cb24-1089"><a href="#cb24-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1090"><a href="#cb24-1090" aria-hidden="true" tabindex="-1"></a>**Solutions:**</span>
<span id="cb24-1091"><a href="#cb24-1091" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add more features (lagged rainfall, soil moisture)</span>
<span id="cb24-1092"><a href="#cb24-1092" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increase lookback window (18-24 months)</span>
<span id="cb24-1093"><a href="#cb24-1093" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use attention mechanisms (advanced)</span>
<span id="cb24-1094"><a href="#cb24-1094" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Try bidirectional LSTM</span>
<span id="cb24-1095"><a href="#cb24-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1096"><a href="#cb24-1096" aria-hidden="true" tabindex="-1"></a>**Issue 4: High error during extreme events (droughts)**</span>
<span id="cb24-1097"><a href="#cb24-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1098"><a href="#cb24-1098" aria-hidden="true" tabindex="-1"></a>**Solutions:**</span>
<span id="cb24-1099"><a href="#cb24-1099" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Oversample drought periods in training data</span>
<span id="cb24-1100"><a href="#cb24-1100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use weighted loss function (higher weight on drought)</span>
<span id="cb24-1101"><a href="#cb24-1101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add drought-specific features (El Niño strength)</span>
<span id="cb24-1102"><a href="#cb24-1102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensemble with other models (Random Forest, GRU)</span>
<span id="cb24-1103"><a href="#cb24-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1104"><a href="#cb24-1104" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1105"><a href="#cb24-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1106"><a href="#cb24-1106" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extensions and Advanced Topics</span></span>
<span id="cb24-1107"><a href="#cb24-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1108"><a href="#cb24-1108" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb24-1109"><a href="#cb24-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">## Going Further</span></span>
<span id="cb24-1110"><a href="#cb24-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1111"><a href="#cb24-1111" aria-hidden="true" tabindex="-1"></a>**1. Spatial LSTM:**</span>
<span id="cb24-1112"><a href="#cb24-1112" aria-hidden="true" tabindex="-1"></a>Extend model to predict drought across multiple locations simultaneously using ConvLSTM</span>
<span id="cb24-1113"><a href="#cb24-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1114"><a href="#cb24-1114" aria-hidden="true" tabindex="-1"></a>**2. Ensemble Models:**</span>
<span id="cb24-1115"><a href="#cb24-1115" aria-hidden="true" tabindex="-1"></a>Combine LSTM with Random Forest and gradient boosting for robust predictions</span>
<span id="cb24-1116"><a href="#cb24-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1117"><a href="#cb24-1117" aria-hidden="true" tabindex="-1"></a>**3. Attention Mechanisms:**</span>
<span id="cb24-1118"><a href="#cb24-1118" aria-hidden="true" tabindex="-1"></a>Add attention layers to identify which historical time steps are most important</span>
<span id="cb24-1119"><a href="#cb24-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1120"><a href="#cb24-1120" aria-hidden="true" tabindex="-1"></a>**4. Uncertainty Quantification:**</span>
<span id="cb24-1121"><a href="#cb24-1121" aria-hidden="true" tabindex="-1"></a>Use Bayesian LSTM or Monte Carlo dropout to estimate prediction confidence intervals</span>
<span id="cb24-1122"><a href="#cb24-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1123"><a href="#cb24-1123" aria-hidden="true" tabindex="-1"></a>**5. Multi-Output Forecasting:**</span>
<span id="cb24-1124"><a href="#cb24-1124" aria-hidden="true" tabindex="-1"></a>Predict NDVI, rainfall, and temperature simultaneously (multi-task learning)</span>
<span id="cb24-1125"><a href="#cb24-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1126"><a href="#cb24-1126" aria-hidden="true" tabindex="-1"></a>**6. Transfer Learning:**</span>
<span id="cb24-1127"><a href="#cb24-1127" aria-hidden="true" tabindex="-1"></a>Train on Mindanao, fine-tune for other Philippine regions (Luzon, Visayas)</span>
<span id="cb24-1128"><a href="#cb24-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1129"><a href="#cb24-1129" aria-hidden="true" tabindex="-1"></a>**7. Explainability:**</span>
<span id="cb24-1130"><a href="#cb24-1130" aria-hidden="true" tabindex="-1"></a>Use SHAP or LIME to interpret which features drive predictions</span>
<span id="cb24-1131"><a href="#cb24-1131" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-1132"><a href="#cb24-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1133"><a href="#cb24-1133" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1134"><a href="#cb24-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1135"><a href="#cb24-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways</span></span>
<span id="cb24-1136"><a href="#cb24-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1137"><a href="#cb24-1137" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb24-1138"><a href="#cb24-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session 2 Summary</span></span>
<span id="cb24-1139"><a href="#cb24-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1140"><a href="#cb24-1140" aria-hidden="true" tabindex="-1"></a>**Lab Achievements:**</span>
<span id="cb24-1141"><a href="#cb24-1141" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Built end-to-end LSTM drought forecasting system for Mindanao</span>
<span id="cb24-1142"><a href="#cb24-1142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Processed 7 years of Sentinel-2 NDVI time series</span>
<span id="cb24-1143"><a href="#cb24-1143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Integrated multi-source data (satellite, weather, climate indices)</span>
<span id="cb24-1144"><a href="#cb24-1144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Achieved operational-grade forecast accuracy (RMSE &lt; 0.05)</span>
<span id="cb24-1145"><a href="#cb24-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1146"><a href="#cb24-1146" aria-hidden="true" tabindex="-1"></a>**Technical Skills:**</span>
<span id="cb24-1147"><a href="#cb24-1147" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time series sequence creation with sliding windows</span>
<span id="cb24-1148"><a href="#cb24-1148" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>LSTM model architecture design and training</span>
<span id="cb24-1149"><a href="#cb24-1149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Proper temporal data splitting (avoid leakage)</span>
<span id="cb24-1150"><a href="#cb24-1150" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model evaluation and interpretation</span>
<span id="cb24-1151"><a href="#cb24-1151" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Deployment considerations for operational systems</span>
<span id="cb24-1152"><a href="#cb24-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1153"><a href="#cb24-1153" aria-hidden="true" tabindex="-1"></a>**Philippine Context:**</span>
<span id="cb24-1154"><a href="#cb24-1154" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mindanao drought vulnerability and agricultural importance</span>
<span id="cb24-1155"><a href="#cb24-1155" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>2015-2016 El Niño case study</span>
<span id="cb24-1156"><a href="#cb24-1156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Integration with DA and PAGASA early warning systems</span>
<span id="cb24-1157"><a href="#cb24-1157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>3-month lead time for climate change adaptation</span>
<span id="cb24-1158"><a href="#cb24-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1159"><a href="#cb24-1159" aria-hidden="true" tabindex="-1"></a>**Operational Readiness:**</span>
<span id="cb24-1160"><a href="#cb24-1160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automated data pipelines feasible</span>
<span id="cb24-1161"><a href="#cb24-1161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Monthly forecast updates practical</span>
<span id="cb24-1162"><a href="#cb24-1162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Alert thresholds definable</span>
<span id="cb24-1163"><a href="#cb24-1163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stakeholder engagement critical</span>
<span id="cb24-1164"><a href="#cb24-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1165"><a href="#cb24-1165" aria-hidden="true" tabindex="-1"></a>**Next Steps:**</span>
<span id="cb24-1166"><a href="#cb24-1166" aria-hidden="true" tabindex="-1"></a>Session 3 explores emerging AI trends (foundation models, self-supervised learning, explainable AI) that could further improve drought monitoring systems.</span>
<span id="cb24-1167"><a href="#cb24-1167" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-1168"><a href="#cb24-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1169"><a href="#cb24-1169" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1170"><a href="#cb24-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1171"><a href="#cb24-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb24-1172"><a href="#cb24-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1173"><a href="#cb24-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code and Data</span></span>
<span id="cb24-1174"><a href="#cb24-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1175"><a href="#cb24-1175" aria-hidden="true" tabindex="-1"></a>**Lab Materials:**</span>
<span id="cb24-1176"><a href="#cb24-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📓 <span class="co">[</span><span class="ot">Student Jupyter Notebook</span><span class="co">](../notebooks/day4_session2_lstm_drought_lab_STUDENT.ipynb)</span> - Guided lab with exercises</span>
<span id="cb24-1177"><a href="#cb24-1177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📓 <span class="co">[</span><span class="ot">Instructor Solution Notebook</span><span class="co">](../notebooks/day4_session2_lstm_drought_lab_INSTRUCTOR.ipynb)</span> - Complete solutions</span>
<span id="cb24-1178"><a href="#cb24-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>📊 Data: Synthetic data generated within notebooks (no separate download needed)</span>
<span id="cb24-1179"><a href="#cb24-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1180"><a href="#cb24-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">### Further Reading</span></span>
<span id="cb24-1181"><a href="#cb24-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1182"><a href="#cb24-1182" aria-hidden="true" tabindex="-1"></a>**LSTM for EO:**</span>
<span id="cb24-1183"><a href="#cb24-1183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ndikumana et al. (2018). "Deep Recurrent Neural Network for Agricultural Classification using SAR Sentinel-1." *Remote Sensing*.</span>
<span id="cb24-1184"><a href="#cb24-1184" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ru et al. (2020). "Deep Learning for Crop Yield Prediction Using LSTM." *Computers and Electronics in Agriculture*.</span>
<span id="cb24-1185"><a href="#cb24-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1186"><a href="#cb24-1186" aria-hidden="true" tabindex="-1"></a>**Drought Monitoring:**</span>
<span id="cb24-1187"><a href="#cb24-1187" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>AghaKouchak et al. (2015). "Remote Sensing of Drought: Progress, Challenges and Opportunities." *Reviews of Geophysics*.</span>
<span id="cb24-1188"><a href="#cb24-1188" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Philippine PAGASA: <span class="co">[</span><span class="ot">Drought Monitoring Reports</span><span class="co">](https://www.pagasa.dost.gov.ph)</span></span>
<span id="cb24-1189"><a href="#cb24-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1190"><a href="#cb24-1190" aria-hidden="true" tabindex="-1"></a>**TensorFlow/Keras:**</span>
<span id="cb24-1191"><a href="#cb24-1191" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Keras Time Series Tutorial</span><span class="co">](https://keras.io/examples/timeseries/)</span></span>
<span id="cb24-1192"><a href="#cb24-1192" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">TensorFlow LSTM Guide</span><span class="co">](https://www.tensorflow.org/tutorials/structured_data/time_series)</span></span>
<span id="cb24-1193"><a href="#cb24-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1194"><a href="#cb24-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">### Philippine EO Platforms</span></span>
<span id="cb24-1195"><a href="#cb24-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1196"><a href="#cb24-1196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">CoPhil Infrastructure</span><span class="co">](https://infra.copphil.philsa.gov.ph)</span></span>
<span id="cb24-1197"><a href="#cb24-1197" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Google Earth Engine</span><span class="co">](https://earthengine.google.com)</span></span>
<span id="cb24-1198"><a href="#cb24-1198" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">PAGASA Climate Data</span><span class="co">](https://www.pagasa.dost.gov.ph)</span></span>
<span id="cb24-1199"><a href="#cb24-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1200"><a href="#cb24-1200" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1201"><a href="#cb24-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1202"><a href="#cb24-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Feedback</span></span>
<span id="cb24-1203"><a href="#cb24-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1204"><a href="#cb24-1204" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb24-1205"><a href="#cb24-1205" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reflect on Your Learning</span></span>
<span id="cb24-1206"><a href="#cb24-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1207"><a href="#cb24-1207" aria-hidden="true" tabindex="-1"></a>**Questions for Discussion:**</span>
<span id="cb24-1208"><a href="#cb24-1208" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>How confident are you in building LSTM models for other EO time series problems?</span>
<span id="cb24-1209"><a href="#cb24-1209" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>What challenges did you encounter during the lab?</span>
<span id="cb24-1210"><a href="#cb24-1210" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>What Philippine applications could benefit from LSTM forecasting?</span>
<span id="cb24-1211"><a href="#cb24-1211" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How would you explain LSTM predictions to non-technical stakeholders (farmers, LGU officials)?</span>
<span id="cb24-1212"><a href="#cb24-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1213"><a href="#cb24-1213" aria-hidden="true" tabindex="-1"></a>**Feedback Form:** <span class="co">[</span><span class="ot">Submit anonymous feedback</span><span class="co">](https://forms.gle/copphil-day4-session2)</span></span>
<span id="cb24-1214"><a href="#cb24-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1215"><a href="#cb24-1215" aria-hidden="true" tabindex="-1"></a>**Instructor Email:** <span class="co">[</span><span class="ot">training@copphil.philsa.gov.ph</span><span class="co">](mailto:training@copphil.philsa.gov.ph)</span></span>
<span id="cb24-1216"><a href="#cb24-1216" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-1217"><a href="#cb24-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1218"><a href="#cb24-1218" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1219"><a href="#cb24-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1220"><a href="#cb24-1220" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preparation for Session 3</span></span>
<span id="cb24-1221"><a href="#cb24-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1222"><a href="#cb24-1222" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb24-1223"><a href="#cb24-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">## Looking Ahead</span></span>
<span id="cb24-1224"><a href="#cb24-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1225"><a href="#cb24-1225" aria-hidden="true" tabindex="-1"></a>**Session 3: Emerging AI Trends in EO**</span>
<span id="cb24-1226"><a href="#cb24-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1227"><a href="#cb24-1227" aria-hidden="true" tabindex="-1"></a>Topics:</span>
<span id="cb24-1228"><a href="#cb24-1228" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Geospatial foundation models (Prithvi, Clay, SatMAE)</span>
<span id="cb24-1229"><a href="#cb24-1229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Self-supervised learning for limited labeled data</span>
<span id="cb24-1230"><a href="#cb24-1230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Explainable AI (SHAP, LIME, Grad-CAM) for transparency</span>
<span id="cb24-1231"><a href="#cb24-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1232"><a href="#cb24-1232" aria-hidden="true" tabindex="-1"></a>**Relevance to This Lab:**</span>
<span id="cb24-1233"><a href="#cb24-1233" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Foundation models could improve drought prediction with less training data</span>
<span id="cb24-1234"><a href="#cb24-1234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Self-supervised pre-training on unlabeled Sentinel-2 archive</span>
<span id="cb24-1235"><a href="#cb24-1235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>XAI methods to explain which months/features drive drought predictions</span>
<span id="cb24-1236"><a href="#cb24-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1237"><a href="#cb24-1237" aria-hidden="true" tabindex="-1"></a>**No advance preparation needed** - Session 3 is theory and discussion-based</span>
<span id="cb24-1238"><a href="#cb24-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1239"><a href="#cb24-1239" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Session 3 Preview →</span><span class="co">](session3.qmd)</span>{.btn .btn-outline-primary}</span>
<span id="cb24-1240"><a href="#cb24-1240" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-1241"><a href="#cb24-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1242"><a href="#cb24-1242" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb24-1243"><a href="#cb24-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1244"><a href="#cb24-1244" aria-hidden="true" tabindex="-1"></a>*This session is part of Day 4: Time Series Analysis, Emerging Trends, and Sustainable Learning - CoPhil 4-Day Advanced Training on AI/ML for Earth Observation, funded by the European Union under the Global Gateway initiative.*</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>CoPhil EO AI/ML Training Programme</p>
</div>   
    <div class="nav-footer-center">
<p>Funded by the European Union - Global Gateway Initiative</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:info@philsa.gov.ph">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://philsa.gov.ph">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>