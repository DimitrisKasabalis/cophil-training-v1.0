<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-16">

<title>Session 3: Hands-on Python for Geospatial Data – CoPhil EO AI/ML Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../day1/sessions/session4.html" rel="next">
<link href="../../day1/sessions/session2.html" rel="prev">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c9822816d3895e59fda95a6fa7545fef.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-4a074efccdeff27617fbc72d37c1244e.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c9822816d3895e59fda95a6fa7545fef.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3775014fae9fc394bbda1d6ff89dd45e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-a15f5dce5650fb3fe5aba34e3b6df9a9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-3775014fae9fc394bbda1d6ff89dd45e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles/custom.css">
<link rel="stylesheet" href="../../styles/phase2-enhancements.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CoPhil EO AI/ML Training</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-training-days" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Training Days</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-training-days">    
        <li>
    <a class="dropdown-item" href="../../day1/index.html">
 <span class="dropdown-text">Day 1: EO Data &amp; Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day2/index.html">
 <span class="dropdown-text">Day 2: Machine Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day3/index.html">
 <span class="dropdown-text">Day 3: Deep Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day4/index.html">
 <span class="dropdown-text">Day 4: Advanced Topics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../resources/setup.html">
 <span class="dropdown-text">Setup Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/philippine-eo.html">
 <span class="dropdown-text">Philippine EO Links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/cheatsheets.html">
 <span class="dropdown-text">Cheat Sheets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/faq.html">
 <span class="dropdown-text">FAQ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cophil-training-v1.0"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/downloads.html"> <i class="bi bi-download" role="img">
</i> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day1/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day1/sessions/session3.html">Session 3: Hands-on Python for Geospatial Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1: EO Data &amp; AI/ML Fundamentals</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Sessions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 1: Copernicus Sentinel Data Deep Dive &amp; Philippine EO Ecosystem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 2: Core Concepts of AI/ML for Earth Observation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Session 3: Hands-on Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 4: Introduction to Google Earth Engine</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/notebook1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook 1: Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/notebook2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook 2: Google Earth Engine</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/Day1_Session3_Python_Geospatial_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1, Session 3: Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/Day1_Session4_Google_Earth_Engine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1, Session 4: Google Earth Engine Python API</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On This Page</h2>
   
  <ul>
  <li><a href="#session-overview" id="toc-session-overview" class="nav-link active" data-scroll-target="#session-overview">Session Overview</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  </ul></li>
  <li><a href="#presentation-slides" id="toc-presentation-slides" class="nav-link" data-scroll-target="#presentation-slides">Presentation Slides</a></li>
  <li><a href="#part-1-why-python-for-earth-observation" id="toc-part-1-why-python-for-earth-observation" class="nav-link" data-scroll-target="#part-1-why-python-for-earth-observation">Part 1: Why Python for Earth Observation?</a>
  <ul class="collapse">
  <li><a href="#the-python-eo-ecosystem" id="toc-the-python-eo-ecosystem" class="nav-link" data-scroll-target="#the-python-eo-ecosystem">The Python EO Ecosystem</a></li>
  <li><a href="#python-in-philippine-eo-systems" id="toc-python-in-philippine-eo-systems" class="nav-link" data-scroll-target="#python-in-philippine-eo-systems">Python in Philippine EO Systems</a></li>
  <li><a href="#connecting-to-session-2-preprocessing-for-ml" id="toc-connecting-to-session-2-preprocessing-for-ml" class="nav-link" data-scroll-target="#connecting-to-session-2-preprocessing-for-ml">Connecting to Session 2: Preprocessing for ML</a></li>
  </ul></li>
  <li><a href="#part-2-setting-up-google-colaboratory" id="toc-part-2-setting-up-google-colaboratory" class="nav-link" data-scroll-target="#part-2-setting-up-google-colaboratory">Part 2: Setting Up Google Colaboratory</a>
  <ul class="collapse">
  <li><a href="#what-is-google-colab" id="toc-what-is-google-colab" class="nav-link" data-scroll-target="#what-is-google-colab">What is Google Colab?</a></li>
  <li><a href="#creating-your-first-colab-notebook" id="toc-creating-your-first-colab-notebook" class="nav-link" data-scroll-target="#creating-your-first-colab-notebook">Creating Your First Colab Notebook</a></li>
  <li><a href="#understanding-the-colab-interface" id="toc-understanding-the-colab-interface" class="nav-link" data-scroll-target="#understanding-the-colab-interface">Understanding the Colab Interface</a></li>
  <li><a href="#connecting-google-drive" id="toc-connecting-google-drive" class="nav-link" data-scroll-target="#connecting-google-drive">Connecting Google Drive</a></li>
  <li><a href="#understanding-colab-runtime" id="toc-understanding-colab-runtime" class="nav-link" data-scroll-target="#understanding-colab-runtime">Understanding Colab Runtime</a></li>
  </ul></li>
  <li><a href="#part-3-installing-geospatial-libraries" id="toc-part-3-installing-geospatial-libraries" class="nav-link" data-scroll-target="#part-3-installing-geospatial-libraries">Part 3: Installing Geospatial Libraries</a>
  <ul class="collapse">
  <li><a href="#required-libraries" id="toc-required-libraries" class="nav-link" data-scroll-target="#required-libraries">Required Libraries</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#verify-installation" id="toc-verify-installation" class="nav-link" data-scroll-target="#verify-installation">Verify Installation</a></li>
  </ul></li>
  <li><a href="#part-4-python-basics-refresher" id="toc-part-4-python-basics-refresher" class="nav-link" data-scroll-target="#part-4-python-basics-refresher">Part 4: Python Basics Refresher</a>
  <ul class="collapse">
  <li><a href="#data-types" id="toc-data-types" class="nav-link" data-scroll-target="#data-types">Data Types</a></li>
  <li><a href="#control-structures" id="toc-control-structures" class="nav-link" data-scroll-target="#control-structures">Control Structures</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  </ul></li>
  <li><a href="#part-5-vector-data-with-geopandas" id="toc-part-5-vector-data-with-geopandas" class="nav-link" data-scroll-target="#part-5-vector-data-with-geopandas">Part 5: Vector Data with GeoPandas</a>
  <ul class="collapse">
  <li><a href="#what-is-vector-data" id="toc-what-is-vector-data" class="nav-link" data-scroll-target="#what-is-vector-data">What is Vector Data?</a></li>
  <li><a href="#understanding-coordinate-reference-systems-crs" id="toc-understanding-coordinate-reference-systems-crs" class="nav-link" data-scroll-target="#understanding-coordinate-reference-systems-crs">Understanding Coordinate Reference Systems (CRS)</a></li>
  <li><a href="#loading-philippine-administrative-boundaries" id="toc-loading-philippine-administrative-boundaries" class="nav-link" data-scroll-target="#loading-philippine-administrative-boundaries">Loading Philippine Administrative Boundaries</a></li>
  <li><a href="#philippine-geospatial-data-sources" id="toc-philippine-geospatial-data-sources" class="nav-link" data-scroll-target="#philippine-geospatial-data-sources">Philippine Geospatial Data Sources</a></li>
  <li><a href="#inspecting-a-geodataframe" id="toc-inspecting-a-geodataframe" class="nav-link" data-scroll-target="#inspecting-a-geodataframe">Inspecting a GeoDataFrame</a></li>
  <li><a href="#working-with-coordinate-reference-systems" id="toc-working-with-coordinate-reference-systems" class="nav-link" data-scroll-target="#working-with-coordinate-reference-systems">Working with Coordinate Reference Systems</a></li>
  <li><a href="#calculating-geometric-properties" id="toc-calculating-geometric-properties" class="nav-link" data-scroll-target="#calculating-geometric-properties">Calculating Geometric Properties</a></li>
  <li><a href="#filtering-and-querying" id="toc-filtering-and-querying" class="nav-link" data-scroll-target="#filtering-and-querying">Filtering and Querying</a></li>
  <li><a href="#spatial-operations" id="toc-spatial-operations" class="nav-link" data-scroll-target="#spatial-operations">Spatial Operations</a></li>
  <li><a href="#visualizing-vector-data" id="toc-visualizing-vector-data" class="nav-link" data-scroll-target="#visualizing-vector-data">Visualizing Vector Data</a></li>
  <li><a href="#creating-area-of-interest-aoi-geometries" id="toc-creating-area-of-interest-aoi-geometries" class="nav-link" data-scroll-target="#creating-area-of-interest-aoi-geometries">Creating Area of Interest (AOI) Geometries</a></li>
  </ul></li>
  <li><a href="#part-6-raster-data-with-rasterio" id="toc-part-6-raster-data-with-rasterio" class="nav-link" data-scroll-target="#part-6-raster-data-with-rasterio">Part 6: Raster Data with Rasterio</a>
  <ul class="collapse">
  <li><a href="#what-is-raster-data" id="toc-what-is-raster-data" class="nav-link" data-scroll-target="#what-is-raster-data">What is Raster Data?</a></li>
  <li><a href="#understanding-sentinel-2-bands-and-resolution" id="toc-understanding-sentinel-2-bands-and-resolution" class="nav-link" data-scroll-target="#understanding-sentinel-2-bands-and-resolution">Understanding Sentinel-2 Bands and Resolution</a></li>
  <li><a href="#opening-a-raster-file" id="toc-opening-a-raster-file" class="nav-link" data-scroll-target="#opening-a-raster-file">Opening a Raster File</a></li>
  <li><a href="#reading-raster-data-into-arrays" id="toc-reading-raster-data-into-arrays" class="nav-link" data-scroll-target="#reading-raster-data-into-arrays">Reading Raster Data into Arrays</a></li>
  <li><a href="#calculating-spectral-indices" id="toc-calculating-spectral-indices" class="nav-link" data-scroll-target="#calculating-spectral-indices">Calculating Spectral Indices</a></li>
  <li><a href="#philippine-application-rice-paddy-monitoring" id="toc-philippine-application-rice-paddy-monitoring" class="nav-link" data-scroll-target="#philippine-application-rice-paddy-monitoring">Philippine Application: Rice Paddy Monitoring</a></li>
  <li><a href="#creating-rgb-and-false-color-composites" id="toc-creating-rgb-and-false-color-composites" class="nav-link" data-scroll-target="#creating-rgb-and-false-color-composites">Creating RGB and False Color Composites</a></li>
  <li><a href="#saving-processed-rasters" id="toc-saving-processed-rasters" class="nav-link" data-scroll-target="#saving-processed-rasters">Saving Processed Rasters</a></li>
  </ul></li>
  <li><a href="#part-7-combining-vector-and-raster-operations" id="toc-part-7-combining-vector-and-raster-operations" class="nav-link" data-scroll-target="#part-7-combining-vector-and-raster-operations">Part 7: Combining Vector and Raster Operations</a>
  <ul class="collapse">
  <li><a href="#clipping-raster-to-vector-boundary" id="toc-clipping-raster-to-vector-boundary" class="nav-link" data-scroll-target="#clipping-raster-to-vector-boundary">Clipping Raster to Vector Boundary</a></li>
  <li><a href="#sampling-raster-values-at-point-locations" id="toc-sampling-raster-values-at-point-locations" class="nav-link" data-scroll-target="#sampling-raster-values-at-point-locations">Sampling Raster Values at Point Locations</a></li>
  <li><a href="#zonal-statistics" id="toc-zonal-statistics" class="nav-link" data-scroll-target="#zonal-statistics">Zonal Statistics</a></li>
  </ul></li>
  <li><a href="#part-8-preprocessing-workflows-for-machine-learning" id="toc-part-8-preprocessing-workflows-for-machine-learning" class="nav-link" data-scroll-target="#part-8-preprocessing-workflows-for-machine-learning">Part 8: Preprocessing Workflows for Machine Learning</a>
  <ul class="collapse">
  <li><a href="#workflow-1-preparing-training-samples-for-classification" id="toc-workflow-1-preparing-training-samples-for-classification" class="nav-link" data-scroll-target="#workflow-1-preparing-training-samples-for-classification">Workflow 1: Preparing Training Samples for Classification</a></li>
  <li><a href="#workflow-2-creating-multi-temporal-stack" id="toc-workflow-2-creating-multi-temporal-stack" class="nav-link" data-scroll-target="#workflow-2-creating-multi-temporal-stack">Workflow 2: Creating Multi-Temporal Stack</a></li>
  <li><a href="#workflow-3-resampling-and-reprojection" id="toc-workflow-3-resampling-and-reprojection" class="nav-link" data-scroll-target="#workflow-3-resampling-and-reprojection">Workflow 3: Resampling and Reprojection</a></li>
  <li><a href="#workflow-4-data-augmentation-for-deep-learning" id="toc-workflow-4-data-augmentation-for-deep-learning" class="nav-link" data-scroll-target="#workflow-4-data-augmentation-for-deep-learning">Workflow 4: Data Augmentation for Deep Learning</a></li>
  </ul></li>
  <li><a href="#part-9-best-practices-and-common-pitfalls" id="toc-part-9-best-practices-and-common-pitfalls" class="nav-link" data-scroll-target="#part-9-best-practices-and-common-pitfalls">Part 9: Best Practices and Common Pitfalls</a>
  <ul class="collapse">
  <li><a href="#memory-management-for-large-rasters" id="toc-memory-management-for-large-rasters" class="nav-link" data-scroll-target="#memory-management-for-large-rasters">Memory Management for Large Rasters</a></li>
  <li><a href="#vectorization-vs.-loops" id="toc-vectorization-vs.-loops" class="nav-link" data-scroll-target="#vectorization-vs.-loops">Vectorization vs.&nbsp;Loops</a></li>
  <li><a href="#error-handling-for-geospatial-operations" id="toc-error-handling-for-geospatial-operations" class="nav-link" data-scroll-target="#error-handling-for-geospatial-operations">Error Handling for Geospatial Operations</a></li>
  <li><a href="#troubleshooting-common-issues" id="toc-troubleshooting-common-issues" class="nav-link" data-scroll-target="#troubleshooting-common-issues">Troubleshooting Common Issues</a></li>
  <li><a href="#code-organization-for-reproducibility" id="toc-code-organization-for-reproducibility" class="nav-link" data-scroll-target="#code-organization-for-reproducibility">Code Organization for Reproducibility</a></li>
  </ul></li>
  <li><a href="#part-10-complete-workflow-example" id="toc-part-10-complete-workflow-example" class="nav-link" data-scroll-target="#part-10-complete-workflow-example">Part 10: Complete Workflow Example</a>
  <ul class="collapse">
  <li><a href="#scenario-agricultural-monitoring-for-palawan-rice-area" id="toc-scenario-agricultural-monitoring-for-palawan-rice-area" class="nav-link" data-scroll-target="#scenario-agricultural-monitoring-for-palawan-rice-area">Scenario: Agricultural Monitoring for Palawan Rice Area</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises">Practice Exercises</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further Reading</a>
  <ul class="collapse">
  <li><a href="#geopandas" id="toc-geopandas" class="nav-link" data-scroll-target="#geopandas">GeoPandas</a></li>
  <li><a href="#rasterio" id="toc-rasterio" class="nav-link" data-scroll-target="#rasterio">Rasterio</a></li>
  <li><a href="#combined-workflows" id="toc-combined-workflows" class="nav-link" data-scroll-target="#combined-workflows">Combined Workflows</a></li>
  <li><a href="#philippine-context" id="toc-philippine-context" class="nav-link" data-scroll-target="#philippine-context">Philippine Context</a></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a></li>
  </ul></li>
  <li><a href="#jupyter-notebook" id="toc-jupyter-notebook" class="nav-link" data-scroll-target="#jupyter-notebook">Jupyter Notebook</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day1/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day1/sessions/session3.html">Session 3: Hands-on Python for Geospatial Data</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Session 3: Hands-on Python for Geospatial Data</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Master vector and raster data processing with GeoPandas and Rasterio</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<nav class="breadcrumb" aria-label="Breadcrumb">
<a href="../../index.html">Home</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <a href="../index.html">Day 1</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <span class="breadcrumb-current">Session 3</span>
</nav>
<div class="session-info">
<p><strong>Duration:</strong> 2 hours | <strong>Format:</strong> Hands-on Coding | <strong>Platform:</strong> Google Colaboratory</p>
</div>
<section id="session-overview" class="level2">
<h2 class="anchored" data-anchor-id="session-overview">Session Overview</h2>
<p>This hands-on session teaches you how to work with geospatial data in Python - the foundation of Earth Observation workflows. Python has become the dominant language for EO and ML applications due to its rich ecosystem of libraries, active community, and seamless integration with operational systems. You’ll use Google Colab (no installation needed!), learn vector data operations with GeoPandas, and master raster processing with Rasterio. By the end, you’ll understand why Python powers Philippine EO platforms like DATOS, SkAI-Pinas, and PRiSM, and you’ll be able to prepare satellite data for AI/ML workflows.</p>
<hr>
<section id="learning-objectives" class="level3 learning-objectives">
<h3 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h3>
<p>By the end of this session, you will be able to:</p>
<ul>
<li><strong>Explain</strong> why Python is the dominant language for EO and ML applications</li>
<li><strong>Set up</strong> Google Colaboratory for geospatial analysis</li>
<li><strong>Mount</strong> Google Drive for data access and storage</li>
<li><strong>Install</strong> Python geospatial libraries (GeoPandas, Rasterio)</li>
<li><strong>Read and inspect</strong> vector data (shapefiles, GeoJSON) with GeoPandas</li>
<li><strong>Transform</strong> coordinate reference systems for Philippine UTM zones</li>
<li><strong>Query and filter</strong> geospatial DataFrames spatially and by attributes</li>
<li><strong>Visualize</strong> vector data with static and interactive maps</li>
<li><strong>Open and examine</strong> raster files and their metadata with Rasterio</li>
<li><strong>Read</strong> raster bands into NumPy arrays efficiently</li>
<li><strong>Calculate</strong> spectral indices (NDVI, EVI, NDWI) from Sentinel-2 bands</li>
<li><strong>Create</strong> RGB and false-color composites from multispectral imagery</li>
<li><strong>Clip</strong> rasters to vector boundaries for area-of-interest analysis</li>
<li><strong>Sample</strong> raster values at point locations for validation</li>
<li><strong>Apply</strong> preprocessing workflows for ML-ready data</li>
<li><strong>Combine</strong> vector and raster operations for complete EO workflows</li>
</ul>
</section>
<hr>
</section>
<section id="presentation-slides" class="level2">
<h2 class="anchored" data-anchor-id="presentation-slides">Presentation Slides</h2>
<iframe src="../presentations/03_session3_python_geospatial.html" width="100%" height="600" style="border: 1px solid #ccc; border-radius: 4px;">
</iframe>
<hr>
</section>
<section id="part-1-why-python-for-earth-observation" class="level2">
<h2 class="anchored" data-anchor-id="part-1-why-python-for-earth-observation">Part 1: Why Python for Earth Observation?</h2>
<section id="the-python-eo-ecosystem" class="level3">
<h3 class="anchored" data-anchor-id="the-python-eo-ecosystem">The Python EO Ecosystem</h3>
<p>Python has become the <strong>de facto standard</strong> for Earth Observation and Machine Learning. Understanding why helps you leverage the right tools for your projects.</p>
<section id="key-advantages" class="level4">
<h4 class="anchored" data-anchor-id="key-advantages">Key Advantages</h4>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TB
    subgraph DataAccess["DATA ACCESS"]
        DA1[Earth Engine&lt;br/&gt;Python API]
        DA2[Sentinel Hub&lt;br/&gt;sentinelhub-py]
        DA3[NASA CMR&lt;br/&gt;earthaccess]
        DA4[STAC&lt;br/&gt;pystac-client]
    end

    subgraph Geospatial["GEOSPATIAL PROCESSING"]
        GP1[GeoPandas&lt;br/&gt;Vector data]
        GP2[Rasterio&lt;br/&gt;Raster I/O]
        GP3[Xarray&lt;br/&gt;N-D arrays]
        GP4[Rioxarray&lt;br/&gt;Raster+Xarray]
        GP5[GDAL/OGR&lt;br/&gt;Low-level ops]
    end

    subgraph DataScience["DATA SCIENCE"]
        DS1[NumPy&lt;br/&gt;Array operations]
        DS2[Pandas&lt;br/&gt;Tabular data]
        DS3[SciPy&lt;br/&gt;Scientific computing]
        DS4[Dask&lt;br/&gt;Parallel computing]
    end

    subgraph ML["MACHINE LEARNING"]
        ML1[Scikit-learn&lt;br/&gt;Traditional ML]
        ML2[TensorFlow&lt;br/&gt;Deep Learning]
        ML3[PyTorch&lt;br/&gt;Deep Learning]
        ML4[TorchGeo&lt;br/&gt;Geospatial DL]
    end

    subgraph Viz["VISUALIZATION"]
        VZ1[Matplotlib&lt;br/&gt;Static plots]
        VZ2[Folium&lt;br/&gt;Interactive maps]
        VZ3[Plotly&lt;br/&gt;Interactive viz]
        VZ4[Cartopy&lt;br/&gt;Map projections]
    end

    DataAccess --&gt; Geospatial
    Geospatial --&gt; DataScience
    DataScience --&gt; ML
    Geospatial --&gt; Viz
    ML --&gt; Viz

    style DataAccess fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style Geospatial fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style DataScience fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style ML fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
    style Viz fill:#f0e6ff,stroke:#6666cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Python Earth Observation Ecosystem</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>1. Rich Library Ecosystem</strong> - <strong>Geospatial Processing:</strong> GeoPandas, Rasterio, Xarray, Rioxarray, GDAL bindings - <strong>Data Science:</strong> NumPy, Pandas, SciPy for array operations and analysis - <strong>Machine Learning:</strong> Scikit-learn, TensorFlow, PyTorch, TorchGeo - <strong>Visualization:</strong> Matplotlib, Seaborn, Folium, Plotly for static and interactive maps</p>
<p><strong>2. Seamless Integration</strong> - <strong>Cloud Platforms:</strong> Google Earth Engine Python API, AWS, Azure - <strong>Big Data:</strong> Dask for parallel/distributed computing on large rasters - <strong>Workflows:</strong> Easy integration between data access → preprocessing → ML → visualization</p>
<p><strong>3. Active Community</strong> - Extensive documentation and tutorials - Stack Overflow, GitHub discussions, forums - Open-source contributions and rapid bug fixes - Jupyter notebooks for reproducible research</p>
<p><strong>4. Industry and Research Standard</strong> - NASA, ESA, USGS use Python for operational systems - Scientific papers increasingly publish Python code - Enterprise solutions (Planet Labs, Descartes Labs) built on Python</p>
</section>
</section>
<section id="python-in-philippine-eo-systems" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="python-in-philippine-eo-systems">Python in Philippine EO Systems</h3>
<p><strong>DATOS (DOST-ASTI)</strong> - Python backend for automated processing - Integrates Sentinel data access and analysis - Generates data products for government use</p>
<p><strong>PRiSM (PhilRice/IRRI)</strong> - Python workflows for SAR-based rice monitoring - Combines Sentinel-1, field data, and crop models - Operational since 2014</p>
<p><strong>SkAI-Pinas (PhilSA)</strong> - Python-based AI/ML training platform - Pre-configured with GeoPandas, Rasterio, TensorFlow - Jupyter notebooks for capacity building</p>
<p><strong>ALaM Project (DOST)</strong> - Python for agricultural land monitoring - Automated crop classification pipelines - Integration with local government data systems</p>
<p><strong>Key Takeaway:</strong> Learning Python for EO opens doors to operational systems, not just research.</p>
</section>
<section id="connecting-to-session-2-preprocessing-for-ml" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-session-2-preprocessing-for-ml">Connecting to Session 2: Preprocessing for ML</h3>
<p>In <strong>Session 2</strong>, you learned that data preprocessing is critical for ML success:</p>
<ul>
<li><strong>Atmospheric correction:</strong> Sen2Cor converts Sentinel-2 Level-1C → Level-2A</li>
<li><strong>Normalization:</strong> Scaling pixel values for neural networks</li>
<li><strong>Cloud masking:</strong> Removing contaminated observations</li>
<li><strong>Data augmentation:</strong> Rotation, flipping, cropping</li>
</ul>
<p><strong>This session provides the Python skills to implement these preprocessing steps</strong> for your own projects. By the end, you’ll prepare analysis-ready data for the ML models in Sessions 5-7.</p>
<hr>
</section>
</section>
<section id="part-2-setting-up-google-colaboratory" class="level2">
<h2 class="anchored" data-anchor-id="part-2-setting-up-google-colaboratory">Part 2: Setting Up Google Colaboratory</h2>
<section id="what-is-google-colab" class="level3">
<h3 class="anchored" data-anchor-id="what-is-google-colab">What is Google Colab?</h3>
<p><strong>Google Colaboratory (Colab)</strong> is a free cloud-based Jupyter notebook environment that allows you to:</p>
<ul>
<li>Write and execute Python code in your browser</li>
<li>Access free GPU/TPU for machine learning</li>
<li>Collaborate with others in real-time</li>
<li>Save notebooks to Google Drive</li>
<li>No local installation required!</li>
</ul>
<p><strong>Perfect for this training:</strong> Everyone has the same environment, no dependency issues, accessible from anywhere.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Why Colab for Philippine Trainees?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>No hardware requirements:</strong> Works on any laptop/computer with a browser</li>
<li><strong>Internet connectivity:</strong> Even with limited bandwidth, code runs on Google’s servers</li>
<li><strong>Free GPU access:</strong> Train deep learning models without expensive hardware</li>
<li><strong>Reproducibility:</strong> Notebooks can be shared and rerun by collaborators</li>
<li><strong>COARE compatibility:</strong> Skills transfer to DOST’s COARE HPC environment</li>
</ul>
</div>
</div>
</section>
<section id="creating-your-first-colab-notebook" class="level3">
<h3 class="anchored" data-anchor-id="creating-your-first-colab-notebook">Creating Your First Colab Notebook</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Access Colab
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>URL:</strong> <a href="https://colab.research.google.com">https://colab.research.google.com</a></p>
<p><strong>Requirements:</strong> - Google account - Modern web browser (Chrome, Firefox, Safari, Edge) - Stable internet connection</p>
</div>
</div>
<p><strong>Steps:</strong></p>
<ol type="1">
<li>Go to colab.research.google.com</li>
<li>Sign in with your Google account</li>
<li>Click <strong>File → New Notebook</strong></li>
<li>Rename: <strong>File → Rename</strong> → “Day1_Session3_Geospatial_Python”</li>
</ol>
</section>
<section id="understanding-the-colab-interface" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-colab-interface">Understanding the Colab Interface</h3>
<p><strong>Key components:</strong></p>
<ul>
<li><strong>Code cells:</strong> Where you write Python code (click or press Enter to edit)</li>
<li><strong>Text cells:</strong> Markdown for documentation (Insert → Text cell)</li>
<li><strong>Run button:</strong> ▶ Execute current cell (or press Shift+Enter)</li>
<li><strong>Runtime menu:</strong> Manage execution environment (restart, change runtime type)</li>
<li><strong>Table of Contents:</strong> Navigate long notebooks (left sidebar icon)</li>
</ul>
<p><strong>Try it:</strong> Create a code cell and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello from Google Colab!"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is the CoPhil EO AI/ML Training"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Python version</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version: </span><span class="sc">{</span>sys<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Press <strong>Shift+Enter</strong> to execute. You should see the output below the cell.</p>
</section>
<section id="connecting-google-drive" class="level3">
<h3 class="anchored" data-anchor-id="connecting-google-drive">Connecting Google Drive</h3>
<p><strong>Why mount Google Drive?</strong></p>
<ul>
<li>Access data files stored in Drive</li>
<li>Save outputs permanently (Colab sessions are temporary!)</li>
<li>Share data with collaborators</li>
<li>Store trained models and results</li>
</ul>
<p><strong>Mount Drive:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">'/content/drive'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What happens:</strong></p>
<ol type="1">
<li>Click the link that appears</li>
<li>Select your Google account</li>
<li>Click “Allow” to grant access</li>
<li>Copy the authorization code</li>
<li>Paste into the input field and press Enter</li>
</ol>
<p><strong>Verification:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'/content/drive/MyDrive'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should see your Google Drive folders listed!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Organizing Your Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a folder structure in Google Drive for this training:</p>
<pre><code>MyDrive/
  CoPhil_Training/
    data/
      vector/          # Shapefiles, GeoJSON (Philippine boundaries, AOIs)
      raster/          # Satellite imagery (Sentinel-2 tiles, NDVI, etc.)
    outputs/           # Processed results (clipped rasters, classification maps)
    notebooks/         # Saved Colab notebooks</code></pre>
<p><strong>Pro Tip:</strong> Use descriptive filenames with dates: <code>palawan_sentinel2_20240615.tif</code></p>
<p>This keeps your training materials organized and makes paths easier to reference in code.</p>
</div>
</div>
</section>
<section id="understanding-colab-runtime" class="level3">
<h3 class="anchored" data-anchor-id="understanding-colab-runtime">Understanding Colab Runtime</h3>
<p><strong>Runtime Types:</strong></p>
<ul>
<li><strong>CPU:</strong> Default, free, sufficient for most geospatial tasks</li>
<li><strong>GPU:</strong> Free, excellent for deep learning (Sessions 5-7)</li>
<li><strong>TPU:</strong> Free, specialized for TensorFlow models</li>
</ul>
<p><strong>Session Limits:</strong></p>
<ul>
<li><strong>Idle timeout:</strong> 90 minutes of inactivity</li>
<li><strong>Maximum runtime:</strong> 12 hours continuous execution</li>
<li><strong>Disk space:</strong> ~100 GB temporary storage</li>
</ul>
<p><strong>Best Practices:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Periodically save important results to Drive</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>shutil.copy(<span class="st">'important_result.tif'</span>, <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-3-installing-geospatial-libraries" class="level2">
<h2 class="anchored" data-anchor-id="part-3-installing-geospatial-libraries">Part 3: Installing Geospatial Libraries</h2>
<section id="required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="required-libraries">Required Libraries</h3>
<p>Google Colab comes with many libraries pre-installed (NumPy, Pandas, Matplotlib), but specialized geospatial tools need installation.</p>
<p><strong>Core libraries we’ll use:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Library</th>
<th>Purpose</th>
<th>Why Important</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GeoPandas</strong></td>
<td>Vector data (shapefiles, GeoJSON, polygons, points)</td>
<td>Spatial operations, CRS transforms, easy plotting</td>
</tr>
<tr class="even">
<td><strong>Rasterio</strong></td>
<td>Raster data (GeoTIFF, satellite imagery)</td>
<td>Read/write rasters, metadata, windowed reading</td>
</tr>
<tr class="odd">
<td><strong>Shapely</strong></td>
<td>Geometric operations (included with GeoPandas)</td>
<td>Create/manipulate geometries, spatial predicates</td>
</tr>
<tr class="even">
<td><strong>Matplotlib</strong></td>
<td>Visualization</td>
<td>Publication-quality figures, customizable plots</td>
</tr>
<tr class="odd">
<td><strong>NumPy</strong></td>
<td>Array operations (pre-installed)</td>
<td>Foundation for all numerical computing</td>
</tr>
</tbody>
</table>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>Run this cell (may take 1-2 minutes):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install geospatial libraries</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install geopandas rasterio fiona shapely pyproj <span class="op">-</span>q</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Installation complete! ✓"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>-q</code> flag makes installation quiet (less output).</p>
<p><strong>What’s being installed:</strong></p>
<ul>
<li><code>geopandas</code>: Main vector library (also installs Pandas)</li>
<li><code>rasterio</code>: Main raster library (also installs GDAL bindings)</li>
<li><code>fiona</code>: File I/O for vector formats (dependency of GeoPandas)</li>
<li><code>shapely</code>: Geometric operations (dependency of GeoPandas)</li>
<li><code>pyproj</code>: Coordinate reference system transformations</li>
</ul>
<p><strong>If you see warnings:</strong> Usually safe to ignore. If errors occur, try:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>upgrade geopandas rasterio</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="verify-installation" class="level3">
<h3 class="anchored" data-anchor-id="verify-installation">Verify Installation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ GeoPandas version:"</span>, gpd.__version__)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Rasterio version:"</span>, rasterio.__version__)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ NumPy version:"</span>, np.__version__)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ All libraries imported successfully!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Runtime Restart
</div>
</div>
<div class="callout-body-container callout-body">
<p>Occasionally, Colab may ask you to restart the runtime after installing libraries:</p>
<p><strong>Runtime → Restart runtime</strong></p>
<p>Then re-run your import cell. This is normal and ensures clean library loading!</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-4-python-basics-refresher" class="level2">
<h2 class="anchored" data-anchor-id="part-4-python-basics-refresher">Part 4: Python Basics Refresher</h2>
<p>Quick recap of Python essentials for geospatial work:</p>
<section id="data-types" class="level3">
<h3 class="anchored" data-anchor-id="data-types">Data Types</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbers</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">1780148</span>        <span class="co"># Integer</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> <span class="fl">42.88</span>           <span class="co"># Float</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Strings</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">"Manila"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>province <span class="op">=</span> <span class="st">"Metro Manila"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lists (ordered collections)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">"Luzon"</span>, <span class="st">"Visayas"</span>, <span class="st">"Mindanao"</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> [<span class="fl">14.5995</span>, <span class="fl">120.9842</span>]  <span class="co"># [latitude, longitude]</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionaries (key-value pairs)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>location_info <span class="op">=</span> {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"city"</span>: <span class="st">"Quezon City"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"population"</span>: <span class="dv">2960048</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>: <span class="st">"NCR"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss"> has population </span><span class="sc">{</span>population<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Regions: </span><span class="sc">{</span>regions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coordinates<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="control-structures" class="level3">
<h3 class="anchored" data-anchor-id="control-structures">Control Structures</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If statements</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cloud_cover <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cloud_cover <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Excellent"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> cloud_cover <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Good"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Poor"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cloud cover </span><span class="sc">{</span>cloud_cover<span class="sc">}</span><span class="ss">%: </span><span class="sc">{</span>quality<span class="sc">}</span><span class="ss"> for optical imagery"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># For loops</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> [<span class="st">"Palawan"</span>, <span class="st">"Zambales"</span>, <span class="st">"Quezon"</span>]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> province <span class="kw">in</span> provinces:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Processing </span><span class="sc">{</span>province<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># List comprehension (Pythonic way)</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>province_lengths <span class="op">=</span> [<span class="bu">len</span>(p) <span class="cf">for</span> p <span class="kw">in</span> provinces]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Province name lengths:"</span>, province_lengths)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(nir, red):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : float or ndarray</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance values</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    red : float or ndarray</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance values</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : float or ndarray</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values ranging from -1 to +1</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add small value to avoid division by zero</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>nir_value <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>red_value <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> calculate_ndvi(nir_value, red_value)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI: </span><span class="sc">{</span>result<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Python concepts for geospatial:</strong></p>
<ul>
<li><strong>Indentation matters:</strong> Use 4 spaces to define code blocks</li>
<li><strong>0-indexed:</strong> First element is <code>list[0]</code>, not <code>list[1]</code></li>
<li><strong>Method chaining:</strong> <code>gdf.filter(...).plot()</code> applies operations sequentially</li>
<li><strong>Context managers:</strong> <code>with rasterio.open() as src:</code> auto-closes files (prevents memory leaks)</li>
</ul>
<hr>
</section>
</section>
<section id="part-5-vector-data-with-geopandas" class="level2">
<h2 class="anchored" data-anchor-id="part-5-vector-data-with-geopandas">Part 5: Vector Data with GeoPandas</h2>
<section id="what-is-vector-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-vector-data">What is Vector Data?</h3>
<p><strong>Vector data represents discrete features as geometric objects:</strong></p>
<ul>
<li><strong>Points:</strong> Cities, field sites, observation locations, GPS waypoints</li>
<li><strong>Lines (LineStrings):</strong> Roads, rivers, transects, boundaries</li>
<li><strong>Polygons:</strong> Administrative boundaries, land parcels, watersheds, protected areas</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TB
    subgraph VectorTypes["VECTOR GEOMETRY TYPES"]
        V1[Point&lt;br/&gt;Single coordinate&lt;br/&gt;Cities, GPS points]
        V2[LineString&lt;br/&gt;Connected coordinates&lt;br/&gt;Roads, rivers]
        V3[Polygon&lt;br/&gt;Closed ring&lt;br/&gt;Boundaries, parcels]
        V4[MultiPoint&lt;br/&gt;Multiple points&lt;br/&gt;Observation sites]
        V5[MultiLineString&lt;br/&gt;Multiple lines&lt;br/&gt;Road networks]
        V6[MultiPolygon&lt;br/&gt;Multiple polygons&lt;br/&gt;Archipelago]
    end

    subgraph GDF["GEOPANDAS GEODATAFRAME"]
        GDF1[Geometry Column&lt;br/&gt;Shapely objects&lt;br/&gt;Point/Line/Polygon]
        GDF2[Attribute Columns&lt;br/&gt;Name, Population&lt;br/&gt;Area, Type, etc.]
        GDF3[CRS Information&lt;br/&gt;EPSG:4326, 32651&lt;br/&gt;Projection metadata]
        GDF4[Spatial Index&lt;br/&gt;R-tree for fast&lt;br/&gt;spatial queries]
    end

    subgraph Formats["FILE FORMATS"]
        F1[Shapefile&lt;br/&gt;.shp + .shx + .dbf + .prj]
        F2[GeoJSON&lt;br/&gt;.geojson, .json]
        F3[GeoPackage&lt;br/&gt;.gpkg]
        F4[KML/KMZ&lt;br/&gt;.kml, .kmz]
    end

    V1 --&gt; GDF1
    V2 --&gt; GDF1
    V3 --&gt; GDF1

    GDF1 --&gt; Operations[Spatial Operations&lt;br/&gt;Buffer, Intersect&lt;br/&gt;Union, Dissolve&lt;br/&gt;Clip, Overlay]
    GDF2 --&gt; Operations
    GDF3 --&gt; Operations

    F1 --&gt;|gpd.read_file| GDF
    F2 --&gt;|gpd.read_file| GDF
    F3 --&gt;|gpd.read_file| GDF

    style VectorTypes fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style GDF fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style Formats fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style Operations fill:#ffe6ff,stroke:#cc00cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Vector Data Types and GeoPandas GeoDataFrame Structure</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>Common formats:</strong> Shapefile (.shp + .shx + .dbf + .prj), GeoJSON (.geojson, .json), KML (.kml), GeoPackage (.gpkg)</p>
<p><strong>Shapefile components:</strong> - <code>.shp</code>: Geometry (points, lines, polygons) - <code>.shx</code>: Shape index - <code>.dbf</code>: Attribute table (database) - <code>.prj</code>: Coordinate reference system - <code>.cpg</code>: Character encoding (optional)</p>
</section>
<section id="understanding-coordinate-reference-systems-crs" class="level3">
<h3 class="anchored" data-anchor-id="understanding-coordinate-reference-systems-crs">Understanding Coordinate Reference Systems (CRS)</h3>
<p>Before we load data, it’s essential to understand CRS - a critical concept for accurate geospatial analysis.</p>
<p><strong>What is a CRS?</strong></p>
<p>A Coordinate Reference System defines how coordinates map to locations on Earth. It consists of:</p>
<ol type="1">
<li><strong>Coordinate System:</strong> Geographic (lat/lon) or Projected (x/y in meters)</li>
<li><strong>Datum:</strong> Reference ellipsoid approximating Earth’s shape (e.g., WGS84)</li>
<li><strong>Projection:</strong> Mathematical transformation from 3D Earth to 2D map</li>
</ol>
<p><strong>Common CRS for Philippines:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>EPSG Code</th>
<th>Name</th>
<th>Type</th>
<th>Units</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>4326</strong></td>
<td>WGS84</td>
<td>Geographic</td>
<td>Degrees</td>
<td>GPS, web maps, global datasets</td>
</tr>
<tr class="even">
<td><strong>32651</strong></td>
<td>UTM Zone 51N</td>
<td>Projected</td>
<td>Meters</td>
<td>Northern/Western Philippines</td>
</tr>
<tr class="odd">
<td><strong>32652</strong></td>
<td>UTM Zone 52N</td>
<td>Projected</td>
<td>Meters</td>
<td>Eastern Philippines</td>
</tr>
<tr class="even">
<td><strong>3123</strong></td>
<td>PRS92 / Philippines Zone III</td>
<td>Projected</td>
<td>Meters</td>
<td>Philippine national standard</td>
</tr>
</tbody>
</table>
<p><strong>Why CRS matters:</strong></p>
<ul>
<li><strong>Distance calculations:</strong> Geographic CRS (degrees) gives wrong distances; use projected CRS (meters)</li>
<li><strong>Area calculations:</strong> Same issue - must use projected CRS for accurate areas</li>
<li><strong>Spatial operations:</strong> CRS must match for intersections, buffers, clipping</li>
<li><strong>Visualization:</strong> Web maps expect EPSG:4326; analysis needs meters</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[GPS Data&lt;br/&gt;EPSG:4326&lt;br/&gt;Lat: 14.5995°&lt;br/&gt;Lon: 120.9842°] --&gt; B{Need distance&lt;br/&gt;or area&lt;br/&gt;calculations?}

    B --&gt;|Yes| C[Transform to&lt;br/&gt;Projected CRS&lt;br/&gt;UTM Zone 51N&lt;br/&gt;EPSG:32651]

    B --&gt;|No, just&lt;br/&gt;visualization| D[Keep Geographic&lt;br/&gt;EPSG:4326&lt;br/&gt;For web maps]

    C --&gt; E[Accurate Calculations&lt;br/&gt;X: 279,000 m&lt;br/&gt;Y: 1,615,000 m]

    E --&gt; F[Spatial Operations&lt;br/&gt;Buffer 1000m&lt;br/&gt;Calculate area in km²&lt;br/&gt;Distance in meters]

    F --&gt; G{Export for&lt;br/&gt;web mapping?}

    G --&gt;|Yes| H[Transform back&lt;br/&gt;to EPSG:4326]
    G --&gt;|No| I[Save in UTM&lt;br/&gt;For further analysis]

    H --&gt; D

    D --&gt; J[Interactive Map&lt;br/&gt;Folium, Leaflet&lt;br/&gt;Google Maps]

    subgraph PhilippineCRS["PHILIPPINE CRS OPTIONS"]
        P1[EPSG:4326&lt;br/&gt;WGS84 Geographic&lt;br/&gt;Global standard]
        P2[EPSG:32651&lt;br/&gt;UTM Zone 51N&lt;br/&gt;Western PH]
        P3[EPSG:32652&lt;br/&gt;UTM Zone 52N&lt;br/&gt;Eastern PH]
        P4[EPSG:3123&lt;br/&gt;PRS92 Zone III&lt;br/&gt;National standard]
    end

    C -.-&gt;|Choose| P2
    C -.-&gt;|Choose| P3
    C -.-&gt;|Choose| P4

    style A fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style C fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
    style E fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style D fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style PhilippineCRS fill:#f0e6ff,stroke:#6666cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Coordinate Reference System Transformation Workflow</figcaption> </figure><p></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Philippine UTM Zones
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Philippines spans <strong>two UTM zones:</strong></p>
<ul>
<li><strong>UTM Zone 51N (EPSG:32651):</strong> Covers western Philippines including Manila, Palawan, western Luzon, western Visayas</li>
<li><strong>UTM Zone 52N (EPSG:32652):</strong> Covers eastern Philippines including Mindanao, eastern Visayas, Bicol</li>
</ul>
<p><strong>Rule of thumb:</strong> Manila and most populated areas use Zone 51N. When in doubt, check your AOI’s central longitude: - Longitude &lt; 120° → Zone 51N - Longitude ≥ 120° → Zone 52N</p>
<p>For national-scale analysis, <strong>PRS92 (EPSG:3123)</strong> is the Philippine standard.</p>
</div>
</div>
</section>
<section id="loading-philippine-administrative-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="loading-philippine-administrative-boundaries">Loading Philippine Administrative Boundaries</h3>
<p>Let’s load provincial boundaries of the Philippines:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: From Google Drive (if you uploaded data)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> gpd.read_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/philippines_provinces.shp'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: From URL (using sample data from PhilGIS)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/altcoder/philippines-json-maps/master/geojson/provinces/hires/BOHOL.json"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sample_province <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For this example, let's use the sample</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> sample_province</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loaded successfully! ✓"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span><span class="bu">type</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="philippine-geospatial-data-sources" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="philippine-geospatial-data-sources">Philippine Geospatial Data Sources</h3>
<p><strong>Official Government Sources:</strong> - <strong>NAMRIA Geoportal:</strong> Official administrative boundaries, topographic maps - Website: https://www.namria.gov.ph/ - Note: May require registration for downloads - <strong>PhilGIS:</strong> Open-source Philippine GIS data repository - Roads, rivers, boundaries, land use - <strong>PSA (Philippine Statistics Authority):</strong> Statistical boundaries matching census data - <strong>LMB (Land Management Bureau):</strong> Cadastral boundaries, land parcel data</p>
<p><strong>Open Data Platforms:</strong> - <strong>GADM:</strong> Global Administrative Areas - free Philippine boundaries - Website: https://gadm.org/download_country.html (select Philippines) - <strong>OpenStreetMap (OSM):</strong> Roads, buildings, POIs, waterways - Export via: https://export.hotosm.org/ or Overpass Turbo - <strong>Humanitarian Data Exchange (HDX):</strong> Disaster-related boundaries and data - <strong>PhilSA Data Portal:</strong> Satellite-derived products and boundaries</p>
<p><strong>Pro Tip:</strong> Download shapefiles to your Google Drive <code>data/vector/</code> folder before the session for offline access.</p>
</section>
<section id="inspecting-a-geodataframe" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-a-geodataframe">Inspecting a GeoDataFrame</h3>
<p><strong>View first rows:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>gdf.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows: - Attribute columns (NAME, PROVINCE, REGION, ADM1_EN, etc.) - <strong>geometry column:</strong> The shapes themselves (Polygon or MultiPolygon)</p>
<p><strong>Check coordinate reference system:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS:"</span>, gdf.crs)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS name:"</span>, gdf.crs.name <span class="cf">if</span> gdf.crs <span class="cf">else</span> <span class="st">"Not defined"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Get basic information:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of features: </span><span class="sc">{</span><span class="bu">len</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span><span class="bu">type</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bounds (minx, miny, maxx, maxy): </span><span class="sc">{</span>gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Columns:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">list</span>(gdf.columns)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Summary statistics:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gdf.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Understand geometry details:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First geometry</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>first_geom <span class="op">=</span> gdf.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>first_geom<span class="sc">.</span>geom_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Is valid: </span><span class="sc">{</span>first_geom<span class="sc">.</span>is_valid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinate count: </span><span class="sc">{</span><span class="bu">len</span>(first_geom.exterior.coords)<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># For Polygon</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="working-with-coordinate-reference-systems" class="level3">
<h3 class="anchored" data-anchor-id="working-with-coordinate-reference-systems">Working with Coordinate Reference Systems</h3>
<p><strong>Check current CRS:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original CRS:"</span>, gdf.crs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Reproject to UTM Zone 51N (for Manila area):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to UTM 51N for accurate distance/area calculations</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>gdf_utm <span class="op">=</span> gdf.to_crs(<span class="st">'EPSG:32651'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reprojected CRS:"</span>, gdf_utm.crs)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare bounds in degrees vs meters</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Original bounds (degrees):"</span>, gdf.total_bounds)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"UTM bounds (meters):"</span>, gdf_utm.total_bounds)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Use Which CRS?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Use Geographic CRS (EPSG:4326) for:</strong> - Loading data (most sources provide data in WGS84) - Web mapping and visualization - Storing data for sharing</p>
<p><strong>Use Projected CRS (UTM or PRS92) for:</strong> - Distance calculations: <code>gdf.geometry.length</code> - Area calculations: <code>gdf.geometry.area</code> - Buffer operations: <code>gdf.geometry.buffer(1000)</code> for 1 km buffer - Spatial analysis requiring metric units</p>
<p><strong>Workflow:</strong> 1. Load data (usually in EPSG:4326) 2. Reproject to appropriate UTM zone 3. Perform spatial operations 4. Optionally reproject back to EPSG:4326 for web display</p>
</div>
</div>
</section>
<section id="calculating-geometric-properties" class="level3">
<h3 class="anchored" data-anchor-id="calculating-geometric-properties">Calculating Geometric Properties</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area in square kilometers</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'area_km2'</span>] <span class="op">=</span> gdf_utm.geometry.area <span class="op">/</span> <span class="dv">1_000_000</span>  <span class="co"># m² to km²</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province area: </span><span class="sc">{</span>gdf_utm[<span class="st">'area_km2'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km²"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate perimeter</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'perimeter_km'</span>] <span class="op">=</span> gdf_utm.geometry.length <span class="op">/</span> <span class="dv">1000</span>  <span class="co"># m to km</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province perimeter: </span><span class="sc">{</span>gdf_utm[<span class="st">'perimeter_km'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroid (in original CRS)</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>] <span class="op">=</span> gdf.geometry.centroid</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Centroid coordinates: </span><span class="sc">{</span>gdf[<span class="st">'centroid'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display updated GeoDataFrame</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>gdf_utm[[<span class="st">'area_km2'</span>, <span class="st">'perimeter_km'</span>]].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="filtering-and-querying" class="level3">
<h3 class="anchored" data-anchor-id="filtering-and-querying">Filtering and Querying</h3>
<p><strong>Filter by attribute:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If using multi-province dataset:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># luzon_provinces = gdf[gdf['ISLAND'] == 'LUZON']</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by area (if area column exists or was calculated)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>large_provinces <span class="op">=</span> gdf_utm[gdf_utm[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Provinces larger than 5000 km²: </span><span class="sc">{</span><span class="bu">len</span>(large_provinces)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Select specific province by name</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> gdf[gdf[<span class="st">'NAME'</span>].<span class="bu">str</span>.contains(<span class="st">'Bohol'</span>, case<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Selected: </span><span class="sc">{</span>target[<span class="st">'NAME'</span>]<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple conditions</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># coastal_large = gdf[(gdf['area_km2'] &gt; 3000) &amp; (gdf['coastal'] == True)]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Spatial filtering:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if geometries are valid</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valid geometries: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span>is_valid<span class="sc">.</span><span class="bu">all</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If invalid, fix them</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> gdf.geometry.is_valid.<span class="bu">all</span>():</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">'geometry'</span>] <span class="op">=</span> gdf.geometry.<span class="bu">buffer</span>(<span class="dv">0</span>)  <span class="co"># Common fix for invalid geometries</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial predicate example: find features within a bounding box</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> (<span class="fl">123.5</span>, <span class="fl">9.5</span>, <span class="fl">125.0</span>, <span class="fl">11.0</span>)  <span class="co"># (minx, miny, maxx, maxy)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>bbox_geom <span class="op">=</span> box(<span class="op">*</span>bbox)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>within_bbox <span class="op">=</span> gdf[gdf.geometry.within(bbox_geom)]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features within bounding box: </span><span class="sc">{</span><span class="bu">len</span>(within_bbox)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="spatial-operations" class="level3">
<h3 class="anchored" data-anchor-id="spatial-operations">Spatial Operations</h3>
<p><strong>Buffer (create zone around feature):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 km buffer around province (must use projected CRS!)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>buffer_10km <span class="op">=</span> gdf_utm.geometry.<span class="bu">buffer</span>(<span class="dv">10000</span>)  <span class="co"># 10,000 meters</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize original and buffer</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>gdf_utm.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>buffer_10km.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'10 km buffer'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with 10 km Buffer"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Dissolve (merge features):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces, dissolve by region</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dissolved = gdf.dissolve(by='REGION', aggfunc='sum')  # Aggregates numeric columns</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Spatial joins:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Join point data to polygons (e.g., field sites to provinces)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># points_gdf = gpd.read_file('field_sites.shp')</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># joined = gpd.sjoin(points_gdf, gdf, how='left', predicate='within')</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This adds province attributes to each point based on which polygon contains it</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualizing-vector-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-vector-data">Visualizing Vector Data</h3>
<p><strong>Simple plot:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>gdf.plot(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), edgecolor<span class="op">=</span><span class="st">'black'</span>, facecolor<span class="op">=</span><span class="st">'lightblue'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province, Philippines"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Styled plot with colors:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces with a classification column:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gdf.plot(column='REGION', legend=True, figsize=(10, 10),</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#          cmap='Set3', edgecolor='black', linewidth=0.5)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title("Philippines Provinces by Region")</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For single feature, style it:</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'#90EE90'</span>, edgecolor<span class="op">=</span><span class="st">'darkgreen'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">50</span>, label<span class="op">=</span><span class="st">'Centroid'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province with Centroid"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Interactive map with Folium:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install folium if not already available</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install folium <span class="op">-</span>q</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get centroid for map center</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>centroid <span class="op">=</span> gdf.geometry.centroid.iloc[<span class="dv">0</span>]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> [centroid.y, centroid.x]  <span class="co"># folium expects [lat, lon]</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>center, zoom_start<span class="op">=</span><span class="dv">9</span>, tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GeoDataFrame to map</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    gdf,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">'Province Boundary'</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    style_function<span class="op">=</span><span class="kw">lambda</span> x: {<span class="st">'fillColor'</span>: <span class="st">'lightblue'</span>, <span class="st">'color'</span>: <span class="st">'darkblue'</span>, <span class="st">'weight'</span>: <span class="dv">2</span>}</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add marker at centroid</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>folium.Marker(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>center,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="st">'Province Centroid'</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'red'</span>, icon<span class="op">=</span><span class="st">'info-sign'</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display map</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="creating-area-of-interest-aoi-geometries" class="level3">
<h3 class="anchored" data-anchor-id="creating-area-of-interest-aoi-geometries">Creating Area of Interest (AOI) Geometries</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, Point, LineString</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple polygon AOI (example coordinates)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>aoi_coords <span class="op">=</span> [</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>),   <span class="co"># Southwest corner</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">9.5</span>),   <span class="co"># Southeast corner</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">11.0</span>),  <span class="co"># Northeast corner</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">11.0</span>),  <span class="co"># Northwest corner</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>)    <span class="co"># Close polygon (first point repeated)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>aoi_polygon <span class="op">=</span> Polygon(aoi_coords)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>aoi_gdf <span class="op">=</span> gpd.GeoDataFrame([<span class="dv">1</span>], geometry<span class="op">=</span>[aoi_polygon], crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>aoi_gdf.columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="st">'geometry'</span>]</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize AOI with province</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>aoi_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'AOI'</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with Area of Interest (Red Box)"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AOI created successfully! ✓"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AOI bounds: </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Save AOI for later use:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as shapefile</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.shp'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as GeoJSON (more portable)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.geojson'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-6-raster-data-with-rasterio" class="level2">
<h2 class="anchored" data-anchor-id="part-6-raster-data-with-rasterio">Part 6: Raster Data with Rasterio</h2>
<section id="what-is-raster-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-raster-data">What is Raster Data?</h3>
<p><strong>Raster data is a grid of pixels (cells), each with a value:</strong></p>
<ul>
<li><strong>Satellite imagery:</strong> Each pixel = reflectance values (0-10000 for Sentinel-2)</li>
<li><strong>DEMs (Digital Elevation Models):</strong> Each pixel = elevation in meters</li>
<li><strong>Temperature maps:</strong> Each pixel = temperature value</li>
<li><strong>Classification maps:</strong> Each pixel = land cover class ID</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Sentinel-2 GeoTIFF&lt;br/&gt;Multi-band raster&lt;br/&gt;13 spectral bands] --&gt; B[Open with Rasterio&lt;br/&gt;rasterio.open]

    B --&gt; C[Read Metadata&lt;br/&gt;CRS, Transform&lt;br/&gt;Bounds, Resolution&lt;br/&gt;Band count]

    C --&gt; D[Read Band Data&lt;br/&gt;src.read&lt;br/&gt;NumPy arrays]

    D --&gt; E{Processing&lt;br/&gt;Goal?}

    E --&gt;|Calculate Index| F[NDVI Calculation&lt;br/&gt;NIR - Red / NIR + Red&lt;br/&gt;NumPy operations]

    E --&gt;|Create Composite| G[RGB Composite&lt;br/&gt;Stack bands&lt;br/&gt;Normalize values]

    E --&gt;|Clip to AOI| H[Vector Mask&lt;br/&gt;GeoDataFrame boundary&lt;br/&gt;rasterio.mask.mask]

    E --&gt;|Resample| I[Change Resolution&lt;br/&gt;Upsample/Downsample&lt;br/&gt;Resampling method]

    F --&gt; J[Write Output&lt;br/&gt;rasterio.open 'w'&lt;br/&gt;Copy metadata&lt;br/&gt;Write array]

    G --&gt; J
    H --&gt; J
    I --&gt; J

    J --&gt; K[New GeoTIFF&lt;br/&gt;Processed raster&lt;br/&gt;Ready for ML]

    subgraph RasterOps["RASTER OPERATIONS"]
        R1[Arithmetic&lt;br/&gt;Add, Subtract&lt;br/&gt;Multiply, Divide]
        R2[Logical&lt;br/&gt;Masks, Filters&lt;br/&gt;Thresholds]
        R3[Statistics&lt;br/&gt;Mean, Std, Min&lt;br/&gt;Max, Percentiles]
        R4[Spatial&lt;br/&gt;Clip, Mosaic&lt;br/&gt;Reproject]
    end

    D --&gt; RasterOps

    style A fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style C fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style D fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style J fill:#ffe6ff,stroke:#cc00cc,stroke-width:2px
    style K fill:#ccffcc,stroke:#00aa44,stroke-width:2px
    style RasterOps fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Raster Data Processing Workflow with Rasterio</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>Common formats:</strong> GeoTIFF (.tif, .tiff), NetCDF (.nc), HDF (.hdf, .h5), JPEG2000 (.jp2)</p>
<p><strong>Raster structure:</strong></p>
<pre><code>┌─────┬─────┬─────┬─────┐
│ 120 │ 130 │ 125 │ 118 │  ← Row 1 (top)
├─────┼─────┼─────┼─────┤
│ 115 │ 140 │ 135 │ 122 │  ← Row 2
├─────┼─────┼─────┼─────┤
│ 110 │ 125 │ 130 │ 119 │  ← Row 3 (bottom)
└─────┴─────┴─────┴─────┘
  ↑     ↑     ↑     ↑
 Col1  Col2  Col3  Col4
 (left)           (right)</code></pre>
<p>Each cell has: - <strong>Value:</strong> Reflectance, elevation, class, etc. - <strong>Location:</strong> Defined by geotransform + CRS - <strong>Size:</strong> Spatial resolution (e.g., 10m means 10m × 10m pixel)</p>
<p><strong>Geotransform:</strong> 6 coefficients that map pixel coordinates to geographic coordinates - <code>[x_origin, x_pixel_size, x_rotation, y_origin, y_rotation, y_pixel_size]</code> - Example: <code>[400000, 10, 0, 5000000, 0, -10]</code> → Origin at (400000, 5000000) UTM, 10m pixels</p>
</section>
<section id="understanding-sentinel-2-bands-and-resolution" class="level3">
<h3 class="anchored" data-anchor-id="understanding-sentinel-2-bands-and-resolution">Understanding Sentinel-2 Bands and Resolution</h3>
<p>Before opening rasters, let’s review Sentinel-2’s band structure (from Session 1):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Band</th>
<th>Name</th>
<th>Wavelength (nm)</th>
<th>Resolution</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B1</td>
<td>Coastal Aerosol</td>
<td>443</td>
<td>60m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="even">
<td>B2</td>
<td>Blue</td>
<td>490</td>
<td><strong>10m</strong></td>
<td>Water body mapping, aerosol detection</td>
</tr>
<tr class="odd">
<td>B3</td>
<td>Green</td>
<td>560</td>
<td><strong>10m</strong></td>
<td>Vegetation vigor, water clarity</td>
</tr>
<tr class="even">
<td>B4</td>
<td>Red</td>
<td>665</td>
<td><strong>10m</strong></td>
<td>Chlorophyll absorption</td>
</tr>
<tr class="odd">
<td>B5</td>
<td>Red Edge 1</td>
<td>705</td>
<td>20m</td>
<td>Vegetation classification</td>
</tr>
<tr class="even">
<td>B6</td>
<td>Red Edge 2</td>
<td>740</td>
<td>20m</td>
<td>Vegetation stress</td>
</tr>
<tr class="odd">
<td>B7</td>
<td>Red Edge 3</td>
<td>783</td>
<td>20m</td>
<td>Vegetation monitoring</td>
</tr>
<tr class="even">
<td>B8</td>
<td>NIR</td>
<td>842</td>
<td><strong>10m</strong></td>
<td>Biomass, vegetation health</td>
</tr>
<tr class="odd">
<td>B8A</td>
<td>Narrow NIR</td>
<td>865</td>
<td>20m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="even">
<td>B9</td>
<td>Water Vapor</td>
<td>945</td>
<td>60m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="odd">
<td>B10</td>
<td>Cirrus</td>
<td>1373</td>
<td>60m</td>
<td>Cirrus cloud detection</td>
</tr>
<tr class="even">
<td>B11</td>
<td>SWIR 1</td>
<td>1610</td>
<td>20m</td>
<td>Snow/ice/cloud discrimination</td>
</tr>
<tr class="odd">
<td>B12</td>
<td>SWIR 2</td>
<td>2190</td>
<td>20m</td>
<td>Vegetation moisture</td>
</tr>
</tbody>
</table>
<p><strong>Key bands for this session:</strong> - <strong>10m bands (B2, B3, B4, B8):</strong> Best for detailed analysis, vegetation indices - <strong>20m bands (B5-B7, B8A, B11-B12):</strong> Useful for spectral indices requiring SWIR - <strong>60m bands (B1, B9, B10):</strong> Mostly for atmospheric correction, rarely used in analysis</p>
</section>
<section id="opening-a-raster-file" class="level3">
<h3 class="anchored" data-anchor-id="opening-a-raster-file">Opening a Raster File</h3>
<p><strong>Example: Sentinel-2 imagery subset</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster path (adjust to your data location)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For demo, we'll show the workflow with a hypothetical path</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>raster_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/data/raster/sentinel2_bohol_subset.tif'</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In real workflow, you'd download Sentinel-2 from Copernicus or GEE</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For now, let's demonstrate with metadata inspection</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Open raster and view metadata</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> rasterio.<span class="bu">open</span>(raster_path)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># View metadata</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Raster Metadata:"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Driver: </span><span class="sc">{</span>src<span class="sc">.</span>driver<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Width (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Height (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Data type: </span><span class="sc">{</span>src<span class="sc">.</span>dtypes[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Transform:</span><span class="ch">\n</span><span class="sc">{</span>src<span class="sc">.</span>transform<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (x_res, y_res) in CRS units</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Nodata value: </span><span class="sc">{</span>src<span class="sc">.</span>nodata<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    src.close()</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Sample raster file not found. We'll use a demonstration dataset."</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"In practice, you'd download Sentinel-2 data from Copernicus Data Space Ecosystem or Google Earth Engine."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Understanding Raster Metadata
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>For a Sentinel-2 10m band over Bohol (hypothetical):</strong></p>
<ul>
<li><strong>Width/Height:</strong> 5490 x 5490 pixels → 54.9km x 54.9km area (standard Sentinel-2 tile)</li>
<li><strong>Bands:</strong> 1 (if single band file) or 4 (if RGB+NIR stack)</li>
<li><strong>Data type:</strong> uint16 (unsigned 16-bit integer, range 0-65535)
<ul>
<li>Sentinel-2 L2A: Reflectance scaled by 10000 (value 5000 = 50% reflectance)</li>
</ul></li>
<li><strong>CRS:</strong> EPSG:32651 (UTM Zone 51N for western Philippines)</li>
<li><strong>Resolution:</strong> (10.0, -10.0) meters
<ul>
<li>Positive x-resolution: columns go west to east</li>
<li>Negative y-resolution: rows go north to south (standard in GeoTIFF)</li>
</ul></li>
<li><strong>Nodata:</strong> 0 or 65535 (no valid data, masked areas)</li>
</ul>
<p><strong>Transform (Affine):</strong></p>
<pre><code>| x_pixel_size  0.0            x_origin |
| 0.0          -y_pixel_size   y_origin |
| 0.0           0.0            1.0      |</code></pre>
<p>Maps pixel coordinates (row, col) to real-world coordinates (x, y).</p>
</div>
</div>
<p><strong>Better pattern: Context manager (auto-closes file):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Context manager ensures file is closed even if error occurs</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Opened: </span><span class="sc">{</span>src<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># File automatically closed after 'with' block - prevents memory leaks!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="reading-raster-data-into-arrays" class="level3">
<h3 class="anchored" data-anchor-id="reading-raster-data-into-arrays">Reading Raster Data into Arrays</h3>
<p><strong>Read a single band:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read band 1 (Rasterio uses 1-indexing for bands!)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    band1 <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for later use</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Band 1 shape: </span><span class="sc">{</span>band1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span>band1<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">, Max value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean value: </span><span class="sc">{</span>band1<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask nodata values</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> profile[<span class="st">'nodata'</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    band1_masked <span class="op">=</span> np.ma.masked_equal(band1, profile[<span class="st">'nodata'</span>])</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean (excluding nodata): </span><span class="sc">{</span>band1_masked<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Read multiple bands:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read all bands as 3D array (bands, height, width)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    all_bands <span class="op">=</span> src.read()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Or read specific bands</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># Band 1: Blue (B2 for Sentinel-2)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># Band 2: Green (B3)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># Band 3: Red (B4)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># Band 4: NIR (B8)</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"All bands shape: </span><span class="sc">{</span>all_bands<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (4, height, width)</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Individual band shape: </span><span class="sc">{</span>blue<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Windowed reading (memory-efficient for large files):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> Window</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read a 1000x1000 pixel window starting at row 500, col 500</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> Window(col_off<span class="op">=</span><span class="dv">500</span>, row_off<span class="op">=</span><span class="dv">500</span>, width<span class="op">=</span><span class="dv">1000</span>, height<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Subset shape: </span><span class="sc">{</span>subset<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (1000, 1000)</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Memory saved by reading only needed area!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="calculating-spectral-indices" class="level3">
<h3 class="anchored" data-anchor-id="calculating-spectral-indices">Calculating Spectral Indices</h3>
<p>Spectral indices combine bands to highlight specific features. Let’s implement the most common indices.</p>
<section id="ndvi-normalized-difference-vegetation-index" class="level4">
<h4 class="anchored" data-anchor-id="ndvi-normalized-difference-vegetation-index">NDVI (Normalized Difference Vegetation Index)</h4>
<p><strong>Formula:</strong> NDVI = (NIR - Red) / (NIR + Red)</p>
<p><strong>For Sentinel-2:</strong> NDVI = (B8 - B4) / (B8 + B4)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read bands as float to avoid integer overflow</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for saving later</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add small value to prevent division by zero</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI range: </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI mean: </span><span class="sc">{</span>ndvi<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize NDVI</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDVI - Vegetation Index"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Column (pixels)"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Row (pixels)"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>NDVI interpretation:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>NDVI Range</th>
<th>Surface Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>&lt; 0</strong></td>
<td>Water, clouds, snow</td>
</tr>
<tr class="even">
<td><strong>0 - 0.2</strong></td>
<td>Bare soil, rock, sand, urban areas</td>
</tr>
<tr class="odd">
<td><strong>0.2 - 0.4</strong></td>
<td>Sparse vegetation, grassland, shrubland</td>
</tr>
<tr class="even">
<td><strong>0.4 - 0.7</strong></td>
<td>Moderate vegetation, cropland, forest</td>
</tr>
<tr class="odd">
<td><strong>&gt; 0.7</strong></td>
<td>Dense vegetation, healthy forest, mature crops</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="philippine-application-rice-paddy-monitoring" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="philippine-application-rice-paddy-monitoring">Philippine Application: Rice Paddy Monitoring</h3>
<p>Rice paddies show characteristic NDVI patterns during growing season:</p>
<ul>
<li><strong>Flooding/transplanting:</strong> Low NDVI (0.1-0.3) - water and sparse seedlings</li>
<li><strong>Vegetative growth:</strong> Rising NDVI (0.4-0.6) - canopy development</li>
<li><strong>Peak growth:</strong> High NDVI (0.6-0.8) - maximum biomass</li>
<li><strong>Senescence/harvest:</strong> Declining NDVI (0.3-0.5) - yellowing and harvest</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify rice paddies (moderate-high NDVI during growing season)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (ndvi <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.85</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Potential Rice Paddies (NDVI 0.5-0.85)"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> rice_mask.size</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># m² to hectares</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice paddies: </span><span class="sc">{</span>rice_pixels<span class="sc">:,}</span><span class="ss"> pixels (</span><span class="sc">{</span>rice_pixels<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Operational use:</strong> PRiSM uses similar SAR-based approaches for nationwide rice monitoring.</p>
</section>
<section id="evi-enhanced-vegetation-index" class="level4">
<h4 class="anchored" data-anchor-id="evi-enhanced-vegetation-index">EVI (Enhanced Vegetation Index)</h4>
<p><strong>Formula:</strong> EVI = 2.5 × ((NIR - Red) / (NIR + 6×Red - 7.5×Blue + 1))</p>
<p><strong>Advantages over NDVI:</strong> - Less saturated in dense vegetation - Better atmospheric correction - Reduces soil background effects</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>).astype(<span class="bu">float</span>)  <span class="co"># B2</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate EVI</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Typical EVI range is -1 to 1, but often 0 to 1 for vegetation</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> np.clip(evi, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Clip extreme values</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'EVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"EVI - Enhanced Vegetation Index"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"EVI range: </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="ndwi-normalized-difference-water-index" class="level4">
<h4 class="anchored" data-anchor-id="ndwi-normalized-difference-water-index">NDWI (Normalized Difference Water Index)</h4>
<p><strong>Formula:</strong> NDWI = (Green - NIR) / (Green + NIR)</p>
<p><strong>For Sentinel-2:</strong> NDWI = (B3 - B8) / (B3 + B8)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>).astype(<span class="bu">float</span>)  <span class="co"># B3</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)    <span class="co"># B8</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDWI</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDWI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDWI - Water Index"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract water bodies (NDWI &gt; 0.3 typically indicates water)</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>water_mask <span class="op">=</span> ndwi <span class="op">&gt;</span> <span class="fl">0.3</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>water_pixels <span class="op">=</span> water_mask.<span class="bu">sum</span>()</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>water_area_ha <span class="op">=</span> (water_pixels <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># 10m pixels, convert to hectares</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water pixels: </span><span class="sc">{</span>water_pixels<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water area: </span><span class="sc">{</span>water_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>NDWI interpretation:</strong> - <strong>&gt; 0.3:</strong> Open water (rivers, lakes, reservoirs) - <strong>0.0 - 0.3:</strong> Wet soil, flooded vegetation - <strong>&lt; 0:</strong> Dry soil, vegetation</p>
</section>
<section id="creating-rgb-and-false-color-composites" class="level3">
<h3 class="anchored" data-anchor-id="creating-rgb-and-false-color-composites">Creating RGB and False Color Composites</h3>
<section id="true-color-composite-red-green-blue" class="level4">
<h4 class="anchored" data-anchor-id="true-color-composite-red-green-blue">True Color Composite (Red, Green, Blue)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># B2</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack bands into RGB array (height, width, 3)</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale to 0-1 range for display</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sentinel-2 L2A surface reflectance: 0-10000</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> rgb.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> np.clip(rgb_scaled, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Clip any values outside 0-1</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhance contrast using percentile stretch</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> scoreatpercentile</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentile_stretch(image, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>):</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Stretch image values between percentiles for better visualization."""</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> np.zeros_like(image, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(image.shape[<span class="dv">2</span>]):</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        band <span class="op">=</span> image[:,:,i]</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        low, high <span class="op">=</span> scoreatpercentile(band, (lower, upper))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        out[:,:,i] <span class="op">=</span> np.clip((band <span class="op">-</span> low) <span class="op">/</span> (high <span class="op">-</span> low), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>rgb_enhanced <span class="op">=</span> percentile_stretch(rgb_scaled, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">7</span>))</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].imshow(rgb_scaled)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"True Color (Linear Stretch)"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(rgb_enhanced)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"True Color (Enhanced Contrast)"</span>)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="false-color-composite-nir-red-green" class="level4">
<h4 class="anchored" data-anchor-id="false-color-composite-nir-red-green">False Color Composite (NIR, Red, Green)</h4>
<p><strong>Purpose:</strong> Highlights vegetation (appears red) and makes it easier to distinguish land cover types.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># B8</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># NIR-R-G composite (standard false color)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>false_color <span class="op">=</span> np.stack([nir, red, green], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> false_color.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> np.clip(false_color_scaled, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply percentile stretch</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>false_color_enhanced <span class="op">=</span> percentile_stretch(false_color_scaled)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.imshow(false_color_enhanced)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"False Color Composite (NIR-Red-Green)</span><span class="ch">\n</span><span class="st">Vegetation appears red"</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>False color interpretation:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Color</th>
<th>Surface Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Bright red</strong></td>
<td>Dense, healthy vegetation (high NIR)</td>
</tr>
<tr class="even">
<td><strong>Pink/magenta</strong></td>
<td>Moderate vegetation</td>
</tr>
<tr class="odd">
<td><strong>Dark blue/black</strong></td>
<td>Water (absorbs NIR)</td>
</tr>
<tr class="even">
<td><strong>Cyan/gray</strong></td>
<td>Urban areas, bare soil</td>
</tr>
<tr class="odd">
<td><strong>Brown/tan</strong></td>
<td>Sparse vegetation, agricultural fields</td>
</tr>
</tbody>
</table>
<p><strong>Why false color is useful:</strong> - Vegetation is much more distinguishable (red tones) - Water bodies are very dark (low NIR) - Urban areas are clearly visible (cyan/gray) - Useful for rapid visual interpretation before quantitative analysis</p>
</section>
</section>
<section id="saving-processed-rasters" class="level3">
<h3 class="anchored" data-anchor-id="saving-processed-rasters">Saving Processed Rasters</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NDVI as GeoTIFF</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/ndvi.tif'</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Update profile for single-band float output</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>profile.update(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>rasterio.float32,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    count<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    compress<span class="op">=</span><span class="st">'lzw'</span>,  <span class="co"># Compress to save space</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span>     <span class="co"># Define nodata value</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(output_path, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    dst.write(ndvi.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved NDVI to: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-7-combining-vector-and-raster-operations" class="level2">
<h2 class="anchored" data-anchor-id="part-7-combining-vector-and-raster-operations">Part 7: Combining Vector and Raster Operations</h2>
<p>Real-world EO workflows often require integrating vector and raster data. Let’s explore common operations.</p>
<section id="clipping-raster-to-vector-boundary" class="level3">
<h3 class="anchored" data-anchor-id="clipping-raster-to-vector-boundary">Clipping Raster to Vector Boundary</h3>
<p><strong>Use case:</strong> Extract satellite data only within your area of interest (e.g., a province, protected area, or farm boundary).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load AOI polygon (from earlier GeoPandas section)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_gdf = gpd.read_file('my_aoi.geojson')</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match - CRITICAL for accurate clipping!</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> aoi_gdf.crs <span class="op">!=</span> src.crs:</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Reprojecting AOI from </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        aoi_gdf <span class="op">=</span> aoi_gdf.to_crs(src.crs)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get geometries in proper format (list of shapely geometries)</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    shapes <span class="op">=</span> aoi_gdf.geometry.values</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip raster to vector boundary</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    out_image, out_transform <span class="op">=</span> mask(src, shapes, crop<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span>src.nodata)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Update metadata for clipped raster</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>out_meta.update({</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"driver"</span>: <span class="st">"GTiff"</span>,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"height"</span>: out_image.shape[<span class="dv">1</span>],</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"width"</span>: out_image.shape[<span class="dv">2</span>],</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"transform"</span>: out_transform</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original raster: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Clipped raster: </span><span class="sc">{</span>out_meta[<span class="st">'width'</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>out_meta[<span class="st">'height'</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size reduction: </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> (out_meta[<span class="st">'width'</span>]<span class="op">*</span>out_meta[<span class="st">'height'</span>])<span class="op">/</span>(src.width<span class="op">*</span>src.height))<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clipped area</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Original</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].imshow(src.read(<span class="dv">3</span>), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="st">"Original Raster (Full Extent)"</span>)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Clipped</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(out_image[<span class="dv">2</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)  <span class="co"># Band 3 (Red channel)</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Clipped to AOI"</span>)</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Save clipped raster:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/clipped_raster.tif'</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dest:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    dest.write(out_image)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved clipped raster to: </span><span class="sc">{</span>clipped_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File size reduced for faster processing and storage!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Clip Rasters
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Advantages:</strong> - <strong>Reduced file size:</strong> Smaller files load and process faster - <strong>Focused analysis:</strong> Only relevant area is analyzed - <strong>Lower memory use:</strong> Important for large Sentinel-2 tiles (100 km² at 10m = 100 million pixels!) - <strong>Easier visualization:</strong> Zoomed to area of interest</p>
<p><strong>Best practice:</strong> Clip rasters early in your workflow to avoid processing unnecessary pixels.</p>
</div>
</div>
</section>
<section id="sampling-raster-values-at-point-locations" class="level3">
<h3 class="anchored" data-anchor-id="sampling-raster-values-at-point-locations">Sampling Raster Values at Point Locations</h3>
<p><strong>Use case:</strong> Extract satellite data at field survey locations for validation or model training.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Field survey locations (GPS coordinates)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>survey_points <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'site_id'</span>: [<span class="st">'Site_A'</span>, <span class="st">'Site_B'</span>, <span class="st">'Site_C'</span>],</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'land_cover'</span>: [<span class="st">'Forest'</span>, <span class="st">'Cropland'</span>, <span class="st">'Urban'</span>],</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: gpd.points_from_xy(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">124.0</span>, <span class="fl">124.5</span>, <span class="fl">123.8</span>],  <span class="co"># Longitudes</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">10.0</span>, <span class="fl">10.3</span>, <span class="fl">9.8</span>]       <span class="co"># Latitudes</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>}, crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster at points</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject points if needed</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> survey_points.crs <span class="op">!=</span> src.crs:</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        survey_points <span class="op">=</span> survey_points.to_crs(src.crs)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coordinates as (x, y) tuples</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> [(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(survey_points.geometry.x, survey_points.geometry.y)]</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample all bands at each point</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    sampled_values <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> src.sample(coords)]</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sampled values to GeoDataFrame</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'blue'</span>] <span class="op">=</span> [v[<span class="dv">0</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'green'</span>] <span class="op">=</span> [v[<span class="dv">1</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'red'</span>] <span class="op">=</span> [v[<span class="dv">2</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'nir'</span>] <span class="op">=</span> [v[<span class="dv">3</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI at points</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'ndvi'</span>] <span class="op">=</span> (survey_points[<span class="st">'nir'</span>] <span class="op">-</span> survey_points[<span class="st">'red'</span>]) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                        (survey_points[<span class="st">'nir'</span>] <span class="op">+</span> survey_points[<span class="st">'red'</span>] <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DN to reflectance (Sentinel-2 scaling)</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> band <span class="kw">in</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>]:</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    survey_points[<span class="ss">f'</span><span class="sc">{</span>band<span class="sc">}</span><span class="ss">_refl'</span>] <span class="op">=</span> survey_points[band] <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sampled Values at Survey Points:"</span>)</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(survey_points[[<span class="st">'site_id'</span>, <span class="st">'land_cover'</span>, <span class="st">'ndvi'</span>]])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Export results for validation:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as CSV for Excel/analysis</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>survey_points.drop(<span class="st">'geometry'</span>, axis<span class="op">=</span><span class="dv">1</span>).to_csv(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.csv'</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="va">False</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as shapefile with geometry</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>survey_points.to_file(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.shp'</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Validation data exported!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="zonal-statistics" class="level3">
<h3 class="anchored" data-anchor-id="zonal-statistics">Zonal Statistics</h3>
<p><strong>Use case:</strong> Calculate average NDVI (or other metrics) for each administrative unit, farm, or land parcel.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Calculate mean NDVI per municipality</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Requires rasterstats library</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install rasterstats <span class="op">-</span>q</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load municipality boundaries</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>municipalities <span class="op">=</span> gpd.read_file(<span class="st">'municipalities.shp'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate zonal statistics</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    municipalities,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    ndvi,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>profile[<span class="st">'transform'</span>],</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>],</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add statistics to GeoDataFrame</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_mean'</span>] <span class="op">=</span> [s[<span class="st">'mean'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_std'</span>] <span class="op">=</span> [s[<span class="st">'std'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize municipalities by mean NDVI</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>municipalities.plot(</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'ndvi_mean'</span>,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlGn'</span>,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Mean NDVI by Municipality"</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(municipalities[[<span class="st">'NAME'</span>, <span class="st">'ndvi_mean'</span>, <span class="st">'ndvi_std'</span>]].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-8-preprocessing-workflows-for-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="part-8-preprocessing-workflows-for-machine-learning">Part 8: Preprocessing Workflows for Machine Learning</h2>
<p>Now let’s connect everything to prepare <strong>analysis-ready data for ML</strong> (Sessions 5-7).</p>
<section id="workflow-1-preparing-training-samples-for-classification" class="level3">
<h3 class="anchored" data-anchor-id="workflow-1-preparing-training-samples-for-classification">Workflow 1: Preparing Training Samples for Classification</h3>
<p><strong>Goal:</strong> Create a dataset of labeled pixels for land cover classification.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load training polygons (digitized by expert)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>training_polygons <span class="op">=</span> gpd.read_file(<span class="st">'training_areas.shp'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns: 'class_id', 'class_name', 'geometry'</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rasterize polygons to match satellite image grid</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create empty array</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    training_mask <span class="op">=</span> rasterize(</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>        [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_polygons.geometry, training_polygons[<span class="st">'class_id'</span>])],</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        out_shape<span class="op">=</span>(src.height, src.width),</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>src.transform,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="dv">0</span>,  <span class="co"># Background class</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract pixel values at training locations</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> src.read()  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to (n_pixels, n_bands)</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>n_bands, height, width <span class="op">=</span> bands.shape</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>pixels <span class="op">=</span> bands.reshape(n_bands, <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, n_bands)</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_mask.flatten()       <span class="co"># (n_pixels,)</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels only (exclude background class 0)</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>labeled_mask <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pixels[labeled_mask]  <span class="co"># Features</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_mask]  <span class="co"># Labels</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training samples: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> pixels"</span>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> bands"</span>)</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Normalize features (important for ML!)</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data ready for ML model training!"</span>)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Next steps: Split into train/val/test, train Random Forest or CNN"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="workflow-2-creating-multi-temporal-stack" class="level3">
<h3 class="anchored" data-anchor-id="workflow-2-creating-multi-temporal-stack">Workflow 2: Creating Multi-Temporal Stack</h3>
<p><strong>Goal:</strong> Combine images from different dates to capture phenology (crop growth cycles, seasonal changes).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of raster paths from different dates</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>date_paths <span class="op">=</span> [</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_01_15.tif'</span>,  <span class="co"># Dry season</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_04_15.tif'</span>,  <span class="co"># Transition</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_07_15.tif'</span>,  <span class="co"># Wet season</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_10_15.tif'</span>   <span class="co"># Harvest</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all dates and stack</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>stacked_bands <span class="op">=</span> []</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> []</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> date_paths:</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(path) <span class="im">as</span> src:</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        stacked_bands.append(src.read())  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        dates.append(path.split(<span class="st">'_'</span>)[<span class="dv">1</span>])  <span class="co"># Extract date from filename</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()  <span class="co"># Use last profile as template</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack along band dimension: (n_dates * n_bands, height, width)</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>multi_temporal <span class="op">=</span> np.concatenate(stacked_bands, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Multi-temporal stack shape: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total bands: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (4 dates × </span><span class="sc">{</span>stacked_bands[<span class="dv">0</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dates: </span><span class="sc">{</span>dates<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Save multi-temporal stack</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>profile.update(count<span class="op">=</span>multi_temporal.shape[<span class="dv">0</span>])</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'multi_temporal_stack.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    dst.write(multi_temporal)</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Multi-temporal stack created!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Why multi-temporal?</strong> - <strong>Better classification:</strong> Captures seasonal patterns (e.g., crops have distinct phenology) - <strong>Change detection:</strong> Compare dates to detect deforestation, urban growth, flooding - <strong>Improved accuracy:</strong> Machine learning models benefit from temporal features - <strong>PRiSM approach:</strong> Uses SAR time series to detect rice planting/harvesting</p>
</section>
<section id="workflow-3-resampling-and-reprojection" class="level3">
<h3 class="anchored" data-anchor-id="workflow-3-resampling-and-reprojection">Workflow 3: Resampling and Reprojection</h3>
<p><strong>Goal:</strong> Make rasters from different sensors compatible (same resolution, CRS, extent).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> reproject, Resampling</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Resample 20m Sentinel-2 bands to 10m</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_20m.tif'</span>) <span class="im">as</span> src:</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define target resolution</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    scale_factor <span class="op">=</span> <span class="dv">2</span>  <span class="co"># 20m → 10m</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate new dimensions</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    new_height <span class="op">=</span> src.height <span class="op">*</span> scale_factor</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    new_width <span class="op">=</span> src.width <span class="op">*</span> scale_factor</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update transform</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    new_transform <span class="op">=</span> src.transform <span class="op">*</span> src.transform.scale(</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        (src.width <span class="op">/</span> new_width),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        (src.height <span class="op">/</span> new_height)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create output array</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    upsampled <span class="op">=</span> np.empty((src.count, new_height, new_width), dtype<span class="op">=</span>src.dtypes[<span class="dv">0</span>])</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    reproject(</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>rasterio.band(src, <span class="dv">1</span>),</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">=</span>upsampled[<span class="dv">0</span>],</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        src_transform<span class="op">=</span>src.transform,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        src_crs<span class="op">=</span>src.crs,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        dst_transform<span class="op">=</span>new_transform,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        dst_crs<span class="op">=</span>src.crs,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        resampling<span class="op">=</span>Resampling.bilinear  <span class="co"># or cubic, nearest</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update profile</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    profile.update(</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>new_width,</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>new_height,</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>new_transform</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Save resampled raster</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_10m.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>    dst.write(upsampled)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Resampled from </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>new_height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>new_width<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Resampling methods:</strong> - <strong>Nearest:</strong> Fast, preserves values (good for classification maps) - <strong>Bilinear:</strong> Smooth, averages neighbors (good for continuous data) - <strong>Cubic:</strong> Smoothest, best for visualization (slower)</p>
</section>
<section id="workflow-4-data-augmentation-for-deep-learning" class="level3">
<h3 class="anchored" data-anchor-id="workflow-4-data-augmentation-for-deep-learning">Workflow 4: Data Augmentation for Deep Learning</h3>
<p><strong>Goal:</strong> Artificially increase training data diversity to prevent overfitting.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Augment image chips for CNN training</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> augment_chip(image, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply random augmentations to image chip.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">    image : ndarray (H, W, C)</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Image chip</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">    label : ndarray (H, W), optional</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Corresponding label mask</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">    augmented_image, augmented_label (if label provided)</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random rotation (0, 90, 180, 270 degrees)</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> np.rot90(image, k)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> np.rot90(label, k)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random flip (horizontal and/or vertical)</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.fliplr(image)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.fliplr(label)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.flipud(image)</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.flipud(label)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random brightness adjustment (simulate atmospheric variations)</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        factor <span class="op">=</span> np.random.uniform(<span class="fl">0.8</span>, <span class="fl">1.2</span>)</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.clip(image <span class="op">*</span> factor, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a><span class="co"># chip = rgb_chip  # (256, 256, 3)</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="co"># label_chip = land_cover_chip  # (256, 256)</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="co"># aug_chip, aug_label = augment_chip(chip, label_chip)</span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data augmentation functions ready!"</span>)</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Use during training to increase dataset size 4-8x without new data collection"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-9-best-practices-and-common-pitfalls" class="level2">
<h2 class="anchored" data-anchor-id="part-9-best-practices-and-common-pitfalls">Part 9: Best Practices and Common Pitfalls</h2>
<section id="memory-management-for-large-rasters" class="level3">
<h3 class="anchored" data-anchor-id="memory-management-for-large-rasters">Memory Management for Large Rasters</h3>
<p><strong>Problem:</strong> Sentinel-2 tiles are huge (100km² at 10m = 100 million pixels × 4 bands = 400 MB per tile).</p>
<p><strong>Solutions:</strong></p>
<p><strong>1. Windowed Reading:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process in chunks instead of loading entire raster</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(large_raster) <span class="im">as</span> src:</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window <span class="kw">in</span> src.block_windows():</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> src.read(window<span class="op">=</span>window)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process chunk</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> process_data(data)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Write chunk to output</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>2. Downsampling:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read at lower resolution for exploratory analysis</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read every 10th pixel</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> src.read(out_shape<span class="op">=</span>(src.count, src.height <span class="op">//</span> <span class="dv">10</span>, src.width <span class="op">//</span> <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>3. Cloud-Optimized GeoTIFF (COG):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to COG for efficient cloud access</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>gdal_translate <span class="bu">input</span>.tif output_cog.tif <span class="op">-</span>of COG <span class="op">-</span>co COMPRESS<span class="op">=</span>DEFLATE</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="vectorization-vs.-loops" class="level3">
<h3 class="anchored" data-anchor-id="vectorization-vs.-loops">Vectorization vs.&nbsp;Loops</h3>
<p><strong>Slow (loop over pixels):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DON'T DO THIS</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(height):</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(width):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        ndvi[i, j] <span class="op">=</span> (nir[i, j] <span class="op">-</span> red[i, j]) <span class="op">/</span> (nir[i, j] <span class="op">+</span> red[i, j])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fast (vectorized with NumPy):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DO THIS</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)  <span class="co"># Single operation on entire array</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Why?</strong> NumPy operations are implemented in C and optimized for array operations. Can be <strong>100-1000x faster</strong> than Python loops!</p>
</section>
<section id="error-handling-for-geospatial-operations" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-for-geospatial-operations">Error Handling for Geospatial Operations</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress common warnings that are usually harmless</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">RuntimeWarning</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe division with error handling</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_divide(numerator, denominator):</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely divide arrays, handling division by zero."""</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">'ignore'</span>, invalid<span class="op">=</span><span class="st">'ignore'</span>):</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        result[<span class="op">~</span>np.isfinite(result)] <span class="op">=</span> np.nan  <span class="co"># Replace inf/nan with nan</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe CRS transformation</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_reproject(gdf, target_crs):</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely reproject GeoDataFrame with error handling."""</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf.to_crs(target_crs)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: Reprojection failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Returning original GeoDataFrame"</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="troubleshooting-common-issues" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting-common-issues">Troubleshooting Common Issues</h3>
<p><strong>Issue 1: CRS Mismatch</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: "CRS mismatch" error when overlaying vector and raster</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Check and align CRS</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    raster_crs <span class="op">=</span> src.crs</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gdf.crs <span class="op">!=</span> raster_crs:</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Reprojecting vector from </span><span class="sc">{</span>gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>raster_crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gdf.to_crs(raster_crs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Issue 2: NoData Handling</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: Nodata values (0, -9999) skew statistics</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Mask nodata before calculations</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create masked array</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>raster_masked <span class="op">=</span> ma.masked_equal(raster, nodata_value)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics now ignore nodata</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> raster_masked.mean()</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> raster_masked.std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Issue 3: Memory Error</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: MemoryError when loading large raster</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 1: Use windowed reading (shown above)</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 2: Work with lower resolution</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 3: Use Dask for out-of-core computation</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open with rioxarray (uses Dask for lazy loading)</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>raster_da <span class="op">=</span> rioxarray.open_rasterio(raster_path, chunks<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (raster_da[<span class="dv">3</span>] <span class="op">-</span> raster_da[<span class="dv">2</span>]) <span class="op">/</span> (raster_da[<span class="dv">3</span>] <span class="op">+</span> raster_da[<span class="dv">2</span>])</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Computation happens only when .compute() is called</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="code-organization-for-reproducibility" class="level3">
<h3 class="anchored" data-anchor-id="code-organization-for-reproducibility">Code Organization for Reproducibility</h3>
<p><strong>Good practices:</strong></p>
<ol type="1">
<li><strong>Clear imports at top:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard library</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Third party</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Project-specific</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> safe_divide, calculate_ndvi</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li><strong>Define paths clearly:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define all paths at the beginning</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data'</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>RASTER_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'raster'</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>VECTOR_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'vector'</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs'</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li><strong>Use functions:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_sentinel2(raster_path, aoi_gdf<span class="op">=</span><span class="va">None</span>, scale_factor<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Load and preprocess Sentinel-2 imagery.</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">    raster_path : str</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to Sentinel-2 GeoTIFF</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">    aoi_gdf : GeoDataFrame, optional</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Area of interest for clipping</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">    scale_factor : int</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Scaling factor for reflectance conversion</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : dict</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary of band arrays</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="co">    profile : dict</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Raster metadata</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> aoi_gdf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clip to AOI</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>            bands_array, transform <span class="op">=</span> mask(src, aoi_gdf.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>            bands_array <span class="op">=</span> src.read()</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>            transform <span class="op">=</span> src.transform</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>        profile.update(transform<span class="op">=</span>transform)</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to reflectance</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> {</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'blue'</span>: bands_array[<span class="dv">0</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'green'</span>: bands_array[<span class="dv">1</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'red'</span>: bands_array[<span class="dv">2</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nir'</span>: bands_array[<span class="dv">3</span>] <span class="op">/</span> scale_factor</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bands, profile</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>bands, profile <span class="op">=</span> preprocess_sentinel2(raster_path, aoi_gdf)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calculate_ndvi(bands[<span class="st">'nir'</span>], bands[<span class="st">'red'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-10-complete-workflow-example" class="level2">
<h2 class="anchored" data-anchor-id="part-10-complete-workflow-example">Part 10: Complete Workflow Example</h2>
<p>Let’s put everything together in a realistic scenario.</p>
<section id="scenario-agricultural-monitoring-for-palawan-rice-area" class="level3">
<h3 class="anchored" data-anchor-id="scenario-agricultural-monitoring-for-palawan-rice-area">Scenario: Agricultural Monitoring for Palawan Rice Area</h3>
<p><strong>Goal:</strong> Map rice cultivation areas in Palawan using Sentinel-2 and prepare training data for ML classification.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. SETUP</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define paths</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>palawan_boundary <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/palawan_province.shp'</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>sentinel2_tile <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/raster/sentinel2_palawan_20240615.tif'</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>training_areas <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/rice_training_polygons.shp'</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs/palawan_rice_analysis'</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>output_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 1: Setup complete ✓"</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. LOAD AND INSPECT DATA</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Palawan boundary</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>palawan <span class="op">=</span> gpd.read_file(palawan_boundary)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded Palawan boundary: </span><span class="sc">{</span>palawan<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Load training areas</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>training <span class="op">=</span> gpd.read_file(training_areas)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded training areas: </span><span class="sc">{</span><span class="bu">len</span>(training)<span class="sc">}</span><span class="ss"> polygons"</span>)</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>training[<span class="st">'class_name'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect Sentinel-2 metadata</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sentinel-2 metadata:"</span>)</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">m"</span>)</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 2: Data loaded ✓"</span>)</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. CLIP RASTER TO PALAWAN</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palawan.crs <span class="op">!=</span> src.crs:</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>        palawan <span class="op">=</span> palawan.to_crs(src.crs)</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip to Palawan boundary</span></span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>    clipped, transform <span class="op">=</span> mask(src, palawan.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update metadata</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a>    out_meta.update({</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">"height"</span>: clipped.shape[<span class="dv">1</span>],</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"width"</span>: clipped.shape[<span class="dv">2</span>],</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transform"</span>: transform</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Save clipped raster</span></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_sentinel2_clipped.tif'</span></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dst:</span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>    dst.write(clipped)</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Step 3: Clipped raster to Palawan ✓"</span>)</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size: </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. CALCULATE SPECTRAL INDICES</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bands</span></span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>blue <span class="op">=</span> clipped[<span class="dv">0</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> clipped[<span class="dv">1</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> clipped[<span class="dv">2</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span> clipped[<span class="dv">3</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate indices</span></span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndvi(nir, red):</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_evi(nir, red, blue):</span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndwi(green, nir):</span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calc_ndvi(nir, red)</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> calc_evi(nir, red, blue)</span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> calc_ndwi(green, nir)</span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 4: Calculated spectral indices ✓"</span>)</span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Save indices</span></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> [(<span class="st">'ndvi'</span>, ndvi), (<span class="st">'evi'</span>, evi), (<span class="st">'ndwi'</span>, ndwi)]:</span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a>    index_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a>    index_meta.update(dtype<span class="op">=</span>rasterio.float32, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>    index_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="ss">f'palawan_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.tif'</span></span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(index_path, <span class="st">'w'</span>, <span class="op">**</span>index_meta) <span class="im">as</span> dst:</span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>        dst.write(data.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. IDENTIFY POTENTIAL RICE AREAS</span></span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice detection criteria (during growing season):</span></span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a><span class="co"># - Moderate to high NDVI (0.4-0.8) - active vegetation</span></span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a><span class="co"># - Slightly negative NDWI (-0.2 to 0.1) - moist soil but not flooded</span></span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a><span class="co"># - EVI in moderate range (0.3-0.6)</span></span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (</span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a>    (ndvi <span class="op">&gt;</span> <span class="fl">0.4</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.8</span>) <span class="op">&amp;</span></span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a>    (ndwi <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.2</span>) <span class="op">&amp;</span> (ndwi <span class="op">&lt;</span> <span class="fl">0.1</span>) <span class="op">&amp;</span></span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a>    (evi <span class="op">&gt;</span> <span class="fl">0.3</span>) <span class="op">&amp;</span> (evi <span class="op">&lt;</span> <span class="fl">0.6</span>)</span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area</span></span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 5: Rice area detection ✓"</span>)</span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of Palawan: </span><span class="sc">{</span>(rice_pixels <span class="op">/</span> rice_mask.size) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Save rice mask</span></span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a>rice_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a>rice_meta.update(dtype<span class="op">=</span><span class="st">'uint8'</span>, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a>rice_mask_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_rice_mask.tif'</span></span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(rice_mask_path, <span class="st">'w'</span>, <span class="op">**</span>rice_meta) <span class="im">as</span> dst:</span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a>    dst.write(rice_mask.astype(<span class="st">'uint8'</span>), <span class="dv">1</span>)</span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. VISUALIZE RESULTS</span></span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a><span class="co"># True color composite</span></span>
<span id="cb66-148"><a href="#cb66-148" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb66-149"><a href="#cb66-149" aria-hidden="true" tabindex="-1"></a>rgb_clip <span class="op">=</span> np.clip(rgb, <span class="dv">0</span>, <span class="fl">0.3</span>) <span class="op">/</span> <span class="fl">0.3</span></span>
<span id="cb66-150"><a href="#cb66-150" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].imshow(rgb_clip)</span>
<span id="cb66-151"><a href="#cb66-151" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"True Color Composite"</span>)</span>
<span id="cb66-152"><a href="#cb66-152" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-153"><a href="#cb66-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-154"><a href="#cb66-154" aria-hidden="true" tabindex="-1"></a><span class="co"># NDVI</span></span>
<span id="cb66-155"><a href="#cb66-155" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>].imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-156"><a href="#cb66-156" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"NDVI"</span>)</span>
<span id="cb66-157"><a href="#cb66-157" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-158"><a href="#cb66-158" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im1, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-159"><a href="#cb66-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-160"><a href="#cb66-160" aria-hidden="true" tabindex="-1"></a><span class="co"># EVI</span></span>
<span id="cb66-161"><a href="#cb66-161" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">2</span>].imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-162"><a href="#cb66-162" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">"EVI"</span>)</span>
<span id="cb66-163"><a href="#cb66-163" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-164"><a href="#cb66-164" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im2, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-165"><a href="#cb66-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-166"><a href="#cb66-166" aria-hidden="true" tabindex="-1"></a><span class="co"># NDWI</span></span>
<span id="cb66-167"><a href="#cb66-167" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>].imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-168"><a href="#cb66-168" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"NDWI"</span>)</span>
<span id="cb66-169"><a href="#cb66-169" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-170"><a href="#cb66-170" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im3, ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-171"><a href="#cb66-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-172"><a href="#cb66-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask</span></span>
<span id="cb66-173"><a href="#cb66-173" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb66-174"><a href="#cb66-174" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="ss">f"Potential Rice Areas</span><span class="ch">\n</span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb66-175"><a href="#cb66-175" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-176"><a href="#cb66-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-177"><a href="#cb66-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask over true color</span></span>
<span id="cb66-178"><a href="#cb66-178" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rgb_clip)</span>
<span id="cb66-179"><a href="#cb66-179" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb66-180"><a href="#cb66-180" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">"Rice Areas (overlay)"</span>)</span>
<span id="cb66-181"><a href="#cb66-181" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-182"><a href="#cb66-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-183"><a href="#cb66-183" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Palawan Rice Monitoring Analysis"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb66-184"><a href="#cb66-184" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb66-185"><a href="#cb66-185" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_dir <span class="op">/</span> <span class="st">'palawan_analysis_results.png'</span>, dpi<span class="op">=</span><span class="dv">150</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb66-186"><a href="#cb66-186" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb66-187"><a href="#cb66-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-188"><a href="#cb66-188" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-189"><a href="#cb66-189" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. PREPARE ML TRAINING DATA</span></span>
<span id="cb66-190"><a href="#cb66-190" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-191"><a href="#cb66-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-192"><a href="#cb66-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Rasterize training polygons</span></span>
<span id="cb66-193"><a href="#cb66-193" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb66-194"><a href="#cb66-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-195"><a href="#cb66-195" aria-hidden="true" tabindex="-1"></a>training_reprojected <span class="op">=</span> training.to_crs(out_meta[<span class="st">'crs'</span>])</span>
<span id="cb66-196"><a href="#cb66-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-197"><a href="#cb66-197" aria-hidden="true" tabindex="-1"></a>training_raster <span class="op">=</span> rasterize(</span>
<span id="cb66-198"><a href="#cb66-198" aria-hidden="true" tabindex="-1"></a>    [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_reprojected.geometry, training_reprojected[<span class="st">'class_id'</span>])],</span>
<span id="cb66-199"><a href="#cb66-199" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>(out_meta[<span class="st">'height'</span>], out_meta[<span class="st">'width'</span>]),</span>
<span id="cb66-200"><a href="#cb66-200" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>out_meta[<span class="st">'transform'</span>],</span>
<span id="cb66-201"><a href="#cb66-201" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb66-202"><a href="#cb66-202" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb66-203"><a href="#cb66-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-204"><a href="#cb66-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-205"><a href="#cb66-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features and labels</span></span>
<span id="cb66-206"><a href="#cb66-206" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> np.stack([blue, green, red, nir, ndvi, evi, ndwi], axis<span class="op">=</span><span class="dv">0</span>)  <span class="co"># (7, H, W)</span></span>
<span id="cb66-207"><a href="#cb66-207" aria-hidden="true" tabindex="-1"></a>features_2d <span class="op">=</span> features.reshape(features.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, 7)</span></span>
<span id="cb66-208"><a href="#cb66-208" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_raster.flatten()</span>
<span id="cb66-209"><a href="#cb66-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-210"><a href="#cb66-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels</span></span>
<span id="cb66-211"><a href="#cb66-211" aria-hidden="true" tabindex="-1"></a>labeled_idx <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb66-212"><a href="#cb66-212" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> features_2d[labeled_idx]</span>
<span id="cb66-213"><a href="#cb66-213" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_idx]</span>
<span id="cb66-214"><a href="#cb66-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-215"><a href="#cb66-215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 7: ML training data prepared ✓"</span>)</span>
<span id="cb66-216"><a href="#cb66-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features shape: </span><span class="sc">{</span>X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-217"><a href="#cb66-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Labels shape: </span><span class="sc">{</span>y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-218"><a href="#cb66-218" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Feature names: blue, green, red, nir, ndvi, evi, ndwi"</span>)</span>
<span id="cb66-219"><a href="#cb66-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-220"><a href="#cb66-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-221"><a href="#cb66-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Save training data</span></span>
<span id="cb66-222"><a href="#cb66-222" aria-hidden="true" tabindex="-1"></a>np.savez(</span>
<span id="cb66-223"><a href="#cb66-223" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">/</span> <span class="st">'training_data.npz'</span>,</span>
<span id="cb66-224"><a href="#cb66-224" aria-hidden="true" tabindex="-1"></a>    features<span class="op">=</span>X,</span>
<span id="cb66-225"><a href="#cb66-225" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>y,</span>
<span id="cb66-226"><a href="#cb66-226" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>, <span class="st">'ndvi'</span>, <span class="st">'evi'</span>, <span class="st">'ndwi'</span>]</span>
<span id="cb66-227"><a href="#cb66-227" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-228"><a href="#cb66-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-229"><a href="#cb66-229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb66-230"><a href="#cb66-230" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ANALYSIS COMPLETE!"</span>)</span>
<span id="cb66-231"><a href="#cb66-231" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb66-232"><a href="#cb66-232" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Outputs saved to: </span><span class="sc">{</span>output_dir<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-233"><a href="#cb66-233" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Files created:"</span>)</span>
<span id="cb66-234"><a href="#cb66-234" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_sentinel2_clipped.tif"</span>)</span>
<span id="cb66-235"><a href="#cb66-235" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_ndvi.tif, palawan_evi.tif, palawan_ndwi.tif"</span>)</span>
<span id="cb66-236"><a href="#cb66-236" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_rice_mask.tif"</span>)</span>
<span id="cb66-237"><a href="#cb66-237" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_analysis_results.png"</span>)</span>
<span id="cb66-238"><a href="#cb66-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - training_data.npz (ready for ML in Sessions 5-7!)"</span>)</span>
<span id="cb66-239"><a href="#cb66-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Next: Use training_data.npz to train Random Forest or CNN classifier"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What we accomplished:</strong></p>
<ol type="1">
<li>✓ Loaded vector and raster data</li>
<li>✓ Clipped raster to area of interest</li>
<li>✓ Calculated multiple spectral indices</li>
<li>✓ Applied rule-based classification (rice detection)</li>
<li>✓ Created publication-quality visualizations</li>
<li>✓ Prepared training data for machine learning</li>
<li>✓ Saved all outputs for future use</li>
</ol>
<p>This workflow demonstrates a complete EO analysis pipeline from raw data to ML-ready datasets!</p>
<hr>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Session 3 Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Google Colab:</strong> - Cloud-based Python environment, no installation needed - Mount Google Drive for data persistence: <code>drive.mount('/content/drive')</code> - Install geospatial libraries: <code>!pip install geopandas rasterio</code> - Free GPU access for ML (Sessions 5-7)</p>
<p><strong>GeoPandas (Vector Data):</strong> - Read shapefiles/GeoJSON: <code>gpd.read_file(path)</code> - Filter by attributes: <code>gdf[gdf['column'] == value]</code> - Visualize: <code>gdf.plot(column='field', cmap='Set3')</code> - CRS operations: <code>gdf.crs</code>, <code>gdf.to_crs('EPSG:32651')</code> - <strong>Philippine CRS:</strong> UTM Zone 51N (EPSG:32651) for western Philippines, UTM Zone 52N (EPSG:32652) for eastern Philippines</p>
<p><strong>Rasterio (Raster Data):</strong> - Open rasters: <code>with rasterio.open(path) as src:</code> - Read bands: <code>src.read(band_number)</code> (1-indexed!) - Arrays are NumPy: all array operations work (vectorized!) - Calculate indices: <code>ndvi = (nir - red) / (nir + red + 1e-10)</code> - <strong>Sentinel-2:</strong> 13 bands at 10m/20m/60m, values 0-10000 (divide by 10000 for reflectance)</p>
<p><strong>Combining Vector + Raster:</strong> - Clip rasters: <code>rasterio.mask.mask(src, shapes, crop=True)</code> - Sample at points: <code>src.sample(coordinates)</code> - Zonal statistics: <code>rasterstats.zonal_stats(polygons, raster)</code> - <strong>Always match CRS</strong> before spatial operations!</p>
<p><strong>Preprocessing for ML:</strong> - Normalize: <code>StandardScaler().fit_transform(features)</code> - Augment: Rotation, flipping, brightness adjustment - Multi-temporal: Stack dates for phenology - Resample: Match resolutions from different sensors</p>
<p><strong>Python for EO Advantage:</strong> - Powers operational systems (DATOS, PRiSM, SkAI-Pinas) - Seamless workflow: data access → preprocessing → ML → visualization - Rich ecosystem: GeoPandas, Rasterio, Scikit-learn, TensorFlow - <strong>You now have the foundation to build your own EO applications!</strong></p>
<p><strong>Next:</strong> Session 4 will leverage Google Earth Engine to access petabytes of Sentinel data without downloading!</p>
</div>
</div>
<hr>
</section>
<section id="practice-exercises" class="level2">
<h2 class="anchored" data-anchor-id="practice-exercises">Practice Exercises</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Try These Challenges
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercise 1: Load Your Own Boundary</strong></p>
<p>Download a shapefile of your province or municipality from NAMRIA Geoportal or PhilGIS. Load it with GeoPandas, reproject to UTM 51N, calculate the area in km², and create a 5 km buffer zone.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>my_boundary <span class="op">=</span> gpd.read_file(<span class="st">'my_province.shp'</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Exercise 2: Calculate Multiple Indices</strong></p>
<p>Using the provided Sentinel-2 tile, calculate NDVI, EVI, NDWI, and SAVI. Create a 2×2 subplot visualization comparing all indices.</p>
<p><strong>Exercise 3: Multi-temporal NDVI Change</strong></p>
<p>If you have two Sentinel-2 images (dry season, wet season), calculate NDVI for both and create a change map showing NDVI difference. Interpret areas of gain (positive change) vs.&nbsp;loss (negative change).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint:</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ndvi_change <span class="op">=</span> ndvi_wet <span class="op">-</span> ndvi_dry</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi_change, cmap<span class="op">=</span><span class="st">'RdBu'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Exercise 4: Training Sample Creation</strong></p>
<p>Create a small training dataset by: 1. Digitizing 3-5 polygons for each land cover class (use <code>gdf = gpd.GeoDataFrame()</code> manually) 2. Rasterizing the polygons to match Sentinel-2 grid 3. Extracting spectral values at labeled pixels 4. Saving as <code>training_samples.csv</code> for ML</p>
<p><strong>Exercise 5: Coastal Water Body Detection</strong></p>
<p>For a coastal area, use NDWI to detect water bodies. Apply a threshold (e.g., NDWI &gt; 0.3), vectorize the result using <code>rasterio.features.shapes()</code>, and save as a shapefile.</p>
<p><strong>Bonus: Build Your Own Function Library</strong></p>
<p>Create a Python module <code>eo_utils.py</code> with reusable functions: - <code>calculate_indices(bands_dict)</code> → returns dict of indices - <code>clip_raster_to_aoi(raster_path, aoi_gdf)</code> → returns clipped array - <code>visualize_results(rgb, ndvi, mask)</code> → creates 3-panel figure - <code>prepare_ml_data(raster_path, training_gdf)</code> → returns X, y arrays</p>
<p>Save to your Drive and import in future notebooks!</p>
</div>
</div>
<hr>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further Reading</h2>
<section id="geopandas" class="level3">
<h3 class="anchored" data-anchor-id="geopandas">GeoPandas</h3>
<ul>
<li><a href="https://geopandas.org/">Official Documentation</a></li>
<li><a href="https://www.datacamp.com/tutorial/geopandas-tutorial-geospatial-analysis">GeoPandas Tutorial (DataCamp)</a></li>
<li><a href="https://geopandas.org/en/stable/gallery/index.html">GeoPandas Examples Gallery</a></li>
<li><a href="https://geopandas.org/en/stable/docs/user_guide/projections.html">Working with Projections</a></li>
</ul>
</section>
<section id="rasterio" class="level3">
<h3 class="anchored" data-anchor-id="rasterio">Rasterio</h3>
<ul>
<li><a href="https://rasterio.readthedocs.io/">Official Documentation</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/quickstart.html">Rasterio Quickstart</a></li>
<li><a href="https://geoscripting-wur.github.io/PythonRaster/">Python Raster Tutorial (WUR)</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/topics/windowed-rw.html">Windowed Reading and Writing</a></li>
</ul>
</section>
<section id="combined-workflows" class="level3">
<h3 class="anchored" data-anchor-id="combined-workflows">Combined Workflows</h3>
<ul>
<li><a href="https://carpentries-incubator.github.io/geospatial-python/">Carpentries Geospatial Python</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/topics/masking-by-shapefile.html">Cropping Rasters with Vector Boundaries</a></li>
<li><a href="https://www.oreilly.com/library/view/python-for-geospatial/9781098104788/">Python for Geospatial Analysis (O’Reilly)</a></li>
</ul>
</section>
<section id="philippine-context" class="level3">
<h3 class="anchored" data-anchor-id="philippine-context">Philippine Context</h3>
<ul>
<li><a href="https://www.namria.gov.ph/">NAMRIA Geoportal</a></li>
<li><a href="https://philgis.org/">PhilGIS Resources</a></li>
<li><a href="https://datos.dost.gov.ph/">DATOS User Guide</a> (if publicly available)</li>
<li><a href="https://prism.philrice.gov.ph/">PRiSM Technical Documentation</a></li>
</ul>
</section>
<section id="advanced-topics" class="level3">
<h3 class="anchored" data-anchor-id="advanced-topics">Advanced Topics</h3>
<ul>
<li><a href="https://docs.xarray.dev/">Xarray for Multi-dimensional Arrays</a></li>
<li><a href="https://docs.dask.org/">Dask for Parallel Computing</a></li>
<li><a href="https://www.cogeo.org/">Cloud-Optimized GeoTIFF Guide</a></li>
<li><a href="https://torchgeo.readthedocs.io/">TorchGeo for Deep Learning</a></li>
</ul>
<hr>
</section>
</section>
<section id="jupyter-notebook" class="level2">
<h2 class="anchored" data-anchor-id="jupyter-notebook">Jupyter Notebook</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Access the Interactive Notebook
</div>
</div>
<div class="callout-body-container callout-body">
<p>A complete Jupyter notebook with all code examples from this session is available:</p>
<p><strong><a href="../../day1/notebooks/notebook1.html">Open Notebook 1: Python Geospatial Data →</a></strong></p>
<p>This notebook includes: - All code examples ready to run in Google Colab - Additional exercises with progressive difficulty - Sample datasets (downloadable links) - Detailed comments and explanations - Solutions to practice exercises (hidden cells) - Links to relevant documentation</p>
<p><strong>To use the notebook:</strong> 1. Click the link above 2. Click “Open in Colab” button 3. Save a copy to your Drive: File → Save a copy in Drive 4. Mount your Drive and start coding!</p>
</div>
</div>
<hr>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/DimitrisKasabalis\.github\.io\/cophil-training-v1\.0");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="cophil-training-v1.0" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../day1/sessions/session2.html" class="pagination-link" aria-label="Session 2: Core Concepts of AI/ML for Earth Observation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Session 2: Core Concepts of AI/ML for Earth Observation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../day1/sessions/session4.html" class="pagination-link" aria-label="Session 4: Introduction to Google Earth Engine">
        <span class="nav-page-text">Session 4: Introduction to Google Earth Engine</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Session 3: Hands-on Python for Geospatial Data"</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Master vector and raster data processing with GeoPandas and Rasterio"</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">nav</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb"</span><span class="ot"> aria-label</span><span class="op">=</span><span class="st">"Breadcrumb"</span><span class="dt">&gt;</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"../../index.html"</span><span class="dt">&gt;</span>Home<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-separator"</span><span class="ot"> aria-hidden</span><span class="op">=</span><span class="st">"true"</span><span class="dt">&gt;</span>›<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"../index.html"</span><span class="dt">&gt;</span>Day 1<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-separator"</span><span class="ot"> aria-hidden</span><span class="op">=</span><span class="st">"true"</span><span class="dt">&gt;</span>›<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"breadcrumb-current"</span><span class="dt">&gt;</span>Session 3<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">nav</span><span class="dt">&gt;</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>::: {.session-info}</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>**Duration:** 2 hours | **Format:** Hands-on Coding | **Platform:** Google Colaboratory</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Overview</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>This hands-on session teaches you how to work with geospatial data in Python - the foundation of Earth Observation workflows. Python has become the dominant language for EO and ML applications due to its rich ecosystem of libraries, active community, and seamless integration with operational systems. You'll use Google Colab (no installation needed!), learn vector data operations with GeoPandas, and master raster processing with Rasterio. By the end, you'll understand why Python powers Philippine EO platforms like DATOS, SkAI-Pinas, and PRiSM, and you'll be able to prepare satellite data for AI/ML workflows.</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>::: {.learning-objectives}</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning Objectives</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>By the end of this session, you will be able to:</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Explain** why Python is the dominant language for EO and ML applications</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Set up** Google Colaboratory for geospatial analysis</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mount** Google Drive for data access and storage</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Install** Python geospatial libraries (GeoPandas, Rasterio)</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Read and inspect** vector data (shapefiles, GeoJSON) with GeoPandas</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Transform** coordinate reference systems for Philippine UTM zones</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Query and filter** geospatial DataFrames spatially and by attributes</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Visualize** vector data with static and interactive maps</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Open and examine** raster files and their metadata with Rasterio</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Read** raster bands into NumPy arrays efficiently</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Calculate** spectral indices (NDVI, EVI, NDWI) from Sentinel-2 bands</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Create** RGB and false-color composites from multispectral imagery</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Clip** rasters to vector boundaries for area-of-interest analysis</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sample** raster values at point locations for validation</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Apply** preprocessing workflows for ML-ready data</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Combine** vector and raster operations for complete EO workflows</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Presentation Slides</span></span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"../presentations/03_session3_python_geospatial.html"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"100%"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"600"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"border: 1px solid #ccc; border-radius: 4px;"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1: Why Python for Earth Observation?</span></span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Python EO Ecosystem</span></span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>Python has become the **de facto standard** for Earth Observation and Machine Learning. Understanding why helps you leverage the right tools for your projects.</span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Key Advantages</span></span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>%%| fig-cap: <span class="ot">"</span><span class="st">Python Earth Observation Ecosystem</span><span class="ot">"</span></span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>%%| fig-width: <span class="dv">100</span>%</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>graph TB</span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>    subgraph DataAccess[<span class="ot">"</span><span class="st">DATA ACCESS</span><span class="ot">"</span>]</span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>        DA1[Earth Engine&lt;br/&gt;Python API]</span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>        DA2[Sentinel Hub&lt;br/&gt;sentinelhub-py]</span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>        DA3[NASA CMR&lt;br/&gt;earthaccess]</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>        DA4[STAC&lt;br/&gt;pystac-client]</span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-82"><a href="#cb69-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-83"><a href="#cb69-83" aria-hidden="true" tabindex="-1"></a>    subgraph Geospatial[<span class="ot">"</span><span class="st">GEOSPATIAL PROCESSING</span><span class="ot">"</span>]</span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a>        GP1[GeoPandas&lt;br/&gt;Vector data]</span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a>        GP2[Rasterio&lt;br/&gt;Raster I/O]</span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a>        GP3[Xarray&lt;br/&gt;N-D arrays]</span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a>        GP4[Rioxarray&lt;br/&gt;Raster+Xarray]</span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a>        GP5[GDAL/OGR&lt;br/&gt;Low-level ops]</span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a>    subgraph DataScience[<span class="ot">"</span><span class="st">DATA SCIENCE</span><span class="ot">"</span>]</span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a>        DS1[NumPy&lt;br/&gt;Array operations]</span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a>        DS2[Pandas&lt;br/&gt;Tabular data]</span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a>        DS3[SciPy&lt;br/&gt;Scientific computing]</span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a>        DS4[Dask&lt;br/&gt;Parallel computing]</span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a>    subgraph ML[<span class="ot">"</span><span class="st">MACHINE LEARNING</span><span class="ot">"</span>]</span>
<span id="cb69-99"><a href="#cb69-99" aria-hidden="true" tabindex="-1"></a>        ML1[Scikit-learn&lt;br/&gt;Traditional ML]</span>
<span id="cb69-100"><a href="#cb69-100" aria-hidden="true" tabindex="-1"></a>        ML2[TensorFlow&lt;br/&gt;Deep Learning]</span>
<span id="cb69-101"><a href="#cb69-101" aria-hidden="true" tabindex="-1"></a>        ML3[PyTorch&lt;br/&gt;Deep Learning]</span>
<span id="cb69-102"><a href="#cb69-102" aria-hidden="true" tabindex="-1"></a>        ML4[TorchGeo&lt;br/&gt;Geospatial DL]</span>
<span id="cb69-103"><a href="#cb69-103" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-104"><a href="#cb69-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-105"><a href="#cb69-105" aria-hidden="true" tabindex="-1"></a>    subgraph Viz[<span class="ot">"</span><span class="st">VISUALIZATION</span><span class="ot">"</span>]</span>
<span id="cb69-106"><a href="#cb69-106" aria-hidden="true" tabindex="-1"></a>        VZ1[Matplotlib&lt;br/&gt;Static plots]</span>
<span id="cb69-107"><a href="#cb69-107" aria-hidden="true" tabindex="-1"></a>        VZ2[Folium&lt;br/&gt;Interactive maps]</span>
<span id="cb69-108"><a href="#cb69-108" aria-hidden="true" tabindex="-1"></a>        VZ3[Plotly&lt;br/&gt;Interactive viz]</span>
<span id="cb69-109"><a href="#cb69-109" aria-hidden="true" tabindex="-1"></a>        VZ4[Cartopy&lt;br/&gt;Map projections]</span>
<span id="cb69-110"><a href="#cb69-110" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-111"><a href="#cb69-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-112"><a href="#cb69-112" aria-hidden="true" tabindex="-1"></a>    DataAccess --&gt; Geospatial</span>
<span id="cb69-113"><a href="#cb69-113" aria-hidden="true" tabindex="-1"></a>    Geospatial --&gt; DataScience</span>
<span id="cb69-114"><a href="#cb69-114" aria-hidden="true" tabindex="-1"></a>    DataScience --&gt; ML</span>
<span id="cb69-115"><a href="#cb69-115" aria-hidden="true" tabindex="-1"></a>    Geospatial --&gt; Viz</span>
<span id="cb69-116"><a href="#cb69-116" aria-hidden="true" tabindex="-1"></a>    ML --&gt; Viz</span>
<span id="cb69-117"><a href="#cb69-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-118"><a href="#cb69-118" aria-hidden="true" tabindex="-1"></a>    style DataAccess fill:<span class="co">#e6f3ff,stroke:#0066cc,stroke-width:2px</span></span>
<span id="cb69-119"><a href="#cb69-119" aria-hidden="true" tabindex="-1"></a>    style Geospatial fill:<span class="co">#e6ffe6,stroke:#00aa44,stroke-width:2px</span></span>
<span id="cb69-120"><a href="#cb69-120" aria-hidden="true" tabindex="-1"></a>    style DataScience fill:<span class="co">#fff4e6,stroke:#ff8800,stroke-width:2px</span></span>
<span id="cb69-121"><a href="#cb69-121" aria-hidden="true" tabindex="-1"></a>    style ML fill:<span class="co">#ffe6e6,stroke:#cc0044,stroke-width:2px</span></span>
<span id="cb69-122"><a href="#cb69-122" aria-hidden="true" tabindex="-1"></a>    style Viz fill:<span class="co">#f0e6ff,stroke:#6666cc,stroke-width:2px</span></span>
<span id="cb69-123"><a href="#cb69-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-124"><a href="#cb69-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-125"><a href="#cb69-125" aria-hidden="true" tabindex="-1"></a>**1. Rich Library Ecosystem**</span>
<span id="cb69-126"><a href="#cb69-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Geospatial Processing:** GeoPandas, Rasterio, Xarray, Rioxarray, GDAL bindings</span>
<span id="cb69-127"><a href="#cb69-127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data Science:** NumPy, Pandas, SciPy for array operations and analysis</span>
<span id="cb69-128"><a href="#cb69-128" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Machine Learning:** Scikit-learn, TensorFlow, PyTorch, TorchGeo</span>
<span id="cb69-129"><a href="#cb69-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Visualization:** Matplotlib, Seaborn, Folium, Plotly for static and interactive maps</span>
<span id="cb69-130"><a href="#cb69-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-131"><a href="#cb69-131" aria-hidden="true" tabindex="-1"></a>**2. Seamless Integration**</span>
<span id="cb69-132"><a href="#cb69-132" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cloud Platforms:** Google Earth Engine Python API, AWS, Azure</span>
<span id="cb69-133"><a href="#cb69-133" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Big Data:** Dask for parallel/distributed computing on large rasters</span>
<span id="cb69-134"><a href="#cb69-134" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Workflows:** Easy integration between data access → preprocessing → ML → visualization</span>
<span id="cb69-135"><a href="#cb69-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-136"><a href="#cb69-136" aria-hidden="true" tabindex="-1"></a>**3. Active Community**</span>
<span id="cb69-137"><a href="#cb69-137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extensive documentation and tutorials</span>
<span id="cb69-138"><a href="#cb69-138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stack Overflow, GitHub discussions, forums</span>
<span id="cb69-139"><a href="#cb69-139" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Open-source contributions and rapid bug fixes</span>
<span id="cb69-140"><a href="#cb69-140" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Jupyter notebooks for reproducible research</span>
<span id="cb69-141"><a href="#cb69-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-142"><a href="#cb69-142" aria-hidden="true" tabindex="-1"></a>**4. Industry and Research Standard**</span>
<span id="cb69-143"><a href="#cb69-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>NASA, ESA, USGS use Python for operational systems</span>
<span id="cb69-144"><a href="#cb69-144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scientific papers increasingly publish Python code</span>
<span id="cb69-145"><a href="#cb69-145" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enterprise solutions (Planet Labs, Descartes Labs) built on Python</span>
<span id="cb69-146"><a href="#cb69-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-147"><a href="#cb69-147" aria-hidden="true" tabindex="-1"></a>::: {.philippine-context}</span>
<span id="cb69-148"><a href="#cb69-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python in Philippine EO Systems</span></span>
<span id="cb69-149"><a href="#cb69-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-150"><a href="#cb69-150" aria-hidden="true" tabindex="-1"></a>**DATOS (DOST-ASTI)**</span>
<span id="cb69-151"><a href="#cb69-151" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python backend for automated processing</span>
<span id="cb69-152"><a href="#cb69-152" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Integrates Sentinel data access and analysis</span>
<span id="cb69-153"><a href="#cb69-153" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Generates data products for government use</span>
<span id="cb69-154"><a href="#cb69-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-155"><a href="#cb69-155" aria-hidden="true" tabindex="-1"></a>**PRiSM (PhilRice/IRRI)**</span>
<span id="cb69-156"><a href="#cb69-156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python workflows for SAR-based rice monitoring</span>
<span id="cb69-157"><a href="#cb69-157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Combines Sentinel-1, field data, and crop models</span>
<span id="cb69-158"><a href="#cb69-158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Operational since 2014</span>
<span id="cb69-159"><a href="#cb69-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-160"><a href="#cb69-160" aria-hidden="true" tabindex="-1"></a>**SkAI-Pinas (PhilSA)**</span>
<span id="cb69-161"><a href="#cb69-161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python-based AI/ML training platform</span>
<span id="cb69-162"><a href="#cb69-162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pre-configured with GeoPandas, Rasterio, TensorFlow</span>
<span id="cb69-163"><a href="#cb69-163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Jupyter notebooks for capacity building</span>
<span id="cb69-164"><a href="#cb69-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-165"><a href="#cb69-165" aria-hidden="true" tabindex="-1"></a>**ALaM Project (DOST)**</span>
<span id="cb69-166"><a href="#cb69-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Python for agricultural land monitoring</span>
<span id="cb69-167"><a href="#cb69-167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automated crop classification pipelines</span>
<span id="cb69-168"><a href="#cb69-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Integration with local government data systems</span>
<span id="cb69-169"><a href="#cb69-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-170"><a href="#cb69-170" aria-hidden="true" tabindex="-1"></a>**Key Takeaway:** Learning Python for EO opens doors to operational systems, not just research.</span>
<span id="cb69-171"><a href="#cb69-171" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-172"><a href="#cb69-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-173"><a href="#cb69-173" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connecting to Session 2: Preprocessing for ML</span></span>
<span id="cb69-174"><a href="#cb69-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-175"><a href="#cb69-175" aria-hidden="true" tabindex="-1"></a>In **Session 2**, you learned that data preprocessing is critical for ML success:</span>
<span id="cb69-176"><a href="#cb69-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-177"><a href="#cb69-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Atmospheric correction:** Sen2Cor converts Sentinel-2 Level-1C → Level-2A</span>
<span id="cb69-178"><a href="#cb69-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Normalization:** Scaling pixel values for neural networks</span>
<span id="cb69-179"><a href="#cb69-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cloud masking:** Removing contaminated observations</span>
<span id="cb69-180"><a href="#cb69-180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data augmentation:** Rotation, flipping, cropping</span>
<span id="cb69-181"><a href="#cb69-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-182"><a href="#cb69-182" aria-hidden="true" tabindex="-1"></a>**This session provides the Python skills to implement these preprocessing steps** for your own projects. By the end, you'll prepare analysis-ready data for the ML models in Sessions 5-7.</span>
<span id="cb69-183"><a href="#cb69-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-184"><a href="#cb69-184" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-185"><a href="#cb69-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-186"><a href="#cb69-186" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2: Setting Up Google Colaboratory</span></span>
<span id="cb69-187"><a href="#cb69-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-188"><a href="#cb69-188" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is Google Colab?</span></span>
<span id="cb69-189"><a href="#cb69-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-190"><a href="#cb69-190" aria-hidden="true" tabindex="-1"></a>**Google Colaboratory (Colab)** is a free cloud-based Jupyter notebook environment that allows you to:</span>
<span id="cb69-191"><a href="#cb69-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-192"><a href="#cb69-192" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Write and execute Python code in your browser</span>
<span id="cb69-193"><a href="#cb69-193" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Access free GPU/TPU for machine learning</span>
<span id="cb69-194"><a href="#cb69-194" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Collaborate with others in real-time</span>
<span id="cb69-195"><a href="#cb69-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save notebooks to Google Drive</span>
<span id="cb69-196"><a href="#cb69-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No local installation required!</span>
<span id="cb69-197"><a href="#cb69-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-198"><a href="#cb69-198" aria-hidden="true" tabindex="-1"></a>**Perfect for this training:** Everyone has the same environment, no dependency issues, accessible from anywhere.</span>
<span id="cb69-199"><a href="#cb69-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-200"><a href="#cb69-200" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb69-201"><a href="#cb69-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Colab for Philippine Trainees?</span></span>
<span id="cb69-202"><a href="#cb69-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-203"><a href="#cb69-203" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**No hardware requirements:** Works on any laptop/computer with a browser</span>
<span id="cb69-204"><a href="#cb69-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Internet connectivity:** Even with limited bandwidth, code runs on Google's servers</span>
<span id="cb69-205"><a href="#cb69-205" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Free GPU access:** Train deep learning models without expensive hardware</span>
<span id="cb69-206"><a href="#cb69-206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reproducibility:** Notebooks can be shared and rerun by collaborators</span>
<span id="cb69-207"><a href="#cb69-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**COARE compatibility:** Skills transfer to DOST's COARE HPC environment</span>
<span id="cb69-208"><a href="#cb69-208" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-209"><a href="#cb69-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-210"><a href="#cb69-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Your First Colab Notebook</span></span>
<span id="cb69-211"><a href="#cb69-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-212"><a href="#cb69-212" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb69-213"><a href="#cb69-213" aria-hidden="true" tabindex="-1"></a><span class="fu">## Access Colab</span></span>
<span id="cb69-214"><a href="#cb69-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-215"><a href="#cb69-215" aria-hidden="true" tabindex="-1"></a>**URL:** <span class="co">[</span><span class="ot">https://colab.research.google.com</span><span class="co">](https://colab.research.google.com)</span></span>
<span id="cb69-216"><a href="#cb69-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-217"><a href="#cb69-217" aria-hidden="true" tabindex="-1"></a>**Requirements:**</span>
<span id="cb69-218"><a href="#cb69-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Google account</span>
<span id="cb69-219"><a href="#cb69-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modern web browser (Chrome, Firefox, Safari, Edge)</span>
<span id="cb69-220"><a href="#cb69-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stable internet connection</span>
<span id="cb69-221"><a href="#cb69-221" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-222"><a href="#cb69-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-223"><a href="#cb69-223" aria-hidden="true" tabindex="-1"></a>**Steps:**</span>
<span id="cb69-224"><a href="#cb69-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-225"><a href="#cb69-225" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Go to colab.research.google.com</span>
<span id="cb69-226"><a href="#cb69-226" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Sign in with your Google account</span>
<span id="cb69-227"><a href="#cb69-227" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Click **File → New Notebook**</span>
<span id="cb69-228"><a href="#cb69-228" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Rename: **File → Rename** → "Day1_Session3_Geospatial_Python"</span>
<span id="cb69-229"><a href="#cb69-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-230"><a href="#cb69-230" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding the Colab Interface</span></span>
<span id="cb69-231"><a href="#cb69-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-232"><a href="#cb69-232" aria-hidden="true" tabindex="-1"></a>**Key components:**</span>
<span id="cb69-233"><a href="#cb69-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-234"><a href="#cb69-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Code cells:** Where you write Python code (click or press Enter to edit)</span>
<span id="cb69-235"><a href="#cb69-235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Text cells:** Markdown for documentation (Insert → Text cell)</span>
<span id="cb69-236"><a href="#cb69-236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Run button:** ▶ Execute current cell (or press Shift+Enter)</span>
<span id="cb69-237"><a href="#cb69-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Runtime menu:** Manage execution environment (restart, change runtime type)</span>
<span id="cb69-238"><a href="#cb69-238" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Table of Contents:** Navigate long notebooks (left sidebar icon)</span>
<span id="cb69-239"><a href="#cb69-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-240"><a href="#cb69-240" aria-hidden="true" tabindex="-1"></a>**Try it:** Create a code cell and run:</span>
<span id="cb69-241"><a href="#cb69-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-242"><a href="#cb69-242" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-243"><a href="#cb69-243" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello from Google Colab!"</span>)</span>
<span id="cb69-244"><a href="#cb69-244" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is the CoPhil EO AI/ML Training"</span>)</span>
<span id="cb69-245"><a href="#cb69-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-246"><a href="#cb69-246" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Python version</span></span>
<span id="cb69-247"><a href="#cb69-247" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb69-248"><a href="#cb69-248" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version: </span><span class="sc">{</span>sys<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-249"><a href="#cb69-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-250"><a href="#cb69-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-251"><a href="#cb69-251" aria-hidden="true" tabindex="-1"></a>Press **Shift+Enter** to execute. You should see the output below the cell.</span>
<span id="cb69-252"><a href="#cb69-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-253"><a href="#cb69-253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connecting Google Drive</span></span>
<span id="cb69-254"><a href="#cb69-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-255"><a href="#cb69-255" aria-hidden="true" tabindex="-1"></a>**Why mount Google Drive?**</span>
<span id="cb69-256"><a href="#cb69-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-257"><a href="#cb69-257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Access data files stored in Drive</span>
<span id="cb69-258"><a href="#cb69-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save outputs permanently (Colab sessions are temporary!)</span>
<span id="cb69-259"><a href="#cb69-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Share data with collaborators</span>
<span id="cb69-260"><a href="#cb69-260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Store trained models and results</span>
<span id="cb69-261"><a href="#cb69-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-262"><a href="#cb69-262" aria-hidden="true" tabindex="-1"></a>**Mount Drive:**</span>
<span id="cb69-263"><a href="#cb69-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-264"><a href="#cb69-264" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-265"><a href="#cb69-265" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb69-266"><a href="#cb69-266" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">'/content/drive'</span>)</span>
<span id="cb69-267"><a href="#cb69-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-268"><a href="#cb69-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-269"><a href="#cb69-269" aria-hidden="true" tabindex="-1"></a>**What happens:**</span>
<span id="cb69-270"><a href="#cb69-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-271"><a href="#cb69-271" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Click the link that appears</span>
<span id="cb69-272"><a href="#cb69-272" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Select your Google account</span>
<span id="cb69-273"><a href="#cb69-273" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Click "Allow" to grant access</span>
<span id="cb69-274"><a href="#cb69-274" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Copy the authorization code</span>
<span id="cb69-275"><a href="#cb69-275" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Paste into the input field and press Enter</span>
<span id="cb69-276"><a href="#cb69-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-277"><a href="#cb69-277" aria-hidden="true" tabindex="-1"></a>**Verification:**</span>
<span id="cb69-278"><a href="#cb69-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-279"><a href="#cb69-279" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-280"><a href="#cb69-280" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb69-281"><a href="#cb69-281" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'/content/drive/MyDrive'</span>)</span>
<span id="cb69-282"><a href="#cb69-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-283"><a href="#cb69-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-284"><a href="#cb69-284" aria-hidden="true" tabindex="-1"></a>You should see your Google Drive folders listed!</span>
<span id="cb69-285"><a href="#cb69-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-286"><a href="#cb69-286" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb69-287"><a href="#cb69-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Organizing Your Data</span></span>
<span id="cb69-288"><a href="#cb69-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-289"><a href="#cb69-289" aria-hidden="true" tabindex="-1"></a>Create a folder structure in Google Drive for this training:</span>
<span id="cb69-290"><a href="#cb69-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-291"><a href="#cb69-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-292"><a href="#cb69-292" aria-hidden="true" tabindex="-1"></a><span class="in">MyDrive/</span></span>
<span id="cb69-293"><a href="#cb69-293" aria-hidden="true" tabindex="-1"></a><span class="in">  CoPhil_Training/</span></span>
<span id="cb69-294"><a href="#cb69-294" aria-hidden="true" tabindex="-1"></a><span class="in">    data/</span></span>
<span id="cb69-295"><a href="#cb69-295" aria-hidden="true" tabindex="-1"></a><span class="in">      vector/          # Shapefiles, GeoJSON (Philippine boundaries, AOIs)</span></span>
<span id="cb69-296"><a href="#cb69-296" aria-hidden="true" tabindex="-1"></a><span class="in">      raster/          # Satellite imagery (Sentinel-2 tiles, NDVI, etc.)</span></span>
<span id="cb69-297"><a href="#cb69-297" aria-hidden="true" tabindex="-1"></a><span class="in">    outputs/           # Processed results (clipped rasters, classification maps)</span></span>
<span id="cb69-298"><a href="#cb69-298" aria-hidden="true" tabindex="-1"></a><span class="in">    notebooks/         # Saved Colab notebooks</span></span>
<span id="cb69-299"><a href="#cb69-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-300"><a href="#cb69-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-301"><a href="#cb69-301" aria-hidden="true" tabindex="-1"></a>**Pro Tip:** Use descriptive filenames with dates: <span class="in">`palawan_sentinel2_20240615.tif`</span></span>
<span id="cb69-302"><a href="#cb69-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-303"><a href="#cb69-303" aria-hidden="true" tabindex="-1"></a>This keeps your training materials organized and makes paths easier to reference in code.</span>
<span id="cb69-304"><a href="#cb69-304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-305"><a href="#cb69-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-306"><a href="#cb69-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Colab Runtime</span></span>
<span id="cb69-307"><a href="#cb69-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-308"><a href="#cb69-308" aria-hidden="true" tabindex="-1"></a>**Runtime Types:**</span>
<span id="cb69-309"><a href="#cb69-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-310"><a href="#cb69-310" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CPU:** Default, free, sufficient for most geospatial tasks</span>
<span id="cb69-311"><a href="#cb69-311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GPU:** Free, excellent for deep learning (Sessions 5-7)</span>
<span id="cb69-312"><a href="#cb69-312" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**TPU:** Free, specialized for TensorFlow models</span>
<span id="cb69-313"><a href="#cb69-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-314"><a href="#cb69-314" aria-hidden="true" tabindex="-1"></a>**Session Limits:**</span>
<span id="cb69-315"><a href="#cb69-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-316"><a href="#cb69-316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Idle timeout:** 90 minutes of inactivity</span>
<span id="cb69-317"><a href="#cb69-317" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Maximum runtime:** 12 hours continuous execution</span>
<span id="cb69-318"><a href="#cb69-318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Disk space:** ~100 GB temporary storage</span>
<span id="cb69-319"><a href="#cb69-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-320"><a href="#cb69-320" aria-hidden="true" tabindex="-1"></a>**Best Practices:**</span>
<span id="cb69-321"><a href="#cb69-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-322"><a href="#cb69-322" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-323"><a href="#cb69-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Periodically save important results to Drive</span></span>
<span id="cb69-324"><a href="#cb69-324" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb69-325"><a href="#cb69-325" aria-hidden="true" tabindex="-1"></a>shutil.copy(<span class="st">'important_result.tif'</span>, <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/'</span>)</span>
<span id="cb69-326"><a href="#cb69-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-327"><a href="#cb69-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-328"><a href="#cb69-328" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-329"><a href="#cb69-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-330"><a href="#cb69-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 3: Installing Geospatial Libraries</span></span>
<span id="cb69-331"><a href="#cb69-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-332"><a href="#cb69-332" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Libraries</span></span>
<span id="cb69-333"><a href="#cb69-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-334"><a href="#cb69-334" aria-hidden="true" tabindex="-1"></a>Google Colab comes with many libraries pre-installed (NumPy, Pandas, Matplotlib), but specialized geospatial tools need installation.</span>
<span id="cb69-335"><a href="#cb69-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-336"><a href="#cb69-336" aria-hidden="true" tabindex="-1"></a>**Core libraries we'll use:**</span>
<span id="cb69-337"><a href="#cb69-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-338"><a href="#cb69-338" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Library <span class="pp">|</span> Purpose <span class="pp">|</span> Why Important <span class="pp">|</span></span>
<span id="cb69-339"><a href="#cb69-339" aria-hidden="true" tabindex="-1"></a><span class="pp">|---------|---------|---------------|</span></span>
<span id="cb69-340"><a href="#cb69-340" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **GeoPandas** <span class="pp">|</span> Vector data (shapefiles, GeoJSON, polygons, points) <span class="pp">|</span> Spatial operations, CRS transforms, easy plotting <span class="pp">|</span></span>
<span id="cb69-341"><a href="#cb69-341" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Rasterio** <span class="pp">|</span> Raster data (GeoTIFF, satellite imagery) <span class="pp">|</span> Read/write rasters, metadata, windowed reading <span class="pp">|</span></span>
<span id="cb69-342"><a href="#cb69-342" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Shapely** <span class="pp">|</span> Geometric operations (included with GeoPandas) <span class="pp">|</span> Create/manipulate geometries, spatial predicates <span class="pp">|</span></span>
<span id="cb69-343"><a href="#cb69-343" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Matplotlib** <span class="pp">|</span> Visualization <span class="pp">|</span> Publication-quality figures, customizable plots <span class="pp">|</span></span>
<span id="cb69-344"><a href="#cb69-344" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **NumPy** <span class="pp">|</span> Array operations (pre-installed) <span class="pp">|</span> Foundation for all numerical computing <span class="pp">|</span></span>
<span id="cb69-345"><a href="#cb69-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-346"><a href="#cb69-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Installation</span></span>
<span id="cb69-347"><a href="#cb69-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-348"><a href="#cb69-348" aria-hidden="true" tabindex="-1"></a>Run this cell (may take 1-2 minutes):</span>
<span id="cb69-349"><a href="#cb69-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-350"><a href="#cb69-350" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-351"><a href="#cb69-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Install geospatial libraries</span></span>
<span id="cb69-352"><a href="#cb69-352" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install geopandas rasterio fiona shapely pyproj <span class="op">-</span>q</span>
<span id="cb69-353"><a href="#cb69-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-354"><a href="#cb69-354" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Installation complete! ✓"</span>)</span>
<span id="cb69-355"><a href="#cb69-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-356"><a href="#cb69-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-357"><a href="#cb69-357" aria-hidden="true" tabindex="-1"></a>The <span class="in">`-q`</span> flag makes installation quiet (less output).</span>
<span id="cb69-358"><a href="#cb69-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-359"><a href="#cb69-359" aria-hidden="true" tabindex="-1"></a>**What's being installed:**</span>
<span id="cb69-360"><a href="#cb69-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-361"><a href="#cb69-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`geopandas`</span>: Main vector library (also installs Pandas)</span>
<span id="cb69-362"><a href="#cb69-362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`rasterio`</span>: Main raster library (also installs GDAL bindings)</span>
<span id="cb69-363"><a href="#cb69-363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`fiona`</span>: File I/O for vector formats (dependency of GeoPandas)</span>
<span id="cb69-364"><a href="#cb69-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`shapely`</span>: Geometric operations (dependency of GeoPandas)</span>
<span id="cb69-365"><a href="#cb69-365" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pyproj`</span>: Coordinate reference system transformations</span>
<span id="cb69-366"><a href="#cb69-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-367"><a href="#cb69-367" aria-hidden="true" tabindex="-1"></a>**If you see warnings:** Usually safe to ignore. If errors occur, try:</span>
<span id="cb69-368"><a href="#cb69-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-369"><a href="#cb69-369" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-370"><a href="#cb69-370" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>upgrade geopandas rasterio</span>
<span id="cb69-371"><a href="#cb69-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-372"><a href="#cb69-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-373"><a href="#cb69-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### Verify Installation</span></span>
<span id="cb69-374"><a href="#cb69-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-375"><a href="#cb69-375" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-376"><a href="#cb69-376" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb69-377"><a href="#cb69-377" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb69-378"><a href="#cb69-378" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb69-379"><a href="#cb69-379" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb69-380"><a href="#cb69-380" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-381"><a href="#cb69-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-382"><a href="#cb69-382" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ GeoPandas version:"</span>, gpd.__version__)</span>
<span id="cb69-383"><a href="#cb69-383" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Rasterio version:"</span>, rasterio.__version__)</span>
<span id="cb69-384"><a href="#cb69-384" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ NumPy version:"</span>, np.__version__)</span>
<span id="cb69-385"><a href="#cb69-385" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ All libraries imported successfully!"</span>)</span>
<span id="cb69-386"><a href="#cb69-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-387"><a href="#cb69-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-388"><a href="#cb69-388" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb69-389"><a href="#cb69-389" aria-hidden="true" tabindex="-1"></a><span class="fu">## Runtime Restart</span></span>
<span id="cb69-390"><a href="#cb69-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-391"><a href="#cb69-391" aria-hidden="true" tabindex="-1"></a>Occasionally, Colab may ask you to restart the runtime after installing libraries:</span>
<span id="cb69-392"><a href="#cb69-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-393"><a href="#cb69-393" aria-hidden="true" tabindex="-1"></a>**Runtime → Restart runtime**</span>
<span id="cb69-394"><a href="#cb69-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-395"><a href="#cb69-395" aria-hidden="true" tabindex="-1"></a>Then re-run your import cell. This is normal and ensures clean library loading!</span>
<span id="cb69-396"><a href="#cb69-396" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-397"><a href="#cb69-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-398"><a href="#cb69-398" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-399"><a href="#cb69-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-400"><a href="#cb69-400" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 4: Python Basics Refresher</span></span>
<span id="cb69-401"><a href="#cb69-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-402"><a href="#cb69-402" aria-hidden="true" tabindex="-1"></a>Quick recap of Python essentials for geospatial work:</span>
<span id="cb69-403"><a href="#cb69-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-404"><a href="#cb69-404" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Types</span></span>
<span id="cb69-405"><a href="#cb69-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-406"><a href="#cb69-406" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-407"><a href="#cb69-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbers</span></span>
<span id="cb69-408"><a href="#cb69-408" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">1780148</span>        <span class="co"># Integer</span></span>
<span id="cb69-409"><a href="#cb69-409" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> <span class="fl">42.88</span>           <span class="co"># Float</span></span>
<span id="cb69-410"><a href="#cb69-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-411"><a href="#cb69-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Strings</span></span>
<span id="cb69-412"><a href="#cb69-412" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">"Manila"</span></span>
<span id="cb69-413"><a href="#cb69-413" aria-hidden="true" tabindex="-1"></a>province <span class="op">=</span> <span class="st">"Metro Manila"</span></span>
<span id="cb69-414"><a href="#cb69-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-415"><a href="#cb69-415" aria-hidden="true" tabindex="-1"></a><span class="co"># Lists (ordered collections)</span></span>
<span id="cb69-416"><a href="#cb69-416" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">"Luzon"</span>, <span class="st">"Visayas"</span>, <span class="st">"Mindanao"</span>]</span>
<span id="cb69-417"><a href="#cb69-417" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> [<span class="fl">14.5995</span>, <span class="fl">120.9842</span>]  <span class="co"># [latitude, longitude]</span></span>
<span id="cb69-418"><a href="#cb69-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-419"><a href="#cb69-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionaries (key-value pairs)</span></span>
<span id="cb69-420"><a href="#cb69-420" aria-hidden="true" tabindex="-1"></a>location_info <span class="op">=</span> {</span>
<span id="cb69-421"><a href="#cb69-421" aria-hidden="true" tabindex="-1"></a>    <span class="st">"city"</span>: <span class="st">"Quezon City"</span>,</span>
<span id="cb69-422"><a href="#cb69-422" aria-hidden="true" tabindex="-1"></a>    <span class="st">"population"</span>: <span class="dv">2960048</span>,</span>
<span id="cb69-423"><a href="#cb69-423" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>: <span class="st">"NCR"</span></span>
<span id="cb69-424"><a href="#cb69-424" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-425"><a href="#cb69-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-426"><a href="#cb69-426" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss"> has population </span><span class="sc">{</span>population<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb69-427"><a href="#cb69-427" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Regions: </span><span class="sc">{</span>regions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-428"><a href="#cb69-428" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coordinates<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-429"><a href="#cb69-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-430"><a href="#cb69-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-431"><a href="#cb69-431" aria-hidden="true" tabindex="-1"></a><span class="fu">### Control Structures</span></span>
<span id="cb69-432"><a href="#cb69-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-433"><a href="#cb69-433" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-434"><a href="#cb69-434" aria-hidden="true" tabindex="-1"></a><span class="co"># If statements</span></span>
<span id="cb69-435"><a href="#cb69-435" aria-hidden="true" tabindex="-1"></a>cloud_cover <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb69-436"><a href="#cb69-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-437"><a href="#cb69-437" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cloud_cover <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb69-438"><a href="#cb69-438" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Excellent"</span></span>
<span id="cb69-439"><a href="#cb69-439" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> cloud_cover <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb69-440"><a href="#cb69-440" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Good"</span></span>
<span id="cb69-441"><a href="#cb69-441" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb69-442"><a href="#cb69-442" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Poor"</span></span>
<span id="cb69-443"><a href="#cb69-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-444"><a href="#cb69-444" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cloud cover </span><span class="sc">{</span>cloud_cover<span class="sc">}</span><span class="ss">%: </span><span class="sc">{</span>quality<span class="sc">}</span><span class="ss"> for optical imagery"</span>)</span>
<span id="cb69-445"><a href="#cb69-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-446"><a href="#cb69-446" aria-hidden="true" tabindex="-1"></a><span class="co"># For loops</span></span>
<span id="cb69-447"><a href="#cb69-447" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> [<span class="st">"Palawan"</span>, <span class="st">"Zambales"</span>, <span class="st">"Quezon"</span>]</span>
<span id="cb69-448"><a href="#cb69-448" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> province <span class="kw">in</span> provinces:</span>
<span id="cb69-449"><a href="#cb69-449" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Processing </span><span class="sc">{</span>province<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb69-450"><a href="#cb69-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-451"><a href="#cb69-451" aria-hidden="true" tabindex="-1"></a><span class="co"># List comprehension (Pythonic way)</span></span>
<span id="cb69-452"><a href="#cb69-452" aria-hidden="true" tabindex="-1"></a>province_lengths <span class="op">=</span> [<span class="bu">len</span>(p) <span class="cf">for</span> p <span class="kw">in</span> provinces]</span>
<span id="cb69-453"><a href="#cb69-453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Province name lengths:"</span>, province_lengths)</span>
<span id="cb69-454"><a href="#cb69-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-455"><a href="#cb69-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-456"><a href="#cb69-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Functions</span></span>
<span id="cb69-457"><a href="#cb69-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-458"><a href="#cb69-458" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-459"><a href="#cb69-459" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(nir, red):</span>
<span id="cb69-460"><a href="#cb69-460" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb69-461"><a href="#cb69-461" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index.</span></span>
<span id="cb69-462"><a href="#cb69-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-463"><a href="#cb69-463" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb69-464"><a href="#cb69-464" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb69-465"><a href="#cb69-465" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : float or ndarray</span></span>
<span id="cb69-466"><a href="#cb69-466" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance values</span></span>
<span id="cb69-467"><a href="#cb69-467" aria-hidden="true" tabindex="-1"></a><span class="co">    red : float or ndarray</span></span>
<span id="cb69-468"><a href="#cb69-468" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance values</span></span>
<span id="cb69-469"><a href="#cb69-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-470"><a href="#cb69-470" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb69-471"><a href="#cb69-471" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb69-472"><a href="#cb69-472" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : float or ndarray</span></span>
<span id="cb69-473"><a href="#cb69-473" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values ranging from -1 to +1</span></span>
<span id="cb69-474"><a href="#cb69-474" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb69-475"><a href="#cb69-475" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add small value to avoid division by zero</span></span>
<span id="cb69-476"><a href="#cb69-476" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-477"><a href="#cb69-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span>
<span id="cb69-478"><a href="#cb69-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-479"><a href="#cb69-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb69-480"><a href="#cb69-480" aria-hidden="true" tabindex="-1"></a>nir_value <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb69-481"><a href="#cb69-481" aria-hidden="true" tabindex="-1"></a>red_value <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb69-482"><a href="#cb69-482" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> calculate_ndvi(nir_value, red_value)</span>
<span id="cb69-483"><a href="#cb69-483" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI: </span><span class="sc">{</span>result<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb69-484"><a href="#cb69-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-485"><a href="#cb69-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-486"><a href="#cb69-486" aria-hidden="true" tabindex="-1"></a>**Key Python concepts for geospatial:**</span>
<span id="cb69-487"><a href="#cb69-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-488"><a href="#cb69-488" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Indentation matters:** Use 4 spaces to define code blocks</span>
<span id="cb69-489"><a href="#cb69-489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0-indexed:** First element is <span class="in">`list[0]`</span>, not <span class="in">`list[1]`</span></span>
<span id="cb69-490"><a href="#cb69-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Method chaining:** <span class="in">`gdf.filter(...).plot()`</span> applies operations sequentially</span>
<span id="cb69-491"><a href="#cb69-491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Context managers:** <span class="in">`with rasterio.open() as src:`</span> auto-closes files (prevents memory leaks)</span>
<span id="cb69-492"><a href="#cb69-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-493"><a href="#cb69-493" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-494"><a href="#cb69-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-495"><a href="#cb69-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 5: Vector Data with GeoPandas</span></span>
<span id="cb69-496"><a href="#cb69-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-497"><a href="#cb69-497" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is Vector Data?</span></span>
<span id="cb69-498"><a href="#cb69-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-499"><a href="#cb69-499" aria-hidden="true" tabindex="-1"></a>**Vector data represents discrete features as geometric objects:**</span>
<span id="cb69-500"><a href="#cb69-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-501"><a href="#cb69-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Points:** Cities, field sites, observation locations, GPS waypoints</span>
<span id="cb69-502"><a href="#cb69-502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lines (LineStrings):** Roads, rivers, transects, boundaries</span>
<span id="cb69-503"><a href="#cb69-503" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Polygons:** Administrative boundaries, land parcels, watersheds, protected areas</span>
<span id="cb69-504"><a href="#cb69-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-507"><a href="#cb69-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb69-508"><a href="#cb69-508" aria-hidden="true" tabindex="-1"></a>%%| fig-cap: <span class="ot">"</span><span class="st">Vector Data Types and GeoPandas GeoDataFrame Structure</span><span class="ot">"</span></span>
<span id="cb69-509"><a href="#cb69-509" aria-hidden="true" tabindex="-1"></a>%%| fig-width: <span class="dv">100</span>%</span>
<span id="cb69-510"><a href="#cb69-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-511"><a href="#cb69-511" aria-hidden="true" tabindex="-1"></a>graph TB</span>
<span id="cb69-512"><a href="#cb69-512" aria-hidden="true" tabindex="-1"></a>    subgraph VectorTypes[<span class="ot">"</span><span class="st">VECTOR GEOMETRY TYPES</span><span class="ot">"</span>]</span>
<span id="cb69-513"><a href="#cb69-513" aria-hidden="true" tabindex="-1"></a>        V1[Point&lt;br/&gt;Single coordinate&lt;br/&gt;Cities, GPS points]</span>
<span id="cb69-514"><a href="#cb69-514" aria-hidden="true" tabindex="-1"></a>        V2[LineString&lt;br/&gt;Connected coordinates&lt;br/&gt;Roads, rivers]</span>
<span id="cb69-515"><a href="#cb69-515" aria-hidden="true" tabindex="-1"></a>        V3[Polygon&lt;br/&gt;Closed ring&lt;br/&gt;Boundaries, parcels]</span>
<span id="cb69-516"><a href="#cb69-516" aria-hidden="true" tabindex="-1"></a>        V4[MultiPoint&lt;br/&gt;Multiple points&lt;br/&gt;Observation sites]</span>
<span id="cb69-517"><a href="#cb69-517" aria-hidden="true" tabindex="-1"></a>        V5[MultiLineString&lt;br/&gt;Multiple lines&lt;br/&gt;Road networks]</span>
<span id="cb69-518"><a href="#cb69-518" aria-hidden="true" tabindex="-1"></a>        V6[MultiPolygon&lt;br/&gt;Multiple polygons&lt;br/&gt;Archipelago]</span>
<span id="cb69-519"><a href="#cb69-519" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-520"><a href="#cb69-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-521"><a href="#cb69-521" aria-hidden="true" tabindex="-1"></a>    subgraph GDF[<span class="ot">"</span><span class="st">GEOPANDAS GEODATAFRAME</span><span class="ot">"</span>]</span>
<span id="cb69-522"><a href="#cb69-522" aria-hidden="true" tabindex="-1"></a>        GDF1[Geometry Column&lt;br/&gt;Shapely objects&lt;br/&gt;Point/Line/Polygon]</span>
<span id="cb69-523"><a href="#cb69-523" aria-hidden="true" tabindex="-1"></a>        GDF2[Attribute Columns&lt;br/&gt;Name, Population&lt;br/&gt;Area, Type, etc.]</span>
<span id="cb69-524"><a href="#cb69-524" aria-hidden="true" tabindex="-1"></a>        GDF3[CRS Information&lt;br/&gt;EPSG:<span class="dv">4326</span>, <span class="dv">32651</span>&lt;br/&gt;Projection metadata]</span>
<span id="cb69-525"><a href="#cb69-525" aria-hidden="true" tabindex="-1"></a>        GDF4[Spatial Index&lt;br/&gt;R-tree <span class="kw">for</span> fast&lt;br/&gt;spatial queries]</span>
<span id="cb69-526"><a href="#cb69-526" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-527"><a href="#cb69-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-528"><a href="#cb69-528" aria-hidden="true" tabindex="-1"></a>    subgraph Formats[<span class="ot">"</span><span class="st">FILE FORMATS</span><span class="ot">"</span>]</span>
<span id="cb69-529"><a href="#cb69-529" aria-hidden="true" tabindex="-1"></a>        F1[Shapefile&lt;br/&gt;.shp + .shx + .dbf + .prj]</span>
<span id="cb69-530"><a href="#cb69-530" aria-hidden="true" tabindex="-1"></a>        F2[GeoJSON&lt;br/&gt;.geojson, .json]</span>
<span id="cb69-531"><a href="#cb69-531" aria-hidden="true" tabindex="-1"></a>        F3[GeoPackage&lt;br/&gt;.gpkg]</span>
<span id="cb69-532"><a href="#cb69-532" aria-hidden="true" tabindex="-1"></a>        F4[KML/KMZ&lt;br/&gt;.kml, .kmz]</span>
<span id="cb69-533"><a href="#cb69-533" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-534"><a href="#cb69-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-535"><a href="#cb69-535" aria-hidden="true" tabindex="-1"></a>    V1 --&gt; GDF1</span>
<span id="cb69-536"><a href="#cb69-536" aria-hidden="true" tabindex="-1"></a>    V2 --&gt; GDF1</span>
<span id="cb69-537"><a href="#cb69-537" aria-hidden="true" tabindex="-1"></a>    V3 --&gt; GDF1</span>
<span id="cb69-538"><a href="#cb69-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-539"><a href="#cb69-539" aria-hidden="true" tabindex="-1"></a>    GDF1 --&gt; Operations[Spatial Operations&lt;br/&gt;Buffer, Intersect&lt;br/&gt;Union, Dissolve&lt;br/&gt;Clip, Overlay]</span>
<span id="cb69-540"><a href="#cb69-540" aria-hidden="true" tabindex="-1"></a>    GDF2 --&gt; Operations</span>
<span id="cb69-541"><a href="#cb69-541" aria-hidden="true" tabindex="-1"></a>    GDF3 --&gt; Operations</span>
<span id="cb69-542"><a href="#cb69-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-543"><a href="#cb69-543" aria-hidden="true" tabindex="-1"></a>    F1 --&gt;|gpd.read_file| GDF</span>
<span id="cb69-544"><a href="#cb69-544" aria-hidden="true" tabindex="-1"></a>    F2 --&gt;|gpd.read_file| GDF</span>
<span id="cb69-545"><a href="#cb69-545" aria-hidden="true" tabindex="-1"></a>    F3 --&gt;|gpd.read_file| GDF</span>
<span id="cb69-546"><a href="#cb69-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-547"><a href="#cb69-547" aria-hidden="true" tabindex="-1"></a>    style VectorTypes fill:<span class="co">#e6f3ff,stroke:#0066cc,stroke-width:2px</span></span>
<span id="cb69-548"><a href="#cb69-548" aria-hidden="true" tabindex="-1"></a>    style GDF fill:<span class="co">#e6ffe6,stroke:#00aa44,stroke-width:2px</span></span>
<span id="cb69-549"><a href="#cb69-549" aria-hidden="true" tabindex="-1"></a>    style Formats fill:<span class="co">#fff4e6,stroke:#ff8800,stroke-width:2px</span></span>
<span id="cb69-550"><a href="#cb69-550" aria-hidden="true" tabindex="-1"></a>    style Operations fill:<span class="co">#ffe6ff,stroke:#cc00cc,stroke-width:2px</span></span>
<span id="cb69-551"><a href="#cb69-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-552"><a href="#cb69-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-553"><a href="#cb69-553" aria-hidden="true" tabindex="-1"></a>**Common formats:** Shapefile (.shp + .shx + .dbf + .prj), GeoJSON (.geojson, .json), KML (.kml), GeoPackage (.gpkg)</span>
<span id="cb69-554"><a href="#cb69-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-555"><a href="#cb69-555" aria-hidden="true" tabindex="-1"></a>**Shapefile components:**</span>
<span id="cb69-556"><a href="#cb69-556" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.shp`</span>: Geometry (points, lines, polygons)</span>
<span id="cb69-557"><a href="#cb69-557" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.shx`</span>: Shape index</span>
<span id="cb69-558"><a href="#cb69-558" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.dbf`</span>: Attribute table (database)</span>
<span id="cb69-559"><a href="#cb69-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.prj`</span>: Coordinate reference system</span>
<span id="cb69-560"><a href="#cb69-560" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`.cpg`</span>: Character encoding (optional)</span>
<span id="cb69-561"><a href="#cb69-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-562"><a href="#cb69-562" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Coordinate Reference Systems (CRS)</span></span>
<span id="cb69-563"><a href="#cb69-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-564"><a href="#cb69-564" aria-hidden="true" tabindex="-1"></a>Before we load data, it's essential to understand CRS - a critical concept for accurate geospatial analysis.</span>
<span id="cb69-565"><a href="#cb69-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-566"><a href="#cb69-566" aria-hidden="true" tabindex="-1"></a>**What is a CRS?**</span>
<span id="cb69-567"><a href="#cb69-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-568"><a href="#cb69-568" aria-hidden="true" tabindex="-1"></a>A Coordinate Reference System defines how coordinates map to locations on Earth. It consists of:</span>
<span id="cb69-569"><a href="#cb69-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-570"><a href="#cb69-570" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Coordinate System:** Geographic (lat/lon) or Projected (x/y in meters)</span>
<span id="cb69-571"><a href="#cb69-571" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Datum:** Reference ellipsoid approximating Earth's shape (e.g., WGS84)</span>
<span id="cb69-572"><a href="#cb69-572" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Projection:** Mathematical transformation from 3D Earth to 2D map</span>
<span id="cb69-573"><a href="#cb69-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-574"><a href="#cb69-574" aria-hidden="true" tabindex="-1"></a>**Common CRS for Philippines:**</span>
<span id="cb69-575"><a href="#cb69-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-576"><a href="#cb69-576" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> EPSG Code <span class="pp">|</span> Name <span class="pp">|</span> Type <span class="pp">|</span> Units <span class="pp">|</span> Use Case <span class="pp">|</span></span>
<span id="cb69-577"><a href="#cb69-577" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------|------|------|-------|----------|</span></span>
<span id="cb69-578"><a href="#cb69-578" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **4326** <span class="pp">|</span> WGS84 <span class="pp">|</span> Geographic <span class="pp">|</span> Degrees <span class="pp">|</span> GPS, web maps, global datasets <span class="pp">|</span></span>
<span id="cb69-579"><a href="#cb69-579" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **32651** <span class="pp">|</span> UTM Zone 51N <span class="pp">|</span> Projected <span class="pp">|</span> Meters <span class="pp">|</span> Northern/Western Philippines <span class="pp">|</span></span>
<span id="cb69-580"><a href="#cb69-580" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **32652** <span class="pp">|</span> UTM Zone 52N <span class="pp">|</span> Projected <span class="pp">|</span> Meters <span class="pp">|</span> Eastern Philippines <span class="pp">|</span></span>
<span id="cb69-581"><a href="#cb69-581" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **3123** <span class="pp">|</span> PRS92 / Philippines Zone III <span class="pp">|</span> Projected <span class="pp">|</span> Meters <span class="pp">|</span> Philippine national standard <span class="pp">|</span></span>
<span id="cb69-582"><a href="#cb69-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-583"><a href="#cb69-583" aria-hidden="true" tabindex="-1"></a>**Why CRS matters:**</span>
<span id="cb69-584"><a href="#cb69-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-585"><a href="#cb69-585" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Distance calculations:** Geographic CRS (degrees) gives wrong distances; use projected CRS (meters)</span>
<span id="cb69-586"><a href="#cb69-586" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Area calculations:** Same issue - must use projected CRS for accurate areas</span>
<span id="cb69-587"><a href="#cb69-587" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Spatial operations:** CRS must match for intersections, buffers, clipping</span>
<span id="cb69-588"><a href="#cb69-588" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Visualization:** Web maps expect EPSG:4326; analysis needs meters</span>
<span id="cb69-589"><a href="#cb69-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-592"><a href="#cb69-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb69-593"><a href="#cb69-593" aria-hidden="true" tabindex="-1"></a>%%| fig-cap: <span class="ot">"</span><span class="st">Coordinate Reference System Transformation Workflow</span><span class="ot">"</span></span>
<span id="cb69-594"><a href="#cb69-594" aria-hidden="true" tabindex="-1"></a>%%| fig-width: <span class="dv">100</span>%</span>
<span id="cb69-595"><a href="#cb69-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-596"><a href="#cb69-596" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb69-597"><a href="#cb69-597" aria-hidden="true" tabindex="-1"></a>    A[GPS Data&lt;br/&gt;EPSG:<span class="dv">4326</span>&lt;br/&gt;Lat: <span class="fl">14.5995</span>°&lt;br/&gt;Lon: <span class="fl">120.9842</span>°] --&gt; B{Need distance&lt;br/&gt;<span class="ot">or</span> area&lt;br/&gt;calculations?}</span>
<span id="cb69-598"><a href="#cb69-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-599"><a href="#cb69-599" aria-hidden="true" tabindex="-1"></a>    B --&gt;|Yes| C[Transform to&lt;br/&gt;Projected CRS&lt;br/&gt;UTM Zone <span class="dv">51</span>N&lt;br/&gt;EPSG:<span class="dv">32651</span>]</span>
<span id="cb69-600"><a href="#cb69-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-601"><a href="#cb69-601" aria-hidden="true" tabindex="-1"></a>    B --&gt;|No, just&lt;br/&gt;visualization| D[Keep Geographic&lt;br/&gt;EPSG:<span class="dv">4326</span>&lt;br/&gt;For web maps]</span>
<span id="cb69-602"><a href="#cb69-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-603"><a href="#cb69-603" aria-hidden="true" tabindex="-1"></a>    C --&gt; E[Accurate Calculations&lt;br/&gt;X: <span class="dv">279</span>,<span class="dv">000</span> <span class="ot">m&lt;br/&gt;Y: 1,615,000 m]</span></span>
<span id="cb69-604"><a href="#cb69-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-605"><a href="#cb69-605" aria-hidden="true" tabindex="-1"></a><span class="ot">    E --&gt; F</span><span class="ch">[</span><span class="bn">Spatial Operations&lt;br/&gt;Buffer 1000m&lt;br/&gt;Calculate area in km²&lt;br/&gt;Distance in meters</span><span class="ch">]</span></span>
<span id="cb69-606"><a href="#cb69-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-607"><a href="#cb69-607" aria-hidden="true" tabindex="-1"></a><span class="ot">    F --&gt; G{Export for&lt;</span>br/&gt;web mapping?}</span>
<span id="cb69-608"><a href="#cb69-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-609"><a href="#cb69-609" aria-hidden="true" tabindex="-1"></a>    G --&gt;|Yes| H[Transform back&lt;br/&gt;to EPSG:<span class="dv">4326</span>]</span>
<span id="cb69-610"><a href="#cb69-610" aria-hidden="true" tabindex="-1"></a>    G --&gt;|No| I[Save in UTM&lt;br/&gt;For further analysis]</span>
<span id="cb69-611"><a href="#cb69-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-612"><a href="#cb69-612" aria-hidden="true" tabindex="-1"></a>    H --&gt; D</span>
<span id="cb69-613"><a href="#cb69-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-614"><a href="#cb69-614" aria-hidden="true" tabindex="-1"></a>    D --&gt; J[Interactive Map&lt;br/&gt;Folium, Leaflet&lt;br/&gt;Google Maps]</span>
<span id="cb69-615"><a href="#cb69-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-616"><a href="#cb69-616" aria-hidden="true" tabindex="-1"></a>    subgraph PhilippineCRS[<span class="ot">"</span><span class="st">PHILIPPINE CRS OPTIONS</span><span class="ot">"</span>]</span>
<span id="cb69-617"><a href="#cb69-617" aria-hidden="true" tabindex="-1"></a>        P1[EPSG:<span class="dv">4326</span>&lt;br/&gt;WGS84 Geographic&lt;br/&gt;Global standard]</span>
<span id="cb69-618"><a href="#cb69-618" aria-hidden="true" tabindex="-1"></a>        P2[EPSG:<span class="dv">32651</span>&lt;br/&gt;UTM Zone <span class="dv">51</span>N&lt;br/&gt;Western PH]</span>
<span id="cb69-619"><a href="#cb69-619" aria-hidden="true" tabindex="-1"></a>        P3[EPSG:<span class="dv">32652</span>&lt;br/&gt;UTM Zone <span class="dv">52</span>N&lt;br/&gt;Eastern PH]</span>
<span id="cb69-620"><a href="#cb69-620" aria-hidden="true" tabindex="-1"></a>        P4[EPSG:<span class="dv">3123</span>&lt;br/&gt;PRS92 Zone III&lt;br/&gt;National standard]</span>
<span id="cb69-621"><a href="#cb69-621" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-622"><a href="#cb69-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-623"><a href="#cb69-623" aria-hidden="true" tabindex="-1"></a>    C -.-&gt;|Choose| P2</span>
<span id="cb69-624"><a href="#cb69-624" aria-hidden="true" tabindex="-1"></a>    C -.-&gt;|Choose| P3</span>
<span id="cb69-625"><a href="#cb69-625" aria-hidden="true" tabindex="-1"></a>    C -.-&gt;|Choose| P4</span>
<span id="cb69-626"><a href="#cb69-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-627"><a href="#cb69-627" aria-hidden="true" tabindex="-1"></a>    style A fill:<span class="co">#e6f3ff,stroke:#0066cc,stroke-width:2px</span></span>
<span id="cb69-628"><a href="#cb69-628" aria-hidden="true" tabindex="-1"></a>    style C fill:<span class="co">#ffe6e6,stroke:#cc0044,stroke-width:2px</span></span>
<span id="cb69-629"><a href="#cb69-629" aria-hidden="true" tabindex="-1"></a>    style E fill:<span class="co">#e6ffe6,stroke:#00aa44,stroke-width:2px</span></span>
<span id="cb69-630"><a href="#cb69-630" aria-hidden="true" tabindex="-1"></a>    style D fill:<span class="co">#fff4e6,stroke:#ff8800,stroke-width:2px</span></span>
<span id="cb69-631"><a href="#cb69-631" aria-hidden="true" tabindex="-1"></a>    style PhilippineCRS fill:<span class="co">#f0e6ff,stroke:#6666cc,stroke-width:2px</span></span>
<span id="cb69-632"><a href="#cb69-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-633"><a href="#cb69-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-634"><a href="#cb69-634" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb69-635"><a href="#cb69-635" aria-hidden="true" tabindex="-1"></a><span class="fu">## Philippine UTM Zones</span></span>
<span id="cb69-636"><a href="#cb69-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-637"><a href="#cb69-637" aria-hidden="true" tabindex="-1"></a>The Philippines spans **two UTM zones:**</span>
<span id="cb69-638"><a href="#cb69-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-639"><a href="#cb69-639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**UTM Zone 51N (EPSG:32651):** Covers western Philippines including Manila, Palawan, western Luzon, western Visayas</span>
<span id="cb69-640"><a href="#cb69-640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**UTM Zone 52N (EPSG:32652):** Covers eastern Philippines including Mindanao, eastern Visayas, Bicol</span>
<span id="cb69-641"><a href="#cb69-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-642"><a href="#cb69-642" aria-hidden="true" tabindex="-1"></a>**Rule of thumb:** Manila and most populated areas use Zone 51N. When in doubt, check your AOI's central longitude:</span>
<span id="cb69-643"><a href="#cb69-643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Longitude &lt; 120° → Zone 51N</span>
<span id="cb69-644"><a href="#cb69-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Longitude ≥ 120° → Zone 52N</span>
<span id="cb69-645"><a href="#cb69-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-646"><a href="#cb69-646" aria-hidden="true" tabindex="-1"></a>For national-scale analysis, **PRS92 (EPSG:3123)** is the Philippine standard.</span>
<span id="cb69-647"><a href="#cb69-647" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-648"><a href="#cb69-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-649"><a href="#cb69-649" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loading Philippine Administrative Boundaries</span></span>
<span id="cb69-650"><a href="#cb69-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-651"><a href="#cb69-651" aria-hidden="true" tabindex="-1"></a>Let's load provincial boundaries of the Philippines:</span>
<span id="cb69-652"><a href="#cb69-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-653"><a href="#cb69-653" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-654"><a href="#cb69-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: From Google Drive (if you uploaded data)</span></span>
<span id="cb69-655"><a href="#cb69-655" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> gpd.read_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/philippines_provinces.shp'</span>)</span>
<span id="cb69-656"><a href="#cb69-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-657"><a href="#cb69-657" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: From URL (using sample data from PhilGIS)</span></span>
<span id="cb69-658"><a href="#cb69-658" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/altcoder/philippines-json-maps/master/geojson/provinces/hires/BOHOL.json"</span></span>
<span id="cb69-659"><a href="#cb69-659" aria-hidden="true" tabindex="-1"></a>sample_province <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb69-660"><a href="#cb69-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-661"><a href="#cb69-661" aria-hidden="true" tabindex="-1"></a><span class="co"># For this example, let's use the sample</span></span>
<span id="cb69-662"><a href="#cb69-662" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> sample_province</span>
<span id="cb69-663"><a href="#cb69-663" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loaded successfully! ✓"</span>)</span>
<span id="cb69-664"><a href="#cb69-664" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span><span class="bu">type</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-665"><a href="#cb69-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-666"><a href="#cb69-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-667"><a href="#cb69-667" aria-hidden="true" tabindex="-1"></a>::: {.philippine-context}</span>
<span id="cb69-668"><a href="#cb69-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Philippine Geospatial Data Sources</span></span>
<span id="cb69-669"><a href="#cb69-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-670"><a href="#cb69-670" aria-hidden="true" tabindex="-1"></a>**Official Government Sources:**</span>
<span id="cb69-671"><a href="#cb69-671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**NAMRIA Geoportal:** Official administrative boundaries, topographic maps</span>
<span id="cb69-672"><a href="#cb69-672" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Website: https://www.namria.gov.ph/</span>
<span id="cb69-673"><a href="#cb69-673" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Note: May require registration for downloads</span>
<span id="cb69-674"><a href="#cb69-674" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PhilGIS:** Open-source Philippine GIS data repository</span>
<span id="cb69-675"><a href="#cb69-675" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Roads, rivers, boundaries, land use</span>
<span id="cb69-676"><a href="#cb69-676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PSA (Philippine Statistics Authority):** Statistical boundaries matching census data</span>
<span id="cb69-677"><a href="#cb69-677" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**LMB (Land Management Bureau):** Cadastral boundaries, land parcel data</span>
<span id="cb69-678"><a href="#cb69-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-679"><a href="#cb69-679" aria-hidden="true" tabindex="-1"></a>**Open Data Platforms:**</span>
<span id="cb69-680"><a href="#cb69-680" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**GADM:** Global Administrative Areas - free Philippine boundaries</span>
<span id="cb69-681"><a href="#cb69-681" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Website: https://gadm.org/download_country.html (select Philippines)</span>
<span id="cb69-682"><a href="#cb69-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**OpenStreetMap (OSM):** Roads, buildings, POIs, waterways</span>
<span id="cb69-683"><a href="#cb69-683" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Export via: https://export.hotosm.org/ or Overpass Turbo</span>
<span id="cb69-684"><a href="#cb69-684" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Humanitarian Data Exchange (HDX):** Disaster-related boundaries and data</span>
<span id="cb69-685"><a href="#cb69-685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PhilSA Data Portal:** Satellite-derived products and boundaries</span>
<span id="cb69-686"><a href="#cb69-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-687"><a href="#cb69-687" aria-hidden="true" tabindex="-1"></a>**Pro Tip:** Download shapefiles to your Google Drive <span class="in">`data/vector/`</span> folder before the session for offline access.</span>
<span id="cb69-688"><a href="#cb69-688" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-689"><a href="#cb69-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-690"><a href="#cb69-690" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspecting a GeoDataFrame</span></span>
<span id="cb69-691"><a href="#cb69-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-692"><a href="#cb69-692" aria-hidden="true" tabindex="-1"></a>**View first rows:**</span>
<span id="cb69-693"><a href="#cb69-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-694"><a href="#cb69-694" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-695"><a href="#cb69-695" aria-hidden="true" tabindex="-1"></a>gdf.head()</span>
<span id="cb69-696"><a href="#cb69-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-697"><a href="#cb69-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-698"><a href="#cb69-698" aria-hidden="true" tabindex="-1"></a>This shows:</span>
<span id="cb69-699"><a href="#cb69-699" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Attribute columns (NAME, PROVINCE, REGION, ADM1_EN, etc.)</span>
<span id="cb69-700"><a href="#cb69-700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**geometry column:** The shapes themselves (Polygon or MultiPolygon)</span>
<span id="cb69-701"><a href="#cb69-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-702"><a href="#cb69-702" aria-hidden="true" tabindex="-1"></a>**Check coordinate reference system:**</span>
<span id="cb69-703"><a href="#cb69-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-704"><a href="#cb69-704" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-705"><a href="#cb69-705" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS:"</span>, gdf.crs)</span>
<span id="cb69-706"><a href="#cb69-706" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS name:"</span>, gdf.crs.name <span class="cf">if</span> gdf.crs <span class="cf">else</span> <span class="st">"Not defined"</span>)</span>
<span id="cb69-707"><a href="#cb69-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-708"><a href="#cb69-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-709"><a href="#cb69-709" aria-hidden="true" tabindex="-1"></a>**Get basic information:**</span>
<span id="cb69-710"><a href="#cb69-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-711"><a href="#cb69-711" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-712"><a href="#cb69-712" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of features: </span><span class="sc">{</span><span class="bu">len</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-713"><a href="#cb69-713" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span><span class="bu">type</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-714"><a href="#cb69-714" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bounds (minx, miny, maxx, maxy): </span><span class="sc">{</span>gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-715"><a href="#cb69-715" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Columns:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">list</span>(gdf.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-716"><a href="#cb69-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-717"><a href="#cb69-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-718"><a href="#cb69-718" aria-hidden="true" tabindex="-1"></a>**Summary statistics:**</span>
<span id="cb69-719"><a href="#cb69-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-720"><a href="#cb69-720" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-721"><a href="#cb69-721" aria-hidden="true" tabindex="-1"></a>gdf.info()</span>
<span id="cb69-722"><a href="#cb69-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-723"><a href="#cb69-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-724"><a href="#cb69-724" aria-hidden="true" tabindex="-1"></a>**Understand geometry details:**</span>
<span id="cb69-725"><a href="#cb69-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-726"><a href="#cb69-726" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-727"><a href="#cb69-727" aria-hidden="true" tabindex="-1"></a><span class="co"># First geometry</span></span>
<span id="cb69-728"><a href="#cb69-728" aria-hidden="true" tabindex="-1"></a>first_geom <span class="op">=</span> gdf.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb69-729"><a href="#cb69-729" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>first_geom<span class="sc">.</span>geom_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-730"><a href="#cb69-730" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Is valid: </span><span class="sc">{</span>first_geom<span class="sc">.</span>is_valid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-731"><a href="#cb69-731" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinate count: </span><span class="sc">{</span><span class="bu">len</span>(first_geom.exterior.coords)<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># For Polygon</span></span>
<span id="cb69-732"><a href="#cb69-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-733"><a href="#cb69-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-734"><a href="#cb69-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Coordinate Reference Systems</span></span>
<span id="cb69-735"><a href="#cb69-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-736"><a href="#cb69-736" aria-hidden="true" tabindex="-1"></a>**Check current CRS:**</span>
<span id="cb69-737"><a href="#cb69-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-738"><a href="#cb69-738" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-739"><a href="#cb69-739" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original CRS:"</span>, gdf.crs)</span>
<span id="cb69-740"><a href="#cb69-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-741"><a href="#cb69-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-742"><a href="#cb69-742" aria-hidden="true" tabindex="-1"></a>**Reproject to UTM Zone 51N (for Manila area):**</span>
<span id="cb69-743"><a href="#cb69-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-744"><a href="#cb69-744" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-745"><a href="#cb69-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to UTM 51N for accurate distance/area calculations</span></span>
<span id="cb69-746"><a href="#cb69-746" aria-hidden="true" tabindex="-1"></a>gdf_utm <span class="op">=</span> gdf.to_crs(<span class="st">'EPSG:32651'</span>)</span>
<span id="cb69-747"><a href="#cb69-747" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reprojected CRS:"</span>, gdf_utm.crs)</span>
<span id="cb69-748"><a href="#cb69-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-749"><a href="#cb69-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare bounds in degrees vs meters</span></span>
<span id="cb69-750"><a href="#cb69-750" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Original bounds (degrees):"</span>, gdf.total_bounds)</span>
<span id="cb69-751"><a href="#cb69-751" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"UTM bounds (meters):"</span>, gdf_utm.total_bounds)</span>
<span id="cb69-752"><a href="#cb69-752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-753"><a href="#cb69-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-754"><a href="#cb69-754" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb69-755"><a href="#cb69-755" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to Use Which CRS?</span></span>
<span id="cb69-756"><a href="#cb69-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-757"><a href="#cb69-757" aria-hidden="true" tabindex="-1"></a>**Use Geographic CRS (EPSG:4326) for:**</span>
<span id="cb69-758"><a href="#cb69-758" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Loading data (most sources provide data in WGS84)</span>
<span id="cb69-759"><a href="#cb69-759" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Web mapping and visualization</span>
<span id="cb69-760"><a href="#cb69-760" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Storing data for sharing</span>
<span id="cb69-761"><a href="#cb69-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-762"><a href="#cb69-762" aria-hidden="true" tabindex="-1"></a>**Use Projected CRS (UTM or PRS92) for:**</span>
<span id="cb69-763"><a href="#cb69-763" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance calculations: <span class="in">`gdf.geometry.length`</span></span>
<span id="cb69-764"><a href="#cb69-764" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Area calculations: <span class="in">`gdf.geometry.area`</span></span>
<span id="cb69-765"><a href="#cb69-765" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Buffer operations: <span class="in">`gdf.geometry.buffer(1000)`</span> for 1 km buffer</span>
<span id="cb69-766"><a href="#cb69-766" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Spatial analysis requiring metric units</span>
<span id="cb69-767"><a href="#cb69-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-768"><a href="#cb69-768" aria-hidden="true" tabindex="-1"></a>**Workflow:**</span>
<span id="cb69-769"><a href="#cb69-769" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Load data (usually in EPSG:4326)</span>
<span id="cb69-770"><a href="#cb69-770" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Reproject to appropriate UTM zone</span>
<span id="cb69-771"><a href="#cb69-771" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Perform spatial operations</span>
<span id="cb69-772"><a href="#cb69-772" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Optionally reproject back to EPSG:4326 for web display</span>
<span id="cb69-773"><a href="#cb69-773" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-774"><a href="#cb69-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-775"><a href="#cb69-775" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating Geometric Properties</span></span>
<span id="cb69-776"><a href="#cb69-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-777"><a href="#cb69-777" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-778"><a href="#cb69-778" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area in square kilometers</span></span>
<span id="cb69-779"><a href="#cb69-779" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'area_km2'</span>] <span class="op">=</span> gdf_utm.geometry.area <span class="op">/</span> <span class="dv">1_000_000</span>  <span class="co"># m² to km²</span></span>
<span id="cb69-780"><a href="#cb69-780" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province area: </span><span class="sc">{</span>gdf_utm[<span class="st">'area_km2'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km²"</span>)</span>
<span id="cb69-781"><a href="#cb69-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-782"><a href="#cb69-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate perimeter</span></span>
<span id="cb69-783"><a href="#cb69-783" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'perimeter_km'</span>] <span class="op">=</span> gdf_utm.geometry.length <span class="op">/</span> <span class="dv">1000</span>  <span class="co"># m to km</span></span>
<span id="cb69-784"><a href="#cb69-784" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province perimeter: </span><span class="sc">{</span>gdf_utm[<span class="st">'perimeter_km'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km"</span>)</span>
<span id="cb69-785"><a href="#cb69-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-786"><a href="#cb69-786" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroid (in original CRS)</span></span>
<span id="cb69-787"><a href="#cb69-787" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>] <span class="op">=</span> gdf.geometry.centroid</span>
<span id="cb69-788"><a href="#cb69-788" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Centroid coordinates: </span><span class="sc">{</span>gdf[<span class="st">'centroid'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-789"><a href="#cb69-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-790"><a href="#cb69-790" aria-hidden="true" tabindex="-1"></a><span class="co"># Display updated GeoDataFrame</span></span>
<span id="cb69-791"><a href="#cb69-791" aria-hidden="true" tabindex="-1"></a>gdf_utm[[<span class="st">'area_km2'</span>, <span class="st">'perimeter_km'</span>]].head()</span>
<span id="cb69-792"><a href="#cb69-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-793"><a href="#cb69-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-794"><a href="#cb69-794" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering and Querying</span></span>
<span id="cb69-795"><a href="#cb69-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-796"><a href="#cb69-796" aria-hidden="true" tabindex="-1"></a>**Filter by attribute:**</span>
<span id="cb69-797"><a href="#cb69-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-798"><a href="#cb69-798" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-799"><a href="#cb69-799" aria-hidden="true" tabindex="-1"></a><span class="co"># If using multi-province dataset:</span></span>
<span id="cb69-800"><a href="#cb69-800" aria-hidden="true" tabindex="-1"></a><span class="co"># luzon_provinces = gdf[gdf['ISLAND'] == 'LUZON']</span></span>
<span id="cb69-801"><a href="#cb69-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-802"><a href="#cb69-802" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by area (if area column exists or was calculated)</span></span>
<span id="cb69-803"><a href="#cb69-803" aria-hidden="true" tabindex="-1"></a>large_provinces <span class="op">=</span> gdf_utm[gdf_utm[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>]</span>
<span id="cb69-804"><a href="#cb69-804" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Provinces larger than 5000 km²: </span><span class="sc">{</span><span class="bu">len</span>(large_provinces)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-805"><a href="#cb69-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-806"><a href="#cb69-806" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Select specific province by name</span></span>
<span id="cb69-807"><a href="#cb69-807" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> gdf[gdf[<span class="st">'NAME'</span>].<span class="bu">str</span>.contains(<span class="st">'Bohol'</span>, case<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb69-808"><a href="#cb69-808" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Selected: </span><span class="sc">{</span>target[<span class="st">'NAME'</span>]<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-809"><a href="#cb69-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-810"><a href="#cb69-810" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple conditions</span></span>
<span id="cb69-811"><a href="#cb69-811" aria-hidden="true" tabindex="-1"></a><span class="co"># coastal_large = gdf[(gdf['area_km2'] &gt; 3000) &amp; (gdf['coastal'] == True)]</span></span>
<span id="cb69-812"><a href="#cb69-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-813"><a href="#cb69-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-814"><a href="#cb69-814" aria-hidden="true" tabindex="-1"></a>**Spatial filtering:**</span>
<span id="cb69-815"><a href="#cb69-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-816"><a href="#cb69-816" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-817"><a href="#cb69-817" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if geometries are valid</span></span>
<span id="cb69-818"><a href="#cb69-818" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valid geometries: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span>is_valid<span class="sc">.</span><span class="bu">all</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-819"><a href="#cb69-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-820"><a href="#cb69-820" aria-hidden="true" tabindex="-1"></a><span class="co"># If invalid, fix them</span></span>
<span id="cb69-821"><a href="#cb69-821" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> gdf.geometry.is_valid.<span class="bu">all</span>():</span>
<span id="cb69-822"><a href="#cb69-822" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">'geometry'</span>] <span class="op">=</span> gdf.geometry.<span class="bu">buffer</span>(<span class="dv">0</span>)  <span class="co"># Common fix for invalid geometries</span></span>
<span id="cb69-823"><a href="#cb69-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-824"><a href="#cb69-824" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial predicate example: find features within a bounding box</span></span>
<span id="cb69-825"><a href="#cb69-825" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> (<span class="fl">123.5</span>, <span class="fl">9.5</span>, <span class="fl">125.0</span>, <span class="fl">11.0</span>)  <span class="co"># (minx, miny, maxx, maxy)</span></span>
<span id="cb69-826"><a href="#cb69-826" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb69-827"><a href="#cb69-827" aria-hidden="true" tabindex="-1"></a>bbox_geom <span class="op">=</span> box(<span class="op">*</span>bbox)</span>
<span id="cb69-828"><a href="#cb69-828" aria-hidden="true" tabindex="-1"></a>within_bbox <span class="op">=</span> gdf[gdf.geometry.within(bbox_geom)]</span>
<span id="cb69-829"><a href="#cb69-829" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features within bounding box: </span><span class="sc">{</span><span class="bu">len</span>(within_bbox)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-830"><a href="#cb69-830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-831"><a href="#cb69-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-832"><a href="#cb69-832" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Operations</span></span>
<span id="cb69-833"><a href="#cb69-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-834"><a href="#cb69-834" aria-hidden="true" tabindex="-1"></a>**Buffer (create zone around feature):**</span>
<span id="cb69-835"><a href="#cb69-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-836"><a href="#cb69-836" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-837"><a href="#cb69-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 km buffer around province (must use projected CRS!)</span></span>
<span id="cb69-838"><a href="#cb69-838" aria-hidden="true" tabindex="-1"></a>buffer_10km <span class="op">=</span> gdf_utm.geometry.<span class="bu">buffer</span>(<span class="dv">10000</span>)  <span class="co"># 10,000 meters</span></span>
<span id="cb69-839"><a href="#cb69-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-840"><a href="#cb69-840" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize original and buffer</span></span>
<span id="cb69-841"><a href="#cb69-841" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-842"><a href="#cb69-842" aria-hidden="true" tabindex="-1"></a>gdf_utm.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb69-843"><a href="#cb69-843" aria-hidden="true" tabindex="-1"></a>buffer_10km.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'10 km buffer'</span>)</span>
<span id="cb69-844"><a href="#cb69-844" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with 10 km Buffer"</span>)</span>
<span id="cb69-845"><a href="#cb69-845" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb69-846"><a href="#cb69-846" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-847"><a href="#cb69-847" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-848"><a href="#cb69-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-849"><a href="#cb69-849" aria-hidden="true" tabindex="-1"></a>**Dissolve (merge features):**</span>
<span id="cb69-850"><a href="#cb69-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-851"><a href="#cb69-851" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-852"><a href="#cb69-852" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces, dissolve by region</span></span>
<span id="cb69-853"><a href="#cb69-853" aria-hidden="true" tabindex="-1"></a><span class="co"># dissolved = gdf.dissolve(by='REGION', aggfunc='sum')  # Aggregates numeric columns</span></span>
<span id="cb69-854"><a href="#cb69-854" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-855"><a href="#cb69-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-856"><a href="#cb69-856" aria-hidden="true" tabindex="-1"></a>**Spatial joins:**</span>
<span id="cb69-857"><a href="#cb69-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-858"><a href="#cb69-858" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-859"><a href="#cb69-859" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Join point data to polygons (e.g., field sites to provinces)</span></span>
<span id="cb69-860"><a href="#cb69-860" aria-hidden="true" tabindex="-1"></a><span class="co"># points_gdf = gpd.read_file('field_sites.shp')</span></span>
<span id="cb69-861"><a href="#cb69-861" aria-hidden="true" tabindex="-1"></a><span class="co"># joined = gpd.sjoin(points_gdf, gdf, how='left', predicate='within')</span></span>
<span id="cb69-862"><a href="#cb69-862" aria-hidden="true" tabindex="-1"></a><span class="co"># This adds province attributes to each point based on which polygon contains it</span></span>
<span id="cb69-863"><a href="#cb69-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-864"><a href="#cb69-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-865"><a href="#cb69-865" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing Vector Data</span></span>
<span id="cb69-866"><a href="#cb69-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-867"><a href="#cb69-867" aria-hidden="true" tabindex="-1"></a>**Simple plot:**</span>
<span id="cb69-868"><a href="#cb69-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-869"><a href="#cb69-869" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-870"><a href="#cb69-870" aria-hidden="true" tabindex="-1"></a>gdf.plot(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), edgecolor<span class="op">=</span><span class="st">'black'</span>, facecolor<span class="op">=</span><span class="st">'lightblue'</span>)</span>
<span id="cb69-871"><a href="#cb69-871" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province, Philippines"</span>)</span>
<span id="cb69-872"><a href="#cb69-872" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb69-873"><a href="#cb69-873" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb69-874"><a href="#cb69-874" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-875"><a href="#cb69-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-876"><a href="#cb69-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-877"><a href="#cb69-877" aria-hidden="true" tabindex="-1"></a>**Styled plot with colors:**</span>
<span id="cb69-878"><a href="#cb69-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-879"><a href="#cb69-879" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-880"><a href="#cb69-880" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces with a classification column:</span></span>
<span id="cb69-881"><a href="#cb69-881" aria-hidden="true" tabindex="-1"></a><span class="co"># gdf.plot(column='REGION', legend=True, figsize=(10, 10),</span></span>
<span id="cb69-882"><a href="#cb69-882" aria-hidden="true" tabindex="-1"></a><span class="co">#          cmap='Set3', edgecolor='black', linewidth=0.5)</span></span>
<span id="cb69-883"><a href="#cb69-883" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title("Philippines Provinces by Region")</span></span>
<span id="cb69-884"><a href="#cb69-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-885"><a href="#cb69-885" aria-hidden="true" tabindex="-1"></a><span class="co"># For single feature, style it:</span></span>
<span id="cb69-886"><a href="#cb69-886" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb69-887"><a href="#cb69-887" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'#90EE90'</span>, edgecolor<span class="op">=</span><span class="st">'darkgreen'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb69-888"><a href="#cb69-888" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">50</span>, label<span class="op">=</span><span class="st">'Centroid'</span>)</span>
<span id="cb69-889"><a href="#cb69-889" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province with Centroid"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb69-890"><a href="#cb69-890" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb69-891"><a href="#cb69-891" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb69-892"><a href="#cb69-892" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb69-893"><a href="#cb69-893" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb69-894"><a href="#cb69-894" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-895"><a href="#cb69-895" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-896"><a href="#cb69-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-897"><a href="#cb69-897" aria-hidden="true" tabindex="-1"></a>**Interactive map with Folium:**</span>
<span id="cb69-898"><a href="#cb69-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-899"><a href="#cb69-899" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-900"><a href="#cb69-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Install folium if not already available</span></span>
<span id="cb69-901"><a href="#cb69-901" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install folium <span class="op">-</span>q</span>
<span id="cb69-902"><a href="#cb69-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-903"><a href="#cb69-903" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb69-904"><a href="#cb69-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-905"><a href="#cb69-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Get centroid for map center</span></span>
<span id="cb69-906"><a href="#cb69-906" aria-hidden="true" tabindex="-1"></a>centroid <span class="op">=</span> gdf.geometry.centroid.iloc[<span class="dv">0</span>]</span>
<span id="cb69-907"><a href="#cb69-907" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> [centroid.y, centroid.x]  <span class="co"># folium expects [lat, lon]</span></span>
<span id="cb69-908"><a href="#cb69-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-909"><a href="#cb69-909" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb69-910"><a href="#cb69-910" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>center, zoom_start<span class="op">=</span><span class="dv">9</span>, tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span>)</span>
<span id="cb69-911"><a href="#cb69-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-912"><a href="#cb69-912" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GeoDataFrame to map</span></span>
<span id="cb69-913"><a href="#cb69-913" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(</span>
<span id="cb69-914"><a href="#cb69-914" aria-hidden="true" tabindex="-1"></a>    gdf,</span>
<span id="cb69-915"><a href="#cb69-915" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">'Province Boundary'</span>,</span>
<span id="cb69-916"><a href="#cb69-916" aria-hidden="true" tabindex="-1"></a>    style_function<span class="op">=</span><span class="kw">lambda</span> x: {<span class="st">'fillColor'</span>: <span class="st">'lightblue'</span>, <span class="st">'color'</span>: <span class="st">'darkblue'</span>, <span class="st">'weight'</span>: <span class="dv">2</span>}</span>
<span id="cb69-917"><a href="#cb69-917" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb69-918"><a href="#cb69-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-919"><a href="#cb69-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Add marker at centroid</span></span>
<span id="cb69-920"><a href="#cb69-920" aria-hidden="true" tabindex="-1"></a>folium.Marker(</span>
<span id="cb69-921"><a href="#cb69-921" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>center,</span>
<span id="cb69-922"><a href="#cb69-922" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="st">'Province Centroid'</span>,</span>
<span id="cb69-923"><a href="#cb69-923" aria-hidden="true" tabindex="-1"></a>    icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'red'</span>, icon<span class="op">=</span><span class="st">'info-sign'</span>)</span>
<span id="cb69-924"><a href="#cb69-924" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb69-925"><a href="#cb69-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-926"><a href="#cb69-926" aria-hidden="true" tabindex="-1"></a><span class="co"># Display map</span></span>
<span id="cb69-927"><a href="#cb69-927" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb69-928"><a href="#cb69-928" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-929"><a href="#cb69-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-930"><a href="#cb69-930" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Area of Interest (AOI) Geometries</span></span>
<span id="cb69-931"><a href="#cb69-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-932"><a href="#cb69-932" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-933"><a href="#cb69-933" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, Point, LineString</span>
<span id="cb69-934"><a href="#cb69-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-935"><a href="#cb69-935" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple polygon AOI (example coordinates)</span></span>
<span id="cb69-936"><a href="#cb69-936" aria-hidden="true" tabindex="-1"></a>aoi_coords <span class="op">=</span> [</span>
<span id="cb69-937"><a href="#cb69-937" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>),   <span class="co"># Southwest corner</span></span>
<span id="cb69-938"><a href="#cb69-938" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">9.5</span>),   <span class="co"># Southeast corner</span></span>
<span id="cb69-939"><a href="#cb69-939" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">11.0</span>),  <span class="co"># Northeast corner</span></span>
<span id="cb69-940"><a href="#cb69-940" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">11.0</span>),  <span class="co"># Northwest corner</span></span>
<span id="cb69-941"><a href="#cb69-941" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>)    <span class="co"># Close polygon (first point repeated)</span></span>
<span id="cb69-942"><a href="#cb69-942" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb69-943"><a href="#cb69-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-944"><a href="#cb69-944" aria-hidden="true" tabindex="-1"></a>aoi_polygon <span class="op">=</span> Polygon(aoi_coords)</span>
<span id="cb69-945"><a href="#cb69-945" aria-hidden="true" tabindex="-1"></a>aoi_gdf <span class="op">=</span> gpd.GeoDataFrame([<span class="dv">1</span>], geometry<span class="op">=</span>[aoi_polygon], crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb69-946"><a href="#cb69-946" aria-hidden="true" tabindex="-1"></a>aoi_gdf.columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="st">'geometry'</span>]</span>
<span id="cb69-947"><a href="#cb69-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-948"><a href="#cb69-948" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize AOI with province</span></span>
<span id="cb69-949"><a href="#cb69-949" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-950"><a href="#cb69-950" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb69-951"><a href="#cb69-951" aria-hidden="true" tabindex="-1"></a>aoi_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'AOI'</span>)</span>
<span id="cb69-952"><a href="#cb69-952" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with Area of Interest (Red Box)"</span>)</span>
<span id="cb69-953"><a href="#cb69-953" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb69-954"><a href="#cb69-954" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-955"><a href="#cb69-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-956"><a href="#cb69-956" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AOI created successfully! ✓"</span>)</span>
<span id="cb69-957"><a href="#cb69-957" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AOI bounds: </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-958"><a href="#cb69-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-959"><a href="#cb69-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-960"><a href="#cb69-960" aria-hidden="true" tabindex="-1"></a>**Save AOI for later use:**</span>
<span id="cb69-961"><a href="#cb69-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-962"><a href="#cb69-962" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-963"><a href="#cb69-963" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as shapefile</span></span>
<span id="cb69-964"><a href="#cb69-964" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.shp'</span>)</span>
<span id="cb69-965"><a href="#cb69-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-966"><a href="#cb69-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as GeoJSON (more portable)</span></span>
<span id="cb69-967"><a href="#cb69-967" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.geojson'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span>
<span id="cb69-968"><a href="#cb69-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-969"><a href="#cb69-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-970"><a href="#cb69-970" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-971"><a href="#cb69-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-972"><a href="#cb69-972" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 6: Raster Data with Rasterio</span></span>
<span id="cb69-973"><a href="#cb69-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-974"><a href="#cb69-974" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is Raster Data?</span></span>
<span id="cb69-975"><a href="#cb69-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-976"><a href="#cb69-976" aria-hidden="true" tabindex="-1"></a>**Raster data is a grid of pixels (cells), each with a value:**</span>
<span id="cb69-977"><a href="#cb69-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-978"><a href="#cb69-978" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Satellite imagery:** Each pixel = reflectance values (0-10000 for Sentinel-2)</span>
<span id="cb69-979"><a href="#cb69-979" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**DEMs (Digital Elevation Models):** Each pixel = elevation in meters</span>
<span id="cb69-980"><a href="#cb69-980" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Temperature maps:** Each pixel = temperature value</span>
<span id="cb69-981"><a href="#cb69-981" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Classification maps:** Each pixel = land cover class ID</span>
<span id="cb69-982"><a href="#cb69-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-985"><a href="#cb69-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb69-986"><a href="#cb69-986" aria-hidden="true" tabindex="-1"></a>%%| fig-cap: <span class="ot">"</span><span class="st">Raster Data Processing Workflow with Rasterio</span><span class="ot">"</span></span>
<span id="cb69-987"><a href="#cb69-987" aria-hidden="true" tabindex="-1"></a>%%| fig-width: <span class="dv">100</span>%</span>
<span id="cb69-988"><a href="#cb69-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-989"><a href="#cb69-989" aria-hidden="true" tabindex="-1"></a>flowchart TD</span>
<span id="cb69-990"><a href="#cb69-990" aria-hidden="true" tabindex="-1"></a>    A[Sentinel<span class="dv">-2</span> GeoTIFF&lt;br/&gt;Multi-band raster&lt;br/&gt;<span class="dv">13</span> spectral bands] --&gt; B[Open with Rasterio&lt;br/&gt;rasterio.<span class="fu">open</span>]</span>
<span id="cb69-991"><a href="#cb69-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-992"><a href="#cb69-992" aria-hidden="true" tabindex="-1"></a>    B --&gt; C[Read Metadata&lt;br/&gt;CRS, Transform&lt;br/&gt;Bounds, Resolution&lt;br/&gt;Band count]</span>
<span id="cb69-993"><a href="#cb69-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-994"><a href="#cb69-994" aria-hidden="true" tabindex="-1"></a>    C --&gt; D[Read Band Data&lt;br/&gt;src.<span class="fu">read</span>&lt;br/&gt;NumPy arrays]</span>
<span id="cb69-995"><a href="#cb69-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-996"><a href="#cb69-996" aria-hidden="true" tabindex="-1"></a>    D --&gt; E{Processing&lt;br/&gt;Goal?}</span>
<span id="cb69-997"><a href="#cb69-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-998"><a href="#cb69-998" aria-hidden="true" tabindex="-1"></a>    E --&gt;|Calculate Index| F[NDVI Calculation&lt;br/&gt;NIR - Red / NIR + Red&lt;br/&gt;NumPy operations]</span>
<span id="cb69-999"><a href="#cb69-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1000"><a href="#cb69-1000" aria-hidden="true" tabindex="-1"></a>    E --&gt;|Create Composite| G[RGB Composite&lt;br/&gt;Stack bands&lt;br/&gt;Normalize <span class="fu">values</span>]</span>
<span id="cb69-1001"><a href="#cb69-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1002"><a href="#cb69-1002" aria-hidden="true" tabindex="-1"></a>    E --&gt;|Clip to AOI| H[Vector Mask&lt;br/&gt;GeoDataFrame boundary&lt;br/&gt;rasterio.mask.mask]</span>
<span id="cb69-1003"><a href="#cb69-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1004"><a href="#cb69-1004" aria-hidden="true" tabindex="-1"></a>    E --&gt;|Resample| I[Change Resolution&lt;br/&gt;Upsample/Downsample&lt;br/&gt;Resampling method]</span>
<span id="cb69-1005"><a href="#cb69-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1006"><a href="#cb69-1006" aria-hidden="true" tabindex="-1"></a>    F --&gt; J[Write Output&lt;br/&gt;rasterio.<span class="fu">open</span> <span class="ot">'</span><span class="ss">w</span><span class="ot">'</span>&lt;br/&gt;Copy metadata&lt;br/&gt;Write array]</span>
<span id="cb69-1007"><a href="#cb69-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1008"><a href="#cb69-1008" aria-hidden="true" tabindex="-1"></a>    G --&gt; J</span>
<span id="cb69-1009"><a href="#cb69-1009" aria-hidden="true" tabindex="-1"></a>    H --&gt; J</span>
<span id="cb69-1010"><a href="#cb69-1010" aria-hidden="true" tabindex="-1"></a>    I --&gt; J</span>
<span id="cb69-1011"><a href="#cb69-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1012"><a href="#cb69-1012" aria-hidden="true" tabindex="-1"></a>    J --&gt; K[New GeoTIFF&lt;br/&gt;Processed raster&lt;br/&gt;Ready <span class="kw">for</span> ML]</span>
<span id="cb69-1013"><a href="#cb69-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1014"><a href="#cb69-1014" aria-hidden="true" tabindex="-1"></a>    subgraph RasterOps[<span class="ot">"</span><span class="st">RASTER OPERATIONS</span><span class="ot">"</span>]</span>
<span id="cb69-1015"><a href="#cb69-1015" aria-hidden="true" tabindex="-1"></a>        R1[Arithmetic&lt;br/&gt;Add, Subtract&lt;br/&gt;Multiply, Divide]</span>
<span id="cb69-1016"><a href="#cb69-1016" aria-hidden="true" tabindex="-1"></a>        R2[Logical&lt;br/&gt;Masks, Filters&lt;br/&gt;Thresholds]</span>
<span id="cb69-1017"><a href="#cb69-1017" aria-hidden="true" tabindex="-1"></a>        R3[Statistics&lt;br/&gt;Mean, Std, Min&lt;br/&gt;Max, Percentiles]</span>
<span id="cb69-1018"><a href="#cb69-1018" aria-hidden="true" tabindex="-1"></a>        R4[Spatial&lt;br/&gt;Clip, Mosaic&lt;br/&gt;Reproject]</span>
<span id="cb69-1019"><a href="#cb69-1019" aria-hidden="true" tabindex="-1"></a>    end</span>
<span id="cb69-1020"><a href="#cb69-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1021"><a href="#cb69-1021" aria-hidden="true" tabindex="-1"></a>    D --&gt; RasterOps</span>
<span id="cb69-1022"><a href="#cb69-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1023"><a href="#cb69-1023" aria-hidden="true" tabindex="-1"></a>    style A fill:<span class="co">#e6f3ff,stroke:#0066cc,stroke-width:2px</span></span>
<span id="cb69-1024"><a href="#cb69-1024" aria-hidden="true" tabindex="-1"></a>    style C fill:<span class="co">#fff4e6,stroke:#ff8800,stroke-width:2px</span></span>
<span id="cb69-1025"><a href="#cb69-1025" aria-hidden="true" tabindex="-1"></a>    style D fill:<span class="co">#e6ffe6,stroke:#00aa44,stroke-width:2px</span></span>
<span id="cb69-1026"><a href="#cb69-1026" aria-hidden="true" tabindex="-1"></a>    style J fill:<span class="co">#ffe6ff,stroke:#cc00cc,stroke-width:2px</span></span>
<span id="cb69-1027"><a href="#cb69-1027" aria-hidden="true" tabindex="-1"></a>    style K fill:<span class="co">#ccffcc,stroke:#00aa44,stroke-width:2px</span></span>
<span id="cb69-1028"><a href="#cb69-1028" aria-hidden="true" tabindex="-1"></a>    style RasterOps fill:<span class="co">#ffe6e6,stroke:#cc0044,stroke-width:2px</span></span>
<span id="cb69-1029"><a href="#cb69-1029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1030"><a href="#cb69-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1031"><a href="#cb69-1031" aria-hidden="true" tabindex="-1"></a>**Common formats:** GeoTIFF (.tif, .tiff), NetCDF (.nc), HDF (.hdf, .h5), JPEG2000 (.jp2)</span>
<span id="cb69-1032"><a href="#cb69-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1033"><a href="#cb69-1033" aria-hidden="true" tabindex="-1"></a>**Raster structure:**</span>
<span id="cb69-1034"><a href="#cb69-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1035"><a href="#cb69-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1036"><a href="#cb69-1036" aria-hidden="true" tabindex="-1"></a><span class="in">┌─────┬─────┬─────┬─────┐</span></span>
<span id="cb69-1037"><a href="#cb69-1037" aria-hidden="true" tabindex="-1"></a><span class="in">│ 120 │ 130 │ 125 │ 118 │  ← Row 1 (top)</span></span>
<span id="cb69-1038"><a href="#cb69-1038" aria-hidden="true" tabindex="-1"></a><span class="in">├─────┼─────┼─────┼─────┤</span></span>
<span id="cb69-1039"><a href="#cb69-1039" aria-hidden="true" tabindex="-1"></a><span class="in">│ 115 │ 140 │ 135 │ 122 │  ← Row 2</span></span>
<span id="cb69-1040"><a href="#cb69-1040" aria-hidden="true" tabindex="-1"></a><span class="in">├─────┼─────┼─────┼─────┤</span></span>
<span id="cb69-1041"><a href="#cb69-1041" aria-hidden="true" tabindex="-1"></a><span class="in">│ 110 │ 125 │ 130 │ 119 │  ← Row 3 (bottom)</span></span>
<span id="cb69-1042"><a href="#cb69-1042" aria-hidden="true" tabindex="-1"></a><span class="in">└─────┴─────┴─────┴─────┘</span></span>
<span id="cb69-1043"><a href="#cb69-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  ↑     ↑     ↑     ↑</span></span>
<span id="cb69-1044"><a href="#cb69-1044" aria-hidden="true" tabindex="-1"></a><span class="in"> Col1  Col2  Col3  Col4</span></span>
<span id="cb69-1045"><a href="#cb69-1045" aria-hidden="true" tabindex="-1"></a><span class="in"> (left)           (right)</span></span>
<span id="cb69-1046"><a href="#cb69-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1047"><a href="#cb69-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1048"><a href="#cb69-1048" aria-hidden="true" tabindex="-1"></a>Each cell has:</span>
<span id="cb69-1049"><a href="#cb69-1049" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Value:** Reflectance, elevation, class, etc.</span>
<span id="cb69-1050"><a href="#cb69-1050" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Location:** Defined by geotransform + CRS</span>
<span id="cb69-1051"><a href="#cb69-1051" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Size:** Spatial resolution (e.g., 10m means 10m × 10m pixel)</span>
<span id="cb69-1052"><a href="#cb69-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1053"><a href="#cb69-1053" aria-hidden="true" tabindex="-1"></a>**Geotransform:** 6 coefficients that map pixel coordinates to geographic coordinates</span>
<span id="cb69-1054"><a href="#cb69-1054" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`[x_origin, x_pixel_size, x_rotation, y_origin, y_rotation, y_pixel_size]`</span></span>
<span id="cb69-1055"><a href="#cb69-1055" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Example: <span class="in">`[400000, 10, 0, 5000000, 0, -10]`</span> → Origin at (400000, 5000000) UTM, 10m pixels</span>
<span id="cb69-1056"><a href="#cb69-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1057"><a href="#cb69-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Sentinel-2 Bands and Resolution</span></span>
<span id="cb69-1058"><a href="#cb69-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1059"><a href="#cb69-1059" aria-hidden="true" tabindex="-1"></a>Before opening rasters, let's review Sentinel-2's band structure (from Session 1):</span>
<span id="cb69-1060"><a href="#cb69-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1061"><a href="#cb69-1061" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Band <span class="pp">|</span> Name <span class="pp">|</span> Wavelength (nm) <span class="pp">|</span> Resolution <span class="pp">|</span> Purpose <span class="pp">|</span></span>
<span id="cb69-1062"><a href="#cb69-1062" aria-hidden="true" tabindex="-1"></a><span class="pp">|------|------|-----------------|------------|---------|</span></span>
<span id="cb69-1063"><a href="#cb69-1063" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B1 <span class="pp">|</span> Coastal Aerosol <span class="pp">|</span> 443 <span class="pp">|</span> 60m <span class="pp">|</span> Atmospheric correction <span class="pp">|</span></span>
<span id="cb69-1064"><a href="#cb69-1064" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B2 <span class="pp">|</span> Blue <span class="pp">|</span> 490 <span class="pp">|</span> **10m** <span class="pp">|</span> Water body mapping, aerosol detection <span class="pp">|</span></span>
<span id="cb69-1065"><a href="#cb69-1065" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B3 <span class="pp">|</span> Green <span class="pp">|</span> 560 <span class="pp">|</span> **10m** <span class="pp">|</span> Vegetation vigor, water clarity <span class="pp">|</span></span>
<span id="cb69-1066"><a href="#cb69-1066" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B4 <span class="pp">|</span> Red <span class="pp">|</span> 665 <span class="pp">|</span> **10m** <span class="pp">|</span> Chlorophyll absorption <span class="pp">|</span></span>
<span id="cb69-1067"><a href="#cb69-1067" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B5 <span class="pp">|</span> Red Edge 1 <span class="pp">|</span> 705 <span class="pp">|</span> 20m <span class="pp">|</span> Vegetation classification <span class="pp">|</span></span>
<span id="cb69-1068"><a href="#cb69-1068" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B6 <span class="pp">|</span> Red Edge 2 <span class="pp">|</span> 740 <span class="pp">|</span> 20m <span class="pp">|</span> Vegetation stress <span class="pp">|</span></span>
<span id="cb69-1069"><a href="#cb69-1069" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B7 <span class="pp">|</span> Red Edge 3 <span class="pp">|</span> 783 <span class="pp">|</span> 20m <span class="pp">|</span> Vegetation monitoring <span class="pp">|</span></span>
<span id="cb69-1070"><a href="#cb69-1070" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B8 <span class="pp">|</span> NIR <span class="pp">|</span> 842 <span class="pp">|</span> **10m** <span class="pp">|</span> Biomass, vegetation health <span class="pp">|</span></span>
<span id="cb69-1071"><a href="#cb69-1071" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B8A <span class="pp">|</span> Narrow NIR <span class="pp">|</span> 865 <span class="pp">|</span> 20m <span class="pp">|</span> Atmospheric correction <span class="pp">|</span></span>
<span id="cb69-1072"><a href="#cb69-1072" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B9 <span class="pp">|</span> Water Vapor <span class="pp">|</span> 945 <span class="pp">|</span> 60m <span class="pp">|</span> Atmospheric correction <span class="pp">|</span></span>
<span id="cb69-1073"><a href="#cb69-1073" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B10 <span class="pp">|</span> Cirrus <span class="pp">|</span> 1373 <span class="pp">|</span> 60m <span class="pp">|</span> Cirrus cloud detection <span class="pp">|</span></span>
<span id="cb69-1074"><a href="#cb69-1074" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B11 <span class="pp">|</span> SWIR 1 <span class="pp">|</span> 1610 <span class="pp">|</span> 20m <span class="pp">|</span> Snow/ice/cloud discrimination <span class="pp">|</span></span>
<span id="cb69-1075"><a href="#cb69-1075" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> B12 <span class="pp">|</span> SWIR 2 <span class="pp">|</span> 2190 <span class="pp">|</span> 20m <span class="pp">|</span> Vegetation moisture <span class="pp">|</span></span>
<span id="cb69-1076"><a href="#cb69-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1077"><a href="#cb69-1077" aria-hidden="true" tabindex="-1"></a>**Key bands for this session:**</span>
<span id="cb69-1078"><a href="#cb69-1078" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**10m bands (B2, B3, B4, B8):** Best for detailed analysis, vegetation indices</span>
<span id="cb69-1079"><a href="#cb69-1079" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**20m bands (B5-B7, B8A, B11-B12):** Useful for spectral indices requiring SWIR</span>
<span id="cb69-1080"><a href="#cb69-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**60m bands (B1, B9, B10):** Mostly for atmospheric correction, rarely used in analysis</span>
<span id="cb69-1081"><a href="#cb69-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1082"><a href="#cb69-1082" aria-hidden="true" tabindex="-1"></a><span class="fu">### Opening a Raster File</span></span>
<span id="cb69-1083"><a href="#cb69-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1084"><a href="#cb69-1084" aria-hidden="true" tabindex="-1"></a>**Example: Sentinel-2 imagery subset**</span>
<span id="cb69-1085"><a href="#cb69-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1086"><a href="#cb69-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1087"><a href="#cb69-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster path (adjust to your data location)</span></span>
<span id="cb69-1088"><a href="#cb69-1088" aria-hidden="true" tabindex="-1"></a><span class="co"># For demo, we'll show the workflow with a hypothetical path</span></span>
<span id="cb69-1089"><a href="#cb69-1089" aria-hidden="true" tabindex="-1"></a>raster_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/data/raster/sentinel2_bohol_subset.tif'</span></span>
<span id="cb69-1090"><a href="#cb69-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1091"><a href="#cb69-1091" aria-hidden="true" tabindex="-1"></a><span class="co"># In real workflow, you'd download Sentinel-2 from Copernicus or GEE</span></span>
<span id="cb69-1092"><a href="#cb69-1092" aria-hidden="true" tabindex="-1"></a><span class="co"># For now, let's demonstrate with metadata inspection</span></span>
<span id="cb69-1093"><a href="#cb69-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1094"><a href="#cb69-1094" aria-hidden="true" tabindex="-1"></a><span class="co"># Open raster and view metadata</span></span>
<span id="cb69-1095"><a href="#cb69-1095" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb69-1096"><a href="#cb69-1096" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> rasterio.<span class="bu">open</span>(raster_path)</span>
<span id="cb69-1097"><a href="#cb69-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1098"><a href="#cb69-1098" aria-hidden="true" tabindex="-1"></a>    <span class="co"># View metadata</span></span>
<span id="cb69-1099"><a href="#cb69-1099" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Raster Metadata:"</span>)</span>
<span id="cb69-1100"><a href="#cb69-1100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Driver: </span><span class="sc">{</span>src<span class="sc">.</span>driver<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1101"><a href="#cb69-1101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Width (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1102"><a href="#cb69-1102" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Height (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1103"><a href="#cb69-1103" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1104"><a href="#cb69-1104" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Data type: </span><span class="sc">{</span>src<span class="sc">.</span>dtypes[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1105"><a href="#cb69-1105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1106"><a href="#cb69-1106" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1107"><a href="#cb69-1107" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Transform:</span><span class="ch">\n</span><span class="sc">{</span>src<span class="sc">.</span>transform<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1108"><a href="#cb69-1108" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (x_res, y_res) in CRS units</span></span>
<span id="cb69-1109"><a href="#cb69-1109" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Nodata value: </span><span class="sc">{</span>src<span class="sc">.</span>nodata<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1110"><a href="#cb69-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1111"><a href="#cb69-1111" aria-hidden="true" tabindex="-1"></a>    src.close()</span>
<span id="cb69-1112"><a href="#cb69-1112" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb69-1113"><a href="#cb69-1113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Sample raster file not found. We'll use a demonstration dataset."</span>)</span>
<span id="cb69-1114"><a href="#cb69-1114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"In practice, you'd download Sentinel-2 data from Copernicus Data Space Ecosystem or Google Earth Engine."</span>)</span>
<span id="cb69-1115"><a href="#cb69-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1116"><a href="#cb69-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1117"><a href="#cb69-1117" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb69-1118"><a href="#cb69-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Raster Metadata</span></span>
<span id="cb69-1119"><a href="#cb69-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1120"><a href="#cb69-1120" aria-hidden="true" tabindex="-1"></a>**For a Sentinel-2 10m band over Bohol (hypothetical):**</span>
<span id="cb69-1121"><a href="#cb69-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1122"><a href="#cb69-1122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Width/Height:** 5490 x 5490 pixels → 54.9km x 54.9km area (standard Sentinel-2 tile)</span>
<span id="cb69-1123"><a href="#cb69-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bands:** 1 (if single band file) or 4 (if RGB+NIR stack)</span>
<span id="cb69-1124"><a href="#cb69-1124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data type:** uint16 (unsigned 16-bit integer, range 0-65535)</span>
<span id="cb69-1125"><a href="#cb69-1125" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Sentinel-2 L2A: Reflectance scaled by 10000 (value 5000 = 50% reflectance)</span>
<span id="cb69-1126"><a href="#cb69-1126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**CRS:** EPSG:32651 (UTM Zone 51N for western Philippines)</span>
<span id="cb69-1127"><a href="#cb69-1127" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Resolution:** (10.0, -10.0) meters</span>
<span id="cb69-1128"><a href="#cb69-1128" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Positive x-resolution: columns go west to east</span>
<span id="cb69-1129"><a href="#cb69-1129" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Negative y-resolution: rows go north to south (standard in GeoTIFF)</span>
<span id="cb69-1130"><a href="#cb69-1130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nodata:** 0 or 65535 (no valid data, masked areas)</span>
<span id="cb69-1131"><a href="#cb69-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1132"><a href="#cb69-1132" aria-hidden="true" tabindex="-1"></a>**Transform (Affine):**</span>
<span id="cb69-1133"><a href="#cb69-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1134"><a href="#cb69-1134" aria-hidden="true" tabindex="-1"></a><span class="in">| x_pixel_size  0.0            x_origin |</span></span>
<span id="cb69-1135"><a href="#cb69-1135" aria-hidden="true" tabindex="-1"></a><span class="in">| 0.0          -y_pixel_size   y_origin |</span></span>
<span id="cb69-1136"><a href="#cb69-1136" aria-hidden="true" tabindex="-1"></a><span class="in">| 0.0           0.0            1.0      |</span></span>
<span id="cb69-1137"><a href="#cb69-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1138"><a href="#cb69-1138" aria-hidden="true" tabindex="-1"></a>Maps pixel coordinates (row, col) to real-world coordinates (x, y).</span>
<span id="cb69-1139"><a href="#cb69-1139" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-1140"><a href="#cb69-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1141"><a href="#cb69-1141" aria-hidden="true" tabindex="-1"></a>**Better pattern: Context manager (auto-closes file):**</span>
<span id="cb69-1142"><a href="#cb69-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1143"><a href="#cb69-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1144"><a href="#cb69-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># Context manager ensures file is closed even if error occurs</span></span>
<span id="cb69-1145"><a href="#cb69-1145" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1146"><a href="#cb69-1146" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Opened: </span><span class="sc">{</span>src<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1147"><a href="#cb69-1147" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1148"><a href="#cb69-1148" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1149"><a href="#cb69-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># File automatically closed after 'with' block - prevents memory leaks!</span></span>
<span id="cb69-1150"><a href="#cb69-1150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1151"><a href="#cb69-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1152"><a href="#cb69-1152" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reading Raster Data into Arrays</span></span>
<span id="cb69-1153"><a href="#cb69-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1154"><a href="#cb69-1154" aria-hidden="true" tabindex="-1"></a>**Read a single band:**</span>
<span id="cb69-1155"><a href="#cb69-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1156"><a href="#cb69-1156" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1157"><a href="#cb69-1157" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1158"><a href="#cb69-1158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read band 1 (Rasterio uses 1-indexing for bands!)</span></span>
<span id="cb69-1159"><a href="#cb69-1159" aria-hidden="true" tabindex="-1"></a>    band1 <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb69-1160"><a href="#cb69-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1161"><a href="#cb69-1161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for later use</span></span>
<span id="cb69-1162"><a href="#cb69-1162" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile</span>
<span id="cb69-1163"><a href="#cb69-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1164"><a href="#cb69-1164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Band 1 shape: </span><span class="sc">{</span>band1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span>
<span id="cb69-1165"><a href="#cb69-1165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span>band1<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1166"><a href="#cb69-1166" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">, Max value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1167"><a href="#cb69-1167" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean value: </span><span class="sc">{</span>band1<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb69-1168"><a href="#cb69-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1169"><a href="#cb69-1169" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask nodata values</span></span>
<span id="cb69-1170"><a href="#cb69-1170" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> profile[<span class="st">'nodata'</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-1171"><a href="#cb69-1171" aria-hidden="true" tabindex="-1"></a>    band1_masked <span class="op">=</span> np.ma.masked_equal(band1, profile[<span class="st">'nodata'</span>])</span>
<span id="cb69-1172"><a href="#cb69-1172" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean (excluding nodata): </span><span class="sc">{</span>band1_masked<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb69-1173"><a href="#cb69-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1174"><a href="#cb69-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1175"><a href="#cb69-1175" aria-hidden="true" tabindex="-1"></a>**Read multiple bands:**</span>
<span id="cb69-1176"><a href="#cb69-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1177"><a href="#cb69-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1178"><a href="#cb69-1178" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1179"><a href="#cb69-1179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read all bands as 3D array (bands, height, width)</span></span>
<span id="cb69-1180"><a href="#cb69-1180" aria-hidden="true" tabindex="-1"></a>    all_bands <span class="op">=</span> src.read()</span>
<span id="cb69-1181"><a href="#cb69-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1182"><a href="#cb69-1182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Or read specific bands</span></span>
<span id="cb69-1183"><a href="#cb69-1183" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># Band 1: Blue (B2 for Sentinel-2)</span></span>
<span id="cb69-1184"><a href="#cb69-1184" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># Band 2: Green (B3)</span></span>
<span id="cb69-1185"><a href="#cb69-1185" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># Band 3: Red (B4)</span></span>
<span id="cb69-1186"><a href="#cb69-1186" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># Band 4: NIR (B8)</span></span>
<span id="cb69-1187"><a href="#cb69-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1188"><a href="#cb69-1188" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"All bands shape: </span><span class="sc">{</span>all_bands<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (4, height, width)</span></span>
<span id="cb69-1189"><a href="#cb69-1189" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Individual band shape: </span><span class="sc">{</span>blue<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span>
<span id="cb69-1190"><a href="#cb69-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1191"><a href="#cb69-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1192"><a href="#cb69-1192" aria-hidden="true" tabindex="-1"></a>**Windowed reading (memory-efficient for large files):**</span>
<span id="cb69-1193"><a href="#cb69-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1194"><a href="#cb69-1194" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1195"><a href="#cb69-1195" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> Window</span>
<span id="cb69-1196"><a href="#cb69-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1197"><a href="#cb69-1197" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1198"><a href="#cb69-1198" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read a 1000x1000 pixel window starting at row 500, col 500</span></span>
<span id="cb69-1199"><a href="#cb69-1199" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> Window(col_off<span class="op">=</span><span class="dv">500</span>, row_off<span class="op">=</span><span class="dv">500</span>, width<span class="op">=</span><span class="dv">1000</span>, height<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb69-1200"><a href="#cb69-1200" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb69-1201"><a href="#cb69-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1202"><a href="#cb69-1202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Subset shape: </span><span class="sc">{</span>subset<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (1000, 1000)</span></span>
<span id="cb69-1203"><a href="#cb69-1203" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Memory saved by reading only needed area!"</span>)</span>
<span id="cb69-1204"><a href="#cb69-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1205"><a href="#cb69-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1206"><a href="#cb69-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating Spectral Indices</span></span>
<span id="cb69-1207"><a href="#cb69-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1208"><a href="#cb69-1208" aria-hidden="true" tabindex="-1"></a>Spectral indices combine bands to highlight specific features. Let's implement the most common indices.</span>
<span id="cb69-1209"><a href="#cb69-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1210"><a href="#cb69-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">#### NDVI (Normalized Difference Vegetation Index)</span></span>
<span id="cb69-1211"><a href="#cb69-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1212"><a href="#cb69-1212" aria-hidden="true" tabindex="-1"></a>**Formula:** NDVI = (NIR - Red) / (NIR + Red)</span>
<span id="cb69-1213"><a href="#cb69-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1214"><a href="#cb69-1214" aria-hidden="true" tabindex="-1"></a>**For Sentinel-2:** NDVI = (B8 - B4) / (B8 + B4)</span>
<span id="cb69-1215"><a href="#cb69-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1216"><a href="#cb69-1216" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1217"><a href="#cb69-1217" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1218"><a href="#cb69-1218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read bands as float to avoid integer overflow</span></span>
<span id="cb69-1219"><a href="#cb69-1219" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb69-1220"><a href="#cb69-1220" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb69-1221"><a href="#cb69-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1222"><a href="#cb69-1222" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for saving later</span></span>
<span id="cb69-1223"><a href="#cb69-1223" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb69-1224"><a href="#cb69-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1225"><a href="#cb69-1225" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI</span></span>
<span id="cb69-1226"><a href="#cb69-1226" aria-hidden="true" tabindex="-1"></a><span class="co"># Add small value to prevent division by zero</span></span>
<span id="cb69-1227"><a href="#cb69-1227" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-1228"><a href="#cb69-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1229"><a href="#cb69-1229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI range: </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb69-1230"><a href="#cb69-1230" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI mean: </span><span class="sc">{</span>ndvi<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb69-1231"><a href="#cb69-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1232"><a href="#cb69-1232" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize NDVI</span></span>
<span id="cb69-1233"><a href="#cb69-1233" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-1234"><a href="#cb69-1234" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-1235"><a href="#cb69-1235" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-1236"><a href="#cb69-1236" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDVI - Vegetation Index"</span>)</span>
<span id="cb69-1237"><a href="#cb69-1237" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Column (pixels)"</span>)</span>
<span id="cb69-1238"><a href="#cb69-1238" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Row (pixels)"</span>)</span>
<span id="cb69-1239"><a href="#cb69-1239" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1240"><a href="#cb69-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1241"><a href="#cb69-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1242"><a href="#cb69-1242" aria-hidden="true" tabindex="-1"></a>**NDVI interpretation:**</span>
<span id="cb69-1243"><a href="#cb69-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1244"><a href="#cb69-1244" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> NDVI Range <span class="pp">|</span> Surface Type <span class="pp">|</span></span>
<span id="cb69-1245"><a href="#cb69-1245" aria-hidden="true" tabindex="-1"></a><span class="pp">|------------|--------------|</span></span>
<span id="cb69-1246"><a href="#cb69-1246" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **&lt; 0** <span class="pp">|</span> Water, clouds, snow <span class="pp">|</span></span>
<span id="cb69-1247"><a href="#cb69-1247" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **0 - 0.2** <span class="pp">|</span> Bare soil, rock, sand, urban areas <span class="pp">|</span></span>
<span id="cb69-1248"><a href="#cb69-1248" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **0.2 - 0.4** <span class="pp">|</span> Sparse vegetation, grassland, shrubland <span class="pp">|</span></span>
<span id="cb69-1249"><a href="#cb69-1249" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **0.4 - 0.7** <span class="pp">|</span> Moderate vegetation, cropland, forest <span class="pp">|</span></span>
<span id="cb69-1250"><a href="#cb69-1250" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **&gt; 0.7** <span class="pp">|</span> Dense vegetation, healthy forest, mature crops <span class="pp">|</span></span>
<span id="cb69-1251"><a href="#cb69-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1252"><a href="#cb69-1252" aria-hidden="true" tabindex="-1"></a>::: {.philippine-context}</span>
<span id="cb69-1253"><a href="#cb69-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Philippine Application: Rice Paddy Monitoring</span></span>
<span id="cb69-1254"><a href="#cb69-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1255"><a href="#cb69-1255" aria-hidden="true" tabindex="-1"></a>Rice paddies show characteristic NDVI patterns during growing season:</span>
<span id="cb69-1256"><a href="#cb69-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1257"><a href="#cb69-1257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flooding/transplanting:** Low NDVI (0.1-0.3) - water and sparse seedlings</span>
<span id="cb69-1258"><a href="#cb69-1258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Vegetative growth:** Rising NDVI (0.4-0.6) - canopy development</span>
<span id="cb69-1259"><a href="#cb69-1259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Peak growth:** High NDVI (0.6-0.8) - maximum biomass</span>
<span id="cb69-1260"><a href="#cb69-1260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Senescence/harvest:** Declining NDVI (0.3-0.5) - yellowing and harvest</span>
<span id="cb69-1261"><a href="#cb69-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1262"><a href="#cb69-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1263"><a href="#cb69-1263" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify rice paddies (moderate-high NDVI during growing season)</span></span>
<span id="cb69-1264"><a href="#cb69-1264" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (ndvi <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.85</span>)</span>
<span id="cb69-1265"><a href="#cb69-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1266"><a href="#cb69-1266" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-1267"><a href="#cb69-1267" aria-hidden="true" tabindex="-1"></a>plt.imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb69-1268"><a href="#cb69-1268" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Potential Rice Paddies (NDVI 0.5-0.85)"</span>)</span>
<span id="cb69-1269"><a href="#cb69-1269" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb69-1270"><a href="#cb69-1270" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1271"><a href="#cb69-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1272"><a href="#cb69-1272" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb69-1273"><a href="#cb69-1273" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> rice_mask.size</span>
<span id="cb69-1274"><a href="#cb69-1274" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb69-1275"><a href="#cb69-1275" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># m² to hectares</span></span>
<span id="cb69-1276"><a href="#cb69-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1277"><a href="#cb69-1277" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice paddies: </span><span class="sc">{</span>rice_pixels<span class="sc">:,}</span><span class="ss"> pixels (</span><span class="sc">{</span>rice_pixels<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb69-1278"><a href="#cb69-1278" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb69-1279"><a href="#cb69-1279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1280"><a href="#cb69-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1281"><a href="#cb69-1281" aria-hidden="true" tabindex="-1"></a>**Operational use:** PRiSM uses similar SAR-based approaches for nationwide rice monitoring.</span>
<span id="cb69-1282"><a href="#cb69-1282" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-1283"><a href="#cb69-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1284"><a href="#cb69-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">#### EVI (Enhanced Vegetation Index)</span></span>
<span id="cb69-1285"><a href="#cb69-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1286"><a href="#cb69-1286" aria-hidden="true" tabindex="-1"></a>**Formula:** EVI = 2.5 × ((NIR - Red) / (NIR + 6×Red - 7.5×Blue + 1))</span>
<span id="cb69-1287"><a href="#cb69-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1288"><a href="#cb69-1288" aria-hidden="true" tabindex="-1"></a>**Advantages over NDVI:**</span>
<span id="cb69-1289"><a href="#cb69-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Less saturated in dense vegetation</span>
<span id="cb69-1290"><a href="#cb69-1290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Better atmospheric correction</span>
<span id="cb69-1291"><a href="#cb69-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduces soil background effects</span>
<span id="cb69-1292"><a href="#cb69-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1293"><a href="#cb69-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1294"><a href="#cb69-1294" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1295"><a href="#cb69-1295" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>).astype(<span class="bu">float</span>)  <span class="co"># B2</span></span>
<span id="cb69-1296"><a href="#cb69-1296" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb69-1297"><a href="#cb69-1297" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb69-1298"><a href="#cb69-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1299"><a href="#cb69-1299" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate EVI</span></span>
<span id="cb69-1300"><a href="#cb69-1300" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb69-1301"><a href="#cb69-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1302"><a href="#cb69-1302" aria-hidden="true" tabindex="-1"></a><span class="co"># Typical EVI range is -1 to 1, but often 0 to 1 for vegetation</span></span>
<span id="cb69-1303"><a href="#cb69-1303" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> np.clip(evi, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Clip extreme values</span></span>
<span id="cb69-1304"><a href="#cb69-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1305"><a href="#cb69-1305" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-1306"><a href="#cb69-1306" aria-hidden="true" tabindex="-1"></a>plt.imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-1307"><a href="#cb69-1307" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'EVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-1308"><a href="#cb69-1308" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"EVI - Enhanced Vegetation Index"</span>)</span>
<span id="cb69-1309"><a href="#cb69-1309" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1310"><a href="#cb69-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1311"><a href="#cb69-1311" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"EVI range: </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb69-1312"><a href="#cb69-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1313"><a href="#cb69-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1314"><a href="#cb69-1314" aria-hidden="true" tabindex="-1"></a><span class="fu">#### NDWI (Normalized Difference Water Index)</span></span>
<span id="cb69-1315"><a href="#cb69-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1316"><a href="#cb69-1316" aria-hidden="true" tabindex="-1"></a>**Formula:** NDWI = (Green - NIR) / (Green + NIR)</span>
<span id="cb69-1317"><a href="#cb69-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1318"><a href="#cb69-1318" aria-hidden="true" tabindex="-1"></a>**For Sentinel-2:** NDWI = (B3 - B8) / (B3 + B8)</span>
<span id="cb69-1319"><a href="#cb69-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1320"><a href="#cb69-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1321"><a href="#cb69-1321" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1322"><a href="#cb69-1322" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>).astype(<span class="bu">float</span>)  <span class="co"># B3</span></span>
<span id="cb69-1323"><a href="#cb69-1323" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)    <span class="co"># B8</span></span>
<span id="cb69-1324"><a href="#cb69-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1325"><a href="#cb69-1325" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDWI</span></span>
<span id="cb69-1326"><a href="#cb69-1326" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-1327"><a href="#cb69-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1328"><a href="#cb69-1328" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb69-1329"><a href="#cb69-1329" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-1330"><a href="#cb69-1330" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDWI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-1331"><a href="#cb69-1331" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDWI - Water Index"</span>)</span>
<span id="cb69-1332"><a href="#cb69-1332" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1333"><a href="#cb69-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1334"><a href="#cb69-1334" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract water bodies (NDWI &gt; 0.3 typically indicates water)</span></span>
<span id="cb69-1335"><a href="#cb69-1335" aria-hidden="true" tabindex="-1"></a>water_mask <span class="op">=</span> ndwi <span class="op">&gt;</span> <span class="fl">0.3</span></span>
<span id="cb69-1336"><a href="#cb69-1336" aria-hidden="true" tabindex="-1"></a>water_pixels <span class="op">=</span> water_mask.<span class="bu">sum</span>()</span>
<span id="cb69-1337"><a href="#cb69-1337" aria-hidden="true" tabindex="-1"></a>water_area_ha <span class="op">=</span> (water_pixels <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># 10m pixels, convert to hectares</span></span>
<span id="cb69-1338"><a href="#cb69-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1339"><a href="#cb69-1339" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water pixels: </span><span class="sc">{</span>water_pixels<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb69-1340"><a href="#cb69-1340" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water area: </span><span class="sc">{</span>water_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb69-1341"><a href="#cb69-1341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1342"><a href="#cb69-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1343"><a href="#cb69-1343" aria-hidden="true" tabindex="-1"></a>**NDWI interpretation:**</span>
<span id="cb69-1344"><a href="#cb69-1344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**&gt; 0.3:** Open water (rivers, lakes, reservoirs)</span>
<span id="cb69-1345"><a href="#cb69-1345" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**0.0 - 0.3:** Wet soil, flooded vegetation</span>
<span id="cb69-1346"><a href="#cb69-1346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**&lt; 0:** Dry soil, vegetation</span>
<span id="cb69-1347"><a href="#cb69-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1348"><a href="#cb69-1348" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating RGB and False Color Composites</span></span>
<span id="cb69-1349"><a href="#cb69-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1350"><a href="#cb69-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">#### True Color Composite (Red, Green, Blue)</span></span>
<span id="cb69-1351"><a href="#cb69-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1352"><a href="#cb69-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1353"><a href="#cb69-1353" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1354"><a href="#cb69-1354" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb69-1355"><a href="#cb69-1355" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb69-1356"><a href="#cb69-1356" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># B2</span></span>
<span id="cb69-1357"><a href="#cb69-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1358"><a href="#cb69-1358" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack bands into RGB array (height, width, 3)</span></span>
<span id="cb69-1359"><a href="#cb69-1359" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb69-1360"><a href="#cb69-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1361"><a href="#cb69-1361" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale to 0-1 range for display</span></span>
<span id="cb69-1362"><a href="#cb69-1362" aria-hidden="true" tabindex="-1"></a><span class="co"># Sentinel-2 L2A surface reflectance: 0-10000</span></span>
<span id="cb69-1363"><a href="#cb69-1363" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> rgb.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb69-1364"><a href="#cb69-1364" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> np.clip(rgb_scaled, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Clip any values outside 0-1</span></span>
<span id="cb69-1365"><a href="#cb69-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1366"><a href="#cb69-1366" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhance contrast using percentile stretch</span></span>
<span id="cb69-1367"><a href="#cb69-1367" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> scoreatpercentile</span>
<span id="cb69-1368"><a href="#cb69-1368" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentile_stretch(image, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>):</span>
<span id="cb69-1369"><a href="#cb69-1369" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Stretch image values between percentiles for better visualization."""</span></span>
<span id="cb69-1370"><a href="#cb69-1370" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> np.zeros_like(image, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb69-1371"><a href="#cb69-1371" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(image.shape[<span class="dv">2</span>]):</span>
<span id="cb69-1372"><a href="#cb69-1372" aria-hidden="true" tabindex="-1"></a>        band <span class="op">=</span> image[:,:,i]</span>
<span id="cb69-1373"><a href="#cb69-1373" aria-hidden="true" tabindex="-1"></a>        low, high <span class="op">=</span> scoreatpercentile(band, (lower, upper))</span>
<span id="cb69-1374"><a href="#cb69-1374" aria-hidden="true" tabindex="-1"></a>        out[:,:,i] <span class="op">=</span> np.clip((band <span class="op">-</span> low) <span class="op">/</span> (high <span class="op">-</span> low), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb69-1375"><a href="#cb69-1375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb69-1376"><a href="#cb69-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1377"><a href="#cb69-1377" aria-hidden="true" tabindex="-1"></a>rgb_enhanced <span class="op">=</span> percentile_stretch(rgb_scaled, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>)</span>
<span id="cb69-1378"><a href="#cb69-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1379"><a href="#cb69-1379" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb69-1380"><a href="#cb69-1380" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">7</span>))</span>
<span id="cb69-1381"><a href="#cb69-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1382"><a href="#cb69-1382" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].imshow(rgb_scaled)</span>
<span id="cb69-1383"><a href="#cb69-1383" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"True Color (Linear Stretch)"</span>)</span>
<span id="cb69-1384"><a href="#cb69-1384" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-1385"><a href="#cb69-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1386"><a href="#cb69-1386" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(rgb_enhanced)</span>
<span id="cb69-1387"><a href="#cb69-1387" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"True Color (Enhanced Contrast)"</span>)</span>
<span id="cb69-1388"><a href="#cb69-1388" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-1389"><a href="#cb69-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1390"><a href="#cb69-1390" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-1391"><a href="#cb69-1391" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1392"><a href="#cb69-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1393"><a href="#cb69-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1394"><a href="#cb69-1394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### False Color Composite (NIR, Red, Green)</span></span>
<span id="cb69-1395"><a href="#cb69-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1396"><a href="#cb69-1396" aria-hidden="true" tabindex="-1"></a>**Purpose:** Highlights vegetation (appears red) and makes it easier to distinguish land cover types.</span>
<span id="cb69-1397"><a href="#cb69-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1398"><a href="#cb69-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1399"><a href="#cb69-1399" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1400"><a href="#cb69-1400" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># B8</span></span>
<span id="cb69-1401"><a href="#cb69-1401" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb69-1402"><a href="#cb69-1402" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb69-1403"><a href="#cb69-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1404"><a href="#cb69-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># NIR-R-G composite (standard false color)</span></span>
<span id="cb69-1405"><a href="#cb69-1405" aria-hidden="true" tabindex="-1"></a>false_color <span class="op">=</span> np.stack([nir, red, green], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb69-1406"><a href="#cb69-1406" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> false_color.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb69-1407"><a href="#cb69-1407" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> np.clip(false_color_scaled, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb69-1408"><a href="#cb69-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1409"><a href="#cb69-1409" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply percentile stretch</span></span>
<span id="cb69-1410"><a href="#cb69-1410" aria-hidden="true" tabindex="-1"></a>false_color_enhanced <span class="op">=</span> percentile_stretch(false_color_scaled)</span>
<span id="cb69-1411"><a href="#cb69-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1412"><a href="#cb69-1412" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb69-1413"><a href="#cb69-1413" aria-hidden="true" tabindex="-1"></a>plt.imshow(false_color_enhanced)</span>
<span id="cb69-1414"><a href="#cb69-1414" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"False Color Composite (NIR-Red-Green)</span><span class="ch">\n</span><span class="st">Vegetation appears red"</span>)</span>
<span id="cb69-1415"><a href="#cb69-1415" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb69-1416"><a href="#cb69-1416" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1417"><a href="#cb69-1417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1418"><a href="#cb69-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1419"><a href="#cb69-1419" aria-hidden="true" tabindex="-1"></a>**False color interpretation:**</span>
<span id="cb69-1420"><a href="#cb69-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1421"><a href="#cb69-1421" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Color <span class="pp">|</span> Surface Type <span class="pp">|</span></span>
<span id="cb69-1422"><a href="#cb69-1422" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------|--------------|</span></span>
<span id="cb69-1423"><a href="#cb69-1423" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Bright red** <span class="pp">|</span> Dense, healthy vegetation (high NIR) <span class="pp">|</span></span>
<span id="cb69-1424"><a href="#cb69-1424" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Pink/magenta** <span class="pp">|</span> Moderate vegetation <span class="pp">|</span></span>
<span id="cb69-1425"><a href="#cb69-1425" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Dark blue/black** <span class="pp">|</span> Water (absorbs NIR) <span class="pp">|</span></span>
<span id="cb69-1426"><a href="#cb69-1426" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Cyan/gray** <span class="pp">|</span> Urban areas, bare soil <span class="pp">|</span></span>
<span id="cb69-1427"><a href="#cb69-1427" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Brown/tan** <span class="pp">|</span> Sparse vegetation, agricultural fields <span class="pp">|</span></span>
<span id="cb69-1428"><a href="#cb69-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1429"><a href="#cb69-1429" aria-hidden="true" tabindex="-1"></a>**Why false color is useful:**</span>
<span id="cb69-1430"><a href="#cb69-1430" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Vegetation is much more distinguishable (red tones)</span>
<span id="cb69-1431"><a href="#cb69-1431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Water bodies are very dark (low NIR)</span>
<span id="cb69-1432"><a href="#cb69-1432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Urban areas are clearly visible (cyan/gray)</span>
<span id="cb69-1433"><a href="#cb69-1433" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Useful for rapid visual interpretation before quantitative analysis</span>
<span id="cb69-1434"><a href="#cb69-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1435"><a href="#cb69-1435" aria-hidden="true" tabindex="-1"></a><span class="fu">### Saving Processed Rasters</span></span>
<span id="cb69-1436"><a href="#cb69-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1437"><a href="#cb69-1437" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1438"><a href="#cb69-1438" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NDVI as GeoTIFF</span></span>
<span id="cb69-1439"><a href="#cb69-1439" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/ndvi.tif'</span></span>
<span id="cb69-1440"><a href="#cb69-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1441"><a href="#cb69-1441" aria-hidden="true" tabindex="-1"></a><span class="co"># Update profile for single-band float output</span></span>
<span id="cb69-1442"><a href="#cb69-1442" aria-hidden="true" tabindex="-1"></a>profile.update(</span>
<span id="cb69-1443"><a href="#cb69-1443" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>rasterio.float32,</span>
<span id="cb69-1444"><a href="#cb69-1444" aria-hidden="true" tabindex="-1"></a>    count<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb69-1445"><a href="#cb69-1445" aria-hidden="true" tabindex="-1"></a>    compress<span class="op">=</span><span class="st">'lzw'</span>,  <span class="co"># Compress to save space</span></span>
<span id="cb69-1446"><a href="#cb69-1446" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span>     <span class="co"># Define nodata value</span></span>
<span id="cb69-1447"><a href="#cb69-1447" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-1448"><a href="#cb69-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1449"><a href="#cb69-1449" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(output_path, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb69-1450"><a href="#cb69-1450" aria-hidden="true" tabindex="-1"></a>    dst.write(ndvi.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb69-1451"><a href="#cb69-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1452"><a href="#cb69-1452" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved NDVI to: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1453"><a href="#cb69-1453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1454"><a href="#cb69-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1455"><a href="#cb69-1455" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-1456"><a href="#cb69-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1457"><a href="#cb69-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 7: Combining Vector and Raster Operations</span></span>
<span id="cb69-1458"><a href="#cb69-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1459"><a href="#cb69-1459" aria-hidden="true" tabindex="-1"></a>Real-world EO workflows often require integrating vector and raster data. Let's explore common operations.</span>
<span id="cb69-1460"><a href="#cb69-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1461"><a href="#cb69-1461" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clipping Raster to Vector Boundary</span></span>
<span id="cb69-1462"><a href="#cb69-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1463"><a href="#cb69-1463" aria-hidden="true" tabindex="-1"></a>**Use case:** Extract satellite data only within your area of interest (e.g., a province, protected area, or farm boundary).</span>
<span id="cb69-1464"><a href="#cb69-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1465"><a href="#cb69-1465" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1466"><a href="#cb69-1466" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb69-1467"><a href="#cb69-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1468"><a href="#cb69-1468" aria-hidden="true" tabindex="-1"></a><span class="co"># Load AOI polygon (from earlier GeoPandas section)</span></span>
<span id="cb69-1469"><a href="#cb69-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_gdf = gpd.read_file('my_aoi.geojson')</span></span>
<span id="cb69-1470"><a href="#cb69-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1471"><a href="#cb69-1471" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1472"><a href="#cb69-1472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match - CRITICAL for accurate clipping!</span></span>
<span id="cb69-1473"><a href="#cb69-1473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> aoi_gdf.crs <span class="op">!=</span> src.crs:</span>
<span id="cb69-1474"><a href="#cb69-1474" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Reprojecting AOI from </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1475"><a href="#cb69-1475" aria-hidden="true" tabindex="-1"></a>        aoi_gdf <span class="op">=</span> aoi_gdf.to_crs(src.crs)</span>
<span id="cb69-1476"><a href="#cb69-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1477"><a href="#cb69-1477" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get geometries in proper format (list of shapely geometries)</span></span>
<span id="cb69-1478"><a href="#cb69-1478" aria-hidden="true" tabindex="-1"></a>    shapes <span class="op">=</span> aoi_gdf.geometry.values</span>
<span id="cb69-1479"><a href="#cb69-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1480"><a href="#cb69-1480" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip raster to vector boundary</span></span>
<span id="cb69-1481"><a href="#cb69-1481" aria-hidden="true" tabindex="-1"></a>    out_image, out_transform <span class="op">=</span> mask(src, shapes, crop<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span>src.nodata)</span>
<span id="cb69-1482"><a href="#cb69-1482" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb69-1483"><a href="#cb69-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1484"><a href="#cb69-1484" aria-hidden="true" tabindex="-1"></a><span class="co"># Update metadata for clipped raster</span></span>
<span id="cb69-1485"><a href="#cb69-1485" aria-hidden="true" tabindex="-1"></a>out_meta.update({</span>
<span id="cb69-1486"><a href="#cb69-1486" aria-hidden="true" tabindex="-1"></a>    <span class="st">"driver"</span>: <span class="st">"GTiff"</span>,</span>
<span id="cb69-1487"><a href="#cb69-1487" aria-hidden="true" tabindex="-1"></a>    <span class="st">"height"</span>: out_image.shape[<span class="dv">1</span>],</span>
<span id="cb69-1488"><a href="#cb69-1488" aria-hidden="true" tabindex="-1"></a>    <span class="st">"width"</span>: out_image.shape[<span class="dv">2</span>],</span>
<span id="cb69-1489"><a href="#cb69-1489" aria-hidden="true" tabindex="-1"></a>    <span class="st">"transform"</span>: out_transform</span>
<span id="cb69-1490"><a href="#cb69-1490" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb69-1491"><a href="#cb69-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1492"><a href="#cb69-1492" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original raster: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb69-1493"><a href="#cb69-1493" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Clipped raster: </span><span class="sc">{</span>out_meta[<span class="st">'width'</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>out_meta[<span class="st">'height'</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb69-1494"><a href="#cb69-1494" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size reduction: </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> (out_meta[<span class="st">'width'</span>]<span class="op">*</span>out_meta[<span class="st">'height'</span>])<span class="op">/</span>(src.width<span class="op">*</span>src.height))<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb69-1495"><a href="#cb69-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1496"><a href="#cb69-1496" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clipped area</span></span>
<span id="cb69-1497"><a href="#cb69-1497" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb69-1498"><a href="#cb69-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1499"><a href="#cb69-1499" aria-hidden="true" tabindex="-1"></a><span class="co"># Original</span></span>
<span id="cb69-1500"><a href="#cb69-1500" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1501"><a href="#cb69-1501" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].imshow(src.read(<span class="dv">3</span>), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb69-1502"><a href="#cb69-1502" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="st">"Original Raster (Full Extent)"</span>)</span>
<span id="cb69-1503"><a href="#cb69-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1504"><a href="#cb69-1504" aria-hidden="true" tabindex="-1"></a><span class="co"># Clipped</span></span>
<span id="cb69-1505"><a href="#cb69-1505" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(out_image[<span class="dv">2</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)  <span class="co"># Band 3 (Red channel)</span></span>
<span id="cb69-1506"><a href="#cb69-1506" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Clipped to AOI"</span>)</span>
<span id="cb69-1507"><a href="#cb69-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1508"><a href="#cb69-1508" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-1509"><a href="#cb69-1509" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1510"><a href="#cb69-1510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1511"><a href="#cb69-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1512"><a href="#cb69-1512" aria-hidden="true" tabindex="-1"></a>**Save clipped raster:**</span>
<span id="cb69-1513"><a href="#cb69-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1514"><a href="#cb69-1514" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1515"><a href="#cb69-1515" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/clipped_raster.tif'</span></span>
<span id="cb69-1516"><a href="#cb69-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1517"><a href="#cb69-1517" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dest:</span>
<span id="cb69-1518"><a href="#cb69-1518" aria-hidden="true" tabindex="-1"></a>    dest.write(out_image)</span>
<span id="cb69-1519"><a href="#cb69-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1520"><a href="#cb69-1520" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved clipped raster to: </span><span class="sc">{</span>clipped_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1521"><a href="#cb69-1521" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File size reduced for faster processing and storage!"</span>)</span>
<span id="cb69-1522"><a href="#cb69-1522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1523"><a href="#cb69-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1524"><a href="#cb69-1524" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb69-1525"><a href="#cb69-1525" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to Clip Rasters</span></span>
<span id="cb69-1526"><a href="#cb69-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1527"><a href="#cb69-1527" aria-hidden="true" tabindex="-1"></a>**Advantages:**</span>
<span id="cb69-1528"><a href="#cb69-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reduced file size:** Smaller files load and process faster</span>
<span id="cb69-1529"><a href="#cb69-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Focused analysis:** Only relevant area is analyzed</span>
<span id="cb69-1530"><a href="#cb69-1530" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lower memory use:** Important for large Sentinel-2 tiles (100 km² at 10m = 100 million pixels!)</span>
<span id="cb69-1531"><a href="#cb69-1531" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Easier visualization:** Zoomed to area of interest</span>
<span id="cb69-1532"><a href="#cb69-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1533"><a href="#cb69-1533" aria-hidden="true" tabindex="-1"></a>**Best practice:** Clip rasters early in your workflow to avoid processing unnecessary pixels.</span>
<span id="cb69-1534"><a href="#cb69-1534" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-1535"><a href="#cb69-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1536"><a href="#cb69-1536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling Raster Values at Point Locations</span></span>
<span id="cb69-1537"><a href="#cb69-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1538"><a href="#cb69-1538" aria-hidden="true" tabindex="-1"></a>**Use case:** Extract satellite data at field survey locations for validation or model training.</span>
<span id="cb69-1539"><a href="#cb69-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1540"><a href="#cb69-1540" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1541"><a href="#cb69-1541" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Field survey locations (GPS coordinates)</span></span>
<span id="cb69-1542"><a href="#cb69-1542" aria-hidden="true" tabindex="-1"></a>survey_points <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb69-1543"><a href="#cb69-1543" aria-hidden="true" tabindex="-1"></a>    <span class="st">'site_id'</span>: [<span class="st">'Site_A'</span>, <span class="st">'Site_B'</span>, <span class="st">'Site_C'</span>],</span>
<span id="cb69-1544"><a href="#cb69-1544" aria-hidden="true" tabindex="-1"></a>    <span class="st">'land_cover'</span>: [<span class="st">'Forest'</span>, <span class="st">'Cropland'</span>, <span class="st">'Urban'</span>],</span>
<span id="cb69-1545"><a href="#cb69-1545" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: gpd.points_from_xy(</span>
<span id="cb69-1546"><a href="#cb69-1546" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">124.0</span>, <span class="fl">124.5</span>, <span class="fl">123.8</span>],  <span class="co"># Longitudes</span></span>
<span id="cb69-1547"><a href="#cb69-1547" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">10.0</span>, <span class="fl">10.3</span>, <span class="fl">9.8</span>]       <span class="co"># Latitudes</span></span>
<span id="cb69-1548"><a href="#cb69-1548" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-1549"><a href="#cb69-1549" aria-hidden="true" tabindex="-1"></a>}, crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb69-1550"><a href="#cb69-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1551"><a href="#cb69-1551" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster at points</span></span>
<span id="cb69-1552"><a href="#cb69-1552" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1553"><a href="#cb69-1553" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject points if needed</span></span>
<span id="cb69-1554"><a href="#cb69-1554" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> survey_points.crs <span class="op">!=</span> src.crs:</span>
<span id="cb69-1555"><a href="#cb69-1555" aria-hidden="true" tabindex="-1"></a>        survey_points <span class="op">=</span> survey_points.to_crs(src.crs)</span>
<span id="cb69-1556"><a href="#cb69-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1557"><a href="#cb69-1557" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coordinates as (x, y) tuples</span></span>
<span id="cb69-1558"><a href="#cb69-1558" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> [(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(survey_points.geometry.x, survey_points.geometry.y)]</span>
<span id="cb69-1559"><a href="#cb69-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1560"><a href="#cb69-1560" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample all bands at each point</span></span>
<span id="cb69-1561"><a href="#cb69-1561" aria-hidden="true" tabindex="-1"></a>    sampled_values <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> src.sample(coords)]</span>
<span id="cb69-1562"><a href="#cb69-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1563"><a href="#cb69-1563" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sampled values to GeoDataFrame</span></span>
<span id="cb69-1564"><a href="#cb69-1564" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'blue'</span>] <span class="op">=</span> [v[<span class="dv">0</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb69-1565"><a href="#cb69-1565" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'green'</span>] <span class="op">=</span> [v[<span class="dv">1</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb69-1566"><a href="#cb69-1566" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'red'</span>] <span class="op">=</span> [v[<span class="dv">2</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb69-1567"><a href="#cb69-1567" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'nir'</span>] <span class="op">=</span> [v[<span class="dv">3</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb69-1568"><a href="#cb69-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1569"><a href="#cb69-1569" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI at points</span></span>
<span id="cb69-1570"><a href="#cb69-1570" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'ndvi'</span>] <span class="op">=</span> (survey_points[<span class="st">'nir'</span>] <span class="op">-</span> survey_points[<span class="st">'red'</span>]) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb69-1571"><a href="#cb69-1571" aria-hidden="true" tabindex="-1"></a>                        (survey_points[<span class="st">'nir'</span>] <span class="op">+</span> survey_points[<span class="st">'red'</span>] <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-1572"><a href="#cb69-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1573"><a href="#cb69-1573" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DN to reflectance (Sentinel-2 scaling)</span></span>
<span id="cb69-1574"><a href="#cb69-1574" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> band <span class="kw">in</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>]:</span>
<span id="cb69-1575"><a href="#cb69-1575" aria-hidden="true" tabindex="-1"></a>    survey_points[<span class="ss">f'</span><span class="sc">{</span>band<span class="sc">}</span><span class="ss">_refl'</span>] <span class="op">=</span> survey_points[band] <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb69-1576"><a href="#cb69-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1577"><a href="#cb69-1577" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sampled Values at Survey Points:"</span>)</span>
<span id="cb69-1578"><a href="#cb69-1578" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(survey_points[[<span class="st">'site_id'</span>, <span class="st">'land_cover'</span>, <span class="st">'ndvi'</span>]])</span>
<span id="cb69-1579"><a href="#cb69-1579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1580"><a href="#cb69-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1581"><a href="#cb69-1581" aria-hidden="true" tabindex="-1"></a>**Export results for validation:**</span>
<span id="cb69-1582"><a href="#cb69-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1583"><a href="#cb69-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1584"><a href="#cb69-1584" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as CSV for Excel/analysis</span></span>
<span id="cb69-1585"><a href="#cb69-1585" aria-hidden="true" tabindex="-1"></a>survey_points.drop(<span class="st">'geometry'</span>, axis<span class="op">=</span><span class="dv">1</span>).to_csv(</span>
<span id="cb69-1586"><a href="#cb69-1586" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.csv'</span>,</span>
<span id="cb69-1587"><a href="#cb69-1587" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="va">False</span></span>
<span id="cb69-1588"><a href="#cb69-1588" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-1589"><a href="#cb69-1589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1590"><a href="#cb69-1590" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as shapefile with geometry</span></span>
<span id="cb69-1591"><a href="#cb69-1591" aria-hidden="true" tabindex="-1"></a>survey_points.to_file(</span>
<span id="cb69-1592"><a href="#cb69-1592" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.shp'</span></span>
<span id="cb69-1593"><a href="#cb69-1593" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-1594"><a href="#cb69-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1595"><a href="#cb69-1595" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Validation data exported!"</span>)</span>
<span id="cb69-1596"><a href="#cb69-1596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1597"><a href="#cb69-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1598"><a href="#cb69-1598" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zonal Statistics</span></span>
<span id="cb69-1599"><a href="#cb69-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1600"><a href="#cb69-1600" aria-hidden="true" tabindex="-1"></a>**Use case:** Calculate average NDVI (or other metrics) for each administrative unit, farm, or land parcel.</span>
<span id="cb69-1601"><a href="#cb69-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1602"><a href="#cb69-1602" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1603"><a href="#cb69-1603" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Calculate mean NDVI per municipality</span></span>
<span id="cb69-1604"><a href="#cb69-1604" aria-hidden="true" tabindex="-1"></a><span class="co"># Requires rasterstats library</span></span>
<span id="cb69-1605"><a href="#cb69-1605" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install rasterstats <span class="op">-</span>q</span>
<span id="cb69-1606"><a href="#cb69-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1607"><a href="#cb69-1607" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb69-1608"><a href="#cb69-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1609"><a href="#cb69-1609" aria-hidden="true" tabindex="-1"></a><span class="co"># Load municipality boundaries</span></span>
<span id="cb69-1610"><a href="#cb69-1610" aria-hidden="true" tabindex="-1"></a>municipalities <span class="op">=</span> gpd.read_file(<span class="st">'municipalities.shp'</span>)</span>
<span id="cb69-1611"><a href="#cb69-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1612"><a href="#cb69-1612" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate zonal statistics</span></span>
<span id="cb69-1613"><a href="#cb69-1613" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(</span>
<span id="cb69-1614"><a href="#cb69-1614" aria-hidden="true" tabindex="-1"></a>    municipalities,</span>
<span id="cb69-1615"><a href="#cb69-1615" aria-hidden="true" tabindex="-1"></a>    ndvi,</span>
<span id="cb69-1616"><a href="#cb69-1616" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>profile[<span class="st">'transform'</span>],</span>
<span id="cb69-1617"><a href="#cb69-1617" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>],</span>
<span id="cb69-1618"><a href="#cb69-1618" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span></span>
<span id="cb69-1619"><a href="#cb69-1619" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-1620"><a href="#cb69-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1621"><a href="#cb69-1621" aria-hidden="true" tabindex="-1"></a><span class="co"># Add statistics to GeoDataFrame</span></span>
<span id="cb69-1622"><a href="#cb69-1622" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_mean'</span>] <span class="op">=</span> [s[<span class="st">'mean'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb69-1623"><a href="#cb69-1623" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_std'</span>] <span class="op">=</span> [s[<span class="st">'std'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb69-1624"><a href="#cb69-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1625"><a href="#cb69-1625" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize municipalities by mean NDVI</span></span>
<span id="cb69-1626"><a href="#cb69-1626" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb69-1627"><a href="#cb69-1627" aria-hidden="true" tabindex="-1"></a>municipalities.plot(</span>
<span id="cb69-1628"><a href="#cb69-1628" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'ndvi_mean'</span>,</span>
<span id="cb69-1629"><a href="#cb69-1629" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlGn'</span>,</span>
<span id="cb69-1630"><a href="#cb69-1630" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb69-1631"><a href="#cb69-1631" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb69-1632"><a href="#cb69-1632" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb69-1633"><a href="#cb69-1633" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb69-1634"><a href="#cb69-1634" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-1635"><a href="#cb69-1635" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Mean NDVI by Municipality"</span>)</span>
<span id="cb69-1636"><a href="#cb69-1636" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-1637"><a href="#cb69-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1638"><a href="#cb69-1638" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(municipalities[[<span class="st">'NAME'</span>, <span class="st">'ndvi_mean'</span>, <span class="st">'ndvi_std'</span>]].head())</span>
<span id="cb69-1639"><a href="#cb69-1639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1640"><a href="#cb69-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1641"><a href="#cb69-1641" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-1642"><a href="#cb69-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1643"><a href="#cb69-1643" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 8: Preprocessing Workflows for Machine Learning</span></span>
<span id="cb69-1644"><a href="#cb69-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1645"><a href="#cb69-1645" aria-hidden="true" tabindex="-1"></a>Now let's connect everything to prepare **analysis-ready data for ML** (Sessions 5-7).</span>
<span id="cb69-1646"><a href="#cb69-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1647"><a href="#cb69-1647" aria-hidden="true" tabindex="-1"></a><span class="fu">### Workflow 1: Preparing Training Samples for Classification</span></span>
<span id="cb69-1648"><a href="#cb69-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1649"><a href="#cb69-1649" aria-hidden="true" tabindex="-1"></a>**Goal:** Create a dataset of labeled pixels for land cover classification.</span>
<span id="cb69-1650"><a href="#cb69-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1651"><a href="#cb69-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1652"><a href="#cb69-1652" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load training polygons (digitized by expert)</span></span>
<span id="cb69-1653"><a href="#cb69-1653" aria-hidden="true" tabindex="-1"></a>training_polygons <span class="op">=</span> gpd.read_file(<span class="st">'training_areas.shp'</span>)</span>
<span id="cb69-1654"><a href="#cb69-1654" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns: 'class_id', 'class_name', 'geometry'</span></span>
<span id="cb69-1655"><a href="#cb69-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1656"><a href="#cb69-1656" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rasterize polygons to match satellite image grid</span></span>
<span id="cb69-1657"><a href="#cb69-1657" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb69-1658"><a href="#cb69-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1659"><a href="#cb69-1659" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1660"><a href="#cb69-1660" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create empty array</span></span>
<span id="cb69-1661"><a href="#cb69-1661" aria-hidden="true" tabindex="-1"></a>    training_mask <span class="op">=</span> rasterize(</span>
<span id="cb69-1662"><a href="#cb69-1662" aria-hidden="true" tabindex="-1"></a>        [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_polygons.geometry, training_polygons[<span class="st">'class_id'</span>])],</span>
<span id="cb69-1663"><a href="#cb69-1663" aria-hidden="true" tabindex="-1"></a>        out_shape<span class="op">=</span>(src.height, src.width),</span>
<span id="cb69-1664"><a href="#cb69-1664" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>src.transform,</span>
<span id="cb69-1665"><a href="#cb69-1665" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="dv">0</span>,  <span class="co"># Background class</span></span>
<span id="cb69-1666"><a href="#cb69-1666" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb69-1667"><a href="#cb69-1667" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-1668"><a href="#cb69-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1669"><a href="#cb69-1669" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract pixel values at training locations</span></span>
<span id="cb69-1670"><a href="#cb69-1670" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1671"><a href="#cb69-1671" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> src.read()  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb69-1672"><a href="#cb69-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1673"><a href="#cb69-1673" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to (n_pixels, n_bands)</span></span>
<span id="cb69-1674"><a href="#cb69-1674" aria-hidden="true" tabindex="-1"></a>n_bands, height, width <span class="op">=</span> bands.shape</span>
<span id="cb69-1675"><a href="#cb69-1675" aria-hidden="true" tabindex="-1"></a>pixels <span class="op">=</span> bands.reshape(n_bands, <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, n_bands)</span></span>
<span id="cb69-1676"><a href="#cb69-1676" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_mask.flatten()       <span class="co"># (n_pixels,)</span></span>
<span id="cb69-1677"><a href="#cb69-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1678"><a href="#cb69-1678" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels only (exclude background class 0)</span></span>
<span id="cb69-1679"><a href="#cb69-1679" aria-hidden="true" tabindex="-1"></a>labeled_mask <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb69-1680"><a href="#cb69-1680" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pixels[labeled_mask]  <span class="co"># Features</span></span>
<span id="cb69-1681"><a href="#cb69-1681" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_mask]  <span class="co"># Labels</span></span>
<span id="cb69-1682"><a href="#cb69-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1683"><a href="#cb69-1683" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training samples: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> pixels"</span>)</span>
<span id="cb69-1684"><a href="#cb69-1684" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> bands"</span>)</span>
<span id="cb69-1685"><a href="#cb69-1685" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1686"><a href="#cb69-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1687"><a href="#cb69-1687" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Normalize features (important for ML!)</span></span>
<span id="cb69-1688"><a href="#cb69-1688" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb69-1689"><a href="#cb69-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1690"><a href="#cb69-1690" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb69-1691"><a href="#cb69-1691" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb69-1692"><a href="#cb69-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1693"><a href="#cb69-1693" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data ready for ML model training!"</span>)</span>
<span id="cb69-1694"><a href="#cb69-1694" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Next steps: Split into train/val/test, train Random Forest or CNN"</span>)</span>
<span id="cb69-1695"><a href="#cb69-1695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1696"><a href="#cb69-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1697"><a href="#cb69-1697" aria-hidden="true" tabindex="-1"></a><span class="fu">### Workflow 2: Creating Multi-Temporal Stack</span></span>
<span id="cb69-1698"><a href="#cb69-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1699"><a href="#cb69-1699" aria-hidden="true" tabindex="-1"></a>**Goal:** Combine images from different dates to capture phenology (crop growth cycles, seasonal changes).</span>
<span id="cb69-1700"><a href="#cb69-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1701"><a href="#cb69-1701" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1702"><a href="#cb69-1702" aria-hidden="true" tabindex="-1"></a><span class="co"># List of raster paths from different dates</span></span>
<span id="cb69-1703"><a href="#cb69-1703" aria-hidden="true" tabindex="-1"></a>date_paths <span class="op">=</span> [</span>
<span id="cb69-1704"><a href="#cb69-1704" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_01_15.tif'</span>,  <span class="co"># Dry season</span></span>
<span id="cb69-1705"><a href="#cb69-1705" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_04_15.tif'</span>,  <span class="co"># Transition</span></span>
<span id="cb69-1706"><a href="#cb69-1706" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_07_15.tif'</span>,  <span class="co"># Wet season</span></span>
<span id="cb69-1707"><a href="#cb69-1707" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_10_15.tif'</span>   <span class="co"># Harvest</span></span>
<span id="cb69-1708"><a href="#cb69-1708" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb69-1709"><a href="#cb69-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1710"><a href="#cb69-1710" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all dates and stack</span></span>
<span id="cb69-1711"><a href="#cb69-1711" aria-hidden="true" tabindex="-1"></a>stacked_bands <span class="op">=</span> []</span>
<span id="cb69-1712"><a href="#cb69-1712" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> []</span>
<span id="cb69-1713"><a href="#cb69-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1714"><a href="#cb69-1714" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> date_paths:</span>
<span id="cb69-1715"><a href="#cb69-1715" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(path) <span class="im">as</span> src:</span>
<span id="cb69-1716"><a href="#cb69-1716" aria-hidden="true" tabindex="-1"></a>        stacked_bands.append(src.read())  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb69-1717"><a href="#cb69-1717" aria-hidden="true" tabindex="-1"></a>        dates.append(path.split(<span class="st">'_'</span>)[<span class="dv">1</span>])  <span class="co"># Extract date from filename</span></span>
<span id="cb69-1718"><a href="#cb69-1718" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()  <span class="co"># Use last profile as template</span></span>
<span id="cb69-1719"><a href="#cb69-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1720"><a href="#cb69-1720" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack along band dimension: (n_dates * n_bands, height, width)</span></span>
<span id="cb69-1721"><a href="#cb69-1721" aria-hidden="true" tabindex="-1"></a>multi_temporal <span class="op">=</span> np.concatenate(stacked_bands, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb69-1722"><a href="#cb69-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1723"><a href="#cb69-1723" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Multi-temporal stack shape: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1724"><a href="#cb69-1724" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total bands: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (4 dates × </span><span class="sc">{</span>stacked_bands[<span class="dv">0</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb69-1725"><a href="#cb69-1725" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dates: </span><span class="sc">{</span>dates<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1726"><a href="#cb69-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1727"><a href="#cb69-1727" aria-hidden="true" tabindex="-1"></a><span class="co"># Save multi-temporal stack</span></span>
<span id="cb69-1728"><a href="#cb69-1728" aria-hidden="true" tabindex="-1"></a>profile.update(count<span class="op">=</span>multi_temporal.shape[<span class="dv">0</span>])</span>
<span id="cb69-1729"><a href="#cb69-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1730"><a href="#cb69-1730" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'multi_temporal_stack.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb69-1731"><a href="#cb69-1731" aria-hidden="true" tabindex="-1"></a>    dst.write(multi_temporal)</span>
<span id="cb69-1732"><a href="#cb69-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1733"><a href="#cb69-1733" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Multi-temporal stack created!"</span>)</span>
<span id="cb69-1734"><a href="#cb69-1734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1735"><a href="#cb69-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1736"><a href="#cb69-1736" aria-hidden="true" tabindex="-1"></a>**Why multi-temporal?**</span>
<span id="cb69-1737"><a href="#cb69-1737" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Better classification:** Captures seasonal patterns (e.g., crops have distinct phenology)</span>
<span id="cb69-1738"><a href="#cb69-1738" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Change detection:** Compare dates to detect deforestation, urban growth, flooding</span>
<span id="cb69-1739"><a href="#cb69-1739" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Improved accuracy:** Machine learning models benefit from temporal features</span>
<span id="cb69-1740"><a href="#cb69-1740" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PRiSM approach:** Uses SAR time series to detect rice planting/harvesting</span>
<span id="cb69-1741"><a href="#cb69-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1742"><a href="#cb69-1742" aria-hidden="true" tabindex="-1"></a><span class="fu">### Workflow 3: Resampling and Reprojection</span></span>
<span id="cb69-1743"><a href="#cb69-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1744"><a href="#cb69-1744" aria-hidden="true" tabindex="-1"></a>**Goal:** Make rasters from different sensors compatible (same resolution, CRS, extent).</span>
<span id="cb69-1745"><a href="#cb69-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1746"><a href="#cb69-1746" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1747"><a href="#cb69-1747" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> reproject, Resampling</span>
<span id="cb69-1748"><a href="#cb69-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1749"><a href="#cb69-1749" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Resample 20m Sentinel-2 bands to 10m</span></span>
<span id="cb69-1750"><a href="#cb69-1750" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_20m.tif'</span>) <span class="im">as</span> src:</span>
<span id="cb69-1751"><a href="#cb69-1751" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define target resolution</span></span>
<span id="cb69-1752"><a href="#cb69-1752" aria-hidden="true" tabindex="-1"></a>    scale_factor <span class="op">=</span> <span class="dv">2</span>  <span class="co"># 20m → 10m</span></span>
<span id="cb69-1753"><a href="#cb69-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1754"><a href="#cb69-1754" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate new dimensions</span></span>
<span id="cb69-1755"><a href="#cb69-1755" aria-hidden="true" tabindex="-1"></a>    new_height <span class="op">=</span> src.height <span class="op">*</span> scale_factor</span>
<span id="cb69-1756"><a href="#cb69-1756" aria-hidden="true" tabindex="-1"></a>    new_width <span class="op">=</span> src.width <span class="op">*</span> scale_factor</span>
<span id="cb69-1757"><a href="#cb69-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1758"><a href="#cb69-1758" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update transform</span></span>
<span id="cb69-1759"><a href="#cb69-1759" aria-hidden="true" tabindex="-1"></a>    new_transform <span class="op">=</span> src.transform <span class="op">*</span> src.transform.scale(</span>
<span id="cb69-1760"><a href="#cb69-1760" aria-hidden="true" tabindex="-1"></a>        (src.width <span class="op">/</span> new_width),</span>
<span id="cb69-1761"><a href="#cb69-1761" aria-hidden="true" tabindex="-1"></a>        (src.height <span class="op">/</span> new_height)</span>
<span id="cb69-1762"><a href="#cb69-1762" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-1763"><a href="#cb69-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1764"><a href="#cb69-1764" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create output array</span></span>
<span id="cb69-1765"><a href="#cb69-1765" aria-hidden="true" tabindex="-1"></a>    upsampled <span class="op">=</span> np.empty((src.count, new_height, new_width), dtype<span class="op">=</span>src.dtypes[<span class="dv">0</span>])</span>
<span id="cb69-1766"><a href="#cb69-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1767"><a href="#cb69-1767" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject</span></span>
<span id="cb69-1768"><a href="#cb69-1768" aria-hidden="true" tabindex="-1"></a>    reproject(</span>
<span id="cb69-1769"><a href="#cb69-1769" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>rasterio.band(src, <span class="dv">1</span>),</span>
<span id="cb69-1770"><a href="#cb69-1770" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">=</span>upsampled[<span class="dv">0</span>],</span>
<span id="cb69-1771"><a href="#cb69-1771" aria-hidden="true" tabindex="-1"></a>        src_transform<span class="op">=</span>src.transform,</span>
<span id="cb69-1772"><a href="#cb69-1772" aria-hidden="true" tabindex="-1"></a>        src_crs<span class="op">=</span>src.crs,</span>
<span id="cb69-1773"><a href="#cb69-1773" aria-hidden="true" tabindex="-1"></a>        dst_transform<span class="op">=</span>new_transform,</span>
<span id="cb69-1774"><a href="#cb69-1774" aria-hidden="true" tabindex="-1"></a>        dst_crs<span class="op">=</span>src.crs,</span>
<span id="cb69-1775"><a href="#cb69-1775" aria-hidden="true" tabindex="-1"></a>        resampling<span class="op">=</span>Resampling.bilinear  <span class="co"># or cubic, nearest</span></span>
<span id="cb69-1776"><a href="#cb69-1776" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-1777"><a href="#cb69-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1778"><a href="#cb69-1778" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update profile</span></span>
<span id="cb69-1779"><a href="#cb69-1779" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb69-1780"><a href="#cb69-1780" aria-hidden="true" tabindex="-1"></a>    profile.update(</span>
<span id="cb69-1781"><a href="#cb69-1781" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>new_width,</span>
<span id="cb69-1782"><a href="#cb69-1782" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>new_height,</span>
<span id="cb69-1783"><a href="#cb69-1783" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>new_transform</span>
<span id="cb69-1784"><a href="#cb69-1784" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-1785"><a href="#cb69-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1786"><a href="#cb69-1786" aria-hidden="true" tabindex="-1"></a><span class="co"># Save resampled raster</span></span>
<span id="cb69-1787"><a href="#cb69-1787" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_10m.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb69-1788"><a href="#cb69-1788" aria-hidden="true" tabindex="-1"></a>    dst.write(upsampled)</span>
<span id="cb69-1789"><a href="#cb69-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1790"><a href="#cb69-1790" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Resampled from </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>new_height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>new_width<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1791"><a href="#cb69-1791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1792"><a href="#cb69-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1793"><a href="#cb69-1793" aria-hidden="true" tabindex="-1"></a>**Resampling methods:**</span>
<span id="cb69-1794"><a href="#cb69-1794" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nearest:** Fast, preserves values (good for classification maps)</span>
<span id="cb69-1795"><a href="#cb69-1795" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bilinear:** Smooth, averages neighbors (good for continuous data)</span>
<span id="cb69-1796"><a href="#cb69-1796" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cubic:** Smoothest, best for visualization (slower)</span>
<span id="cb69-1797"><a href="#cb69-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1798"><a href="#cb69-1798" aria-hidden="true" tabindex="-1"></a><span class="fu">### Workflow 4: Data Augmentation for Deep Learning</span></span>
<span id="cb69-1799"><a href="#cb69-1799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1800"><a href="#cb69-1800" aria-hidden="true" tabindex="-1"></a>**Goal:** Artificially increase training data diversity to prevent overfitting.</span>
<span id="cb69-1801"><a href="#cb69-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1802"><a href="#cb69-1802" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1803"><a href="#cb69-1803" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Augment image chips for CNN training</span></span>
<span id="cb69-1804"><a href="#cb69-1804" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb69-1805"><a href="#cb69-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1806"><a href="#cb69-1806" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> augment_chip(image, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb69-1807"><a href="#cb69-1807" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb69-1808"><a href="#cb69-1808" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply random augmentations to image chip.</span></span>
<span id="cb69-1809"><a href="#cb69-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1810"><a href="#cb69-1810" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb69-1811"><a href="#cb69-1811" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb69-1812"><a href="#cb69-1812" aria-hidden="true" tabindex="-1"></a><span class="co">    image : ndarray (H, W, C)</span></span>
<span id="cb69-1813"><a href="#cb69-1813" aria-hidden="true" tabindex="-1"></a><span class="co">        Image chip</span></span>
<span id="cb69-1814"><a href="#cb69-1814" aria-hidden="true" tabindex="-1"></a><span class="co">    label : ndarray (H, W), optional</span></span>
<span id="cb69-1815"><a href="#cb69-1815" aria-hidden="true" tabindex="-1"></a><span class="co">        Corresponding label mask</span></span>
<span id="cb69-1816"><a href="#cb69-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1817"><a href="#cb69-1817" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb69-1818"><a href="#cb69-1818" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb69-1819"><a href="#cb69-1819" aria-hidden="true" tabindex="-1"></a><span class="co">    augmented_image, augmented_label (if label provided)</span></span>
<span id="cb69-1820"><a href="#cb69-1820" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb69-1821"><a href="#cb69-1821" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random rotation (0, 90, 180, 270 degrees)</span></span>
<span id="cb69-1822"><a href="#cb69-1822" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb69-1823"><a href="#cb69-1823" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> np.rot90(image, k)</span>
<span id="cb69-1824"><a href="#cb69-1824" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-1825"><a href="#cb69-1825" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> np.rot90(label, k)</span>
<span id="cb69-1826"><a href="#cb69-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1827"><a href="#cb69-1827" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random flip (horizontal and/or vertical)</span></span>
<span id="cb69-1828"><a href="#cb69-1828" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb69-1829"><a href="#cb69-1829" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.fliplr(image)</span>
<span id="cb69-1830"><a href="#cb69-1830" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-1831"><a href="#cb69-1831" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.fliplr(label)</span>
<span id="cb69-1832"><a href="#cb69-1832" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb69-1833"><a href="#cb69-1833" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.flipud(image)</span>
<span id="cb69-1834"><a href="#cb69-1834" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-1835"><a href="#cb69-1835" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.flipud(label)</span>
<span id="cb69-1836"><a href="#cb69-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1837"><a href="#cb69-1837" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random brightness adjustment (simulate atmospheric variations)</span></span>
<span id="cb69-1838"><a href="#cb69-1838" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb69-1839"><a href="#cb69-1839" aria-hidden="true" tabindex="-1"></a>        factor <span class="op">=</span> np.random.uniform(<span class="fl">0.8</span>, <span class="fl">1.2</span>)</span>
<span id="cb69-1840"><a href="#cb69-1840" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.clip(image <span class="op">*</span> factor, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb69-1841"><a href="#cb69-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1842"><a href="#cb69-1842" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-1843"><a href="#cb69-1843" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb69-1844"><a href="#cb69-1844" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span>
<span id="cb69-1845"><a href="#cb69-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1846"><a href="#cb69-1846" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb69-1847"><a href="#cb69-1847" aria-hidden="true" tabindex="-1"></a><span class="co"># chip = rgb_chip  # (256, 256, 3)</span></span>
<span id="cb69-1848"><a href="#cb69-1848" aria-hidden="true" tabindex="-1"></a><span class="co"># label_chip = land_cover_chip  # (256, 256)</span></span>
<span id="cb69-1849"><a href="#cb69-1849" aria-hidden="true" tabindex="-1"></a><span class="co"># aug_chip, aug_label = augment_chip(chip, label_chip)</span></span>
<span id="cb69-1850"><a href="#cb69-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1851"><a href="#cb69-1851" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data augmentation functions ready!"</span>)</span>
<span id="cb69-1852"><a href="#cb69-1852" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Use during training to increase dataset size 4-8x without new data collection"</span>)</span>
<span id="cb69-1853"><a href="#cb69-1853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1854"><a href="#cb69-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1855"><a href="#cb69-1855" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-1856"><a href="#cb69-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1857"><a href="#cb69-1857" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 9: Best Practices and Common Pitfalls</span></span>
<span id="cb69-1858"><a href="#cb69-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1859"><a href="#cb69-1859" aria-hidden="true" tabindex="-1"></a><span class="fu">### Memory Management for Large Rasters</span></span>
<span id="cb69-1860"><a href="#cb69-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1861"><a href="#cb69-1861" aria-hidden="true" tabindex="-1"></a>**Problem:** Sentinel-2 tiles are huge (100km² at 10m = 100 million pixels × 4 bands = 400 MB per tile).</span>
<span id="cb69-1862"><a href="#cb69-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1863"><a href="#cb69-1863" aria-hidden="true" tabindex="-1"></a>**Solutions:**</span>
<span id="cb69-1864"><a href="#cb69-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1865"><a href="#cb69-1865" aria-hidden="true" tabindex="-1"></a>**1. Windowed Reading:**</span>
<span id="cb69-1866"><a href="#cb69-1866" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1867"><a href="#cb69-1867" aria-hidden="true" tabindex="-1"></a><span class="co"># Process in chunks instead of loading entire raster</span></span>
<span id="cb69-1868"><a href="#cb69-1868" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(large_raster) <span class="im">as</span> src:</span>
<span id="cb69-1869"><a href="#cb69-1869" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window <span class="kw">in</span> src.block_windows():</span>
<span id="cb69-1870"><a href="#cb69-1870" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> src.read(window<span class="op">=</span>window)</span>
<span id="cb69-1871"><a href="#cb69-1871" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process chunk</span></span>
<span id="cb69-1872"><a href="#cb69-1872" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> process_data(data)</span>
<span id="cb69-1873"><a href="#cb69-1873" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Write chunk to output</span></span>
<span id="cb69-1874"><a href="#cb69-1874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1875"><a href="#cb69-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1876"><a href="#cb69-1876" aria-hidden="true" tabindex="-1"></a>**2. Downsampling:**</span>
<span id="cb69-1877"><a href="#cb69-1877" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1878"><a href="#cb69-1878" aria-hidden="true" tabindex="-1"></a><span class="co"># Read at lower resolution for exploratory analysis</span></span>
<span id="cb69-1879"><a href="#cb69-1879" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1880"><a href="#cb69-1880" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read every 10th pixel</span></span>
<span id="cb69-1881"><a href="#cb69-1881" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> src.read(out_shape<span class="op">=</span>(src.count, src.height <span class="op">//</span> <span class="dv">10</span>, src.width <span class="op">//</span> <span class="dv">10</span>))</span>
<span id="cb69-1882"><a href="#cb69-1882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1883"><a href="#cb69-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1884"><a href="#cb69-1884" aria-hidden="true" tabindex="-1"></a>**3. Cloud-Optimized GeoTIFF (COG):**</span>
<span id="cb69-1885"><a href="#cb69-1885" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1886"><a href="#cb69-1886" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to COG for efficient cloud access</span></span>
<span id="cb69-1887"><a href="#cb69-1887" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>gdal_translate <span class="bu">input</span>.tif output_cog.tif <span class="op">-</span>of COG <span class="op">-</span>co COMPRESS<span class="op">=</span>DEFLATE</span>
<span id="cb69-1888"><a href="#cb69-1888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1889"><a href="#cb69-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1890"><a href="#cb69-1890" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vectorization vs. Loops</span></span>
<span id="cb69-1891"><a href="#cb69-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1892"><a href="#cb69-1892" aria-hidden="true" tabindex="-1"></a>**Slow (loop over pixels):**</span>
<span id="cb69-1893"><a href="#cb69-1893" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1894"><a href="#cb69-1894" aria-hidden="true" tabindex="-1"></a><span class="co"># DON'T DO THIS</span></span>
<span id="cb69-1895"><a href="#cb69-1895" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(height):</span>
<span id="cb69-1896"><a href="#cb69-1896" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(width):</span>
<span id="cb69-1897"><a href="#cb69-1897" aria-hidden="true" tabindex="-1"></a>        ndvi[i, j] <span class="op">=</span> (nir[i, j] <span class="op">-</span> red[i, j]) <span class="op">/</span> (nir[i, j] <span class="op">+</span> red[i, j])</span>
<span id="cb69-1898"><a href="#cb69-1898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1899"><a href="#cb69-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1900"><a href="#cb69-1900" aria-hidden="true" tabindex="-1"></a>**Fast (vectorized with NumPy):**</span>
<span id="cb69-1901"><a href="#cb69-1901" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1902"><a href="#cb69-1902" aria-hidden="true" tabindex="-1"></a><span class="co"># DO THIS</span></span>
<span id="cb69-1903"><a href="#cb69-1903" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)  <span class="co"># Single operation on entire array</span></span>
<span id="cb69-1904"><a href="#cb69-1904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1905"><a href="#cb69-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1906"><a href="#cb69-1906" aria-hidden="true" tabindex="-1"></a>**Why?** NumPy operations are implemented in C and optimized for array operations. Can be **100-1000x faster** than Python loops!</span>
<span id="cb69-1907"><a href="#cb69-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1908"><a href="#cb69-1908" aria-hidden="true" tabindex="-1"></a><span class="fu">### Error Handling for Geospatial Operations</span></span>
<span id="cb69-1909"><a href="#cb69-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1910"><a href="#cb69-1910" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1911"><a href="#cb69-1911" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb69-1912"><a href="#cb69-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1913"><a href="#cb69-1913" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress common warnings that are usually harmless</span></span>
<span id="cb69-1914"><a href="#cb69-1914" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">RuntimeWarning</span>)</span>
<span id="cb69-1915"><a href="#cb69-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1916"><a href="#cb69-1916" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe division with error handling</span></span>
<span id="cb69-1917"><a href="#cb69-1917" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_divide(numerator, denominator):</span>
<span id="cb69-1918"><a href="#cb69-1918" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely divide arrays, handling division by zero."""</span></span>
<span id="cb69-1919"><a href="#cb69-1919" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">'ignore'</span>, invalid<span class="op">=</span><span class="st">'ignore'</span>):</span>
<span id="cb69-1920"><a href="#cb69-1920" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb69-1921"><a href="#cb69-1921" aria-hidden="true" tabindex="-1"></a>        result[<span class="op">~</span>np.isfinite(result)] <span class="op">=</span> np.nan  <span class="co"># Replace inf/nan with nan</span></span>
<span id="cb69-1922"><a href="#cb69-1922" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb69-1923"><a href="#cb69-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1924"><a href="#cb69-1924" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe CRS transformation</span></span>
<span id="cb69-1925"><a href="#cb69-1925" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_reproject(gdf, target_crs):</span>
<span id="cb69-1926"><a href="#cb69-1926" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely reproject GeoDataFrame with error handling."""</span></span>
<span id="cb69-1927"><a href="#cb69-1927" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb69-1928"><a href="#cb69-1928" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf.to_crs(target_crs)</span>
<span id="cb69-1929"><a href="#cb69-1929" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb69-1930"><a href="#cb69-1930" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: Reprojection failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1931"><a href="#cb69-1931" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Returning original GeoDataFrame"</span>)</span>
<span id="cb69-1932"><a href="#cb69-1932" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf</span>
<span id="cb69-1933"><a href="#cb69-1933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1934"><a href="#cb69-1934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1935"><a href="#cb69-1935" aria-hidden="true" tabindex="-1"></a><span class="fu">### Troubleshooting Common Issues</span></span>
<span id="cb69-1936"><a href="#cb69-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1937"><a href="#cb69-1937" aria-hidden="true" tabindex="-1"></a>**Issue 1: CRS Mismatch**</span>
<span id="cb69-1938"><a href="#cb69-1938" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1939"><a href="#cb69-1939" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: "CRS mismatch" error when overlaying vector and raster</span></span>
<span id="cb69-1940"><a href="#cb69-1940" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Check and align CRS</span></span>
<span id="cb69-1941"><a href="#cb69-1941" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-1942"><a href="#cb69-1942" aria-hidden="true" tabindex="-1"></a>    raster_crs <span class="op">=</span> src.crs</span>
<span id="cb69-1943"><a href="#cb69-1943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1944"><a href="#cb69-1944" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gdf.crs <span class="op">!=</span> raster_crs:</span>
<span id="cb69-1945"><a href="#cb69-1945" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Reprojecting vector from </span><span class="sc">{</span>gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>raster_crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-1946"><a href="#cb69-1946" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gdf.to_crs(raster_crs)</span>
<span id="cb69-1947"><a href="#cb69-1947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1948"><a href="#cb69-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1949"><a href="#cb69-1949" aria-hidden="true" tabindex="-1"></a>**Issue 2: NoData Handling**</span>
<span id="cb69-1950"><a href="#cb69-1950" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1951"><a href="#cb69-1951" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: Nodata values (0, -9999) skew statistics</span></span>
<span id="cb69-1952"><a href="#cb69-1952" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Mask nodata before calculations</span></span>
<span id="cb69-1953"><a href="#cb69-1953" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb69-1954"><a href="#cb69-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1955"><a href="#cb69-1955" aria-hidden="true" tabindex="-1"></a><span class="co"># Create masked array</span></span>
<span id="cb69-1956"><a href="#cb69-1956" aria-hidden="true" tabindex="-1"></a>raster_masked <span class="op">=</span> ma.masked_equal(raster, nodata_value)</span>
<span id="cb69-1957"><a href="#cb69-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1958"><a href="#cb69-1958" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics now ignore nodata</span></span>
<span id="cb69-1959"><a href="#cb69-1959" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> raster_masked.mean()</span>
<span id="cb69-1960"><a href="#cb69-1960" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> raster_masked.std()</span>
<span id="cb69-1961"><a href="#cb69-1961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1962"><a href="#cb69-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1963"><a href="#cb69-1963" aria-hidden="true" tabindex="-1"></a>**Issue 3: Memory Error**</span>
<span id="cb69-1964"><a href="#cb69-1964" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1965"><a href="#cb69-1965" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: MemoryError when loading large raster</span></span>
<span id="cb69-1966"><a href="#cb69-1966" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 1: Use windowed reading (shown above)</span></span>
<span id="cb69-1967"><a href="#cb69-1967" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 2: Work with lower resolution</span></span>
<span id="cb69-1968"><a href="#cb69-1968" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 3: Use Dask for out-of-core computation</span></span>
<span id="cb69-1969"><a href="#cb69-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1970"><a href="#cb69-1970" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb69-1971"><a href="#cb69-1971" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb69-1972"><a href="#cb69-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1973"><a href="#cb69-1973" aria-hidden="true" tabindex="-1"></a><span class="co"># Open with rioxarray (uses Dask for lazy loading)</span></span>
<span id="cb69-1974"><a href="#cb69-1974" aria-hidden="true" tabindex="-1"></a>raster_da <span class="op">=</span> rioxarray.open_rasterio(raster_path, chunks<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb69-1975"><a href="#cb69-1975" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (raster_da[<span class="dv">3</span>] <span class="op">-</span> raster_da[<span class="dv">2</span>]) <span class="op">/</span> (raster_da[<span class="dv">3</span>] <span class="op">+</span> raster_da[<span class="dv">2</span>])</span>
<span id="cb69-1976"><a href="#cb69-1976" aria-hidden="true" tabindex="-1"></a><span class="co"># Computation happens only when .compute() is called</span></span>
<span id="cb69-1977"><a href="#cb69-1977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1978"><a href="#cb69-1978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1979"><a href="#cb69-1979" aria-hidden="true" tabindex="-1"></a><span class="fu">### Code Organization for Reproducibility</span></span>
<span id="cb69-1980"><a href="#cb69-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1981"><a href="#cb69-1981" aria-hidden="true" tabindex="-1"></a>**Good practices:**</span>
<span id="cb69-1982"><a href="#cb69-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1983"><a href="#cb69-1983" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Clear imports at top:**</span>
<span id="cb69-1984"><a href="#cb69-1984" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-1985"><a href="#cb69-1985" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard library</span></span>
<span id="cb69-1986"><a href="#cb69-1986" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb69-1987"><a href="#cb69-1987" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb69-1988"><a href="#cb69-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1989"><a href="#cb69-1989" aria-hidden="true" tabindex="-1"></a><span class="co"># Third party</span></span>
<span id="cb69-1990"><a href="#cb69-1990" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-1991"><a href="#cb69-1991" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb69-1992"><a href="#cb69-1992" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb69-1993"><a href="#cb69-1993" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb69-1994"><a href="#cb69-1994" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb69-1995"><a href="#cb69-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-1996"><a href="#cb69-1996" aria-hidden="true" tabindex="-1"></a><span class="co"># Project-specific</span></span>
<span id="cb69-1997"><a href="#cb69-1997" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> safe_divide, calculate_ndvi</span>
<span id="cb69-1998"><a href="#cb69-1998" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-1999"><a href="#cb69-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2000"><a href="#cb69-2000" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Define paths clearly:**</span>
<span id="cb69-2001"><a href="#cb69-2001" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-2002"><a href="#cb69-2002" aria-hidden="true" tabindex="-1"></a><span class="co"># Define all paths at the beginning</span></span>
<span id="cb69-2003"><a href="#cb69-2003" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb69-2004"><a href="#cb69-2004" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data'</span></span>
<span id="cb69-2005"><a href="#cb69-2005" aria-hidden="true" tabindex="-1"></a>RASTER_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'raster'</span></span>
<span id="cb69-2006"><a href="#cb69-2006" aria-hidden="true" tabindex="-1"></a>VECTOR_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'vector'</span></span>
<span id="cb69-2007"><a href="#cb69-2007" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs'</span></span>
<span id="cb69-2008"><a href="#cb69-2008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2009"><a href="#cb69-2009" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb69-2010"><a href="#cb69-2010" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-2011"><a href="#cb69-2011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-2012"><a href="#cb69-2012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2013"><a href="#cb69-2013" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Use functions:**</span>
<span id="cb69-2014"><a href="#cb69-2014" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-2015"><a href="#cb69-2015" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_sentinel2(raster_path, aoi_gdf<span class="op">=</span><span class="va">None</span>, scale_factor<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb69-2016"><a href="#cb69-2016" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb69-2017"><a href="#cb69-2017" aria-hidden="true" tabindex="-1"></a><span class="co">    Load and preprocess Sentinel-2 imagery.</span></span>
<span id="cb69-2018"><a href="#cb69-2018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2019"><a href="#cb69-2019" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb69-2020"><a href="#cb69-2020" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb69-2021"><a href="#cb69-2021" aria-hidden="true" tabindex="-1"></a><span class="co">    raster_path : str</span></span>
<span id="cb69-2022"><a href="#cb69-2022" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to Sentinel-2 GeoTIFF</span></span>
<span id="cb69-2023"><a href="#cb69-2023" aria-hidden="true" tabindex="-1"></a><span class="co">    aoi_gdf : GeoDataFrame, optional</span></span>
<span id="cb69-2024"><a href="#cb69-2024" aria-hidden="true" tabindex="-1"></a><span class="co">        Area of interest for clipping</span></span>
<span id="cb69-2025"><a href="#cb69-2025" aria-hidden="true" tabindex="-1"></a><span class="co">    scale_factor : int</span></span>
<span id="cb69-2026"><a href="#cb69-2026" aria-hidden="true" tabindex="-1"></a><span class="co">        Scaling factor for reflectance conversion</span></span>
<span id="cb69-2027"><a href="#cb69-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2028"><a href="#cb69-2028" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb69-2029"><a href="#cb69-2029" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb69-2030"><a href="#cb69-2030" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : dict</span></span>
<span id="cb69-2031"><a href="#cb69-2031" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary of band arrays</span></span>
<span id="cb69-2032"><a href="#cb69-2032" aria-hidden="true" tabindex="-1"></a><span class="co">    profile : dict</span></span>
<span id="cb69-2033"><a href="#cb69-2033" aria-hidden="true" tabindex="-1"></a><span class="co">        Raster metadata</span></span>
<span id="cb69-2034"><a href="#cb69-2034" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb69-2035"><a href="#cb69-2035" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb69-2036"><a href="#cb69-2036" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> aoi_gdf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb69-2037"><a href="#cb69-2037" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clip to AOI</span></span>
<span id="cb69-2038"><a href="#cb69-2038" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb69-2039"><a href="#cb69-2039" aria-hidden="true" tabindex="-1"></a>            bands_array, transform <span class="op">=</span> mask(src, aoi_gdf.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-2040"><a href="#cb69-2040" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb69-2041"><a href="#cb69-2041" aria-hidden="true" tabindex="-1"></a>            bands_array <span class="op">=</span> src.read()</span>
<span id="cb69-2042"><a href="#cb69-2042" aria-hidden="true" tabindex="-1"></a>            transform <span class="op">=</span> src.transform</span>
<span id="cb69-2043"><a href="#cb69-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2044"><a href="#cb69-2044" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb69-2045"><a href="#cb69-2045" aria-hidden="true" tabindex="-1"></a>        profile.update(transform<span class="op">=</span>transform)</span>
<span id="cb69-2046"><a href="#cb69-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2047"><a href="#cb69-2047" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to reflectance</span></span>
<span id="cb69-2048"><a href="#cb69-2048" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> {</span>
<span id="cb69-2049"><a href="#cb69-2049" aria-hidden="true" tabindex="-1"></a>        <span class="st">'blue'</span>: bands_array[<span class="dv">0</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb69-2050"><a href="#cb69-2050" aria-hidden="true" tabindex="-1"></a>        <span class="st">'green'</span>: bands_array[<span class="dv">1</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb69-2051"><a href="#cb69-2051" aria-hidden="true" tabindex="-1"></a>        <span class="st">'red'</span>: bands_array[<span class="dv">2</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb69-2052"><a href="#cb69-2052" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nir'</span>: bands_array[<span class="dv">3</span>] <span class="op">/</span> scale_factor</span>
<span id="cb69-2053"><a href="#cb69-2053" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-2054"><a href="#cb69-2054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2055"><a href="#cb69-2055" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bands, profile</span>
<span id="cb69-2056"><a href="#cb69-2056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2057"><a href="#cb69-2057" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb69-2058"><a href="#cb69-2058" aria-hidden="true" tabindex="-1"></a>bands, profile <span class="op">=</span> preprocess_sentinel2(raster_path, aoi_gdf)</span>
<span id="cb69-2059"><a href="#cb69-2059" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calculate_ndvi(bands[<span class="st">'nir'</span>], bands[<span class="st">'red'</span>])</span>
<span id="cb69-2060"><a href="#cb69-2060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-2061"><a href="#cb69-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2062"><a href="#cb69-2062" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-2063"><a href="#cb69-2063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2064"><a href="#cb69-2064" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 10: Complete Workflow Example</span></span>
<span id="cb69-2065"><a href="#cb69-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2066"><a href="#cb69-2066" aria-hidden="true" tabindex="-1"></a>Let's put everything together in a realistic scenario.</span>
<span id="cb69-2067"><a href="#cb69-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2068"><a href="#cb69-2068" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scenario: Agricultural Monitoring for Palawan Rice Area</span></span>
<span id="cb69-2069"><a href="#cb69-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2070"><a href="#cb69-2070" aria-hidden="true" tabindex="-1"></a>**Goal:** Map rice cultivation areas in Palawan using Sentinel-2 and prepare training data for ML classification.</span>
<span id="cb69-2071"><a href="#cb69-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2072"><a href="#cb69-2072" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-2073"><a href="#cb69-2073" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-2074"><a href="#cb69-2074" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb69-2075"><a href="#cb69-2075" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb69-2076"><a href="#cb69-2076" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb69-2077"><a href="#cb69-2077" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb69-2078"><a href="#cb69-2078" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb69-2079"><a href="#cb69-2079" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb69-2080"><a href="#cb69-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2081"><a href="#cb69-2081" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2082"><a href="#cb69-2082" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. SETUP</span></span>
<span id="cb69-2083"><a href="#cb69-2083" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2084"><a href="#cb69-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2085"><a href="#cb69-2085" aria-hidden="true" tabindex="-1"></a><span class="co"># Define paths</span></span>
<span id="cb69-2086"><a href="#cb69-2086" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb69-2087"><a href="#cb69-2087" aria-hidden="true" tabindex="-1"></a>palawan_boundary <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/palawan_province.shp'</span></span>
<span id="cb69-2088"><a href="#cb69-2088" aria-hidden="true" tabindex="-1"></a>sentinel2_tile <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/raster/sentinel2_palawan_20240615.tif'</span></span>
<span id="cb69-2089"><a href="#cb69-2089" aria-hidden="true" tabindex="-1"></a>training_areas <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/rice_training_polygons.shp'</span></span>
<span id="cb69-2090"><a href="#cb69-2090" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs/palawan_rice_analysis'</span></span>
<span id="cb69-2091"><a href="#cb69-2091" aria-hidden="true" tabindex="-1"></a>output_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-2092"><a href="#cb69-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2093"><a href="#cb69-2093" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 1: Setup complete ✓"</span>)</span>
<span id="cb69-2094"><a href="#cb69-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2095"><a href="#cb69-2095" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2096"><a href="#cb69-2096" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. LOAD AND INSPECT DATA</span></span>
<span id="cb69-2097"><a href="#cb69-2097" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2098"><a href="#cb69-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2099"><a href="#cb69-2099" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Palawan boundary</span></span>
<span id="cb69-2100"><a href="#cb69-2100" aria-hidden="true" tabindex="-1"></a>palawan <span class="op">=</span> gpd.read_file(palawan_boundary)</span>
<span id="cb69-2101"><a href="#cb69-2101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded Palawan boundary: </span><span class="sc">{</span>palawan<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2102"><a href="#cb69-2102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2103"><a href="#cb69-2103" aria-hidden="true" tabindex="-1"></a><span class="co"># Load training areas</span></span>
<span id="cb69-2104"><a href="#cb69-2104" aria-hidden="true" tabindex="-1"></a>training <span class="op">=</span> gpd.read_file(training_areas)</span>
<span id="cb69-2105"><a href="#cb69-2105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded training areas: </span><span class="sc">{</span><span class="bu">len</span>(training)<span class="sc">}</span><span class="ss"> polygons"</span>)</span>
<span id="cb69-2106"><a href="#cb69-2106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>training[<span class="st">'class_name'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2107"><a href="#cb69-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2108"><a href="#cb69-2108" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect Sentinel-2 metadata</span></span>
<span id="cb69-2109"><a href="#cb69-2109" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb69-2110"><a href="#cb69-2110" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sentinel-2 metadata:"</span>)</span>
<span id="cb69-2111"><a href="#cb69-2111" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">m"</span>)</span>
<span id="cb69-2112"><a href="#cb69-2112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2113"><a href="#cb69-2113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2114"><a href="#cb69-2114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2115"><a href="#cb69-2115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2116"><a href="#cb69-2116" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 2: Data loaded ✓"</span>)</span>
<span id="cb69-2117"><a href="#cb69-2117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2118"><a href="#cb69-2118" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2119"><a href="#cb69-2119" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. CLIP RASTER TO PALAWAN</span></span>
<span id="cb69-2120"><a href="#cb69-2120" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2121"><a href="#cb69-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2122"><a href="#cb69-2122" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb69-2123"><a href="#cb69-2123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match</span></span>
<span id="cb69-2124"><a href="#cb69-2124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palawan.crs <span class="op">!=</span> src.crs:</span>
<span id="cb69-2125"><a href="#cb69-2125" aria-hidden="true" tabindex="-1"></a>        palawan <span class="op">=</span> palawan.to_crs(src.crs)</span>
<span id="cb69-2126"><a href="#cb69-2126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2127"><a href="#cb69-2127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip to Palawan boundary</span></span>
<span id="cb69-2128"><a href="#cb69-2128" aria-hidden="true" tabindex="-1"></a>    clipped, transform <span class="op">=</span> mask(src, palawan.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb69-2129"><a href="#cb69-2129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2130"><a href="#cb69-2130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update metadata</span></span>
<span id="cb69-2131"><a href="#cb69-2131" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb69-2132"><a href="#cb69-2132" aria-hidden="true" tabindex="-1"></a>    out_meta.update({</span>
<span id="cb69-2133"><a href="#cb69-2133" aria-hidden="true" tabindex="-1"></a>        <span class="st">"height"</span>: clipped.shape[<span class="dv">1</span>],</span>
<span id="cb69-2134"><a href="#cb69-2134" aria-hidden="true" tabindex="-1"></a>        <span class="st">"width"</span>: clipped.shape[<span class="dv">2</span>],</span>
<span id="cb69-2135"><a href="#cb69-2135" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transform"</span>: transform</span>
<span id="cb69-2136"><a href="#cb69-2136" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb69-2137"><a href="#cb69-2137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2138"><a href="#cb69-2138" aria-hidden="true" tabindex="-1"></a><span class="co"># Save clipped raster</span></span>
<span id="cb69-2139"><a href="#cb69-2139" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_sentinel2_clipped.tif'</span></span>
<span id="cb69-2140"><a href="#cb69-2140" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dst:</span>
<span id="cb69-2141"><a href="#cb69-2141" aria-hidden="true" tabindex="-1"></a>    dst.write(clipped)</span>
<span id="cb69-2142"><a href="#cb69-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2143"><a href="#cb69-2143" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Step 3: Clipped raster to Palawan ✓"</span>)</span>
<span id="cb69-2144"><a href="#cb69-2144" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size: </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb69-2145"><a href="#cb69-2145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2146"><a href="#cb69-2146" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2147"><a href="#cb69-2147" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. CALCULATE SPECTRAL INDICES</span></span>
<span id="cb69-2148"><a href="#cb69-2148" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2149"><a href="#cb69-2149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2150"><a href="#cb69-2150" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bands</span></span>
<span id="cb69-2151"><a href="#cb69-2151" aria-hidden="true" tabindex="-1"></a>blue <span class="op">=</span> clipped[<span class="dv">0</span>].astype(<span class="bu">float</span>)</span>
<span id="cb69-2152"><a href="#cb69-2152" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> clipped[<span class="dv">1</span>].astype(<span class="bu">float</span>)</span>
<span id="cb69-2153"><a href="#cb69-2153" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> clipped[<span class="dv">2</span>].astype(<span class="bu">float</span>)</span>
<span id="cb69-2154"><a href="#cb69-2154" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span> clipped[<span class="dv">3</span>].astype(<span class="bu">float</span>)</span>
<span id="cb69-2155"><a href="#cb69-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2156"><a href="#cb69-2156" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate indices</span></span>
<span id="cb69-2157"><a href="#cb69-2157" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndvi(nir, red):</span>
<span id="cb69-2158"><a href="#cb69-2158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-2159"><a href="#cb69-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2160"><a href="#cb69-2160" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_evi(nir, red, blue):</span>
<span id="cb69-2161"><a href="#cb69-2161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb69-2162"><a href="#cb69-2162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2163"><a href="#cb69-2163" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndwi(green, nir):</span>
<span id="cb69-2164"><a href="#cb69-2164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb69-2165"><a href="#cb69-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2166"><a href="#cb69-2166" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calc_ndvi(nir, red)</span>
<span id="cb69-2167"><a href="#cb69-2167" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> calc_evi(nir, red, blue)</span>
<span id="cb69-2168"><a href="#cb69-2168" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> calc_ndwi(green, nir)</span>
<span id="cb69-2169"><a href="#cb69-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2170"><a href="#cb69-2170" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 4: Calculated spectral indices ✓"</span>)</span>
<span id="cb69-2171"><a href="#cb69-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2172"><a href="#cb69-2172" aria-hidden="true" tabindex="-1"></a><span class="co"># Save indices</span></span>
<span id="cb69-2173"><a href="#cb69-2173" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> [(<span class="st">'ndvi'</span>, ndvi), (<span class="st">'evi'</span>, evi), (<span class="st">'ndwi'</span>, ndwi)]:</span>
<span id="cb69-2174"><a href="#cb69-2174" aria-hidden="true" tabindex="-1"></a>    index_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb69-2175"><a href="#cb69-2175" aria-hidden="true" tabindex="-1"></a>    index_meta.update(dtype<span class="op">=</span>rasterio.float32, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb69-2176"><a href="#cb69-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2177"><a href="#cb69-2177" aria-hidden="true" tabindex="-1"></a>    index_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="ss">f'palawan_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.tif'</span></span>
<span id="cb69-2178"><a href="#cb69-2178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(index_path, <span class="st">'w'</span>, <span class="op">**</span>index_meta) <span class="im">as</span> dst:</span>
<span id="cb69-2179"><a href="#cb69-2179" aria-hidden="true" tabindex="-1"></a>        dst.write(data.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb69-2180"><a href="#cb69-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2181"><a href="#cb69-2181" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2182"><a href="#cb69-2182" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. IDENTIFY POTENTIAL RICE AREAS</span></span>
<span id="cb69-2183"><a href="#cb69-2183" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2184"><a href="#cb69-2184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2185"><a href="#cb69-2185" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice detection criteria (during growing season):</span></span>
<span id="cb69-2186"><a href="#cb69-2186" aria-hidden="true" tabindex="-1"></a><span class="co"># - Moderate to high NDVI (0.4-0.8) - active vegetation</span></span>
<span id="cb69-2187"><a href="#cb69-2187" aria-hidden="true" tabindex="-1"></a><span class="co"># - Slightly negative NDWI (-0.2 to 0.1) - moist soil but not flooded</span></span>
<span id="cb69-2188"><a href="#cb69-2188" aria-hidden="true" tabindex="-1"></a><span class="co"># - EVI in moderate range (0.3-0.6)</span></span>
<span id="cb69-2189"><a href="#cb69-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2190"><a href="#cb69-2190" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (</span>
<span id="cb69-2191"><a href="#cb69-2191" aria-hidden="true" tabindex="-1"></a>    (ndvi <span class="op">&gt;</span> <span class="fl">0.4</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.8</span>) <span class="op">&amp;</span></span>
<span id="cb69-2192"><a href="#cb69-2192" aria-hidden="true" tabindex="-1"></a>    (ndwi <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.2</span>) <span class="op">&amp;</span> (ndwi <span class="op">&lt;</span> <span class="fl">0.1</span>) <span class="op">&amp;</span></span>
<span id="cb69-2193"><a href="#cb69-2193" aria-hidden="true" tabindex="-1"></a>    (evi <span class="op">&gt;</span> <span class="fl">0.3</span>) <span class="op">&amp;</span> (evi <span class="op">&lt;</span> <span class="fl">0.6</span>)</span>
<span id="cb69-2194"><a href="#cb69-2194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-2195"><a href="#cb69-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2196"><a href="#cb69-2196" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area</span></span>
<span id="cb69-2197"><a href="#cb69-2197" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb69-2198"><a href="#cb69-2198" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb69-2199"><a href="#cb69-2199" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb69-2200"><a href="#cb69-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2201"><a href="#cb69-2201" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 5: Rice area detection ✓"</span>)</span>
<span id="cb69-2202"><a href="#cb69-2202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb69-2203"><a href="#cb69-2203" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of Palawan: </span><span class="sc">{</span>(rice_pixels <span class="op">/</span> rice_mask.size) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb69-2204"><a href="#cb69-2204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2205"><a href="#cb69-2205" aria-hidden="true" tabindex="-1"></a><span class="co"># Save rice mask</span></span>
<span id="cb69-2206"><a href="#cb69-2206" aria-hidden="true" tabindex="-1"></a>rice_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb69-2207"><a href="#cb69-2207" aria-hidden="true" tabindex="-1"></a>rice_meta.update(dtype<span class="op">=</span><span class="st">'uint8'</span>, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb69-2208"><a href="#cb69-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2209"><a href="#cb69-2209" aria-hidden="true" tabindex="-1"></a>rice_mask_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_rice_mask.tif'</span></span>
<span id="cb69-2210"><a href="#cb69-2210" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(rice_mask_path, <span class="st">'w'</span>, <span class="op">**</span>rice_meta) <span class="im">as</span> dst:</span>
<span id="cb69-2211"><a href="#cb69-2211" aria-hidden="true" tabindex="-1"></a>    dst.write(rice_mask.astype(<span class="st">'uint8'</span>), <span class="dv">1</span>)</span>
<span id="cb69-2212"><a href="#cb69-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2213"><a href="#cb69-2213" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2214"><a href="#cb69-2214" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. VISUALIZE RESULTS</span></span>
<span id="cb69-2215"><a href="#cb69-2215" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2216"><a href="#cb69-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2217"><a href="#cb69-2217" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb69-2218"><a href="#cb69-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2219"><a href="#cb69-2219" aria-hidden="true" tabindex="-1"></a><span class="co"># True color composite</span></span>
<span id="cb69-2220"><a href="#cb69-2220" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb69-2221"><a href="#cb69-2221" aria-hidden="true" tabindex="-1"></a>rgb_clip <span class="op">=</span> np.clip(rgb, <span class="dv">0</span>, <span class="fl">0.3</span>) <span class="op">/</span> <span class="fl">0.3</span></span>
<span id="cb69-2222"><a href="#cb69-2222" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].imshow(rgb_clip)</span>
<span id="cb69-2223"><a href="#cb69-2223" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"True Color Composite"</span>)</span>
<span id="cb69-2224"><a href="#cb69-2224" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2225"><a href="#cb69-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2226"><a href="#cb69-2226" aria-hidden="true" tabindex="-1"></a><span class="co"># NDVI</span></span>
<span id="cb69-2227"><a href="#cb69-2227" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>].imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-2228"><a href="#cb69-2228" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"NDVI"</span>)</span>
<span id="cb69-2229"><a href="#cb69-2229" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2230"><a href="#cb69-2230" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im1, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-2231"><a href="#cb69-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2232"><a href="#cb69-2232" aria-hidden="true" tabindex="-1"></a><span class="co"># EVI</span></span>
<span id="cb69-2233"><a href="#cb69-2233" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">2</span>].imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-2234"><a href="#cb69-2234" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">"EVI"</span>)</span>
<span id="cb69-2235"><a href="#cb69-2235" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2236"><a href="#cb69-2236" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im2, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-2237"><a href="#cb69-2237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2238"><a href="#cb69-2238" aria-hidden="true" tabindex="-1"></a><span class="co"># NDWI</span></span>
<span id="cb69-2239"><a href="#cb69-2239" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>].imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-2240"><a href="#cb69-2240" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"NDWI"</span>)</span>
<span id="cb69-2241"><a href="#cb69-2241" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2242"><a href="#cb69-2242" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im3, ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb69-2243"><a href="#cb69-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2244"><a href="#cb69-2244" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask</span></span>
<span id="cb69-2245"><a href="#cb69-2245" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb69-2246"><a href="#cb69-2246" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="ss">f"Potential Rice Areas</span><span class="ch">\n</span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb69-2247"><a href="#cb69-2247" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2248"><a href="#cb69-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2249"><a href="#cb69-2249" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask over true color</span></span>
<span id="cb69-2250"><a href="#cb69-2250" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rgb_clip)</span>
<span id="cb69-2251"><a href="#cb69-2251" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb69-2252"><a href="#cb69-2252" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">"Rice Areas (overlay)"</span>)</span>
<span id="cb69-2253"><a href="#cb69-2253" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb69-2254"><a href="#cb69-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2255"><a href="#cb69-2255" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Palawan Rice Monitoring Analysis"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb69-2256"><a href="#cb69-2256" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-2257"><a href="#cb69-2257" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_dir <span class="op">/</span> <span class="st">'palawan_analysis_results.png'</span>, dpi<span class="op">=</span><span class="dv">150</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb69-2258"><a href="#cb69-2258" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb69-2259"><a href="#cb69-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2260"><a href="#cb69-2260" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2261"><a href="#cb69-2261" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. PREPARE ML TRAINING DATA</span></span>
<span id="cb69-2262"><a href="#cb69-2262" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb69-2263"><a href="#cb69-2263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2264"><a href="#cb69-2264" aria-hidden="true" tabindex="-1"></a><span class="co"># Rasterize training polygons</span></span>
<span id="cb69-2265"><a href="#cb69-2265" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb69-2266"><a href="#cb69-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2267"><a href="#cb69-2267" aria-hidden="true" tabindex="-1"></a>training_reprojected <span class="op">=</span> training.to_crs(out_meta[<span class="st">'crs'</span>])</span>
<span id="cb69-2268"><a href="#cb69-2268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2269"><a href="#cb69-2269" aria-hidden="true" tabindex="-1"></a>training_raster <span class="op">=</span> rasterize(</span>
<span id="cb69-2270"><a href="#cb69-2270" aria-hidden="true" tabindex="-1"></a>    [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_reprojected.geometry, training_reprojected[<span class="st">'class_id'</span>])],</span>
<span id="cb69-2271"><a href="#cb69-2271" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>(out_meta[<span class="st">'height'</span>], out_meta[<span class="st">'width'</span>]),</span>
<span id="cb69-2272"><a href="#cb69-2272" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>out_meta[<span class="st">'transform'</span>],</span>
<span id="cb69-2273"><a href="#cb69-2273" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb69-2274"><a href="#cb69-2274" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb69-2275"><a href="#cb69-2275" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-2276"><a href="#cb69-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2277"><a href="#cb69-2277" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features and labels</span></span>
<span id="cb69-2278"><a href="#cb69-2278" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> np.stack([blue, green, red, nir, ndvi, evi, ndwi], axis<span class="op">=</span><span class="dv">0</span>)  <span class="co"># (7, H, W)</span></span>
<span id="cb69-2279"><a href="#cb69-2279" aria-hidden="true" tabindex="-1"></a>features_2d <span class="op">=</span> features.reshape(features.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, 7)</span></span>
<span id="cb69-2280"><a href="#cb69-2280" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_raster.flatten()</span>
<span id="cb69-2281"><a href="#cb69-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2282"><a href="#cb69-2282" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels</span></span>
<span id="cb69-2283"><a href="#cb69-2283" aria-hidden="true" tabindex="-1"></a>labeled_idx <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb69-2284"><a href="#cb69-2284" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> features_2d[labeled_idx]</span>
<span id="cb69-2285"><a href="#cb69-2285" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_idx]</span>
<span id="cb69-2286"><a href="#cb69-2286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2287"><a href="#cb69-2287" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 7: ML training data prepared ✓"</span>)</span>
<span id="cb69-2288"><a href="#cb69-2288" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features shape: </span><span class="sc">{</span>X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2289"><a href="#cb69-2289" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Labels shape: </span><span class="sc">{</span>y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2290"><a href="#cb69-2290" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Feature names: blue, green, red, nir, ndvi, evi, ndwi"</span>)</span>
<span id="cb69-2291"><a href="#cb69-2291" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2292"><a href="#cb69-2292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2293"><a href="#cb69-2293" aria-hidden="true" tabindex="-1"></a><span class="co"># Save training data</span></span>
<span id="cb69-2294"><a href="#cb69-2294" aria-hidden="true" tabindex="-1"></a>np.savez(</span>
<span id="cb69-2295"><a href="#cb69-2295" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">/</span> <span class="st">'training_data.npz'</span>,</span>
<span id="cb69-2296"><a href="#cb69-2296" aria-hidden="true" tabindex="-1"></a>    features<span class="op">=</span>X,</span>
<span id="cb69-2297"><a href="#cb69-2297" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>y,</span>
<span id="cb69-2298"><a href="#cb69-2298" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>, <span class="st">'ndvi'</span>, <span class="st">'evi'</span>, <span class="st">'ndwi'</span>]</span>
<span id="cb69-2299"><a href="#cb69-2299" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-2300"><a href="#cb69-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2301"><a href="#cb69-2301" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb69-2302"><a href="#cb69-2302" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ANALYSIS COMPLETE!"</span>)</span>
<span id="cb69-2303"><a href="#cb69-2303" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb69-2304"><a href="#cb69-2304" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Outputs saved to: </span><span class="sc">{</span>output_dir<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-2305"><a href="#cb69-2305" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Files created:"</span>)</span>
<span id="cb69-2306"><a href="#cb69-2306" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_sentinel2_clipped.tif"</span>)</span>
<span id="cb69-2307"><a href="#cb69-2307" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_ndvi.tif, palawan_evi.tif, palawan_ndwi.tif"</span>)</span>
<span id="cb69-2308"><a href="#cb69-2308" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_rice_mask.tif"</span>)</span>
<span id="cb69-2309"><a href="#cb69-2309" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_analysis_results.png"</span>)</span>
<span id="cb69-2310"><a href="#cb69-2310" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - training_data.npz (ready for ML in Sessions 5-7!)"</span>)</span>
<span id="cb69-2311"><a href="#cb69-2311" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Next: Use training_data.npz to train Random Forest or CNN classifier"</span>)</span>
<span id="cb69-2312"><a href="#cb69-2312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-2313"><a href="#cb69-2313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2314"><a href="#cb69-2314" aria-hidden="true" tabindex="-1"></a>**What we accomplished:**</span>
<span id="cb69-2315"><a href="#cb69-2315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2316"><a href="#cb69-2316" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>✓ Loaded vector and raster data</span>
<span id="cb69-2317"><a href="#cb69-2317" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>✓ Clipped raster to area of interest</span>
<span id="cb69-2318"><a href="#cb69-2318" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>✓ Calculated multiple spectral indices</span>
<span id="cb69-2319"><a href="#cb69-2319" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>✓ Applied rule-based classification (rice detection)</span>
<span id="cb69-2320"><a href="#cb69-2320" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>✓ Created publication-quality visualizations</span>
<span id="cb69-2321"><a href="#cb69-2321" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>✓ Prepared training data for machine learning</span>
<span id="cb69-2322"><a href="#cb69-2322" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>✓ Saved all outputs for future use</span>
<span id="cb69-2323"><a href="#cb69-2323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2324"><a href="#cb69-2324" aria-hidden="true" tabindex="-1"></a>This workflow demonstrates a complete EO analysis pipeline from raw data to ML-ready datasets!</span>
<span id="cb69-2325"><a href="#cb69-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2326"><a href="#cb69-2326" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-2327"><a href="#cb69-2327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2328"><a href="#cb69-2328" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways</span></span>
<span id="cb69-2329"><a href="#cb69-2329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2330"><a href="#cb69-2330" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb69-2331"><a href="#cb69-2331" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session 3 Summary</span></span>
<span id="cb69-2332"><a href="#cb69-2332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2333"><a href="#cb69-2333" aria-hidden="true" tabindex="-1"></a>**Google Colab:**</span>
<span id="cb69-2334"><a href="#cb69-2334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cloud-based Python environment, no installation needed</span>
<span id="cb69-2335"><a href="#cb69-2335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mount Google Drive for data persistence: <span class="in">`drive.mount('/content/drive')`</span></span>
<span id="cb69-2336"><a href="#cb69-2336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install geospatial libraries: <span class="in">`!pip install geopandas rasterio`</span></span>
<span id="cb69-2337"><a href="#cb69-2337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Free GPU access for ML (Sessions 5-7)</span>
<span id="cb69-2338"><a href="#cb69-2338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2339"><a href="#cb69-2339" aria-hidden="true" tabindex="-1"></a>**GeoPandas (Vector Data):**</span>
<span id="cb69-2340"><a href="#cb69-2340" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read shapefiles/GeoJSON: <span class="in">`gpd.read_file(path)`</span></span>
<span id="cb69-2341"><a href="#cb69-2341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Filter by attributes: <span class="in">`gdf[gdf['column'] == value]`</span></span>
<span id="cb69-2342"><a href="#cb69-2342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Visualize: <span class="in">`gdf.plot(column='field', cmap='Set3')`</span></span>
<span id="cb69-2343"><a href="#cb69-2343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CRS operations: <span class="in">`gdf.crs`</span>, <span class="in">`gdf.to_crs('EPSG:32651')`</span></span>
<span id="cb69-2344"><a href="#cb69-2344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Philippine CRS:** UTM Zone 51N (EPSG:32651) for western Philippines, UTM Zone 52N (EPSG:32652) for eastern Philippines</span>
<span id="cb69-2345"><a href="#cb69-2345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2346"><a href="#cb69-2346" aria-hidden="true" tabindex="-1"></a>**Rasterio (Raster Data):**</span>
<span id="cb69-2347"><a href="#cb69-2347" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Open rasters: <span class="in">`with rasterio.open(path) as src:`</span></span>
<span id="cb69-2348"><a href="#cb69-2348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read bands: <span class="in">`src.read(band_number)`</span> (1-indexed!)</span>
<span id="cb69-2349"><a href="#cb69-2349" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Arrays are NumPy: all array operations work (vectorized!)</span>
<span id="cb69-2350"><a href="#cb69-2350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate indices: <span class="in">`ndvi = (nir - red) / (nir + red + 1e-10)`</span></span>
<span id="cb69-2351"><a href="#cb69-2351" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sentinel-2:** 13 bands at 10m/20m/60m, values 0-10000 (divide by 10000 for reflectance)</span>
<span id="cb69-2352"><a href="#cb69-2352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2353"><a href="#cb69-2353" aria-hidden="true" tabindex="-1"></a>**Combining Vector + Raster:**</span>
<span id="cb69-2354"><a href="#cb69-2354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clip rasters: <span class="in">`rasterio.mask.mask(src, shapes, crop=True)`</span></span>
<span id="cb69-2355"><a href="#cb69-2355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sample at points: <span class="in">`src.sample(coordinates)`</span></span>
<span id="cb69-2356"><a href="#cb69-2356" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Zonal statistics: <span class="in">`rasterstats.zonal_stats(polygons, raster)`</span></span>
<span id="cb69-2357"><a href="#cb69-2357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Always match CRS** before spatial operations!</span>
<span id="cb69-2358"><a href="#cb69-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2359"><a href="#cb69-2359" aria-hidden="true" tabindex="-1"></a>**Preprocessing for ML:**</span>
<span id="cb69-2360"><a href="#cb69-2360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Normalize: <span class="in">`StandardScaler().fit_transform(features)`</span></span>
<span id="cb69-2361"><a href="#cb69-2361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Augment: Rotation, flipping, brightness adjustment</span>
<span id="cb69-2362"><a href="#cb69-2362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multi-temporal: Stack dates for phenology</span>
<span id="cb69-2363"><a href="#cb69-2363" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resample: Match resolutions from different sensors</span>
<span id="cb69-2364"><a href="#cb69-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2365"><a href="#cb69-2365" aria-hidden="true" tabindex="-1"></a>**Python for EO Advantage:**</span>
<span id="cb69-2366"><a href="#cb69-2366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Powers operational systems (DATOS, PRiSM, SkAI-Pinas)</span>
<span id="cb69-2367"><a href="#cb69-2367" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Seamless workflow: data access → preprocessing → ML → visualization</span>
<span id="cb69-2368"><a href="#cb69-2368" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rich ecosystem: GeoPandas, Rasterio, Scikit-learn, TensorFlow</span>
<span id="cb69-2369"><a href="#cb69-2369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You now have the foundation to build your own EO applications!**</span>
<span id="cb69-2370"><a href="#cb69-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2371"><a href="#cb69-2371" aria-hidden="true" tabindex="-1"></a>**Next:** Session 4 will leverage Google Earth Engine to access petabytes of Sentinel data without downloading!</span>
<span id="cb69-2372"><a href="#cb69-2372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-2373"><a href="#cb69-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2374"><a href="#cb69-2374" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-2375"><a href="#cb69-2375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2376"><a href="#cb69-2376" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice Exercises</span></span>
<span id="cb69-2377"><a href="#cb69-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2378"><a href="#cb69-2378" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb69-2379"><a href="#cb69-2379" aria-hidden="true" tabindex="-1"></a><span class="fu">## Try These Challenges</span></span>
<span id="cb69-2380"><a href="#cb69-2380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2381"><a href="#cb69-2381" aria-hidden="true" tabindex="-1"></a>**Exercise 1: Load Your Own Boundary**</span>
<span id="cb69-2382"><a href="#cb69-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2383"><a href="#cb69-2383" aria-hidden="true" tabindex="-1"></a>Download a shapefile of your province or municipality from NAMRIA Geoportal or PhilGIS. Load it with GeoPandas, reproject to UTM 51N, calculate the area in km², and create a 5 km buffer zone.</span>
<span id="cb69-2384"><a href="#cb69-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2385"><a href="#cb69-2385" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-2386"><a href="#cb69-2386" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb69-2387"><a href="#cb69-2387" aria-hidden="true" tabindex="-1"></a>my_boundary <span class="op">=</span> gpd.read_file(<span class="st">'my_province.shp'</span>)</span>
<span id="cb69-2388"><a href="#cb69-2388" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb69-2389"><a href="#cb69-2389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-2390"><a href="#cb69-2390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2391"><a href="#cb69-2391" aria-hidden="true" tabindex="-1"></a>**Exercise 2: Calculate Multiple Indices**</span>
<span id="cb69-2392"><a href="#cb69-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2393"><a href="#cb69-2393" aria-hidden="true" tabindex="-1"></a>Using the provided Sentinel-2 tile, calculate NDVI, EVI, NDWI, and SAVI. Create a 2×2 subplot visualization comparing all indices.</span>
<span id="cb69-2394"><a href="#cb69-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2395"><a href="#cb69-2395" aria-hidden="true" tabindex="-1"></a>**Exercise 3: Multi-temporal NDVI Change**</span>
<span id="cb69-2396"><a href="#cb69-2396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2397"><a href="#cb69-2397" aria-hidden="true" tabindex="-1"></a>If you have two Sentinel-2 images (dry season, wet season), calculate NDVI for both and create a change map showing NDVI difference. Interpret areas of gain (positive change) vs. loss (negative change).</span>
<span id="cb69-2398"><a href="#cb69-2398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2399"><a href="#cb69-2399" aria-hidden="true" tabindex="-1"></a><span class="in">```python</span></span>
<span id="cb69-2400"><a href="#cb69-2400" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint:</span></span>
<span id="cb69-2401"><a href="#cb69-2401" aria-hidden="true" tabindex="-1"></a>ndvi_change <span class="op">=</span> ndvi_wet <span class="op">-</span> ndvi_dry</span>
<span id="cb69-2402"><a href="#cb69-2402" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi_change, cmap<span class="op">=</span><span class="st">'RdBu'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb69-2403"><a href="#cb69-2403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb69-2404"><a href="#cb69-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2405"><a href="#cb69-2405" aria-hidden="true" tabindex="-1"></a>**Exercise 4: Training Sample Creation**</span>
<span id="cb69-2406"><a href="#cb69-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2407"><a href="#cb69-2407" aria-hidden="true" tabindex="-1"></a>Create a small training dataset by:</span>
<span id="cb69-2408"><a href="#cb69-2408" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Digitizing 3-5 polygons for each land cover class (use <span class="in">`gdf = gpd.GeoDataFrame()`</span> manually)</span>
<span id="cb69-2409"><a href="#cb69-2409" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Rasterizing the polygons to match Sentinel-2 grid</span>
<span id="cb69-2410"><a href="#cb69-2410" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Extracting spectral values at labeled pixels</span>
<span id="cb69-2411"><a href="#cb69-2411" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Saving as <span class="in">`training_samples.csv`</span> for ML</span>
<span id="cb69-2412"><a href="#cb69-2412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2413"><a href="#cb69-2413" aria-hidden="true" tabindex="-1"></a>**Exercise 5: Coastal Water Body Detection**</span>
<span id="cb69-2414"><a href="#cb69-2414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2415"><a href="#cb69-2415" aria-hidden="true" tabindex="-1"></a>For a coastal area, use NDWI to detect water bodies. Apply a threshold (e.g., NDWI &gt; 0.3), vectorize the result using <span class="in">`rasterio.features.shapes()`</span>, and save as a shapefile.</span>
<span id="cb69-2416"><a href="#cb69-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2417"><a href="#cb69-2417" aria-hidden="true" tabindex="-1"></a>**Bonus: Build Your Own Function Library**</span>
<span id="cb69-2418"><a href="#cb69-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2419"><a href="#cb69-2419" aria-hidden="true" tabindex="-1"></a>Create a Python module <span class="in">`eo_utils.py`</span> with reusable functions:</span>
<span id="cb69-2420"><a href="#cb69-2420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`calculate_indices(bands_dict)`</span> → returns dict of indices</span>
<span id="cb69-2421"><a href="#cb69-2421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`clip_raster_to_aoi(raster_path, aoi_gdf)`</span> → returns clipped array</span>
<span id="cb69-2422"><a href="#cb69-2422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`visualize_results(rgb, ndvi, mask)`</span> → creates 3-panel figure</span>
<span id="cb69-2423"><a href="#cb69-2423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`prepare_ml_data(raster_path, training_gdf)`</span> → returns X, y arrays</span>
<span id="cb69-2424"><a href="#cb69-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2425"><a href="#cb69-2425" aria-hidden="true" tabindex="-1"></a>Save to your Drive and import in future notebooks!</span>
<span id="cb69-2426"><a href="#cb69-2426" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-2427"><a href="#cb69-2427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2428"><a href="#cb69-2428" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-2429"><a href="#cb69-2429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2430"><a href="#cb69-2430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further Reading</span></span>
<span id="cb69-2431"><a href="#cb69-2431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2432"><a href="#cb69-2432" aria-hidden="true" tabindex="-1"></a><span class="fu">### GeoPandas</span></span>
<span id="cb69-2433"><a href="#cb69-2433" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Official Documentation</span><span class="co">](https://geopandas.org/)</span></span>
<span id="cb69-2434"><a href="#cb69-2434" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">GeoPandas Tutorial (DataCamp)</span><span class="co">](https://www.datacamp.com/tutorial/geopandas-tutorial-geospatial-analysis)</span></span>
<span id="cb69-2435"><a href="#cb69-2435" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">GeoPandas Examples Gallery</span><span class="co">](https://geopandas.org/en/stable/gallery/index.html)</span></span>
<span id="cb69-2436"><a href="#cb69-2436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Working with Projections</span><span class="co">](https://geopandas.org/en/stable/docs/user_guide/projections.html)</span></span>
<span id="cb69-2437"><a href="#cb69-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2438"><a href="#cb69-2438" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rasterio</span></span>
<span id="cb69-2439"><a href="#cb69-2439" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Official Documentation</span><span class="co">](https://rasterio.readthedocs.io/)</span></span>
<span id="cb69-2440"><a href="#cb69-2440" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Rasterio Quickstart</span><span class="co">](https://rasterio.readthedocs.io/en/stable/quickstart.html)</span></span>
<span id="cb69-2441"><a href="#cb69-2441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Python Raster Tutorial (WUR)</span><span class="co">](https://geoscripting-wur.github.io/PythonRaster/)</span></span>
<span id="cb69-2442"><a href="#cb69-2442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Windowed Reading and Writing</span><span class="co">](https://rasterio.readthedocs.io/en/stable/topics/windowed-rw.html)</span></span>
<span id="cb69-2443"><a href="#cb69-2443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2444"><a href="#cb69-2444" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combined Workflows</span></span>
<span id="cb69-2445"><a href="#cb69-2445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Carpentries Geospatial Python</span><span class="co">](https://carpentries-incubator.github.io/geospatial-python/)</span></span>
<span id="cb69-2446"><a href="#cb69-2446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Cropping Rasters with Vector Boundaries</span><span class="co">](https://rasterio.readthedocs.io/en/stable/topics/masking-by-shapefile.html)</span></span>
<span id="cb69-2447"><a href="#cb69-2447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Python for Geospatial Analysis (O'Reilly)</span><span class="co">](https://www.oreilly.com/library/view/python-for-geospatial/9781098104788/)</span></span>
<span id="cb69-2448"><a href="#cb69-2448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2449"><a href="#cb69-2449" aria-hidden="true" tabindex="-1"></a><span class="fu">### Philippine Context</span></span>
<span id="cb69-2450"><a href="#cb69-2450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">NAMRIA Geoportal</span><span class="co">](https://www.namria.gov.ph/)</span></span>
<span id="cb69-2451"><a href="#cb69-2451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">PhilGIS Resources</span><span class="co">](https://philgis.org/)</span></span>
<span id="cb69-2452"><a href="#cb69-2452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">DATOS User Guide</span><span class="co">](https://datos.dost.gov.ph/)</span>  (if publicly available)</span>
<span id="cb69-2453"><a href="#cb69-2453" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">PRiSM Technical Documentation</span><span class="co">](https://prism.philrice.gov.ph/)</span></span>
<span id="cb69-2454"><a href="#cb69-2454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2455"><a href="#cb69-2455" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced Topics</span></span>
<span id="cb69-2456"><a href="#cb69-2456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Xarray for Multi-dimensional Arrays</span><span class="co">](https://docs.xarray.dev/)</span></span>
<span id="cb69-2457"><a href="#cb69-2457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Dask for Parallel Computing</span><span class="co">](https://docs.dask.org/)</span></span>
<span id="cb69-2458"><a href="#cb69-2458" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Cloud-Optimized GeoTIFF Guide</span><span class="co">](https://www.cogeo.org/)</span></span>
<span id="cb69-2459"><a href="#cb69-2459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">TorchGeo for Deep Learning</span><span class="co">](https://torchgeo.readthedocs.io/)</span></span>
<span id="cb69-2460"><a href="#cb69-2460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2461"><a href="#cb69-2461" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb69-2462"><a href="#cb69-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2463"><a href="#cb69-2463" aria-hidden="true" tabindex="-1"></a><span class="fu">## Jupyter Notebook</span></span>
<span id="cb69-2464"><a href="#cb69-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2465"><a href="#cb69-2465" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb69-2466"><a href="#cb69-2466" aria-hidden="true" tabindex="-1"></a><span class="fu">## Access the Interactive Notebook</span></span>
<span id="cb69-2467"><a href="#cb69-2467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2468"><a href="#cb69-2468" aria-hidden="true" tabindex="-1"></a>A complete Jupyter notebook with all code examples from this session is available:</span>
<span id="cb69-2469"><a href="#cb69-2469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2470"><a href="#cb69-2470" aria-hidden="true" tabindex="-1"></a>**[Open Notebook 1: Python Geospatial Data →](../notebooks/notebook1.qmd)**</span>
<span id="cb69-2471"><a href="#cb69-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2472"><a href="#cb69-2472" aria-hidden="true" tabindex="-1"></a>This notebook includes:</span>
<span id="cb69-2473"><a href="#cb69-2473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All code examples ready to run in Google Colab</span>
<span id="cb69-2474"><a href="#cb69-2474" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Additional exercises with progressive difficulty</span>
<span id="cb69-2475"><a href="#cb69-2475" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sample datasets (downloadable links)</span>
<span id="cb69-2476"><a href="#cb69-2476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Detailed comments and explanations</span>
<span id="cb69-2477"><a href="#cb69-2477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Solutions to practice exercises (hidden cells)</span>
<span id="cb69-2478"><a href="#cb69-2478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Links to relevant documentation</span>
<span id="cb69-2479"><a href="#cb69-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2480"><a href="#cb69-2480" aria-hidden="true" tabindex="-1"></a>**To use the notebook:**</span>
<span id="cb69-2481"><a href="#cb69-2481" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Click the link above</span>
<span id="cb69-2482"><a href="#cb69-2482" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Click "Open in Colab" button</span>
<span id="cb69-2483"><a href="#cb69-2483" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Save a copy to your Drive: File → Save a copy in Drive</span>
<span id="cb69-2484"><a href="#cb69-2484" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Mount your Drive and start coding!</span>
<span id="cb69-2485"><a href="#cb69-2485" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb69-2486"><a href="#cb69-2486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2487"><a href="#cb69-2487" aria-hidden="true" tabindex="-1"></a>---</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>CoPhil EO AI/ML Training Programme</p>
</div>   
    <div class="nav-footer-center">
<p>Funded by the European Union - Global Gateway Initiative</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:info@philsa.gov.ph">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://philsa.gov.ph">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>